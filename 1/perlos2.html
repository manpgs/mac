<!DOCTYPE html>
<html lang="en">
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.14 (Pod::Simple 3.42)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>PERLOS2(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">PERLOS2(1)</td>
    <td class="head-vol"><a href=".">Perl Programmers Reference Guide</a></td>
    <td class="head-rtitle">PERLOS2(1)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">perlos2 - Perl under OS/2, DOS, Win0.3*, Win0.95 and WinNT.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<p class="Pp">One can read this document in the following formats:</p>
<p class="Pp"></p>
<pre>        man perlos2
        view perl perlos2
        explorer perlos2.html
        info perlos2
</pre>
<p class="Pp">to list some (not all may be available simultaneously), or it may
    be read <i>as is</i>: either as <i>README.os2</i>, or
    <i>pod/perlos2.pod</i>.</p>
<p class="Pp">To read the <i>.INF</i> version of documentation (<b>very</b>
    recommended) outside of OS/2, one needs an IBM's reader (may be available on
    IBM ftp sites (?) (URL anyone?)) or shipped with PC DOS 7.0 and IBM's Visual
    Age C++ 3.5.</p>
<p class="Pp">A copy of a Win* viewer is contained in the &quot;Just add OS/2
    Warp&quot; package</p>
<p class="Pp"></p>
<pre>  ftp://ftp.software.ibm.com/ps/products/os2/tools/jaow/jaow.zip
</pre>
<p class="Pp">in <i>?:\JUST_ADD\view.exe</i>. This gives one an access to EMX's
    <i>.INF</i> docs as well (text form is available in <i>/emx/doc</i> in EMX's
    distribution). There is also a different viewer named xview.</p>
<p class="Pp">Note that if you have <i>lynx.exe</i> or <i>netscape.exe</i>
    installed, you can follow WWW links from this document in <i>.INF</i>
    format. If you have EMX docs installed correctly, you can follow library
    links (you need to have <span class="Li">&quot;view emxbook&quot;</span>
    working by setting <span class="Li">&quot;EMXBOOK&quot;</span> environment
    variable as it is described in EMX docs).</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<section class="Ss">
<h2 class="Ss" id="Target"><a class="permalink" href="#Target">Target</a></h2>
<p class="Pp">The target is to make OS/2 one of the best supported platform for
    using/building/developing Perl and <i>Perl applications</i>, as well as make
    Perl the best language to use under OS/2. The secondary target is to try to
    make this work under DOS and Win* as well (but not <b>too</b> hard).</p>
<p class="Pp">The current state is quite close to this target. Known
    limitations:</p>
<ul class="Bl-bullet">
  <li>Some *nix programs use <b>fork()</b> a lot; with the mostly useful flavors
      of perl for OS/2 (there are several built simultaneously) this is
      supported; but some flavors do not support this (e.g., when Perl is called
      from inside REXX). Using <b>fork()</b> after <i>use</i>ing dynamically
      loading extensions would not work with <i>very</i> old versions of
    EMX.</li>
  <li>You need a separate perl executable <i>perl__.exe</i> (see
      &quot;perl__.exe&quot;) if you want to use PM code in your application (as
      Perl/Tk or OpenGL Perl modules do) without having a text-mode window
      present.
    <p class="Pp">While using the standard <i>perl.exe</i> from a text-mode
        window is possible too, I have seen cases when this causes degradation
        of the system stability. Using <i>perl__.exe</i> avoids such a
        degradation.</p>
  </li>
  <li>There is no simple way to access WPS objects. The only way I know is via
      <span class="Li">&quot;OS2::REXX&quot;</span> and
      <span class="Li">&quot;SOM&quot;</span> extensions (see OS2::REXX, SOM).
      However, we do not have access to convenience methods of Object-REXX. (Is
      it possible at all? I know of no Object-REXX API.) The
      <span class="Li">&quot;SOM&quot;</span> extension (currently in
      alpha-text) may eventually remove this shortcoming; however, due to the
      fact that DII is not supported by the
      <span class="Li">&quot;SOM&quot;</span> module, using
      <span class="Li">&quot;SOM&quot;</span> is not as convenient as one would
      like it.</li>
</ul>
<p class="Pp">Please keep this list up-to-date by informing me about other
    items.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Other_OSes"><a class="permalink" href="#Other_OSes">Other
  OSes</a></h2>
<p class="Pp">Since OS/2 port of perl uses a remarkable EMX environment, it can
    run (and build extensions, and - possibly - be built itself) under any
    environment which can run EMX. The current list is DOS, DOS-inside-OS/2,
    Win0.3*, Win0.95 and WinNT. Out of many perl flavors, only one works, see
    &quot;<i>perl_.exe</i>&quot;.</p>
<p class="Pp">Note that not all features of Perl are available under these
    environments. This depends on the features the <i>extender</i> - most
    probably RSX - decided to implement.</p>
<p class="Pp">Cf. &quot;Prerequisites&quot;.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Prerequisites"><a class="permalink" href="#Prerequisites">Prerequisites</a></h2>
<dl class="Bl-tag">
  <dt id="EMX"><a class="permalink" href="#EMX">EMX</a></dt>
  <dd>EMX runtime is required (may be substituted by RSX). Note that it is
      possible to make <i>perl_.exe</i> to run under DOS without any external
      support by binding <i>emx.exe</i>/<i>rsx.exe</i> to it, see
      <span class="Li">&quot;emxbind&quot;</span>. Note that under DOS for best
      results one should use RSX runtime, which has much more functions working
      (like <span class="Li">&quot;fork&quot;</span>,
      <span class="Li">&quot;popen&quot;</span> and so on). In fact RSX is
      required if there is no VCPI present. Note the RSX requires DPMI. Many
      implementations of DPMI are known to be very buggy, beware!
    <p class="Pp">Only the latest runtime is supported, currently
        <span class="Li">&quot;0.9d fix 03&quot;</span>. Perl may run under
        earlier versions of EMX, but this is not tested.</p>
    <p class="Pp">One can get different parts of EMX from, say</p>
    <p class="Pp"></p>
    <pre>  ftp://crydee.sai.msu.ru/pub/comp/os/os2/leo/gnu/emx+gcc/
  http://hobbes.nmsu.edu/h-browse.php?dir=/pub/os2/dev/emx/v0.9d/
    </pre>
    <p class="Pp">The runtime component should have the name
      <i>emxrt.zip</i>.</p>
    <p class="Pp"><b>NOTE</b>. When using <i>emx.exe</i>/<i>rsx.exe</i>, it is
        enough to have them on your path. One does not need to specify them
        explicitly (though this</p>
    <p class="Pp"></p>
    <pre>  emx perl_.exe -de 0
    </pre>
    <p class="Pp">will work as well.)</p>
  </dd>
  <dt id="RSX"><a class="permalink" href="#RSX">RSX</a></dt>
  <dd>To run Perl on DPMI platforms one needs RSX runtime. This is needed under
      DOS-inside-OS/2, Win0.3*, Win0.95 and WinNT (see &quot;Other OSes&quot;).
      RSX would not work with VCPI only, as EMX would, it requires DMPI.
    <p class="Pp">Having RSX and the latest <i>sh.exe</i> one gets a fully
        functional <b>*nix</b>-ish environment under DOS, say,
        <span class="Li">&quot;fork&quot;</span>,
        <span class="Li">&quot;``&quot;</span> and
        pipe-<span class="Li">&quot;open&quot;</span> work. In fact, MakeMaker
        works (for static build), so one can have Perl development environment
        under DOS.</p>
    <p class="Pp">One can get RSX from, say</p>
    <p class="Pp"></p>
    <pre>  http://cd.textfiles.com/hobbesos29804/disk1/EMX09C/
  ftp://crydee.sai.msu.ru/pub/comp/os/os2/leo/gnu/emx+gcc/contrib/
    </pre>
    <p class="Pp">Contact the author on
        <span class="Li">&quot;rainer@mathematik.uni-bielefeld.de&quot;</span>.</p>
    <p class="Pp">The latest <i>sh.exe</i> with DOS hooks is available in</p>
    <p class="Pp"></p>
    <pre>  http://www.ilyaz.org/software/os2/
    </pre>
    <p class="Pp">as <i>sh_dos.zip</i> or under similar names starting with
        <span class="Li">&quot;sh&quot;</span>,
        <span class="Li">&quot;pdksh&quot;</span> etc.</p>
  </dd>
  <dt id="HPFS"><a class="permalink" href="#HPFS">HPFS</a></dt>
  <dd>Perl does not care about file systems, but the perl library contains many
      files with long names, so to install it intact one needs a file system
      which supports long file names.
    <p class="Pp">Note that if you do not plan to build the perl itself, it may
        be possible to fool EMX to truncate file names. This is not supported,
        read EMX docs to see how to do it.</p>
  </dd>
  <dt id="pdksh"><a class="permalink" href="#pdksh">pdksh</a></dt>
  <dd>To start external programs with complicated command lines (like with pipes
      in between, and/or quoting of arguments), Perl uses an external shell.
      With EMX port such shell should be named <i>sh.exe</i>, and located either
      in the wired-in-during-compile locations (usually <i>F:/bin</i>), or in
      configurable location (see
      &quot;<span class="Li">&quot;PERL_SH_DIR&quot;</span>&quot;).
    <p class="Pp">For best results use EMX pdksh. The standard binary (5.2.14 or
        later) runs under DOS (with &quot;RSX&quot;) as well, see</p>
    <p class="Pp"></p>
    <pre>  http://www.ilyaz.org/software/os2/
    </pre>
  </dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="Starting_Perl_programs_under_"><a class="permalink" href="#Starting_Perl_programs_under_">Starting
  Perl programs under OS/2 (and DOS and...)</a></h2>
<p class="Pp">Start your Perl program <i>foo.pl</i> with arguments
    <span class="Li">&quot;arg1 arg2 arg3&quot;</span> the same way as on any
    other platform, by</p>
<p class="Pp"></p>
<pre>        perl foo.pl arg1 arg2 arg3
</pre>
<p class="Pp">If you want to specify perl options
    <span class="Li">&quot;-my_opts&quot;</span> to the perl itself (as opposed
    to your program), use</p>
<p class="Pp"></p>
<pre>        perl -my_opts foo.pl arg1 arg2 arg3
</pre>
<p class="Pp">Alternately, if you use OS/2-ish shell, like CMD or 4os2, put the
    following at the start of your perl script:</p>
<p class="Pp"></p>
<pre>        extproc perl -S -my_opts
</pre>
<p class="Pp">rename your program to <i>foo.cmd</i>, and start it by typing</p>
<p class="Pp"></p>
<pre>        foo arg1 arg2 arg3
</pre>
<p class="Pp">Note that because of stupid OS/2 limitations the full path of the
    perl script is not available when you use
    <span class="Li">&quot;extproc&quot;</span>, thus you are forced to use
    <span class="Li">&quot;-S&quot;</span> perl switch, and your script should
    be on the <span class="Li">&quot;PATH&quot;</span>. As a plus side, if you
    know a full path to your script, you may still start it with</p>
<p class="Pp"></p>
<pre>        perl ../../blah/foo.cmd arg1 arg2 arg3
</pre>
<p class="Pp">(note that the argument
    <span class="Li">&quot;-my_opts&quot;</span> is taken care of by the
    <span class="Li">&quot;extproc&quot;</span> line in your script, see
    <span class="Li">&quot;&quot;extproc&quot; on the first
  line&quot;</span>).</p>
<p class="Pp">To understand what the above <i>magic</i> does, read perl docs
    about <span class="Li">&quot;-S&quot;</span> switch - see perlrun, and
    cmdref about <span class="Li">&quot;extproc&quot;</span>:</p>
<p class="Pp"></p>
<pre>        view perl perlrun
        man perlrun
        view cmdref extproc
        help extproc
</pre>
<p class="Pp">or whatever method you prefer.</p>
<p class="Pp">There are also endless possibilities to use <i>executable
    extensions</i> of 4os2, <i>associations</i> of WPS and so on... However, if
    you use *nixish shell (like <i>sh.exe</i> supplied in the binary
    distribution), you need to follow the syntax specified in &quot;Command
    Switches&quot; in perlrun.</p>
<p class="Pp">Note that <b>-S</b> switch supports scripts with additional
    extensions <i>.cmd</i>, <i>.btm</i>, <i>.bat</i>, <i>.pl</i> as well.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Starting_"><a class="permalink" href="#Starting_">Starting
  OS/2 (and DOS) programs under Perl</a></h2>
<p class="Pp">This is what <b>system()</b> (see &quot;system&quot; in perlfunc),
    <span class="Li">&quot;``&quot;</span> (see &quot;I/O Operators&quot; in
    perlop), and <i>open pipe</i> (see &quot;open&quot; in perlfunc) are for.
    (Avoid <b>exec()</b> (see &quot;exec&quot; in perlfunc) unless you know what
    you do).</p>
<p class="Pp">Note however that to use some of these operators you need to have
    a sh-syntax shell installed (see &quot;Pdksh&quot;, &quot;Frequently asked
    questions&quot;), and perl should be able to find it (see
    &quot;<span class="Li">&quot;PERL_SH_DIR&quot;</span>&quot;).</p>
<p class="Pp">The cases when the shell is used are:</p>
<dl class="Bl-tag">
  <dt>1.</dt>
  <dd>One-argument <b>system()</b> (see &quot;system&quot; in perlfunc),
      <b>exec()</b> (see &quot;exec&quot; in perlfunc) with redirection or shell
      meta-characters;</dd>
  <dt>2.</dt>
  <dd>Pipe-open (see &quot;open&quot; in perlfunc) with the command which
      contains redirection or shell meta-characters;</dd>
  <dt>3.</dt>
  <dd>Backticks <span class="Li">&quot;``&quot;</span> (see &quot;I/O
      Operators&quot; in perlop) with the command which contains redirection or
      shell meta-characters;</dd>
  <dt>4.</dt>
  <dd>If the executable called by
      <b>system()</b>/<b>exec()</b>/pipe-<b>open()</b>/<span class="Li">&quot;``&quot;</span>
      is a script with the &quot;magic&quot;
      <span class="Li">&quot;#!&quot;</span> line or
      <span class="Li">&quot;extproc&quot;</span> line which specifies
    shell;</dd>
  <dt>5.</dt>
  <dd>If the executable called by
      <b>system()</b>/<b>exec()</b>/pipe-<b>open()</b>/<span class="Li">&quot;``&quot;</span>
      is a script without &quot;magic&quot; line, and
      <span class="Li">$ENV{EXECSHELL}</span> is set to shell;</dd>
  <dt>6.</dt>
  <dd>If the executable called by
      <b>system()</b>/<b>exec()</b>/pipe-<b>open()</b>/<span class="Li">&quot;``&quot;</span>
      is not found (is not this remark obsolete?);</dd>
  <dt>7.</dt>
  <dd>For globbing (see &quot;glob&quot; in perlfunc, &quot;I/O Operators&quot;
      in perlop) (obsolete? Perl uses builtin globbing nowadays...).</dd>
</dl>
<p class="Pp">For the sake of speed for a common case, in the above algorithms
    backslashes in the command name are not considered as shell
  metacharacters.</p>
<p class="Pp">Perl starts scripts which begin with cookies
    <span class="Li">&quot;extproc&quot;</span> or
    <span class="Li">&quot;#!&quot;</span> directly, without an intervention of
    shell. Perl uses the same algorithm to find the executable as <i>pdksh</i>:
    if the path on <span class="Li">&quot;#!&quot;</span> line does not work,
    and contains <span class="Li">&quot;/&quot;</span>, then the directory part
    of the executable is ignored, and the executable is searched in <i>.</i> and
    on <span class="Li">&quot;PATH&quot;</span>. To find arguments for these
    scripts Perl uses a different algorithm than <i>pdksh</i>: up to 3 arguments
    are recognized, and trailing whitespace is stripped.</p>
<p class="Pp">If a script does not contain such a cooky, then to avoid calling
    <i>sh.exe</i>, Perl uses the same algorithm as <i>pdksh</i>: if
    <span class="Li">$ENV{EXECSHELL}</span> is set, the script is given as the
    first argument to this command, if not set, then
    <span class="Li">&quot;$ENV{COMSPEC} /c&quot;</span> is used (or a hardwired
    guess if <span class="Li">$ENV{COMSPEC}</span> is not set).</p>
<p class="Pp">When starting scripts directly, Perl uses exactly the same
    algorithm as for the search of script given by <b>-S</b> command-line
    option: it will look in the current directory, then on components of
    <span class="Li">$ENV{PATH}</span> using the following order of appended
    extensions: no extension, <i>.cmd</i>, <i>.btm</i>, <i>.bat</i>,
  <i>.pl</i>.</p>
<p class="Pp">Note that Perl will start to look for scripts only if OS/2 cannot
    start the specified application, thus <span class="Li">&quot;system
    'blah'&quot;</span> will not look for a script if there is an executable
    file <i>blah.exe</i> <i>anywhere</i> on
    <span class="Li">&quot;PATH&quot;</span>. In other words,
    <span class="Li">&quot;PATH&quot;</span> is essentially searched twice: once
    by the OS for an executable, then by Perl for scripts.</p>
<p class="Pp">Note also that executable files on OS/2 can have an arbitrary
    extension, but <i>.exe</i> will be automatically appended if no dot is
    present in the name. The workaround is as simple as that: since <i>blah.</i>
    and <i>blah</i> denote the same file (at list on FAT and HPFS file systems),
    to start an executable residing in file <i>n:/bin/blah</i> (no extension)
    give an argument <span class="Li">&quot;n:/bin/blah.&quot;</span> (dot
    appended) to <b>system()</b>.</p>
<p class="Pp">Perl will start PM programs from VIO (=text-mode) Perl process in
    a separate PM session; the opposite is not true: when you start a non-PM
    program from a PM Perl process, Perl would not run it in a separate session.
    If a separate session is desired, either ensure that shell will be used, as
    in <span class="Li">&quot;system 'cmd /c myprog'&quot;</span>, or start it
    using optional arguments to <b>system()</b> documented in
    <span class="Li">&quot;OS2::Process&quot;</span> module. This is considered
    to be a feature.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="Frequently_asked_questions"><a class="permalink" href="#Frequently_asked_questions">Frequently
  asked questions</a></h1>
<section class="Ss">
<h2 class="Ss" id="_It_does_not_work_"><a class="permalink" href="#_It_does_not_work_">&quot;It
  does not work&quot;</a></h2>
<p class="Pp">Perl binary distributions come with a <i>testperl.cmd</i> script
    which tries to detect common problems with misconfigured installations.
    There is a pretty large chance it will discover which step of the
    installation you managed to goof.
  <span class="Li">&quot;;-)&quot;</span></p>
</section>
<section class="Ss">
<h2 class="Ss" id="I_cannot_run_external_programs"><a class="permalink" href="#I_cannot_run_external_programs">I
  cannot run external programs</a></h2>
<ul class="Bl-bullet">
  <li>Did you run your programs with <span class="Li">&quot;-w&quot;</span>
      switch? See &quot;Starting OS/2 (and DOS) programs under Perl&quot;.</li>
  <li>Do you try to run <i>internal</i> shell commands, like
      <span class="Li">&quot;`copy a b`&quot;</span> (internal for
      <i>cmd.exe</i>), or <span class="Li">&quot;`glob a*b`&quot;</span>
      (internal for ksh)? You need to specify your shell explicitly, like
      <span class="Li">&quot;`cmd /c copy a b`&quot;</span>, since Perl cannot
      deduce which commands are internal to your shell.</li>
</ul>
</section>
<section class="Ss">
<h2 class="Ss" id="I_cannot_embed_perl_into_my_program,_or_use_"><a class="permalink" href="#I_cannot_embed_perl_into_my_program,_or_use_">I
  cannot embed perl into my program, or use <i>perl.dll</i> from my
  program.</a></h2>
<dl class="Bl-tag">
  <dt id="Is"><a class="permalink" href="#Is">Is your program EMX-compiled with
    &quot;-Zmt -Zcrtdll&quot;?</a></dt>
  <dd>Well, nowadays Perl DLL should be usable from a differently compiled
      program too... If you can run Perl code from REXX scripts (see OS2::REXX),
      then there are some other aspect of interaction which are overlooked by
      the current hackish code to support differently-compiled principal
      programs.
    <p class="Pp">If everything else fails, you need to build a stand-alone DLL
        for perl. Contact me, I did it once. Sockets would not work, as a lot of
        other stuff.</p>
  </dd>
  <dt id="Did"><a class="permalink" href="#Did">Did you use
    ExtUtils::Embed?</a></dt>
  <dd>Some time ago I had reports it does not work. Nowadays it is checked in
      the Perl test suite, so grep <i>./t</i> subdirectory of the build tree (as
      well as <i>*.t</i> files in the <i>./lib</i> subdirectory) to find how it
      should be done &quot;correctly&quot;.</dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="_"><a class="permalink" href="#_">&quot;``&quot; and
  pipe-&quot;open&quot; do not work under DOS.</a></h2>
<p class="Pp">This may a variant of just &quot;I cannot run external
    programs&quot;, or a deeper problem. Basically: you <i>need</i> RSX (see
    &quot;Prerequisites&quot;) for these commands to work, and you may need a
    port of <i>sh.exe</i> which understands command arguments. One of such ports
    is listed in &quot;Prerequisites&quot; under RSX. Do not forget to set
    variable &quot;<span class="Li">&quot;PERL_SH_DIR&quot;</span>&quot; as
    well.</p>
<p class="Pp">DPMI is required for RSX.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Cannot_start__find.exe__pattern__file_"><a class="permalink" href="#Cannot_start__find.exe__pattern__file_">Cannot
  start &quot;find.exe &quot;pattern&quot; file&quot;</a></h2>
<p class="Pp">The whole idea of the &quot;standard C API to start
    applications&quot; is that the forms <span class="Li">&quot;foo&quot;</span>
    and <span class="Li">&quot;foo&quot;</span> of program arguments are
    completely interchangeable. <i>find</i> breaks this paradigm;</p>
<p class="Pp"></p>
<pre>  find &quot;pattern&quot; file
  find pattern file
</pre>
<p class="Pp">are not equivalent; <i>find</i> cannot be started directly using
    the above API. One needs a way to surround the doublequotes in some other
    quoting construction, necessarily having an extra non-Unixish shell in
    between.</p>
<p class="Pp">Use one of</p>
<p class="Pp"></p>
<pre>  system 'cmd', '/c', 'find &quot;pattern&quot; file';
  `cmd /c 'find &quot;pattern&quot; file'`
</pre>
<p class="Pp">This would start <i>find.exe</i> via <i>cmd.exe</i> via
    <span class="Li">&quot;sh.exe&quot;</span> via
    <span class="Li">&quot;perl.exe&quot;</span>, but this is a price to pay if
    you want to use non-conforming program.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="INSTALLATION"><a class="permalink" href="#INSTALLATION">INSTALLATION</a></h1>
<section class="Ss">
<h2 class="Ss" id="Automatic_binary_installation"><a class="permalink" href="#Automatic_binary_installation">Automatic
  binary installation</a></h2>
<p class="Pp">The most convenient way of installing a binary distribution of
    perl is via perl installer <i>install.exe</i>. Just follow the instructions,
    and 99% of the installation blues would go away.</p>
<p class="Pp">Note however, that you need to have <i>unzip.exe</i> on your path,
    and EMX environment <i>running</i>. The latter means that if you just
    installed EMX, and made all the needed changes to <i>Config.sys</i>, you may
    need to reboot in between. Check EMX runtime by running</p>
<p class="Pp"></p>
<pre>        emxrev
</pre>
<p class="Pp">Binary installer also creates a folder on your desktop with some
    useful objects. If you need to change some aspects of the work of the binary
    installer, feel free to edit the file <i>Perl.pkg</i>. This may be useful
    e.g., if you need to run the installer many times and do not want to make
    many interactive changes in the GUI.</p>
<p class="Pp"><b>Things not taken care of by automatic binary
  installation:</b></p>
<dl class="Bl-tag">
  <dt>&quot;PERL_BADLANG&quot;</dt>
  <dd>may be needed if you change your codepage <i>after</i> perl installation,
      and the new value is not supported by EMX. See
      &quot;<span class="Li">&quot;PERL_BADLANG&quot;</span>&quot;.</dd>
  <dt>&quot;PERL_BADFREE&quot;</dt>
  <dd>see &quot;<span class="Li">&quot;PERL_BADFREE&quot;</span>&quot;.</dd>
  <dt id="Config.pm"><a class="permalink" href="#Config.pm"><i>Config.pm</i></a></dt>
  <dd>This file resides somewhere deep in the location you installed your perl
      library, find it out by
    <p class="Pp"></p>
    <pre>  perl -MConfig -le &quot;print $INC{'Config.pm'}&quot;
    </pre>
    <p class="Pp">While most important values in this file <i>are</i> updated by
        the binary installer, some of them may need to be hand-edited. I know no
        such data, please keep me informed if you find one. Moreover, manual
        changes to the installed version may need to be accompanied by an edit
        of this file.</p>
  </dd>
</dl>
<p class="Pp"><b>NOTE</b>. Because of a typo the binary installer of 5.00305
    would install a variable <span class="Li">&quot;PERL_SHPATH&quot;</span>
    into <i>Config.sys</i>. Please remove this variable and put
    <span class="Li">&quot;PERL_SH_DIR&quot;</span> instead.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Manual_binary_installation"><a class="permalink" href="#Manual_binary_installation">Manual
  binary installation</a></h2>
<p class="Pp">As of version 5.00305, OS/2 perl binary distribution comes split
    into 11 components. Unfortunately, to enable configurable binary
    installation, the file paths in the zip files are not absolute, but relative
    to some directory.</p>
<p class="Pp">Note that the extraction with the stored paths is still necessary
    (default with unzip, specify <span class="Li">&quot;-d&quot;</span> to
    pkunzip). However, you need to know where to extract the files. You need
    also to manually change entries in <i>Config.sys</i> to reflect where did
    you put the files. Note that if you have some primitive unzipper (like
    <span class="Li">&quot;pkunzip&quot;</span>), you may get a lot of
    warnings/errors during unzipping. Upgrade to
    <span class="Li">&quot;(w)unzip&quot;</span>.</p>
<p class="Pp">Below is the sample of what to do to reproduce the configuration
    on my machine. In <i>VIEW.EXE</i> you can press
    <span class="Li">&quot;Ctrl-Insert&quot;</span> now, and cut-and-paste from
    the resulting file - created in the directory you started <i>VIEW.EXE</i>
    from.</p>
<p class="Pp">For each component, we mention environment variables related to
    each installation directory. Either choose directories to match your values
    of the variables, or create/append-to variables to take into account the
    directories.</p>
<dl class="Bl-tag">
  <dt id="Perl"><a class="permalink" href="#Perl">Perl VIO and PM executables
    (dynamically linked)</a></dt>
  <dd>
    <pre>  unzip perl_exc.zip *.exe *.ico -d f:/emx.add/bin
  unzip perl_exc.zip *.dll -d f:/emx.add/dll
    </pre>
    <p class="Pp">(have the directories with
        <span class="Li">&quot;*.exe&quot;</span> on PATH, and
        <span class="Li">&quot;*.dll&quot;</span> on LIBPATH);</p>
  </dd>
  <dt id="Perl_"><a class="permalink" href="#Perl_">Perl_ VIO executable
    (statically linked)</a></dt>
  <dd>
    <pre>  unzip perl_aou.zip -d f:/emx.add/bin
    </pre>
    <p class="Pp">(have the directory on PATH);</p>
  </dd>
  <dt id="Executables"><a class="permalink" href="#Executables">Executables for
    Perl utilities</a></dt>
  <dd>
    <pre>  unzip perl_utl.zip -d f:/emx.add/bin
    </pre>
    <p class="Pp">(have the directory on PATH);</p>
  </dd>
  <dt id="Main"><a class="permalink" href="#Main">Main Perl library</a></dt>
  <dd>
    <pre>  unzip perl_mlb.zip -d f:/perllib/lib
    </pre>
    <p class="Pp">If this directory is exactly the same as the prefix which was
        compiled into <i>perl.exe</i>, you do not need to change anything.
        However, for perl to find the library if you use a different path, you
        need to <span class="Li">&quot;set PERLLIB_PREFIX&quot;</span> in
        <i>Config.sys</i>, see
        &quot;<span class="Li">&quot;PERLLIB_PREFIX&quot;</span>&quot;.</p>
  </dd>
  <dt id="Additional"><a class="permalink" href="#Additional">Additional Perl
    modules</a></dt>
  <dd>
    <pre>  unzip perl_ste.zip -d f:/perllib/lib/site_perl/5.34.1/
    </pre>
    <p class="Pp">Same remark as above applies. Additionally, if this directory
        is not one of directories on <span class="Li">@INC</span> (and
        <span class="Li">@INC</span> is influenced by
        <span class="Li">&quot;PERLLIB_PREFIX&quot;</span>), you need to put
        this directory and subdirectory <i>./os2</i> in
        <span class="Li">&quot;PERLLIB&quot;</span> or
        <span class="Li">&quot;PERL5LIB&quot;</span> variable. Do not use
        <span class="Li">&quot;PERL5LIB&quot;</span> unless you have it set
        already. See &quot;ENVIRONMENT&quot; in perl.</p>
    <p class="Pp"><b>[Check whether this extraction directory is still
        applicable with</b> <b>the new directory structure layout!]</b></p>
  </dd>
  <dt id="Tools"><a class="permalink" href="#Tools">Tools to compile Perl
    modules</a></dt>
  <dd>
    <pre>  unzip perl_blb.zip -d f:/perllib/lib
    </pre>
    <p class="Pp">Same remark as for <i>perl_ste.zip</i>.</p>
  </dd>
  <dt>Manpages for Perl and utilities</dt>
  <dd>
    <pre>  unzip perl_man.zip -d f:/perllib/man
    </pre>
    <p class="Pp">This directory should better be on
        <span class="Li">&quot;MANPATH&quot;</span>. You need to have a working
        <i>man</i> to access these files.</p>
  </dd>
  <dt>Manpages for Perl modules</dt>
  <dd>
    <pre>  unzip perl_mam.zip -d f:/perllib/man
    </pre>
    <p class="Pp">This directory should better be on
        <span class="Li">&quot;MANPATH&quot;</span>. You need to have a working
        man to access these files.</p>
  </dd>
  <dt id="Source"><a class="permalink" href="#Source">Source for Perl
    documentation</a></dt>
  <dd>
    <pre>  unzip perl_pod.zip -d f:/perllib/lib
    </pre>
    <p class="Pp">This is used by the
        <span class="Li">&quot;perldoc&quot;</span> program (see perldoc), and
        may be used to generate HTML documentation usable by WWW browsers, and
        documentation in zillions of other formats:
        <span class="Li">&quot;info&quot;</span>,
        <span class="Li">&quot;LaTeX&quot;</span>,
        <span class="Li">&quot;Acrobat&quot;</span>,
        <span class="Li">&quot;FrameMaker&quot;</span> and so on. [Use programs
        such as <i>pod2latex</i> etc.]</p>
  </dd>
  <dt id="Perl~2"><a class="permalink" href="#Perl~2">Perl manual in <i>.INF</i>
    format</a></dt>
  <dd>
    <pre>  unzip perl_inf.zip -d d:/os2/book
    </pre>
    <p class="Pp">This directory should better be on
        <span class="Li">&quot;BOOKSHELF&quot;</span>.</p>
  </dd>
  <dt id="Pdksh"><a class="permalink" href="#Pdksh">Pdksh</a></dt>
  <dd>
    <pre>  unzip perl_sh.zip -d f:/bin
    </pre>
    <p class="Pp">This is used by perl to run external commands which explicitly
        require shell, like the commands using <i>redirection</i> and
        <i>shell</i> <i>metacharacters</i>. It is also used instead of explicit
        <i>/bin/sh</i>.</p>
    <p class="Pp">Set <span class="Li">&quot;PERL_SH_DIR&quot;</span> (see
        &quot;<span class="Li">&quot;PERL_SH_DIR&quot;</span>&quot;) if you move
        <i>sh.exe</i> from the above location.</p>
    <p class="Pp"><b>Note.</b> It may be possible to use some other
        sh-compatible shell (untested).</p>
  </dd>
</dl>
<p class="Pp">After you installed the components you needed and updated the
    <i>Config.sys</i> correspondingly, you need to hand-edit <i>Config.pm</i>.
    This file resides somewhere deep in the location you installed your perl
    library, find it out by</p>
<p class="Pp"></p>
<pre>  perl -MConfig -le &quot;print $INC{'Config.pm'}&quot;
</pre>
<p class="Pp">You need to correct all the entries which look like file paths
    (they currently start with <span class="Li">&quot;f:/&quot;</span>).</p>
</section>
<section class="Ss">
<h2 class="Ss"><b>Warning</b></h2>
<p class="Pp">The automatic and manual perl installation leave precompiled paths
    inside perl executables. While these paths are overwritable (see
    &quot;<span class="Li">&quot;PERLLIB_PREFIX&quot;</span>&quot;,
    &quot;<span class="Li">&quot;PERL_SH_DIR&quot;</span>&quot;), some people
    may prefer binary editing of paths inside the executables/DLLs.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="Accessing_documentation"><a class="permalink" href="#Accessing_documentation">Accessing
  documentation</a></h1>
<p class="Pp">Depending on how you built/installed perl you may have (otherwise
    identical) Perl documentation in the following formats:</p>
<section class="Ss">
<h2 class="Ss">OS/2 <i>.INF</i> file</h2>
<p class="Pp">Most probably the most convenient form. Under OS/2 view it as</p>
<p class="Pp"></p>
<pre>  view perl
  view perl perlfunc
  view perl less
  view perl ExtUtils::MakeMaker
</pre>
<p class="Pp">(currently the last two may hit a wrong location, but this may
    improve soon). Under Win* see &quot;SYNOPSIS&quot;.</p>
<p class="Pp">If you want to build the docs yourself, and have <i>OS/2
    toolkit</i>, run</p>
<p class="Pp"></p>
<pre>        pod2ipf &gt; perl.ipf
</pre>
<p class="Pp">in <i>/perllib/lib/pod</i> directory, then</p>
<p class="Pp"></p>
<pre>        ipfc /inf perl.ipf
</pre>
<p class="Pp">(Expect a lot of errors during the both steps.) Now move it on
    your BOOKSHELF path.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Plain_text"><a class="permalink" href="#Plain_text">Plain
  text</a></h2>
<p class="Pp">If you have perl documentation in the source form, perl utilities
    installed, and GNU groff installed, you may use</p>
<p class="Pp"></p>
<pre>        perldoc perlfunc
        perldoc less
        perldoc ExtUtils::MakeMaker
</pre>
<p class="Pp">to access the perl documentation in the text form (note that you
    may get better results using perl manpages).</p>
<p class="Pp">Alternately, try running pod2text on <i>.pod</i> files.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Manpages"><a class="permalink" href="#Manpages">Manpages</a></h2>
<p class="Pp">If you have <i>man</i> installed on your system, and you installed
    perl manpages, use something like this:</p>
<p class="Pp"></p>
<pre>        man perlfunc
        man 3 less
        man ExtUtils.MakeMaker
</pre>
<p class="Pp">to access documentation for different components of Perl. Start
    with</p>
<p class="Pp"></p>
<pre>        man perl
</pre>
<p class="Pp">Note that dot (<i>.</i>) is used as a package separator for
    documentation for packages, and as usual, sometimes you need to give the
    section - <span class="Li">3</span> above - to avoid shadowing by the
    <i></i><b><i>less</i></b><i>(1) manpage</i>.</p>
<p class="Pp">Make sure that the directory <b>above</b> the directory with
    manpages is on our <span class="Li">&quot;MANPATH&quot;</span>, like
  this</p>
<p class="Pp"></p>
<pre>  set MANPATH=c:/man;f:/perllib/man
</pre>
<p class="Pp">for Perl manpages in
    <span class="Li">&quot;f:/perllib/man/man1/&quot;</span> etc.</p>
</section>
<section class="Ss">
<h2 class="Ss">HTML</h2>
<p class="Pp">If you have some WWW browser available, installed the Perl
    documentation in the source form, and Perl utilities, you can build HTML
    docs. Cd to directory with <i>.pod</i> files, and do like this</p>
<p class="Pp"></p>
<pre>        cd f:/perllib/lib/pod
        pod2html
</pre>
<p class="Pp">After this you can direct your browser the file <i>perl.html</i>
    in this directory, and go ahead with reading docs, like this:</p>
<p class="Pp"></p>
<pre>        explore file:///f:/perllib/lib/pod/perl.html
</pre>
<p class="Pp">Alternatively you may be able to get these docs prebuilt from
    CPAN.</p>
</section>
<section class="Ss">
<h2 class="Ss">GNU &quot;info&quot; files</h2>
<p class="Pp">Users of Emacs would appreciate it very much, especially with
    <span class="Li">&quot;CPerl&quot;</span> mode loaded. You need to get
    latest <span class="Li">&quot;pod2texi&quot;</span> from
    <span class="Li">&quot;CPAN&quot;</span>, or, alternately, the prebuilt info
    pages.</p>
</section>
<section class="Ss">
<h2 class="Ss"><i>PDF</i> files</h2>
<p class="Pp">for <span class="Li">&quot;Acrobat&quot;</span> are available on
    CPAN (may be for slightly older version of perl).</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_LaTeX__docs"><a class="permalink" href="#_LaTeX__docs">&quot;LaTeX&quot;
  docs</a></h2>
<p class="Pp">can be constructed using
    <span class="Li">&quot;pod2latex&quot;</span>.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="BUILD"><a class="permalink" href="#BUILD">BUILD</a></h1>
<p class="Pp">Here we discuss how to build Perl under OS/2.</p>
<section class="Ss">
<h2 class="Ss" id="The_short_story"><a class="permalink" href="#The_short_story">The
  short story</a></h2>
<p class="Pp">Assume that you are a seasoned porter, so are sure that all the
    necessary tools are already present on your system, and you know how to get
    the Perl source distribution. Untar it, change to the extract directory,
  and</p>
<p class="Pp"></p>
<pre>  gnupatch -p0 &lt; os2\diff.configure
  sh Configure -des -D prefix=f:/perllib
  make
  make test
  make install
  make aout_test
  make aout_install
</pre>
<p class="Pp">This puts the executables in f:/perllib/bin. Manually move them to
    the <span class="Li">&quot;PATH&quot;</span>, manually move the built
    <i>perl*.dll</i> to <span class="Li">&quot;LIBPATH&quot;</span> (here for
    Perl DLL <i>*</i> is a not-very-meaningful hex checksum), and run</p>
<p class="Pp"></p>
<pre>  make installcmd INSTALLCMDDIR=d:/ir/on/path
</pre>
<p class="Pp">Assuming that the <span class="Li">&quot;man&quot;</span>-files
    were put on an appropriate location, this completes the installation of
    minimal Perl system. (The binary distribution contains also a lot of
    additional modules, and the documentation in INF format.)</p>
<p class="Pp">What follows is a detailed guide through these steps.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Prerequisites~2"><a class="permalink" href="#Prerequisites~2">Prerequisites</a></h2>
<p class="Pp">You need to have the latest EMX development environment, the full
    GNU tool suite (gawk renamed to awk, and GNU <i>find.exe</i> earlier on path
    than the OS/2 <i>find.exe</i>, same with <i>sort.exe</i>, to check use</p>
<p class="Pp"></p>
<pre>  find --version
  sort --version
</pre>
<p class="Pp">). You need the latest version of <i>pdksh</i> installed as
    <i>sh.exe</i>.</p>
<p class="Pp">Check that you have <b>BSD</b> libraries and headers installed,
    and - optionally - Berkeley DB headers and libraries, and crypt.</p>
<p class="Pp">Possible locations to get the files:</p>
<p class="Pp"></p>
<pre>  ftp://ftp.uni-heidelberg.de/pub/os2/unix/
  http://hobbes.nmsu.edu/h-browse.php?dir=/pub/os2
  http://cd.textfiles.com/hobbesos29804/disk1/DEV32/
  http://cd.textfiles.com/hobbesos29804/disk1/EMX09C/
</pre>
<p class="Pp">It is reported that the following archives contain enough utils to
    build perl: <i>gnufutil.zip</i>, <i>gnusutil.zip</i>, <i>gnututil.zip</i>,
    <i>gnused.zip</i>, <i>gnupatch.zip</i>, <i>gnuawk.zip</i>,
    <i>gnumake.zip</i>, <i>gnugrep.zip</i>, <i>bsddev.zip</i> and
    <i>ksh527rt.zip</i> (or a later version). Note that all these utilities are
    known to be available from LEO:</p>
<p class="Pp"></p>
<pre>  ftp://crydee.sai.msu.ru/pub/comp/os/os2/leo/gnu/
</pre>
<p class="Pp">Note also that the <i>db.lib</i> and <i>db.a</i> from the EMX
    distribution are not suitable for multi-threaded compile (even
    single-threaded flavor of Perl uses multi-threaded C RTL, for compatibility
    with XFree86-OS/2). Get a corrected one from</p>
<p class="Pp"></p>
<pre>  http://www.ilyaz.org/software/os2/db_mt.zip
</pre>
<p class="Pp">If you have <i>exactly the same version of Perl</i> installed
    already, make sure that no copies or perl are currently running. Later steps
    of the build may fail since an older version of <i>perl.dll</i> loaded into
    memory may be found. Running <span class="Li">&quot;make test&quot;</span>
    becomes meaningless, since the test are checking a previous build of perl
    (this situation is detected and reported by <i>os2/os2_base.t</i> test). Do
    not forget to unset <span class="Li">&quot;PERL_EMXLOAD_SEC&quot;</span> in
    environment.</p>
<p class="Pp">Also make sure that you have <i>/tmp</i> directory on the current
    drive, and <i>.</i> directory in your
    <span class="Li">&quot;LIBPATH&quot;</span>. One may try to correct the
    latter condition by</p>
<p class="Pp"></p>
<pre>  set BEGINLIBPATH .\.
</pre>
<p class="Pp">if you use something like <i>CMD.EXE</i> or latest versions of
    <i>4os2.exe</i>. (Setting BEGINLIBPATH to just
    <span class="Li">&quot;.&quot;</span> is ignored by the OS/2 kernel.)</p>
<p class="Pp">Make sure your gcc is good for
    <span class="Li">&quot;-Zomf&quot;</span> linking: run
    <span class="Li">&quot;omflibs&quot;</span> script in <i>/emx/lib</i>
    directory.</p>
<p class="Pp">Check that you have link386 installed. It comes standard with
    OS/2, but may be not installed due to customization. If typing</p>
<p class="Pp"></p>
<pre>  link386
</pre>
<p class="Pp">shows you do not have it, do <i>Selective install</i>, and choose
    <span class="Li">&quot;Link</span> <span class="Li">object
    modules&quot;</span> in <i>Optional system utilities/More</i>. If you get
    into link386 prompts, press <span class="Li">&quot;Ctrl-C&quot;</span> to
    exit.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Getting_perl_source"><a class="permalink" href="#Getting_perl_source">Getting
  perl source</a></h2>
<p class="Pp">You need to fetch the latest perl source (including developers
    releases). With some probability it is located in</p>
<p class="Pp"></p>
<pre>  http://www.cpan.org/src/
  http://www.cpan.org/src/unsupported
</pre>
<p class="Pp">If not, you may need to dig in the indices to find it in the
    directory of the current maintainer.</p>
<p class="Pp">Quick cycle of developers release may break the OS/2 build time to
    time, looking into</p>
<p class="Pp"></p>
<pre>  http://www.cpan.org/ports/os2/
</pre>
<p class="Pp">may indicate the latest release which was publicly released by the
    maintainer. Note that the release may include some additional patches to
    apply to the current source of perl.</p>
<p class="Pp">Extract it like this</p>
<p class="Pp"></p>
<pre>  tar vzxf perl5.00409.tar.gz
</pre>
<p class="Pp">You may see a message about errors while extracting
    <i>Configure</i>. This is because there is a conflict with a similarly-named
    file <i>configure</i>.</p>
<p class="Pp">Change to the directory of extraction.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Application_of_the_patches"><a class="permalink" href="#Application_of_the_patches">Application
  of the patches</a></h2>
<p class="Pp">You need to apply the patches in <i>./os2/diff.*</i> like
  this:</p>
<p class="Pp"></p>
<pre>  gnupatch -p0 &lt; os2\diff.configure
</pre>
<p class="Pp">You may also need to apply the patches supplied with the binary
    distribution of perl. It also makes sense to look on the perl5-porters
    mailing list for the latest OS/2-related patches (see
    &lt;http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/&gt;). Such
    patches usually contain strings <span class="Li">&quot;/os2/&quot;</span>
    and <span class="Li">&quot;patch&quot;</span>, so it makes sense looking for
    these strings.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Hand-editing"><a class="permalink" href="#Hand-editing">Hand-editing</a></h2>
<p class="Pp">You may look into the file <i>./hints/os2.sh</i> and correct
    anything wrong you find there. I do not expect it is needed anywhere.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Making"><a class="permalink" href="#Making">Making</a></h2>
<pre>  sh Configure -des -D prefix=f:/perllib
</pre>
<p class="Pp"><span class="Li">&quot;prefix&quot;</span> means: where to install
    the resulting perl library. Giving correct prefix you may avoid the need to
    specify <span class="Li">&quot;PERLLIB_PREFIX&quot;</span>, see
    &quot;<span class="Li">&quot;PERLLIB_PREFIX&quot;</span>&quot;.</p>
<p class="Pp"><i>Ignore the message about missing
    </i><span class="Li"><i>&quot;ln&quot;</i></span><i>, and about
    </i><span class="Li"><i>&quot;-c&quot;</i></span><i> option to</i>
    <i>tr</i>. The latter is most probably already fixed, if you see it and can
    trace where the latter spurious warning comes from, please inform me.</p>
<p class="Pp">Now</p>
<p class="Pp"></p>
<pre>  make
</pre>
<p class="Pp">At some moment the built may die, reporting a <i>version
    mismatch</i> or <i>unable to run </i><i>perl</i><i></i>. This means that you
    do not have <i>.</i> in your LIBPATH, so <i>perl.exe</i> cannot find the
    needed <i>perl67B2.dll</i> (treat these hex digits as line noise). After
    this is fixed the build should finish without a lot of fuss.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Testing"><a class="permalink" href="#Testing">Testing</a></h2>
<p class="Pp">Now run</p>
<p class="Pp"></p>
<pre>  make test
</pre>
<p class="Pp">All tests should succeed (with some of them skipped). If you have
    the same version of Perl installed, it is crucial that you have
    <span class="Li">&quot;.&quot;</span> early in your LIBPATH (or in
    BEGINLIBPATH), otherwise your tests will most probably test the wrong
    version of Perl.</p>
<p class="Pp">Some tests may generate extra messages similar to</p>
<dl class="Bl-tag">
  <dt id="A"><a class="permalink" href="#A">A lot of &quot;bad
    free&quot;</a></dt>
  <dd>in database tests related to Berkeley DB. <i>This should be fixed
      already.</i> If it persists, you may disable this warnings, see
      &quot;<span class="Li">&quot;PERL_BADFREE&quot;</span>&quot;.</dd>
  <dt id="Process"><a class="permalink" href="#Process">Process terminated by
    SIGTERM/SIGINT</a></dt>
  <dd>This is a standard message issued by OS/2 applications. *nix applications
      die in silence. It is considered to be a feature. One can easily disable
      this by appropriate sighandlers.
    <p class="Pp">However the test engine bleeds these message to screen in
        unexpected moments. Two messages of this kind <i>should</i> be present
        during testing.</p>
  </dd>
</dl>
<p class="Pp">To get finer test reports, call</p>
<p class="Pp"></p>
<pre>  perl t/harness
</pre>
<p class="Pp">The report with <i>io/pipe.t</i> failing may look like this:</p>
<p class="Pp"></p>
<pre> Failed Test  Status Wstat Total Fail  Failed  List of failed
 ------------------------------------------------------------
 io/pipe.t                    12    1   8.33%  9
 7 tests skipped, plus 56 subtests skipped.
 Failed 1/195 test scripts, 99.49% okay. 1/6542 subtests failed,
    99.98% okay.
</pre>
<p class="Pp">The reasons for most important skipped tests are:</p>
<dl class="Bl-tag">
  <dt id="op/fs.t"><a class="permalink" href="#op/fs.t"><i>op/fs.t</i></a></dt>
  <dd></dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>18</dt>
  <dd>Checks <span class="Li">&quot;atime&quot;</span> and
      <span class="Li">&quot;mtime&quot;</span> of
      <span class="Li">&quot;stat()&quot;</span> - unfortunately, HPFS provides
      only 2sec time granularity (for compatibility with FAT?).</dd>
  <dt>25</dt>
  <dd>Checks <span class="Li">&quot;truncate()&quot;</span> on a filehandle just
      opened for write - I do not know why this should or should not work.</dd>
</dl>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt id="op/stat.t"><a class="permalink" href="#op/stat.t"><i>op/stat.t</i></a></dt>
  <dd>Checks <span class="Li">&quot;stat()&quot;</span>. Tests:</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>4</dt>
  <dd>Checks <span class="Li">&quot;atime&quot;</span> and
      <span class="Li">&quot;mtime&quot;</span> of
      <span class="Li">&quot;stat()&quot;</span> - unfortunately, HPFS provides
      only 2sec time granularity (for compatibility with FAT?).</dd>
</dl>
</div>
<div class="Bd-indent"></div>
</section>
<section class="Ss">
<h2 class="Ss" id="Installing_the_built_perl"><a class="permalink" href="#Installing_the_built_perl">Installing
  the built perl</a></h2>
<p class="Pp">If you haven't yet moved
    <span class="Li">&quot;perl*.dll&quot;</span> onto LIBPATH, do it now.</p>
<p class="Pp">Run</p>
<p class="Pp"></p>
<pre>  make install
</pre>
<p class="Pp">It would put the generated files into needed locations. Manually
    put <i>perl.exe</i>, <i>perl__.exe</i> and <i>perl___.exe</i> to a location
    on your PATH, <i>perl.dll</i> to a location on your LIBPATH.</p>
<p class="Pp">Run</p>
<p class="Pp"></p>
<pre>  make installcmd INSTALLCMDDIR=d:/ir/on/path
</pre>
<p class="Pp">to convert perl utilities to <i>.cmd</i> files and put them on
    PATH. You need to put <i>.EXE</i>-utilities on path manually. They are
    installed in <span class="Li">&quot;$prefix/bin&quot;</span>, here
    <span class="Li">$prefix</span> is what you gave to <i>Configure</i>, see
    &quot;Making&quot;.</p>
<p class="Pp">If you use <span class="Li">&quot;man&quot;</span>, either move
    the installed <i>*/man/</i> directories to your
    <span class="Li">&quot;MANPATH&quot;</span>, or modify
    <span class="Li">&quot;MANPATH&quot;</span> to match the location. (One
    could have avoided this by providing a correct
    <span class="Li">&quot;manpath&quot;</span> option to <i>./Configure</i>, or
    editing <i>./config.sh</i> between configuring and making steps.)</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_a.out_"><a class="permalink" href="#_a.out_">&quot;a.out&quot;-style
  build</a></h2>
<p class="Pp">Proceed as above, but make <i>perl_.exe</i> (see
    &quot;<i>perl_.exe</i>&quot;) by</p>
<p class="Pp"></p>
<pre>  make perl_
</pre>
<p class="Pp">test and install by</p>
<p class="Pp"></p>
<pre>  make aout_test
  make aout_install
</pre>
<p class="Pp">Manually put <i>perl_.exe</i> to a location on your PATH.</p>
<p class="Pp"><b>Note.</b> The build process for
    <span class="Li">&quot;perl_&quot;</span> <i>does not know</i> about all the
    dependencies, so you should make sure that anything is up-to-date, say, by
    doing</p>
<p class="Pp"></p>
<pre>  make perl_dll
</pre>
<p class="Pp">first.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="Building_a_binary_distribution"><a class="permalink" href="#Building_a_binary_distribution">Building
  a binary distribution</a></h1>
<p class="Pp">[This section provides a short overview only...]</p>
<p class="Pp">Building should proceed differently depending on whether the
    version of perl you install is already present and used on your system, or
    is a new version not yet used. The description below assumes that the
    version is new, so installing its DLLs and <i>.pm</i> files will not disrupt
    the operation of your system even if some intermediate steps are not yet
    fully working.</p>
<p class="Pp">The other cases require a little bit more convoluted procedures.
    Below I suppose that the current version of Perl is
    <span class="Li">5.8.2</span>, so the executables are named accordingly.</p>
<dl class="Bl-tag">
  <dt>1.</dt>
  <dd>Fully build and test the Perl distribution. Make sure that no tests are
      failing with <span class="Li">&quot;test&quot;</span> and
      <span class="Li">&quot;aout_test&quot;</span> targets; fix the bugs in
      Perl and the Perl test suite detected by these tests. Make sure that
      <span class="Li">&quot;all_test&quot;</span> make target runs as clean as
      possible. Check that <i>os2/perlrexx.cmd</i> runs fine.</dd>
  <dt>2.</dt>
  <dd>Fully install Perl, including
      <span class="Li">&quot;installcmd&quot;</span> target. Copy the generated
      DLLs to <span class="Li">&quot;LIBPATH&quot;</span>; copy the numbered
      Perl executables (as in <i>perl5.8.2.exe</i>) to
      <span class="Li">&quot;PATH&quot;</span>; copy
      <span class="Li">&quot;perl_.exe&quot;</span> to
      <span class="Li">&quot;PATH&quot;</span> as
      <span class="Li">&quot;perl_5.8.2.exe&quot;</span>. Think whether you need
      backward-compatibility DLLs. In most cases you do not need to install them
      yet; but sometime this may simplify the following steps.</dd>
  <dt>3.</dt>
  <dd>Make sure that <span class="Li">&quot;CPAN.pm&quot;</span> can download
      files from CPAN. If not, you may need to manually install
      <span class="Li">&quot;Net::FTP&quot;</span>.</dd>
  <dt>4.</dt>
  <dd>Install the bundle <span class="Li">&quot;Bundle::OS2_default&quot;</span>
    <p class="Pp"></p>
    <pre> perl5.8.2 -MCPAN -e &quot;install Bundle::OS2_default&quot; &lt; nul |&amp; tee 00cpan_i_1
    </pre>
    <p class="Pp">This may take a couple of hours on 1GHz processor (when run
        the first time). And this should not be necessarily a smooth procedure.
        Some modules may not specify required dependencies, so one may need to
        repeat this procedure several times until the results stabilize.</p>
    <p class="Pp"></p>
    <pre> perl5.8.2 -MCPAN -e &quot;install Bundle::OS2_default&quot; &lt; nul |&amp; tee 00cpan_i_2
 perl5.8.2 -MCPAN -e &quot;install Bundle::OS2_default&quot; &lt; nul |&amp; tee 00cpan_i_3
    </pre>
    <p class="Pp">Even after they stabilize, some tests may fail.</p>
    <p class="Pp">Fix as many discovered bugs as possible. Document all the bugs
        which are not fixed, and all the failures with unknown reasons. Inspect
        the produced logs <i>00cpan_i_1</i> to find suspiciously skipped tests,
        and other fishy events.</p>
    <p class="Pp">Keep in mind that <i>installation</i> of some modules may fail
        too: for example, the DLLs to update may be already loaded by
        <i>CPAN.pm</i>. Inspect the <span class="Li">&quot;install&quot;</span>
        logs (in the example above <i>00cpan_i_1</i> etc) for errors, and
        install things manually, as in</p>
    <p class="Pp"></p>
    <pre>  cd $CPANHOME/.cpan/build/Digest-MD5-2.31
  make install
    </pre>
    <p class="Pp">Some distributions may fail some tests, but you may want to
        install them anyway (as above, or via <span class="Li">&quot;force
        install&quot;</span> command of
        <span class="Li">&quot;CPAN.pm&quot;</span> shell-mode).</p>
    <p class="Pp">Since this procedure may take quite a long time to complete,
        it makes sense to &quot;freeze&quot; your CPAN configuration by
        disabling periodic updates of the local copy of CPAN index: set
        <span class="Li">&quot;index_expire&quot;</span> to some big value (I
        use 365), then save the settings</p>
    <p class="Pp"></p>
    <pre>  CPAN&gt; o conf index_expire 365
  CPAN&gt; o conf commit
    </pre>
    <p class="Pp">Reset back to the default value <span class="Li">1</span> when
        you are finished.</p>
  </dd>
  <dt>5.</dt>
  <dd>When satisfied with the results, rerun the
      <span class="Li">&quot;installcmd&quot;</span> target. Now you can copy
      <span class="Li">&quot;perl5.8.2.exe&quot;</span> to
      <span class="Li">&quot;perl.exe&quot;</span>, and install the other
      OMF-build executables: <span class="Li">&quot;perl__.exe&quot;</span> etc.
      They are ready to be used.</dd>
  <dt>6.</dt>
  <dd>Change to the <span class="Li">&quot;./pod&quot;</span> directory of the
      build tree, download the Perl logo <i>CamelGrayBig.BMP</i>, and run
    <p class="Pp"></p>
    <pre>  ( perl2ipf &gt; perl.ipf ) |&amp; tee 00ipf
  ipfc /INF perl.ipf |&amp; tee 00inf
    </pre>
    <p class="Pp">This produces the Perl docs online book
        <span class="Li">&quot;perl.INF&quot;</span>. Install in on
        <span class="Li">&quot;BOOKSHELF&quot;</span> path.</p>
  </dd>
  <dt>7.</dt>
  <dd>Now is the time to build statically linked executable <i>perl_.exe</i>
      which includes newly-installed via
      <span class="Li">&quot;Bundle::OS2_default&quot;</span> modules. Doing
      testing via <span class="Li">&quot;CPAN.pm&quot;</span> is going to be
      painfully slow, since it statically links a new executable per XS
      extension.
    <p class="Pp">Here is a possible workaround: create a toplevel
        <i>Makefile.PL</i> in
        <i></i><span class="Li"><i>$CPANHOME</i></span><i>/.cpan/build/</i> with
        contents being (compare with &quot;Making executables with a custom
        collection of statically loaded extensions&quot;)</p>
    <p class="Pp"></p>
    <pre>  use ExtUtils::MakeMaker;
  WriteMakefile NAME =&gt; 'dummy';
    </pre>
    <p class="Pp">execute this as</p>
    <p class="Pp"></p>
    <pre>  perl_5.8.2.exe Makefile.PL &lt;nul |&amp; tee 00aout_c1
  make -k all test &lt;nul |&amp; 00aout_t1
    </pre>
    <p class="Pp">Again, this procedure should not be absolutely smooth. Some
        <span class="Li">&quot;Makefile.PL&quot;</span>'s in subdirectories may
        be buggy, and would not run as &quot;child&quot; scripts. The
        interdependency of modules can strike you; however, since non-XS modules
        are already installed, the prerequisites of most modules have a very
        good chance to be present.</p>
    <p class="Pp">If you discover some glitches, move directories of problematic
        modules to a different location; if these modules are non-XS modules,
        you may just ignore them - they are already installed; the remaining,
        XS, modules you need to install manually one by one.</p>
    <p class="Pp">After each such removal you need to rerun the
        <span class="Li">&quot;Makefile.PL&quot;</span>/<span class="Li">&quot;make&quot;</span>
        process; usually this procedure converges soon. (But be sure to convert
        all the necessary external C libraries from <i>.lib</i> format to
        <i>.a</i> format: run one of</p>
    <p class="Pp"></p>
    <pre>  emxaout foo.lib
  emximp -o foo.a foo.lib
    </pre>
    <p class="Pp">whichever is appropriate.) Also, make sure that the DLLs for
        external libraries are usable with executables compiled without
        <span class="Li">&quot;-Zmtd&quot;</span> options.</p>
    <p class="Pp">When you are sure that only a few subdirectories lead to
        failures, you may want to add <span class="Li">&quot;-j4&quot;</span>
        option to <span class="Li">&quot;make&quot;</span> to speed up skipping
        subdirectories with already finished build.</p>
    <p class="Pp">When you are satisfied with the results of tests, install the
        build C libraries for extensions:</p>
    <p class="Pp"></p>
    <pre>  make install |&amp; tee 00aout_i
    </pre>
    <p class="Pp">Now you can rename the file <i>./perl.exe</i> generated during
        the last phase to <i>perl_5.8.2.exe</i>; place it on
        <span class="Li">&quot;PATH&quot;</span>; if there is an
        inter-dependency between some XS modules, you may need to repeat the
        <span class="Li">&quot;test&quot;</span>/<span class="Li">&quot;install&quot;</span>
        loop with this new executable and some excluded modules - until the
        procedure converges.</p>
    <p class="Pp">Now you have all the necessary <i>.a</i> libraries for these
        Perl modules in the places where Perl builder can find it. Use the perl
        builder: change to an empty directory, create a &quot;dummy&quot;
        <i>Makefile.PL</i> again, and run</p>
    <p class="Pp"></p>
    <pre>  perl_5.8.2.exe Makefile.PL |&amp; tee 00c
  make perl                  |&amp; tee 00p
    </pre>
    <p class="Pp">This should create an executable <i>./perl.exe</i> with all
        the statically loaded extensions built in. Compare the generated
        <i>perlmain.c</i> files to make sure that during the iterations the
        number of loaded extensions only increases. Rename <i>./perl.exe</i> to
        <i>perl_5.8.2.exe</i> on <span class="Li">&quot;PATH&quot;</span>.</p>
    <p class="Pp">When it converges, you got a functional variant of
        <i>perl_5.8.2.exe</i>; copy it to
        <span class="Li">&quot;perl_.exe&quot;</span>. You are done with
        generation of the local Perl installation.</p>
  </dd>
  <dt>8.</dt>
  <dd>Make sure that the installed modules are actually installed in the
      location of the new Perl, and are not inherited from entries of
      <span class="Li">@INC</span> given for inheritance from the older versions
      of Perl: set <span class="Li">&quot;PERLLIB_582_PREFIX&quot;</span> to
      redirect the new version of Perl to a new location, and copy the installed
      files to this new location. Redo the tests to make sure that the versions
      of modules inherited from older versions of Perl are not needed.
    <p class="Pp">Actually, the log output of <b>pod2ipf</b>(1) during the step
        6 gives a very detailed info about which modules are loaded from which
        place; so you may use it as an additional verification tool.</p>
    <p class="Pp">Check that some temporary files did not make into the perl
        install tree. Run something like this</p>
    <p class="Pp"></p>
    <pre>  pfind . -f &quot;!(/\.(pm|pl|ix|al|h|a|lib|txt|pod|imp|bs|dll|ld|bs|inc|xbm|yml|cgi|uu|e2x|skip|packlist|eg|cfg|html|pub|enc|all|ini|po|pot)$/i or /^\w+$/&quot;) | less
    </pre>
    <p class="Pp">in the install tree (both top one and <i>sitelib</i> one).</p>
    <p class="Pp">Compress all the DLLs with <i>lxlite</i>. The tiny <i>.exe</i>
        can be compressed with <span class="Li">&quot;/c:max&quot;</span> (the
        bug only appears when there is a fixup in the last 6 bytes of a page
        (?); since the tiny executables are much smaller than a page, the bug
        will not hit). Do not compress
        <span class="Li">&quot;perl_.exe&quot;</span> - it would not work under
        DOS.</p>
  </dd>
  <dt>9.</dt>
  <dd>Now you can generate the binary distribution. This is done by running the
      test of the CPAN distribution
      <span class="Li">&quot;OS2::SoftInstaller&quot;</span>. Tune up the file
      <i>test.pl</i> to suit the layout of current version of Perl first. Do not
      forget to pack the necessary external DLLs accordingly. Include the
      description of the bugs and test suite failures you could not fix. Include
      the small-stack versions of Perl executables from Perl build directory.
    <p class="Pp">Include <i>perl5.def</i> so that people can relink the perl
        DLL preserving the binary compatibility, or can create compatibility
        DLLs. Include the diff files (<span class="Li">&quot;diff -pu old
        new&quot;</span>) of fixes you did so that people can rebuild your
        version. Include <i>perl5.map</i> so that one can use remote
      debugging.</p>
  </dd>
  <dt>10.</dt>
  <dd>Share what you did with the other people. Relax. Enjoy fruits of your
      work.</dd>
  <dt>11.</dt>
  <dd>Brace yourself for thanks, bug reports, hate mail and spam coming as
      result of the previous step. No good deed should remain unpunished!</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="Building_custom_"><a class="permalink" href="#Building_custom_">Building
  custom <i>.EXE</i> files</a></h1>
<p class="Pp">The Perl executables can be easily rebuilt at any moment.
    Moreover, one can use the <i>embedding</i> interface (see perlembed) to make
    very customized executables.</p>
<section class="Ss">
<h2 class="Ss" id="Making_executables_with_a_custom_collection_of_statically_loaded_extensions"><a class="permalink" href="#Making_executables_with_a_custom_collection_of_statically_loaded_extensions">Making
  executables with a custom collection of statically loaded extensions</a></h2>
<p class="Pp">It is a little bit easier to do so while <i>decreasing</i> the
    list of statically loaded extensions. We discuss this case only here.</p>
<dl class="Bl-tag">
  <dt>1.</dt>
  <dd>Change to an empty directory, and create a placeholder
      &lt;Makefile.PL&gt;:
    <p class="Pp"></p>
    <pre>  use ExtUtils::MakeMaker;
  WriteMakefile NAME =&gt; 'dummy';
    </pre>
  </dd>
  <dt>2.</dt>
  <dd>Run it with the flavor of Perl (<i>perl.exe</i> or <i>perl_.exe</i>) you
      want to rebuild.
    <p class="Pp"></p>
    <pre>  perl_ Makefile.PL
    </pre>
  </dd>
  <dt>3.</dt>
  <dd>Ask it to create new Perl executable:
    <p class="Pp"></p>
    <pre>  make perl
    </pre>
    <p class="Pp">(you may need to manually add
        <span class="Li">&quot;PERLTYPE=-DPERL_CORE&quot;</span> to this
        commandline on some versions of Perl; the symptom is that the
        command-line globbing does not work from OS/2 shells with the
        newly-compiled executable; check with</p>
    <p class="Pp"></p>
    <pre>  .\perl.exe -wle &quot;print for @ARGV&quot; *
    </pre>
    <p class="Pp">).</p>
  </dd>
  <dt>4.</dt>
  <dd>The previous step created <i>perlmain.c</i> which contains a list of
      <b>newXS()</b> calls near the end. Removing unnecessary calls, and
      rerunning
    <p class="Pp"></p>
    <pre>  make perl
    </pre>
    <p class="Pp">will produce a customized executable.</p>
  </dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="Making_executables_with_a_custom_search-paths"><a class="permalink" href="#Making_executables_with_a_custom_search-paths">Making
  executables with a custom search-paths</a></h2>
<p class="Pp">The default perl executable is flexible enough to support most
    usages. However, one may want something yet more flexible; for example, one
    may want to find Perl DLL relatively to the location of the EXE file; or one
    may want to ignore the environment when setting the Perl-library search
    patch, etc.</p>
<p class="Pp">If you fill comfortable with <i>embedding</i> interface (see
    perlembed), such things are easy to do repeating the steps outlined in
    &quot;Making executables with a custom collection of statically loaded
    extensions&quot;, and doing more comprehensive edits to <b>main()</b> of
    <i>perlmain.c</i>. The people with little desire to understand Perl can just
    rename <b>main()</b>, and do necessary modification in a custom
    <b>main()</b> which calls the renamed function in appropriate time.</p>
<p class="Pp">However, there is a third way: perl DLL exports the <b>main()</b>
    function and several callbacks to customize the search path. Below is a
    complete example of a &quot;Perl loader&quot; which</p>
<dl class="Bl-tag">
  <dt>1.</dt>
  <dd>Looks for Perl DLL in the directory
      <span class="Li">&quot;$exedir/../dll&quot;</span>;</dd>
  <dt>2.</dt>
  <dd>Prepends the above directory to
      <span class="Li">&quot;BEGINLIBPATH&quot;</span>;</dd>
  <dt>3.</dt>
  <dd>Fails if the Perl DLL found via
      <span class="Li">&quot;BEGINLIBPATH&quot;</span> is different from what
      was loaded on step 1; e.g., another process could have loaded it from
      <span class="Li">&quot;LIBPATH&quot;</span> or from a different value of
      <span class="Li">&quot;BEGINLIBPATH&quot;</span>. In these cases one needs
      to modify the setting of the system so that this other process either does
      not run, or loads the DLL from
      <span class="Li">&quot;BEGINLIBPATH&quot;</span> with
      <span class="Li">&quot;LIBPATHSTRICT=T&quot;</span> (available with
      kernels after September 2000).</dd>
  <dt>4.</dt>
  <dd>Loads Perl library from
      <span class="Li">&quot;$exedir/../dll/lib/&quot;</span>.</dd>
  <dt>5.</dt>
  <dd>Uses Bourne shell from
      <span class="Li">&quot;$exedir/../dll/sh/ksh.exe&quot;</span>.</dd>
</dl>
<p class="Pp">For best results compile the C file below with the same options as
    the Perl DLL. However, a lot of functionality will work even if the
    executable is not an EMX applications, e.g., if compiled with</p>
<p class="Pp"></p>
<pre>  gcc -Wall -DDOSISH -DOS2=1 -O2 -s -Zomf -Zsys perl-starter.c \
    -DPERL_DLL_BASENAME=\&quot;perl312F\&quot; -Zstack 8192 -Zlinker /PM:VIO
</pre>
<p class="Pp">Here is the sample C file:</p>
<p class="Pp"></p>
<pre> #define INCL_DOS
 #define INCL_NOPM
 /* These are needed for compile if os2.h includes os2tk.h, not
  * os2emx.h */
 #define INCL_DOSPROCESS
 #include &lt;os2.h&gt;
 #include &quot;EXTERN.h&quot;
 #define PERL_IN_MINIPERLMAIN_C
 #include &quot;perl.h&quot;
 static char *me;
 HMODULE handle;
 static void
 die_with(char *msg1, char *msg2, char *msg3, char *msg4)
 {
    ULONG c;
    char *s = &quot; error: &quot;;
    DosWrite(2, me, strlen(me), &amp;c);
    DosWrite(2, s, strlen(s), &amp;c);
    DosWrite(2, msg1, strlen(msg1), &amp;c);
    DosWrite(2, msg2, strlen(msg2), &amp;c);
    DosWrite(2, msg3, strlen(msg3), &amp;c);
    DosWrite(2, msg4, strlen(msg4), &amp;c);
    DosWrite(2, &quot;\r\n&quot;, 2, &amp;c);
    exit(255);
 }
 typedef ULONG (*fill_extLibpath_t)(int type,
                                    char *pre,
                                    char *post,
                                    int replace,
                                    char *msg);
 typedef int (*main_t)(int type, char *argv[], char *env[]);
 typedef int (*handler_t)(void* data, int which);
 #ifndef PERL_DLL_BASENAME
 #  define PERL_DLL_BASENAME &quot;perl&quot;
 #endif
 static HMODULE
 load_perl_dll(char *basename)
 {
     char buf[300], fail[260];
     STRLEN l, dirl;
     fill_extLibpath_t f;
     ULONG rc_fullname;
     HMODULE handle, handle1;
     if (_execname(buf, sizeof(buf) - 13) != 0)
         die_with(&quot;Can't find full path: &quot;, strerror(errno), &quot;&quot;, &quot;&quot;);
     /* XXXX Fill 'me' with new value */
     l = strlen(buf);
     while (l &amp;&amp; buf[l-1] != '/' &amp;&amp; buf[l-1] != '\\')
         l--;
     dirl = l - 1;
     strcpy(buf + l, basename);
     l += strlen(basename);
     strcpy(buf + l, &quot;.dll&quot;);
     if ( (rc_fullname = DosLoadModule(fail, sizeof fail, buf, &amp;handle))
                                                                    != 0
          &amp;&amp; DosLoadModule(fail, sizeof fail, basename, &amp;handle) != 0 )
         die_with(&quot;Can't load DLL &quot;, buf, &quot;&quot;, &quot;&quot;);
     if (rc_fullname)
         return handle;    /* was loaded with short name; all is fine */
     if (DosQueryProcAddr(handle, 0, &quot;fill_extLibpath&quot;, (PFN*)&amp;f))
         die_with(buf,
                  &quot;: DLL exports no symbol &quot;,
                  &quot;fill_extLibpath&quot;,
                  &quot;&quot;);
     buf[dirl] = 0;
     if (f(0 /*BEGINLIBPATH*/, buf /* prepend */, NULL /* append */,
           0 /* keep old value */, me))
         die_with(me, &quot;: prepending BEGINLIBPATH&quot;, &quot;&quot;, &quot;&quot;);
     if (DosLoadModule(fail, sizeof fail, basename, &amp;handle1) != 0)
         die_with(me,
                  &quot;: finding perl DLL again via BEGINLIBPATH&quot;,
                  &quot;&quot;,
                  &quot;&quot;);
     buf[dirl] = '\\';
     if (handle1 != handle) {
         if (DosQueryModuleName(handle1, sizeof(fail), fail))
             strcpy(fail, &quot;???&quot;);
         die_with(buf,
                  &quot;:\n\tperl DLL via BEGINLIBPATH is different: \n\t&quot;,
                  fail,
                  &quot;\n\tYou may need to manipulate global BEGINLIBPATH&quot;
                     &quot; and LIBPATHSTRICT&quot;
                     &quot;\n\tso that the other copy is loaded via&quot;
                     BEGINLIBPATH.&quot;);
     }
     return handle;
 }
 int
 main(int argc, char **argv, char **env)
 {
     main_t f;
     handler_t h;
     me = argv[0];
     /**/
     handle = load_perl_dll(PERL_DLL_BASENAME);
     if (DosQueryProcAddr(handle,
                          0,
                          &quot;Perl_OS2_handler_install&quot;,
                          (PFN*)&amp;h))
         die_with(PERL_DLL_BASENAME,
                  &quot;: DLL exports no symbol &quot;,
                  &quot;Perl_OS2_handler_install&quot;,
                  &quot;&quot;);
     if ( !h((void *)&quot;~installprefix&quot;, Perlos2_handler_perllib_from)
          || !h((void *)&quot;~dll&quot;, Perlos2_handler_perllib_to)
          || !h((void *)&quot;~dll/sh/ksh.exe&quot;, Perlos2_handler_perl_sh) )
         die_with(PERL_DLL_BASENAME,
                  &quot;: Can't install @INC manglers&quot;,
                  &quot;&quot;,
                  &quot;&quot;);
     if (DosQueryProcAddr(handle, 0, &quot;dll_perlmain&quot;, (PFN*)&amp;f))
         die_with(PERL_DLL_BASENAME,
                  &quot;: DLL exports no symbol &quot;,
                  &quot;dll_perlmain&quot;,
                  &quot;&quot;);
     return f(argc, argv, env);
 }
</pre>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="Build_FAQ"><a class="permalink" href="#Build_FAQ">Build
  FAQ</a></h1>
<section class="Ss">
<h2 class="Ss" id="Some__/__became__"><a class="permalink" href="#Some__/__became__">Some
  &quot;/&quot; became &quot;\&quot; in pdksh.</a></h2>
<p class="Pp">You have a very old pdksh. See &quot;Prerequisites&quot;.</p>
</section>
<section class="Ss">
<h2 class="Ss">'errno' - unresolved external</h2>
<p class="Pp">You do not have MT-safe <i>db.lib</i>. See
    &quot;Prerequisites&quot;.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Problems_with_tr_or_sed"><a class="permalink" href="#Problems_with_tr_or_sed">Problems
  with tr or sed</a></h2>
<p class="Pp">reported with very old version of tr and sed.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Some_problem_(forget_which_;"><a class="permalink" href="#Some_problem_(forget_which_;">Some
  problem (forget which ;-)</a></h2>
<p class="Pp">You have an older version of <i>perl.dll</i> on your LIBPATH,
    which broke the build of extensions.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Library_..._not_found"><a class="permalink" href="#Library_..._not_found">Library
  ... not found</a></h2>
<p class="Pp">You did not run <span class="Li">&quot;omflibs&quot;</span>. See
    &quot;Prerequisites&quot;.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Segfault_in_make"><a class="permalink" href="#Segfault_in_make">Segfault
  in make</a></h2>
<p class="Pp">You use an old version of GNU make. See
  &quot;Prerequisites&quot;.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="op/sprintf_test_failure"><a class="permalink" href="#op/sprintf_test_failure">op/sprintf
  test failure</a></h2>
<p class="Pp">This can result from a bug in emx sprintf which was fixed in 0.9d
    fix 03.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="Specific_(mis)features_of_OS/2_port"><a class="permalink" href="#Specific_(mis)features_of_OS/2_port">Specific
  (mis)features of OS/2 port</a></h1>
<section class="Ss">
<h2 class="Ss" id="_setpriority_,__getpriority_"><a class="permalink" href="#_setpriority_,__getpriority_">&quot;setpriority&quot;,
  &quot;getpriority&quot;</a></h2>
<p class="Pp">Note that these functions are compatible with *nix, not with the
    older ports of '94 - 95. The priorities are absolute, go from 32 to -95,
    lower is quicker. 0 is the default priority.</p>
<p class="Pp"><b>WARNING</b>. Calling
    <span class="Li">&quot;getpriority&quot;</span> on a non-existing process
    could lock the system before Warp3 fixpak22. Starting with Warp3, Perl will
    use a workaround: it aborts <b>getpriority()</b> if the process is not
    present. This is not possible on older versions
    <span class="Li">&quot;2.*&quot;</span>, and has a race condition
  anyway.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_system()_"><a class="permalink" href="#_system()_">&quot;system()&quot;</a></h2>
<p class="Pp">Multi-argument form of
    <span class="Li">&quot;system()&quot;</span> allows an additional numeric
    argument. The meaning of this argument is described in OS2::Process.</p>
<p class="Pp">When finding a program to run, Perl first asks the OS to look for
    executables on <span class="Li">&quot;PATH&quot;</span> (OS/2 adds extension
    <i>.exe</i> if no extension is present). If not found, it looks for a script
    with possible extensions added in this order: no extension, <i>.cmd</i>,
    <i>.btm</i>, <i>.bat</i>, <i>.pl</i>. If found, Perl checks the start of the
    file for magic strings <span class="Li">&quot;#!&quot;</span> and
    <span class="Li">&quot;extproc &quot;</span>. If found, Perl uses the rest
    of the first line as the beginning of the command line to run this script.
    The only mangling done to the first line is extraction of arguments
    (currently up to 3), and ignoring of the path-part of the
    &quot;interpreter&quot; name if it can't be found using the full path.</p>
<p class="Pp">E.g., <span class="Li">&quot;system 'foo', 'bar',
    'baz'&quot;</span> may lead Perl to finding <i>C:/emx/bin/foo.cmd</i> with
    the first line being</p>
<p class="Pp"></p>
<pre> extproc /bin/bash    -x   -c
</pre>
<p class="Pp">If <i>/bin/bash.exe</i> is not found, then Perl looks for an
    executable <i>bash.exe</i> on <span class="Li">&quot;PATH&quot;</span>. If
    found in <i>C:/emx.add/bin/bash.exe</i>, then the above <b>system()</b> is
    translated to</p>
<p class="Pp"></p>
<pre>  system qw(C:/emx.add/bin/bash.exe -x -c C:/emx/bin/foo.cmd bar baz)
</pre>
<p class="Pp">One additional translation is performed: instead of <i>/bin/sh</i>
    Perl uses the hardwired-or-customized shell (see
    &quot;<span class="Li">&quot;PERL_SH_DIR&quot;</span>&quot;).</p>
<p class="Pp">The above search for &quot;interpreter&quot; is recursive: if
    <i>bash</i> executable is not found, but <i>bash.btm</i> is found, Perl will
    investigate its first line etc. The only hardwired limit on the recursion
    depth is implicit: there is a limit 4 on the number of additional arguments
    inserted before the actual arguments given to <b>system()</b>. In
    particular, if no additional arguments are specified on the
    &quot;magic&quot; first lines, then the limit on the depth is 4.</p>
<p class="Pp">If Perl finds that the found executable is of PM type when the
    current session is not, it will start the new process in a separate session
    of necessary type. Call via <span class="Li">&quot;OS2::Process&quot;</span>
    to disable this magic.</p>
<p class="Pp"><b>WARNING</b>. Due to the described logic, you need to explicitly
    specify <i>.com</i> extension if needed. Moreover, if the executable
    <i>perl5.6.1</i> is requested, Perl will not look for <i>perl5.6.1.exe</i>.
    [This may change in the future.]</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_extproc__on_the_first_line"><a class="permalink" href="#_extproc__on_the_first_line">&quot;extproc&quot;
  on the first line</a></h2>
<p class="Pp">If the first chars of a Perl script are
    <span class="Li">&quot;extproc &quot;</span>, this line is treated as
    <span class="Li">&quot;#!&quot;</span>-line, thus all the switches on this
    line are processed (twice if script was started via cmd.exe). See
    &quot;DESCRIPTION&quot; in perlrun.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Additional_modules:"><a class="permalink" href="#Additional_modules:">Additional
  modules:</a></h2>
<p class="Pp">OS2::Process, OS2::DLL, OS2::REXX, OS2::PrfDB, OS2::ExtAttr. These
    modules provide access to additional numeric argument for
    <span class="Li">&quot;system&quot;</span> and to the information about the
    running process, to DLLs having functions with REXX signature and to the
    REXX runtime, to OS/2 databases in the <i>.INI</i> format, and to Extended
    Attributes.</p>
<p class="Pp">Two additional extensions by Andreas Kaiser,
    <span class="Li">&quot;OS2::UPM&quot;</span>, and
    <span class="Li">&quot;OS2::FTP&quot;</span>, are included into
    <span class="Li">&quot;ILYAZ&quot;</span> directory, mirrored on CPAN. Other
    OS/2-related extensions are available too.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Prebuilt_methods:"><a class="permalink" href="#Prebuilt_methods:">Prebuilt
  methods:</a></h2>
<dl class="Bl-tag">
  <dt>&quot;File::Copy::syscopy&quot;</dt>
  <dd>used by <span class="Li">&quot;File::Copy::copy&quot;</span>, see
      File::Copy.</dd>
  <dt>&quot;DynaLoader::mod2fname&quot;</dt>
  <dd>used by <span class="Li">&quot;DynaLoader&quot;</span> for DLL name
      mangling.</dd>
  <dt>&quot;Cwd::current_drive()&quot;</dt>
  <dd>Self explanatory.</dd>
  <dt>&quot;Cwd::sys_chdir(name)&quot;</dt>
  <dd>leaves drive as it is.</dd>
  <dt>&quot;Cwd::change_drive(name)&quot;</dt>
  <dd>changes the &quot;current&quot; drive.</dd>
  <dt>&quot;Cwd::sys_is_absolute(name)&quot;</dt>
  <dd>means has drive letter and is_rooted.</dd>
  <dt>&quot;Cwd::sys_is_rooted(name)&quot;</dt>
  <dd>means has leading <span class="Li">&quot;[/\\]&quot;</span> (maybe after a
      drive-letter:).</dd>
  <dt>&quot;Cwd::sys_is_relative(name)&quot;</dt>
  <dd>means changes with current dir.</dd>
  <dt>&quot;Cwd::sys_cwd(name)&quot;</dt>
  <dd>Interface to cwd from EMX. Used by
      <span class="Li">&quot;Cwd::cwd&quot;</span>.</dd>
  <dt>&quot;Cwd::sys_abspath(name, dir)&quot;</dt>
  <dd>Really really odious function to implement. Returns absolute name of file
      which would have <span class="Li">&quot;name&quot;</span> if CWD were
      <span class="Li">&quot;dir&quot;</span>.
      <span class="Li">&quot;Dir&quot;</span> defaults to the current dir.</dd>
  <dt>&quot;Cwd::extLibpath([type])&quot;</dt>
  <dd>Get current value of extended library search path. If
      <span class="Li">&quot;type&quot;</span> is present and positive, works
      with <span class="Li">&quot;END_LIBPATH&quot;</span>, if negative, works
      with <span class="Li">&quot;LIBPATHSTRICT&quot;</span>, otherwise with
      <span class="Li">&quot;BEGIN_LIBPATH&quot;</span>.</dd>
  <dt>&quot;Cwd::extLibpath_set( path [, type ] )&quot;</dt>
  <dd>Set current value of extended library search path. If
      <span class="Li">&quot;type&quot;</span> is present and positive, works
      with &lt;END_LIBPATH&gt;, if negative, works with
      <span class="Li">&quot;LIBPATHSTRICT&quot;</span>, otherwise with
      <span class="Li">&quot;BEGIN_LIBPATH&quot;</span>.</dd>
  <dt>&quot;OS2::Error(do_harderror,do_exception)&quot;</dt>
  <dd>Returns	<span class="Li">&quot;undef&quot;</span> if it was not called
      yet, otherwise bit 1 is set if on the previous call do_harderror was
      enabled, bit 2 is set if on previous call do_exception was enabled.
    <p class="Pp">This function enables/disables error popups associated with
        hardware errors (Disk not ready etc.) and software exceptions.</p>
    <p class="Pp">I know of no way to find out the state of popups <i>before</i>
        the first call to this function.</p>
  </dd>
  <dt>&quot;OS2::Errors2Drive(drive)&quot;</dt>
  <dd>Returns <span class="Li">&quot;undef&quot;</span> if it was not called
      yet, otherwise return false if errors were not requested to be written to
      a hard drive, or the drive letter if this was requested.
    <p class="Pp">This function may redirect error popups associated with
        hardware errors (Disk not ready etc.) and software exceptions to the
        file POPUPLOG.OS2 at the root directory of the specified drive.
        Overrides <b>OS2::Error()</b> specified by individual programs. Given
        argument undef will disable redirection.</p>
    <p class="Pp">Has global effect, persists after the application exits.</p>
    <p class="Pp">I know of no way to find out the state of redirection of
        popups to the disk <i>before</i> the first call to this function.</p>
  </dd>
  <dt id="OS2::SysInfo()"><a class="permalink" href="#OS2::SysInfo()"><b>OS2::SysInfo()</b></a></dt>
  <dd>Returns a hash with system information. The keys of the hash are
    <p class="Pp"></p>
    <pre>        MAX_PATH_LENGTH, MAX_TEXT_SESSIONS, MAX_PM_SESSIONS,
        MAX_VDM_SESSIONS, BOOT_DRIVE, DYN_PRI_VARIATION,
        MAX_WAIT, MIN_SLICE, MAX_SLICE, PAGE_SIZE,
        VERSION_MAJOR, VERSION_MINOR, VERSION_REVISION,
        MS_COUNT, TIME_LOW, TIME_HIGH, TOTPHYSMEM, TOTRESMEM,
        TOTAVAILMEM, MAXPRMEM, MAXSHMEM, TIMER_INTERVAL,
        MAX_COMP_LENGTH, FOREGROUND_FS_SESSION,
        FOREGROUND_PROCESS
    </pre>
  </dd>
  <dt id="OS2::BootDrive()"><a class="permalink" href="#OS2::BootDrive()"><b>OS2::BootDrive()</b></a></dt>
  <dd>Returns a letter without colon.</dd>
  <dt>&quot;OS2::MorphPM(serve)&quot;, &quot;OS2::UnMorphPM(serve)&quot;</dt>
  <dd>Transforms the current application into a PM application and back. The
      argument true means that a real message loop is going to be served.
      <b>OS2::MorphPM()</b> returns the PM message queue handle as an integer.
    <p class="Pp">See &quot;Centralized management of resources&quot; for
        additional details.</p>
  </dd>
  <dt>&quot;OS2::Serve_Messages(force)&quot;</dt>
  <dd>Fake on-demand retrieval of outstanding PM messages. If
      <span class="Li">&quot;force&quot;</span> is false, will not dispatch
      messages if a real message loop is known to be present. Returns number of
      messages retrieved.
    <p class="Pp">Dies with &quot;QUITing...&quot; if WM_QUIT message is
        obtained.</p>
  </dd>
  <dt>&quot;OS2::Process_Messages(force [, cnt])&quot;</dt>
  <dd>Retrieval of PM messages until window creation/destruction. If
      <span class="Li">&quot;force&quot;</span> is false, will not dispatch
      messages if a real message loop is known to be present.
    <p class="Pp">Returns change in number of windows. If
        <span class="Li">&quot;cnt&quot;</span> is given, it is incremented by
        the number of messages retrieved.</p>
    <p class="Pp">Dies with &quot;QUITing...&quot; if WM_QUIT message is
        obtained.</p>
  </dd>
  <dt>&quot;OS2::_control87(new,mask)&quot;</dt>
  <dd>the same as <b>_control87</b>(3) of EMX. Takes integers as arguments,
      returns the previous coprocessor control word as an integer. Only bits in
      <span class="Li">&quot;new&quot;</span> which are present in
      <span class="Li">&quot;mask&quot;</span> are changed in the control
    word.</dd>
  <dt id="OS2::get_control87()"><a class="permalink" href="#OS2::get_control87()"><b>OS2::get_control87()</b></a></dt>
  <dd>gets the coprocessor control word as an integer.</dd>
  <dt>&quot;OS2::set_control87_em(new=MCW_EM,mask=MCW_EM)&quot;</dt>
  <dd>The variant of <b>OS2::_control87()</b> with default values good for
      handling exception mask: if no <span class="Li">&quot;mask&quot;</span>,
      uses exception mask part of <span class="Li">&quot;new&quot;</span> only.
      If no <span class="Li">&quot;new&quot;</span>, disables all the floating
      point exceptions.
    <p class="Pp">See &quot;Misfeatures&quot; for details.</p>
  </dd>
  <dt>&quot;OS2::DLLname([how [, \&amp;xsub]])&quot;</dt>
  <dd>Gives the information about the Perl DLL or the DLL containing the C
      function bound to by <span class="Li">&amp;xsub</span>. The meaning of
      <span class="Li">&quot;how&quot;</span> is: default (2): full name; 0:
      handle; 1: module name.</dd>
</dl>
<p class="Pp">(Note that some of these may be moved to different libraries -
    eventually).</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Prebuilt_variables:"><a class="permalink" href="#Prebuilt_variables:">Prebuilt
  variables:</a></h2>
<dl class="Bl-tag">
  <dt>$OS2::emx_rev</dt>
  <dd>numeric value is the same as _emx_rev of EMX, a string value the same as
      _emx_vprt (similar to <span class="Li">&quot;0.9c&quot;</span>).</dd>
  <dt>$OS2::emx_env</dt>
  <dd>same as _emx_env of EMX, a number similar to 0x8001.</dd>
  <dt>$OS2::os_ver</dt>
  <dd>a number <span class="Li">&quot;OS_MAJOR + 0.001 *
    OS_MINOR&quot;</span>.</dd>
  <dt>$OS2::is_aout</dt>
  <dd>true if the Perl library was compiled in AOUT format.</dd>
  <dt>$OS2::can_fork</dt>
  <dd>true if the current executable is an AOUT EMX executable, so Perl can
      fork. Do not use this, use the portable check for
      <span class="Li">$Config::Config</span>{dfork}.</dd>
  <dt>$OS2::nsyserror</dt>
  <dd>This variable (default is 1) controls whether to enforce the contents of
      $^E to start with <span class="Li">&quot;SYS0003&quot;</span>-like id. If
      set to 0, then the string value of $^E is what is available from the OS/2
      message file. (Some messages in this file have an
      <span class="Li">&quot;SYS0003&quot;</span>-like id prepended, some
    not.)</dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="Misfeatures"><a class="permalink" href="#Misfeatures">Misfeatures</a></h2>
<ul class="Bl-bullet">
  <li>Since <b>flock</b>(3) is present in EMX, but is not functional, it is
      emulated by perl. To disable the emulations, set environment variable
      <span class="Li">&quot;USE_PERL_FLOCK=0&quot;</span>.</li>
  <li>Here is the list of things which may be &quot;broken&quot; on EMX (from
      EMX docs):</li>
</ul>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>The functions <b>recvmsg</b>(3), <b>sendmsg</b>(3), and
      <b>socketpair</b>(3) are not implemented.</li>
  <li><b>sock_init</b>(3) is not required and not implemented.</li>
  <li><b>flock</b>(3) is not yet implemented (dummy function). (Perl has a
      workaround.)</li>
  <li><b>kill</b>(3): Special treatment of PID=0, PID=1 and PID=-1 is not
      implemented.</li>
  <li><b>waitpid</b>(3):
    <p class="Pp"></p>
    <pre>      WUNTRACED
              Not implemented.
      waitpid() is not implemented for negative values of PID.
    </pre>
  </li>
</ul>
</div>
<div class="Bd-indent">
<p class="Pp">Note that <span class="Li">&quot;kill -9&quot;</span> does not
    work with the current version of EMX.</p>
</div>
<ul class="Bl-bullet">
  <li>See &quot;Text-mode filehandles&quot;.</li>
  <li>Unix-domain sockets on OS/2 live in a pseudo-file-system
      <span class="Li">&quot;/sockets/...&quot;</span>. To avoid a failure to
      create a socket with a name of a different form,
      <span class="Li">&quot;/socket/&quot;</span> is prepended to the socket
      name (unless it starts with this already).
    <p class="Pp">This may lead to problems later in case the socket is accessed
        via the &quot;usual&quot; file-system calls using the
        &quot;initial&quot; name.</p>
  </li>
  <li>Apparently, IBM used a compiler (for some period of time around '95?)
      which changes FP mask right and left. This is not <i>that</i> bad for
      IBM's programs, but the same compiler was used for DLLs which are used
      with general-purpose applications. When these DLLs are used, the state of
      floating-point flags in the application is not predictable.
    <p class="Pp">What is much worse, some DLLs change the floating point flags
        when in <b>_DLLInitTerm()</b> (e.g., <i>TCP32IP</i>). This means that
        even if you do not <i>call</i> any function in the DLL, just the act of
        loading this DLL will reset your flags. What is worse, the same compiler
        was used to compile some HOOK DLLs. Given that HOOK dlls are executed in
        the context of <i>all</i> the applications in the system, this means a
        complete unpredictability of floating point flags on systems using such
        HOOK DLLs. E.g., <i>GAMESRVR.DLL</i> of <b>DIVE</b> origin changes the
        floating point flags on each write to the TTY of a VIO (windowed
        text-mode) applications.</p>
    <p class="Pp">Some other (not completely debugged) situations when FP flags
        change include some video drivers (?), and some operations related to
        creation of the windows. People who code <b>OpenGL</b> may have more
        experience on this.</p>
    <p class="Pp">Perl is generally used in the situation when all the
        floating-point exceptions are ignored, as is the default under EMX. If
        they are not ignored, some benign Perl programs would get a
        <span class="Li">&quot;SIGFPE&quot;</span> and would die a horrible
        death.</p>
    <p class="Pp">To circumvent this, Perl uses two hacks. They help against
        <i>one</i> type of damage only: FP flags changed when loading a DLL.</p>
    <p class="Pp">One of the hacks is to disable floating point exceptions on
        Perl startup (as is the default with EMX). This helps only with
        compile-time-linked DLLs changing the flags before <b>main()</b> had a
        chance to be called.</p>
    <p class="Pp">The other hack is to restore FP flags after a call to
        <b>dlopen()</b>. This helps against similar damage done by DLLs
        <b>_DLLInitTerm()</b> at runtime. Currently no way to switch these hacks
        off is provided.</p>
  </li>
</ul>
</section>
<section class="Ss">
<h2 class="Ss" id="Modifications"><a class="permalink" href="#Modifications">Modifications</a></h2>
<p class="Pp">Perl modifies some standard C library calls in the following
  ways:</p>
<dl class="Bl-tag">
  <dt>&quot;popen&quot;</dt>
  <dd><span class="Li">&quot;my_popen&quot;</span> uses <i>sh.exe</i> if shell
      is required, cf.
      &quot;<span class="Li">&quot;PERL_SH_DIR&quot;</span>&quot;.</dd>
  <dt>&quot;tmpnam&quot;</dt>
  <dd>is created using <span class="Li">&quot;TMP&quot;</span> or
      <span class="Li">&quot;TEMP&quot;</span> environment variable, via
      <span class="Li">&quot;tempnam&quot;</span>.</dd>
  <dt>&quot;tmpfile&quot;</dt>
  <dd>If the current directory is not writable, file is created using modified
      <span class="Li">&quot;tmpnam&quot;</span>, so there may be a race
      condition.</dd>
  <dt>&quot;ctermid&quot;</dt>
  <dd>a dummy implementation.</dd>
  <dt>&quot;stat&quot;</dt>
  <dd><span class="Li">&quot;os2_stat&quot;</span> special-cases <i>/dev/tty</i>
      and <i>/dev/con</i>.</dd>
  <dt>&quot;mkdir&quot;, &quot;rmdir&quot;</dt>
  <dd>these EMX functions do not work if the path contains a trailing
      <span class="Li">&quot;/&quot;</span>. Perl contains a workaround for
      this.</dd>
  <dt>&quot;flock&quot;</dt>
  <dd>Since <b>flock</b>(3) is present in EMX, but is not functional, it is
      emulated by perl. To disable the emulations, set environment variable
      <span class="Li">&quot;USE_PERL_FLOCK=0&quot;</span>.</dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="Identifying_DLLs"><a class="permalink" href="#Identifying_DLLs">Identifying
  DLLs</a></h2>
<p class="Pp">All the DLLs built with the current versions of Perl have ID
    strings identifying the name of the extension, its version, and the version
    of Perl required for this DLL. Run <span class="Li">&quot;bldlevel
    DLL-name&quot;</span> to find this info.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Centralized_management_of_resources"><a class="permalink" href="#Centralized_management_of_resources">Centralized
  management of resources</a></h2>
<p class="Pp">Since to call certain OS/2 API one needs to have a correctly
    initialized <span class="Li">&quot;Win&quot;</span> subsystem, OS/2-specific
    extensions may require getting <span class="Li">&quot;HAB&quot;</span>s and
    <span class="Li">&quot;HMQ&quot;</span>s. If an extension would do it on its
    own, another extension could fail to initialize.</p>
<p class="Pp">Perl provides a centralized management of these resources:</p>
<dl class="Bl-tag">
  <dt>&quot;HAB&quot;</dt>
  <dd>To get the HAB, the extension should call <span class="Li">&quot;hab =
      perl_hab_GET()&quot;</span> in C. After this call is performed,
      <span class="Li">&quot;hab&quot;</span> may be accessed as
      <span class="Li">&quot;Perl_hab&quot;</span>. There is no need to release
      the HAB after it is used.
    <p class="Pp">If by some reasons <i>perl.h</i> cannot be included, use</p>
    <p class="Pp"></p>
    <pre>  extern int Perl_hab_GET(void);
    </pre>
    <p class="Pp">instead.</p>
  </dd>
  <dt>&quot;HMQ&quot;</dt>
  <dd>There are two cases:</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>the extension needs an <span class="Li">&quot;HMQ&quot;</span> only
      because some API will not work otherwise. Use <span class="Li">&quot;serve
      = 0&quot;</span> below.</li>
  <li>the extension needs an <span class="Li">&quot;HMQ&quot;</span> since it
      wants to engage in a PM event loop. Use <span class="Li">&quot;serve =
      1&quot;</span> below.</li>
</ul>
</div>
<div class="Bd-indent">
<p class="Pp">To get an <span class="Li">&quot;HMQ&quot;</span>, the extension
    should call <span class="Li">&quot;hmq = perl_hmq_GET(serve)&quot;</span> in
    C. After this call is performed, <span class="Li">&quot;hmq&quot;</span> may
    be accessed as <span class="Li">&quot;Perl_hmq&quot;</span>.</p>
<p class="Pp">To signal to Perl that HMQ is not needed any more, call
    <span class="Li">&quot;perl_hmq_UNSET(serve)&quot;</span>. Perl process will
    automatically morph/unmorph itself into/from a PM process if HMQ is
    needed/not-needed. Perl will automatically enable/disable
    <span class="Li">&quot;WM_QUIT&quot;</span> message during shutdown if the
    message queue is served/not-served.</p>
<p class="Pp"><b>NOTE</b>. If during a shutdown there is a message queue which
    did not disable WM_QUIT, and which did not process the received WM_QUIT
    message, the shutdown will be automatically cancelled. Do not call
    <span class="Li">perl_hmq_GET(1)</span> unless you are going to process
    messages on an orderly basis.</p>
</div>
<dl class="Bl-tag">
  <dt id="Treating"><a class="permalink" href="#Treating">Treating errors
    reported by OS/2 API</a></dt>
  <dd>There are two principal conventions (it is useful to call them
      <span class="Li">&quot;Dos*&quot;</span> and
      <span class="Li">&quot;Win*&quot;</span> - though this part of the
      function signature is not always determined by the name of the API) of
      reporting the error conditions of OS/2 API. Most of
      <span class="Li">&quot;Dos*&quot;</span> APIs report the error code as the
      result of the call (so 0 means success, and there are many types of
      errors). Most of <span class="Li">&quot;Win*&quot;</span> API report
      success/fail via the result being
      <span class="Li">&quot;TRUE&quot;</span>/<span class="Li">&quot;FALSE&quot;</span>;
      to find the reason for the failure one should call
      <b>WinGetLastError()</b> API.
    <p class="Pp">Some <span class="Li">&quot;Win*&quot;</span> entry points
        also overload a &quot;meaningful&quot; return value with the error
        indicator; having a 0 return value indicates an error. Yet some other
        <span class="Li">&quot;Win*&quot;</span> entry points overload things
        even more, and 0 return value may mean a successful call returning a
        valid value 0, as well as an error condition; in the case of a 0 return
        value one should call <b>WinGetLastError()</b> API to distinguish a
        successful call from a failing one.</p>
    <p class="Pp">By convention, all the calls to OS/2 API should indicate their
        failures by resetting $^E. All the Perl-accessible functions which call
        OS/2 API may be broken into two classes: some <b>die()</b>s when an API
        error is encountered, the other report the error via a false return
        value (of course, this does not concern Perl-accessible functions which
        <i>expect</i> a failure of the OS/2 API call, having some workarounds
        coded).</p>
    <p class="Pp">Obviously, in the situation of the last type of the signature
        of an OS/2 API, it is must more convenient for the users if the failure
        is indicated by <b>die()</b>ing: one does not need to check $^E to know
        that something went wrong. If, however, this solution is not desirable
        by some reason, the code in question should reset $^E to 0 before making
        this OS/2 API call, so that the caller of this Perl-accessible function
        has a chance to distinguish a success-but-0-return value from a failure.
        (One may return undef as an alternative way of reporting an error.)</p>
    <p class="Pp">The macros to simplify this type of error propagation are</p>
  </dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>&quot;CheckOSError(expr)&quot;</dt>
  <dd>Returns true on error, sets $^E. Expects <b>expr()</b> be a call of
      <span class="Li">&quot;Dos*&quot;</span>-style API.</dd>
  <dt>&quot;CheckWinError(expr)&quot;</dt>
  <dd>Returns true on error, sets $^E. Expects <b>expr()</b> be a call of
      <span class="Li">&quot;Win*&quot;</span>-style API.</dd>
  <dt>&quot;SaveWinError(expr)&quot;</dt>
  <dd>Returns <span class="Li">&quot;expr&quot;</span>, sets $^E from
      <b>WinGetLastError()</b> if <span class="Li">&quot;expr&quot;</span> is
      false.</dd>
  <dt>&quot;SaveCroakWinError(expr,die,name1,name2)&quot;</dt>
  <dd>Returns <span class="Li">&quot;expr&quot;</span>, sets $^E from
      <b>WinGetLastError()</b> if <span class="Li">&quot;expr&quot;</span> is
      false, and <b>die()</b>s if <span class="Li">&quot;die&quot;</span> and
      $^E are true. The message to die is the concatenated strings
      <span class="Li">&quot;name1&quot;</span> and
      <span class="Li">&quot;name2&quot;</span>, separated by
      <span class="Li">&quot;: &quot;</span> from the contents of $^E.</dd>
  <dt>&quot;WinError_2_Perl_rc&quot;</dt>
  <dd>Sets <span class="Li">&quot;Perl_rc&quot;</span> to the return value of
      <b>WinGetLastError()</b>.</dd>
  <dt>&quot;FillWinError&quot;</dt>
  <dd>Sets <span class="Li">&quot;Perl_rc&quot;</span> to the return value of
      <b>WinGetLastError()</b>, and sets $^E to the corresponding value.</dd>
  <dt>&quot;FillOSError(rc)&quot;</dt>
  <dd>Sets <span class="Li">&quot;Perl_rc&quot;</span> to
      <span class="Li">&quot;rc&quot;</span>, and sets $^E to the corresponding
      value.</dd>
</dl>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt id="Loading"><a class="permalink" href="#Loading">Loading DLLs and
    ordinals in DLLs</a></dt>
  <dd>Some DLLs are only present in some versions of OS/2, or in some
      configurations of OS/2. Some exported entry points are present only in
      DLLs shipped with some versions of OS/2. If these DLLs and entry points
      were linked directly for a Perl executable/DLL or from a Perl extensions,
      this binary would work only with the specified versions/setups. Even if
      these entry points were not needed, the <i>load</i> of the executable (or
      DLL) would fail.
    <p class="Pp">For example, many newer useful APIs are not present in OS/2
        v2; many PM-related APIs require DLLs not available on floppy-boot
        setup.</p>
    <p class="Pp">To make these calls fail <i>only when the calls are
        executed</i>, one should call these API via a dynamic linking API. There
        is a subsystem in Perl to simplify such type of calls. A large number of
        entry points available for such linking is provided (see
        <span class="Li">&quot;entries_ordinals&quot;</span> - and also
        <span class="Li">&quot;PMWIN_entries&quot;</span> - in <i>os2ish.h</i>).
        These ordinals can be accessed via the APIs:</p>
    <p class="Pp"></p>
    <pre> CallORD(), DeclFuncByORD(), DeclVoidFuncByORD(),
 DeclOSFuncByORD(), DeclWinFuncByORD(), AssignFuncPByORD(),
 DeclWinFuncByORD_CACHE(), DeclWinFuncByORD_CACHE_survive(),
 DeclWinFuncByORD_CACHE_resetError_survive(),
 DeclWinFunc_CACHE(), DeclWinFunc_CACHE_resetError(),
 DeclWinFunc_CACHE_survive(), DeclWinFunc_CACHE_resetError_survive()
    </pre>
    <p class="Pp">See the header files and the C code in the supplied
        OS/2-related modules for the details on usage of these functions.</p>
    <p class="Pp">Some of these functions also combine dynaloading semantic with
        the error-propagation semantic discussed above.</p>
  </dd>
</dl>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="Perl_flavors"><a class="permalink" href="#Perl_flavors">Perl
  flavors</a></h1>
<p class="Pp">Because of idiosyncrasies of OS/2 one cannot have all the eggs in
    the same basket (though EMX environment tries hard to overcome this
    limitations, so the situation may somehow improve). There are 4 executables
    for Perl provided by the distribution:</p>
<section class="Ss">
<h2 class="Ss"><i>perl.exe</i></h2>
<p class="Pp">The main workhorse. This is a chimera executable: it is compiled
    as an <span class="Li">&quot;a.out&quot;</span>-style executable, but is
    linked with <span class="Li">&quot;omf&quot;</span>-style dynamic library
    <i>perl.dll</i>, and with dynamic CRT DLL. This executable is a VIO
    application.</p>
<p class="Pp">It can load perl dynamic extensions, and it can <b>fork()</b>.</p>
<p class="Pp"><b>Note.</b> Keep in mind that <b>fork()</b> is needed to open a
    pipe to yourself.</p>
</section>
<section class="Ss">
<h2 class="Ss"><i>perl_.exe</i></h2>
<p class="Pp">This is a statically linked
    <span class="Li">&quot;a.out&quot;</span>-style executable. It cannot load
    dynamic Perl extensions. The executable supplied in binary distributions has
    a lot of extensions prebuilt, thus the above restriction is important only
    if you use custom-built extensions. This executable is a VIO
  application.</p>
<p class="Pp"><i>This is the only executable with does not require OS/2.</i> The
    friends locked into <span class="Li">&quot;M$&quot;</span> world would
    appreciate the fact that this executable runs under DOS, Win0.3*, Win0.95
    and WinNT with an appropriate extender. See &quot;Other OSes&quot;.</p>
</section>
<section class="Ss">
<h2 class="Ss"><i>perl__.exe</i></h2>
<p class="Pp">This is the same executable as <i>perl___.exe</i>, but it is a PM
    application.</p>
<p class="Pp"><b>Note.</b> Usually (unless explicitly redirected during the
    startup) STDIN, STDERR, and STDOUT of a PM application are redirected to
    <i>nul</i>. However, it is possible to <i>see</i> them if you start
    <span class="Li">&quot;perl__.exe&quot;</span> from a PM program which
    emulates a console window, like <i>Shell mode</i> of Emacs or EPM. Thus it
    <i>is</i> <i>possible</i> to use Perl debugger (see perldebug) to debug your
    PM application (but beware of the message loop lockups - this will not work
    if you have a message queue to serve, unless you hook the serving into the
    <b>getc()</b> function of the debugger).</p>
<p class="Pp">Another way to see the output of a PM program is to run it as</p>
<p class="Pp"></p>
<pre>  pm_prog args 2&gt;&amp;1 | cat -
</pre>
<p class="Pp">with a shell <i>different</i> from <i>cmd.exe</i>, so that it does
    not create a link between a VIO session and the session of
    <span class="Li">&quot;pm_porg&quot;</span>. (Such a link closes the VIO
    window.) E.g., this works with <i>sh.exe</i> - or with Perl!</p>
<p class="Pp"></p>
<pre>  open P, 'pm_prog args 2&gt;&amp;1 |' or die;
  print while &lt;P&gt;;
</pre>
<p class="Pp">The flavor <i>perl__.exe</i> is required if you want to start your
    program without a VIO window present, but not
    <span class="Li">&quot;detach&quot;</span>ed (run
    <span class="Li">&quot;help detach&quot;</span> for more info). Very useful
    for extensions which use PM, like
    <span class="Li">&quot;Perl/Tk&quot;</span> or
    <span class="Li">&quot;OpenGL&quot;</span>.</p>
<p class="Pp">Note also that the differences between PM and VIO executables are
    only in the <i>default</i> behaviour. One can start <i>any</i> executable in
    <i>any</i> kind of session by using the arguments
    <span class="Li">&quot;/fs&quot;</span>,
    <span class="Li">&quot;/pm&quot;</span> or
    <span class="Li">&quot;/win&quot;</span> switches of the command
    <span class="Li">&quot;start&quot;</span> (of <i>CMD.EXE</i> or a similar
    shell). Alternatively, one can use the numeric first argument of the
    <span class="Li">&quot;system&quot;</span> Perl function (see
  OS2::Process).</p>
</section>
<section class="Ss">
<h2 class="Ss"><i>perl___.exe</i></h2>
<p class="Pp">This is an <span class="Li">&quot;omf&quot;</span>-style
    executable which is dynamically linked to <i>perl.dll</i> and CRT DLL. I
    know no advantages of this executable over
    <span class="Li">&quot;perl.exe&quot;</span>, but it cannot <b>fork()</b> at
    all. Well, one advantage is that the build process is not so convoluted as
    with <span class="Li">&quot;perl.exe&quot;</span>.</p>
<p class="Pp">It is a VIO application.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Why_strange_names?"><a class="permalink" href="#Why_strange_names?">Why
  strange names?</a></h2>
<p class="Pp">Since Perl processes the
    <span class="Li">&quot;#!&quot;</span>-line (cf. &quot;DESCRIPTION&quot; in
    perlrun, &quot;Command Switches&quot; in perlrun, &quot;No Perl script found
    in input&quot; in perldiag), it should know when a program <i>is a Perl</i>.
    There is some naming convention which allows Perl to distinguish correct
    lines from wrong ones. The above names are almost the only names allowed by
    this convention which do not contain digits (which have absolutely different
    semantics).</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Why_dynamic_linking?"><a class="permalink" href="#Why_dynamic_linking?">Why
  dynamic linking?</a></h2>
<p class="Pp">Well, having several executables dynamically linked to the same
    huge library has its advantages, but this would not substantiate the
    additional work to make it compile. The reason is the
    complicated-to-developers but very quick and convenient-to-users
    &quot;hard&quot; dynamic linking used by OS/2.</p>
<p class="Pp">There are two distinctive features of the dyna-linking model of
    OS/2: first, all the references to external functions are resolved at the
    compile time; second, there is no runtime fixup of the DLLs after they are
    loaded into memory. The first feature is an enormous advantage over other
    models: it avoids conflicts when several DLLs used by an application export
    entries with the same name. In such cases &quot;other&quot; models of
    dyna-linking just choose between these two entry points using some random
    criterion - with predictable disasters as results. But it is the second
    feature which requires the build of <i>perl.dll</i>.</p>
<p class="Pp">The address tables of DLLs are patched only once, when they are
    loaded. The addresses of the entry points into DLLs are guaranteed to be the
    same for all the programs which use the same DLL. This removes the runtime
    fixup - once DLL is loaded, its code is read-only.</p>
<p class="Pp">While this allows some (significant?) performance advantages, this
    makes life much harder for developers, since the above scheme makes it
    impossible for a DLL to be &quot;linked&quot; to a symbol in the <i>.EXE</i>
    file. Indeed, this would need a DLL to have different relocations tables for
    the (different) executables which use this DLL.</p>
<p class="Pp">However, a dynamically loaded Perl extension is forced to use some
    symbols from the perl executable, e.g., to know how to find the arguments to
    the functions: the arguments live on the perl internal evaluation stack. The
    solution is to put the main code of the interpreter into a DLL, and make the
    <i>.EXE</i> file which just loads this DLL into memory and supplies
    command-arguments. The extension DLL cannot link to symbols in <i>.EXE</i>,
    but it has no problem linking to symbols in the <i>.DLL</i>.</p>
<p class="Pp">This <i>greatly</i> increases the load time for the application
    (as well as complexity of the compilation). Since interpreter is in a DLL,
    the C RTL is basically forced to reside in a DLL as well (otherwise
    extensions would not be able to use CRT). There are some advantages if you
    use different flavors of perl, such as running <i>perl.exe</i> and
    <i>perl__.exe</i> simultaneously: they share the memory of
  <i>perl.dll</i>.</p>
<p class="Pp"><b>NOTE</b>. There is one additional effect which makes DLLs more
    wasteful: DLLs are loaded in the shared memory region, which is a scarse
    resource given the 512M barrier of the &quot;standard&quot; OS/2 virtual
    memory. The code of <i>.EXE</i> files is also shared by all the processes
    which use the particular <i>.EXE</i>, but they are &quot;shared in the
    private address space of the process&quot;; this is possible because the
    address at which different sections of the <i>.EXE</i> file are loaded is
    decided at compile-time, thus all the processes have these sections loaded
    at same addresses, and no fixup of internal links inside the <i>.EXE</i> is
    needed.</p>
<p class="Pp">Since DLLs may be loaded at run time, to have the same mechanism
    for DLLs one needs to have the address range of <i>any of the loaded</i>
    DLLs in the system to be available <i>in all the processes</i> which did not
    load a particular DLL yet. This is why the DLLs are mapped to the shared
    memory region.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Why_chimera_build?"><a class="permalink" href="#Why_chimera_build?">Why
  chimera build?</a></h2>
<p class="Pp">Current EMX environment does not allow DLLs compiled using Unixish
    <span class="Li">&quot;a.out&quot;</span> format to export symbols for data
    (or at least some types of data). This forces
    <span class="Li">&quot;omf&quot;</span>-style compile of
  <i>perl.dll</i>.</p>
<p class="Pp">Current EMX environment does not allow <i>.EXE</i> files compiled
    in <span class="Li">&quot;omf&quot;</span> format to <b>fork()</b>.
    <b>fork()</b> is needed for exactly three Perl operations:</p>
<ul class="Bl-bullet">
  <li>explicit <b>fork()</b> in the script,</li>
  <li><span class="Li">&quot;open FH, &quot;|-&quot;&quot;</span></li>
  <li><span class="Li">&quot;open FH, &quot;-|&quot;&quot;</span>, in other
      words, opening pipes to itself.</li>
</ul>
<p class="Pp">While these operations are not questions of life and death, they
    are needed for a lot of useful scripts. This forces
    <span class="Li">&quot;a.out&quot;</span>-style compile of
  <i>perl.exe</i>.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="ENVIRONMENT"><a class="permalink" href="#ENVIRONMENT">ENVIRONMENT</a></h1>
<p class="Pp">Here we list environment variables with are either OS/2- and DOS-
    and Win*-specific, or are more important under OS/2 than under other
  OSes.</p>
<section class="Ss">
<h2 class="Ss" id="_PERLLIB_PREFIX_"><a class="permalink" href="#_PERLLIB_PREFIX_">&quot;PERLLIB_PREFIX&quot;</a></h2>
<p class="Pp">Specific for EMX port. Should have the form</p>
<p class="Pp"></p>
<pre>  path1;path2
</pre>
<p class="Pp">or</p>
<p class="Pp"></p>
<pre>  path1 path2
</pre>
<p class="Pp">If the beginning of some prebuilt path matches <i>path1</i>, it is
    substituted with <i>path2</i>.</p>
<p class="Pp">Should be used if the perl library is moved from the default
    location in preference to <span class="Li">&quot;PERL(5)LIB&quot;</span>,
    since this would not leave wrong entries in <span class="Li">@INC</span>.
    For example, if the compiled version of perl looks for
    <span class="Li">@INC</span> in <i>f:/perllib/lib</i>, and you want to
    install the library in <i>h:/opt/gnu</i>, do</p>
<p class="Pp"></p>
<pre>  set PERLLIB_PREFIX=f:/perllib/lib;h:/opt/gnu
</pre>
<p class="Pp">This will cause Perl with the prebuilt
    <span class="Li">@INC</span> of</p>
<p class="Pp"></p>
<pre>  f:/perllib/lib/5.00553/os2
  f:/perllib/lib/5.00553
  f:/perllib/lib/site_perl/5.00553/os2
  f:/perllib/lib/site_perl/5.00553
  .
</pre>
<p class="Pp">to use the following <span class="Li">@INC:</span></p>
<p class="Pp"></p>
<pre>  h:/opt/gnu/5.00553/os2
  h:/opt/gnu/5.00553
  h:/opt/gnu/site_perl/5.00553/os2
  h:/opt/gnu/site_perl/5.00553
  .
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_PERL_BADLANG_"><a class="permalink" href="#_PERL_BADLANG_">&quot;PERL_BADLANG&quot;</a></h2>
<p class="Pp">If 0, perl ignores <b>setlocale()</b> failing. May be useful with
    some strange <i>locale</i>s.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_PERL_BADFREE_"><a class="permalink" href="#_PERL_BADFREE_">&quot;PERL_BADFREE&quot;</a></h2>
<p class="Pp">If 0, perl would not warn of in case of unwarranted <b>free()</b>.
    With older perls this might be useful in conjunction with the module
    DB_File, which was buggy when dynamically linked and OMF-built.</p>
<p class="Pp">Should not be set with newer Perls, since this may hide some
    <i>real</i> problems.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_PERL_SH_DIR_"><a class="permalink" href="#_PERL_SH_DIR_">&quot;PERL_SH_DIR&quot;</a></h2>
<p class="Pp">Specific for EMX port. Gives the directory part of the location
    for <i>sh.exe</i>.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_USE_PERL_FLOCK_"><a class="permalink" href="#_USE_PERL_FLOCK_">&quot;USE_PERL_FLOCK&quot;</a></h2>
<p class="Pp">Specific for EMX port. Since <b>flock</b>(3) is present in EMX,
    but is not functional, it is emulated by perl. To disable the emulations,
    set environment variable
    <span class="Li">&quot;USE_PERL_FLOCK=0&quot;</span>.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_TMP__or__TEMP_"><a class="permalink" href="#_TMP__or__TEMP_">&quot;TMP&quot;
  or &quot;TEMP&quot;</a></h2>
<p class="Pp">Specific for EMX port. Used as storage place for temporary
  files.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="Evolution"><a class="permalink" href="#Evolution">Evolution</a></h1>
<p class="Pp">Here we list major changes which could make you by surprise.</p>
<section class="Ss">
<h2 class="Ss" id="Text-mode_filehandles"><a class="permalink" href="#Text-mode_filehandles">Text-mode
  filehandles</a></h2>
<p class="Pp">Starting from version 5.8, Perl uses a builtin translation layer
    for text-mode files. This replaces the efficient well-tested EMX layer by
    some code which should be best characterized as a &quot;quick
  hack&quot;.</p>
<p class="Pp">In addition to possible bugs and an inability to follow changes to
    the translation policy with off/on switches of TERMIO translation, this
    introduces a serious incompatible change: before <b>sysread()</b> on
    text-mode filehandles would go through the translation layer, now it would
    not.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Priorities"><a class="permalink" href="#Priorities">Priorities</a></h2>
<p class="Pp"><span class="Li">&quot;setpriority&quot;</span> and
    <span class="Li">&quot;getpriority&quot;</span> are not compatible with
    earlier ports by Andreas Kaiser. See <span class="Li">&quot;setpriority,
    getpriority&quot;</span>.</p>
</section>
<section class="Ss">
<h2 class="Ss">DLL name mangling: pre 5.6.2</h2>
<p class="Pp">With the release 5.003_01 the dynamically loadable libraries
    should be rebuilt when a different version of Perl is compiled. In
    particular, DLLs (including <i>perl.dll</i>) are now created with the names
    which contain a checksum, thus allowing workaround for OS/2 scheme of
    caching DLLs.</p>
<p class="Pp">It may be possible to code a simple workaround which would</p>
<ul class="Bl-bullet">
  <li>find the old DLLs looking through the old
    <span class="Li">@INC</span>;</li>
  <li>mangle the names according to the scheme of new perl and copy the DLLs to
      these names;</li>
  <li>edit the internal <span class="Li">&quot;LX&quot;</span> tables of DLL to
      reflect the change of the name (probably not needed for Perl extension
      DLLs, since the internally coded names are not used for
      &quot;specific&quot; DLLs, they used only for &quot;global&quot;
    DLLs).</li>
  <li>edit the internal <span class="Li">&quot;IMPORT&quot;</span> tables and
      change the name of the &quot;old&quot; <i>perl????.dll</i> to the
      &quot;new&quot; <i>perl????.dll</i>.</li>
</ul>
</section>
<section class="Ss">
<h2 class="Ss">DLL name mangling: 5.6.2 and beyond</h2>
<p class="Pp">In fact mangling of <i>extension</i> DLLs was done due to
    misunderstanding of the OS/2 dynaloading model. OS/2 (effectively) maintains
    two different tables of loaded DLL:</p>
<dl class="Bl-tag">
  <dt id="Global"><a class="permalink" href="#Global">Global DLLs</a></dt>
  <dd>those loaded by the base name from
      <span class="Li">&quot;LIBPATH&quot;</span>; including those associated at
      link time;</dd>
  <dt id="specific"><a class="permalink" href="#specific">specific DLLs</a></dt>
  <dd>loaded by the full name.</dd>
</dl>
<p class="Pp">When resolving a request for a global DLL, the table of
    already-loaded specific DLLs is (effectively) ignored; moreover, specific
    DLLs are <i>always</i> loaded from the prescribed path.</p>
<p class="Pp">There is/was a minor twist which makes this scheme fragile: what
    to do with DLLs loaded from</p>
<dl class="Bl-tag">
  <dt>&quot;BEGINLIBPATH&quot; and &quot;ENDLIBPATH&quot;</dt>
  <dd>(which depend on the process)</dd>
  <dt><i>.</i> from &quot;LIBPATH&quot;</dt>
  <dd>which <i>effectively</i> depends on the process (although
      <span class="Li">&quot;LIBPATH&quot;</span> is the same for all the
      processes).</dd>
</dl>
<p class="Pp">Unless <span class="Li">&quot;LIBPATHSTRICT&quot;</span> is set to
    <span class="Li">&quot;T&quot;</span> (and the kernel is after 2000/09/01),
    such DLLs are considered to be global. When loading a global DLL it is first
    looked in the table of already-loaded global DLLs. Because of this the fact
    that one executable loaded a DLL from
    <span class="Li">&quot;BEGINLIBPATH&quot;</span> and
    <span class="Li">&quot;ENDLIBPATH&quot;</span>, or <i>.</i> from
    <span class="Li">&quot;LIBPATH&quot;</span> may affect <i>which</i> DLL is
    loaded when <i>another</i> executable requests a DLL with the same name.
    <i>This</i> is the reason for version-specific mangling of the DLL name for
    perl DLL.</p>
<p class="Pp">Since the Perl extension DLLs are always loaded with the full
    path, there is no need to mangle their names in a version-specific ways:
    their directory already reflects the corresponding version of perl, and
    <span class="Li">@INC</span> takes into account binary compatibility with
    older version. Starting from <span class="Li">5.6.2</span> the name mangling
    scheme is fixed to be the same as for Perl 5.005_53 (same as in a popular
    binary release). Thus new Perls will be able to <i>resolve the names</i> of
    old extension DLLs if <span class="Li">@INC</span> allows finding their
    directories.</p>
<p class="Pp">However, this still does not guarantee that these DLL may be
    loaded. The reason is the mangling of the name of the <i>Perl DLL</i>. And
    since the extension DLLs link with the Perl DLL, extension DLLs for older
    versions would load an older Perl DLL, and would most probably segfault
    (since the data in this DLL is not properly initialized).</p>
<p class="Pp">There is a partial workaround (which can be made complete with
    newer OS/2 kernels): create a forwarder DLL with the same name as the DLL of
    the older version of Perl, which forwards the entry points to the newer
    Perl's DLL. Make this DLL accessible on (say) the
    <span class="Li">&quot;BEGINLIBPATH&quot;</span> of the new Perl executable.
    When the new executable accesses old Perl's extension DLLs, they would
    request the old Perl's DLL by name, get the forwarder instead, so
    effectively will link with the currently running (new) Perl DLL.</p>
<p class="Pp">This may break in two ways:</p>
<ul class="Bl-bullet">
  <li>Old perl executable is started when a new executable is running has loaded
      an extension compiled for the old executable (ouph!). In this case the old
      executable will get a forwarder DLL instead of the old perl DLL, so would
      link with the new perl DLL. While not directly fatal, it will behave the
      same as new executable. This beats the whole purpose of explicitly
      starting an old executable.</li>
  <li>A new executable loads an extension compiled for the old executable when
      an old perl executable is running. In this case the extension will not
      pick up the forwarder - with fatal results.</li>
</ul>
<p class="Pp">With support for <span class="Li">&quot;LIBPATHSTRICT&quot;</span>
    this may be circumvented - unless one of DLLs is started from <i>.</i> from
    <span class="Li">&quot;LIBPATH&quot;</span> (I do not know whether
    <span class="Li">&quot;LIBPATHSTRICT&quot;</span> affects this case).</p>
<p class="Pp"><b>REMARK</b>. Unless newer kernels allow <i>.</i> in
    <span class="Li">&quot;BEGINLIBPATH&quot;</span> (older do not), this mess
    cannot be completely cleaned. (It turns out that as of the beginning of
    2002, <i>.</i> is not allowed, but <i>.\.</i> is - and it has the same
    effect.)</p>
<p class="Pp"><b>REMARK</b>. <span class="Li">&quot;LIBPATHSTRICT&quot;</span>,
    <span class="Li">&quot;BEGINLIBPATH&quot;</span> and
    <span class="Li">&quot;ENDLIBPATH&quot;</span> are not environment
    variables, although <i>cmd.exe</i> emulates them on
    <span class="Li">&quot;SET</span> <span class="Li">...&quot;</span> lines.
    From Perl they may be accessed by Cwd::extLibpath and
  Cwd::extLibpath_set.</p>
</section>
<section class="Ss">
<h2 class="Ss">DLL forwarder generation</h2>
<p class="Pp">Assume that the old DLL is named <i>perlE0AC.dll</i> (as is one
    for 5.005_53), and the new version is 5.6.1. Create a file
    <i>perl5shim.def-leader</i> with</p>
<p class="Pp"></p>
<pre>  LIBRARY 'perlE0AC' INITINSTANCE TERMINSTANCE
  DESCRIPTION '@#perl5-porters@perl.org:5.006001#@ Perl module for 5.00553 -&gt; Perl 5.6.1 forwarder'
  CODE LOADONCALL
  DATA LOADONCALL NONSHARED MULTIPLE
  EXPORTS
</pre>
<p class="Pp">modifying the versions/names as needed. Run</p>
<p class="Pp"></p>
<pre> perl -wnle &quot;next if 0../EXPORTS/; print qq(  \&quot;$1\&quot;)
                                          if /\&quot;(\w+)\&quot;/&quot; perl5.def &gt;lst
</pre>
<p class="Pp">in the Perl build directory (to make the DLL smaller replace
    perl5.def with the definition file for the older version of Perl if
    present).</p>
<p class="Pp"></p>
<pre> cat perl5shim.def-leader lst &gt;perl5shim.def
 gcc -Zomf -Zdll -o perlE0AC.dll perl5shim.def -s -llibperl
</pre>
<p class="Pp">(ignore multiple <span class="Li">&quot;warning
    L4085&quot;</span>).</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Threading"><a class="permalink" href="#Threading">Threading</a></h2>
<p class="Pp">As of release 5.003_01 perl is linked to multithreaded C RTL DLL.
    If perl itself is not compiled multithread-enabled, so will not be perl's
    <b>malloc()</b>. However, extensions may use multiple thread on their own
    risk.</p>
<p class="Pp">This was needed to compile
    <span class="Li">&quot;Perl/Tk&quot;</span> for XFree86-OS/2 out-of-the-box,
    and link with DLLs for other useful libraries, which typically are compiled
    with <span class="Li">&quot;-Zmt -Zcrtdll&quot;</span>.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Calls_to_external_programs"><a class="permalink" href="#Calls_to_external_programs">Calls
  to external programs</a></h2>
<p class="Pp">Due to a popular demand the perl external program calling has been
    changed wrt Andreas Kaiser's port. <i>If</i> perl needs to call an external
    program <i>via shell</i>, the <i>f:/bin/sh.exe</i> will be called, or
    whatever is the override, see
    &quot;<span class="Li">&quot;PERL_SH_DIR&quot;</span>&quot;.</p>
<p class="Pp">Thus means that you need to get some copy of a <i>sh.exe</i> as
    well (I use one from pdksh). The path <i>F:/bin</i> above is set up
    automatically during the build to a correct value on the builder machine,
    but is overridable at runtime,</p>
<p class="Pp"><b>Reasons:</b> a consensus on
    <span class="Li">&quot;perl5-porters&quot;</span> was that perl should use
    one non-overridable shell per platform. The obvious choices for OS/2 are
    <i>cmd.exe</i> and <i>sh.exe</i>. Having perl build itself would be
    impossible with <i>cmd.exe</i> as a shell, thus I picked up
    <span class="Li">&quot;sh.exe&quot;</span>. This assures almost 100%
    compatibility with the scripts coming from *nix. As an added benefit this
    works as well under DOS if you use DOS-enabled port of pdksh (see
    &quot;Prerequisites&quot;).</p>
<p class="Pp"><b>Disadvantages:</b> currently <i>sh.exe</i> of pdksh calls
    external programs via <b>fork()</b>/<b>exec()</b>, and there is <i>no</i>
    functioning <b>exec()</b> on OS/2. <b>exec()</b> is emulated by EMX by an
    asynchronous call while the caller waits for child completion (to pretend
    that the <span class="Li">&quot;pid&quot;</span> did not change). This means
    that 1 <i>extra</i> copy of <i>sh.exe</i> is made active via
    <b>fork()</b>/<b>exec()</b>, which may lead to some resources taken from the
    system (even if we do not count extra work needed for <b>fork()</b>ing).</p>
<p class="Pp">Note that this a lesser issue now when we do not spawn
    <i>sh.exe</i> unless needed (metachars found).</p>
<p class="Pp">One can always start <i>cmd.exe</i> explicitly via</p>
<p class="Pp"></p>
<pre>  system 'cmd', '/c', 'mycmd', 'arg1', 'arg2', ...
</pre>
<p class="Pp">If you need to use <i>cmd.exe</i>, and do not want to hand-edit
    thousands of your scripts, the long-term solution proposed on p5-p is to
    have a directive</p>
<p class="Pp"></p>
<pre>  use OS2::Cmd;
</pre>
<p class="Pp">which will override <b>system()</b>, <b>exec()</b>,
    <span class="Li">&quot;``&quot;</span>, and
    <span class="Li">&quot;open(,'...|')&quot;</span>. With current perl you may
    override only <b>system()</b>, <b>readpipe()</b> - the explicit version of
    <span class="Li">&quot;``&quot;</span>, and maybe <b>exec()</b>. The code
    will substitute the one-argument call to <b>system()</b> by
    <span class="Li">&quot;CORE::system('cmd.exe', '/c',
  shift)&quot;</span>.</p>
<p class="Pp">If you have some working code for
    <span class="Li">&quot;OS2::Cmd&quot;</span>, please send it to me, I will
    include it into distribution. I have no need for such a module, so cannot
    test it.</p>
<p class="Pp">For the details of the current situation with calling external
    programs, see &quot;Starting OS/2 (and DOS) programs under Perl&quot;. Set
    us mention a couple of features:</p>
<ul class="Bl-bullet">
  <li>External scripts may be called by their basename. Perl will try the same
      extensions as when processing <b>-S</b> command-line switch.</li>
  <li>External scripts starting with <span class="Li">&quot;#!&quot;</span> or
      <span class="Li">&quot;extproc &quot;</span> will be executed directly,
      without calling the shell, by calling the program specified on the rest of
      the first line.</li>
</ul>
</section>
<section class="Ss">
<h2 class="Ss" id="Memory_allocation"><a class="permalink" href="#Memory_allocation">Memory
  allocation</a></h2>
<p class="Pp">Perl uses its own <b>malloc()</b> under OS/2 - interpreters are
    usually malloc-bound for speed, but perl is not, since its malloc is
    lightning-fast. Perl-memory-usage-tuned benchmarks show that Perl's malloc
    is 5 times quicker than EMX one. I do not have convincing data about memory
    footprint, but a (pretty random) benchmark showed that Perl's one is 5%
    better.</p>
<p class="Pp">Combination of perl's <b>malloc()</b> and rigid DLL name
    resolution creates a special problem with library functions which expect
    their return value to be <b>free()</b>d by system's <b>free()</b>. To
    facilitate extensions which need to call such functions, system
    memory-allocation functions are still available with the prefix
    <span class="Li">&quot;emx_&quot;</span> added. (Currently only DLL perl has
    this, it should propagate to <i>perl_.exe</i> shortly.)</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Threads"><a class="permalink" href="#Threads">Threads</a></h2>
<p class="Pp">One can build perl with thread support enabled by providing
    <span class="Li">&quot;-D usethreads&quot;</span> option to
    <i>Configure</i>. Currently OS/2 support of threads is very preliminary.</p>
<p class="Pp">Most notable problems:</p>
<dl class="Bl-tag">
  <dt>&quot;COND_WAIT&quot;</dt>
  <dd>may have a race condition (but probably does not due to edge-triggered
      nature of OS/2 Event semaphores). (Needs a reimplementation (in terms of
      chaining waiting threads, with the linked list stored in per-thread
      structure?)?)</dd>
  <dt id="os2.c"><a class="permalink" href="#os2.c"><i>os2.c</i></a></dt>
  <dd>has a couple of static variables used in OS/2-specific functions. (Need to
      be moved to per-thread structure, or serialized?)</dd>
</dl>
<p class="Pp">Note that these problems should not discourage experimenting,
    since they have a low probability of affecting small programs.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="BUGS"><a class="permalink" href="#BUGS">BUGS</a></h1>
<p class="Pp">This description is not updated often (since 5.6.1?), see
    <i>./os2/Changes</i> for more info.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHOR"><a class="permalink" href="#AUTHOR">AUTHOR</a></h1>
<p class="Pp">Ilya Zakharevich, cpan@ilyaz.org</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><b>perl</b>(1).</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2022-02-26</td>
    <td class="foot-os"><a href="..">perl v5.34.1</a></td>
  </tr>
</table>
</body>
</html>
