<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>SPFQUERY(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">SPFQUERY(1)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">SPFQUERY(1)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">spfquery - (Mail::SPF) - Checks if a given set of e-mail
    parameters matches a domain's SPF policy</p>
</section>
<section class="Sh">
<h1 class="Sh" id="VERSION"><a class="permalink" href="#VERSION">VERSION</a></h1>
<p class="Pp">2.501</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<dl class="Bl-tag">
  <dt id="Preferred"><a class="permalink" href="#Preferred"><b>Preferred
    usage:</b></a></dt>
  <dd><b>spfquery</b> [<b>--versions</b>|<b>-v</b> <b>1</b>|<b>2</b>|<b>1,2</b>]
      [<b>--scope</b>|<b>-s</b> <b>helo</b>|<b>mfrom</b>|<b>pra</b>]
      <b>--identity</b>|<b>--id</b> <i>identity</i>
      <b>--ip-address</b>|<b>--ip</b> <i>ip-address</i>
      [<b>--helo-identity</b>|<b>--helo-id</b> <i>helo-identity</i>]
      [<i>OPTIONS</i>]
    <p class="Pp"><b>spfquery</b> [<b>--versions</b>|<b>-v</b>
        <b>1</b>|<b>2</b>|<b>1,2</b>] [<b>--scope</b>|<b>-s</b>
        <b>helo</b>|<b>mfrom</b>|<b>pra</b>] <b>--file</b>|<b>-f</b>
        <i>filename</i>|<b>-</b> [<i>OPTIONS</i>]</p>
  </dd>
  <dt id="Legacy"><a class="permalink" href="#Legacy"><b>Legacy
    usage:</b></a></dt>
  <dd><b>spfquery</b> <b>--helo</b> <i>helo-identity</i>
      <b>--ip-address</b>|<b>--ip</b> <i>ip-address</i> [<i>OPTIONS</i>]
    <p class="Pp"><b>spfquery</b> <b>--mfrom</b> <i>mfrom-identity</i>
        <b>--ip-address</b>|<b>--ip</b> <i>ip-address</i> [<b>--helo</b>
        <i>helo-identity</i>] [<i>OPTIONS</i>]</p>
    <p class="Pp"><b>spfquery</b> <b>--pra</b> <i>pra-identity</i>
        <b>--ip-address</b>|<b>--ip</b> <i>ip-address</i> [<i>OPTIONS</i>]</p>
  </dd>
  <dt id="Other"><a class="permalink" href="#Other"><b>Other usage:</b></a></dt>
  <dd><b>spfquery</b> <b>--version</b>|<b>-V</b>
    <p class="Pp"><b>spfquery</b> <b>--help</b></p>
  </dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp"><b>spfquery</b> checks if a given set of e-mail parameters (e.g.,
    the SMTP sender's IP address) matches the responsible domain's Sender Policy
    Framework (SPF) policy. For more information on SPF see
    &lt;http://www.openspf.org&gt;.</p>
<section class="Ss">
<h2 class="Ss" id="Preferred_Usage"><a class="permalink" href="#Preferred_Usage">Preferred
  Usage</a></h2>
<p class="Pp">The following usage forms are preferred over the legacy forms used
    by older <b>spfquery</b> versions:</p>
<p class="Pp">The <b>--identity</b> form checks if the given <i>ip-address</i>
    is an authorized SMTP sender for the given
    <span class="Li">&quot;helo&quot;</span> hostname,
    <span class="Li">&quot;mfrom&quot;</span> envelope sender e-mail address, or
    <span class="Li">&quot;pra&quot;</span> (so-called purported resonsible
    address) e-mail address, depending on the value of the <b>--scope</b> option
    (which defaults to <b>mfrom</b> if omitted).</p>
<p class="Pp">The <b>--file</b> form reads &quot;<i>ip-address</i>
    <i>identity</i> [<i>helo-identity</i>]&quot; tuples from the file with the
    specified <i>filename</i>, or from standard input if <i>filename</i> is
    <b>-</b>, and checks them against the specified scope (<b>mfrom</b> by
    default).</p>
<p class="Pp">Both forms support an optional <b>--versions</b> option, which
    specifies a comma-separated list of the SPF version numbers of SPF records
    that may be used. <b>1</b> means that
    <span class="Li">&quot;v=spf1&quot;</span> records should be used. <b>2</b>
    means that <span class="Li">&quot;spf2.0&quot;</span> records should be
    used. Defaults to <b>1,2</b>, i.e., uses any SPF records that are available.
    Records of a higher version are preferred.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Legacy_Usage"><a class="permalink" href="#Legacy_Usage">Legacy
  Usage</a></h2>
<p class="Pp"><b>spfquery</b> versions before 2.500 featured the following usage
    forms, which are discouraged but still supported for backwards
    compatibility:</p>
<p class="Pp">The <b>--helo</b> form checks if the given <i>ip-address</i> is an
    authorized SMTP sender for the <span class="Li">&quot;HELO&quot;</span>
    hostname given as the <i>identity</i> (so-called
    <span class="Li">&quot;HELO&quot;</span> check).</p>
<p class="Pp">The <b>--mfrom</b> form checks if the given <i>ip-address</i> is
    an authorized SMTP sender for the envelope sender email-address (or domain)
    given as the <i>identity</i> (so-called <span class="Li">&quot;MAIL
    FROM&quot;</span> check). If a domain is given instead of an e-mail address,
    <span class="Li">&quot;postmaster&quot;</span> will be substituted for the
    localpart.</p>
<p class="Pp">The <b>--pra</b> form checks if the given <i>ip-address</i> is an
    authorized SMTP sender for the PRA (Purported Responsible Address) e-mail
    address given as the identity.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Other_Usage"><a class="permalink" href="#Other_Usage">Other
  Usage</a></h2>
<p class="Pp">The <b>--version</b> form prints version information of spfquery.
    The <b>--help</b> form prints usage information for spfquery.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="OPTIONS"><a class="permalink" href="#OPTIONS">OPTIONS</a></h1>
<section class="Ss">
<h2 class="Ss" id="Standard_Options"><a class="permalink" href="#Standard_Options">Standard
  Options</a></h2>
<p class="Pp">The preferred and legacy forms optionally take any of the
    following <i>OPTIONS</i>:</p>
<dl class="Bl-tag">
  <dt id="default"><a class="permalink" href="#default"><b>--default-explanation</b>
    <i>string</i></a></dt>
  <dd></dd>
  <dt id="def"><a class="permalink" href="#def"><b>--def-exp</b>
    <i>string</i></a></dt>
  <dd>Use the specified <i>string</i> as the default explanation if the
      authority domain does not specify an explanation string of its own.</dd>
  <dt id="hostname"><a class="permalink" href="#hostname"><b>--hostname</b>
    <i>hostname</i></a></dt>
  <dd>Use <i>hostname</i> as the host name of the local system instead of
      auto-detecting it.</dd>
  <dt id="keep"><a class="permalink" href="#keep"><b>--keep-comments</b></a></dt>
  <dd></dd>
  <dt id="no"><a class="permalink" href="#no"><b>--no-keep-comments</b></a></dt>
  <dd>Do (not) print any comments found when reading from a file or from
      standard input.</dd>
  <dt id="sanitize"><a class="permalink" href="#sanitize"><b>--sanitize</b>
    (currently ignored)</a></dt>
  <dd></dd>
  <dt id="no~2"><a class="permalink" href="#no~2"><b>--no-sanitize</b>
    (currently ignored)</a></dt>
  <dd>Do (not) sanitize the output by condensing consecutive white-space into a
      single space and replacing non-printable characters with question marks.
      Enabled by default.</dd>
  <dt id="debug"><a class="permalink" href="#debug"><b>--debug</b> (currently
    ignored)</a></dt>
  <dd>Print out debug information.</dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="Black_Magic_Options"><a class="permalink" href="#Black_Magic_Options">Black
  Magic Options</a></h2>
<p class="Pp">Several options that were supported by earlier versions of
    <b>spfquery</b> are considered black magic (i.e. potentially dangerous for
    the innocent user) and are thus disabled by default. If the
    <b>Mail::SPF::BlackMagic</b> Perl module is installed, they may be enabled
    by specifying <b>--enable-black-magic</b>.</p>
<dl class="Bl-tag">
  <dt id="max"><a class="permalink" href="#max"><b>--max-dns-interactive-terms</b>
    <i>n</i></a></dt>
  <dd>Evaluate a maximum of <i>n</i> DNS-interactive mechanisms and modifiers
      per SPF check. Defaults to <b>10</b>. Do <i>not</i> override the default
      unless you know what you are doing!</dd>
  <dt id="max~2"><a class="permalink" href="#max~2"><b>--max-name-lookups-per-term</b>
    <i>n</i></a></dt>
  <dd>Perform a maximum of <i>n</i> DNS name look-ups per mechanism or modifier.
      Defaults to <b>10</b>. Do <i>not</i> override the default unless you know
      what you are doing!</dd>
  <dt id="authorize"><a class="permalink" href="#authorize"><b>--authorize-mxes-for</b>
    <i>email-address</i>|<i>domain</i><b>,</b>...</a></dt>
  <dd>Consider all the MXes of the comma-separated list of
      <i>email-address</i>es and <i>domain</i>s as inherently authorized.</dd>
  <dt id="tfwl"><a class="permalink" href="#tfwl"><b>--tfwl</b></a></dt>
  <dd>Perform <span class="Li">&quot;trusted-forwarder.org&quot;</span>
      accreditation checking.</dd>
  <dt id="guess"><a class="permalink" href="#guess"><b>--guess</b>
    <i>spf-terms</i></a></dt>
  <dd>Use <i>spf-terms</i> as a default record if no SPF record is found.</dd>
  <dt id="local"><a class="permalink" href="#local"><b>--local</b>
    <i>spf-terms</i></a></dt>
  <dd>Process <i>spf-terms</i> as local policy before resorting to a default
      result (the implicit or explicit <span class="Li">&quot;all&quot;</span>
      mechanism at the end of the domain's SPF record). For example, this could
      be used for white-listing one's secondary MXes:
      <span class="Li">&quot;mx:mydomain.example.org&quot;</span>.</dd>
  <dt id="override"><a class="permalink" href="#override"><b>--override</b>
    <i>domain</i><b>=</b><i>spf-record</i></a></dt>
  <dd></dd>
  <dt id="fallback"><a class="permalink" href="#fallback"><b>--fallback</b>
    <i>domain</i><b>=</b><i>spf-record</i></a></dt>
  <dd>Set overrides and fallbacks. Each option can be specified multiple times.
      For example:
    <p class="Pp"></p>
    <pre>    --override example.org='v=spf1 -all'
    --override '*.example.net'='v=spf1 a mx -all'
    --fallback example.com='v=spf1 -all'
    </pre>
  </dd>
</dl>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="RESULT_CODES"><a class="permalink" href="#RESULT_CODES">RESULT
  CODES</a></h1>
<dl class="Bl-tag">
  <dt id="pass"><a class="permalink" href="#pass"><b>pass</b></a></dt>
  <dd>The specified IP address is an authorized SMTP sender for the
    identity.</dd>
  <dt id="fail"><a class="permalink" href="#fail"><b>fail</b></a></dt>
  <dd>The specified IP address is not an authorized SMTP sender for the
      identity.</dd>
  <dt id="softfail"><a class="permalink" href="#softfail"><b>softfail</b></a></dt>
  <dd>The specified IP address is not an authorized SMTP sender for the
      identity, however the authority domain is still testing out its SPF
      policy.</dd>
  <dt id="neutral"><a class="permalink" href="#neutral"><b>neutral</b></a></dt>
  <dd>The identity's authority domain makes no assertion about the status of the
      IP address.</dd>
  <dt id="permerror"><a class="permalink" href="#permerror"><b>permerror</b></a></dt>
  <dd>A permanent error occurred while evaluating the authority domain's policy
      (e.g., a syntax error in the SPF record). Manual intervention is required
      from the authority domain.</dd>
  <dt id="temperror"><a class="permalink" href="#temperror"><b>temperror</b></a></dt>
  <dd>A temporary error occurred while evaluating the authority domain's policy
      (e.g., a DNS error). Try again later.</dd>
  <dt id="none"><a class="permalink" href="#none"><b>none</b></a></dt>
  <dd>There is no applicable SPF policy for the identity domain.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="EXIT_CODES"><a class="permalink" href="#EXIT_CODES">EXIT
  CODES</a></h1>
<pre>  Result    | Exit code
 -----------+-----------
  pass      |     0
  fail      |     1
  softfail  |     2
  neutral   |     3
  permerror |     4
  temperror |     5
  none      |     6
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="EXAMPLES"><a class="permalink" href="#EXAMPLES">EXAMPLES</a></h1>
<pre>    spfquery --scope mfrom --id user@example.com --ip 1.2.3.4
    spfquery --file test_data
    echo &quot;127.0.0.1 user@example.com helohost.example.com&quot; | spfquery -f -
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="COMPATIBILITY"><a class="permalink" href="#COMPATIBILITY">COMPATIBILITY</a></h1>
<p class="Pp"><b>spfquery</b> has undergone the following interface changes
    compared to earlier versions:</p>
<dl class="Bl-tag">
  <dt><b>2.500</b></dt>
  <dd></dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>A new preferred usage style for performing individual SPF checks has been
      introduced. The new style accepts a unified <b>--identity</b> option and
      an optional <b>--scope</b> option that specifies the type (scope) of the
      identity. In contrast, the legacy usage style requires a separate usage
      form for every supported scope. See &quot;Preferred usage&quot; and
      &quot;Legacy usage&quot; for details.</li>
  <li>The former <span class="Li">&quot;unknown&quot;</span> and
      <span class="Li">&quot;error&quot;</span> result codes have been renamed
      to <span class="Li">&quot;permerror&quot;</span> and
      <span class="Li">&quot;temperror&quot;</span>, respectively, in order to
      comply with RFC 4408 terminology.</li>
  <li>SPF checks with an empty identity are no longer supported. In the case of
      an empty <span class="Li">&quot;MAIL FROM&quot;</span> SMTP transaction
      parameter, perform a check with the
      <span class="Li">&quot;helo&quot;</span> scope directly.</li>
  <li>The <b>--debug</b> and <b>--(no-)sanitize</b> options are currently
      ignored by this version of <b>spfquery</b>. They will again be supported
      in the future.</li>
  <li>Several features that were supported by earlier versions of
      <b>spfquery</b> are considered black magic and thus are now disabled by
      default. See &quot;Black Magic Options&quot;.</li>
  <li>Several option names have been deprecated. This is a list of them and
      their preferred synonyms:
    <p class="Pp"></p>
    <pre>  Deprecated options  | Preferred options
 ---------------------+-----------------------------
  --sender, -s        | --mfrom
  --ipv4, -i          | --ip-address, --ip
  --name              | --hostname
  --max-lookup-count, | --max-dns-interactive-terms
    --max-lookup      |
  --rcpt-to, -r       | --authorize-mxes-for
  --trusted           | --tfwl
    </pre>
  </li>
</ul>
</div>
<div class="Bd-indent"></div>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp">Mail::SPF, <b>spfd</b>(8)</p>
<p class="Pp">&lt;http://tools.ietf.org/html/rfc4408&gt;</p>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHORS"><a class="permalink" href="#AUTHORS">AUTHORS</a></h1>
<p class="Pp">This version of <b>spfquery</b> is a complete rewrite by Julian
    Mehnle &lt;julian@mehnle.net&gt;, based on an earlier version written by
    Meng Weng Wong &lt;mengwong+spf@pobox.com&gt; and Wayne Schlitt
    &lt;wayne@schlitt.net&gt;.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2023-11-12</td>
    <td class="foot-os">perl v5.30.3</td>
  </tr>
</table>
</body>
</html>
