<!DOCTYPE html>
<html lang="en">
<!-- This is an automatically generated file.  Do not edit.
   Copyright (c) 2003-2005 Lars Hellstr\[u00F6]m <Lars dot Hellstrom at residenset dot net>
  
   The definitions below are for supplemental macros used in Tcl/Tk
   manual entries.
  
   .AP type name in/out ?indent?
  	Start paragraph describing an argument to a library procedure.
  	type is type of argument (int, etc.), in/out is either "in", "out",
  	or "in/out" to describe whether procedure reads or modifies arg,
  	and indent is equivalent to second arg of .IP (shouldn't ever be
  	needed;  use .AS below instead)
  
   .AS ?type? ?name?
  	Give maximum sizes of arguments for setting tab stops.  Type and
  	name are examples of largest possible arguments that will be passed
  	to .AP later.  If args are omitted, default tab stops are used.
  
   .BS
  	Start box enclosure.  From here until next .BE, everything will be
  	enclosed in one large box.
  
   .BE
  	End of box enclosure.
  
   .CS
  	Begin code excerpt.
  
   .CE
  	End code excerpt.
  
   .VS ?version? ?br?
  	Begin vertical sidebar, for use in marking newly-changed parts
  	of man pages.  The first argument is ignored and used for recording
  	the version when the .VS was added, so that the sidebars can be
  	found and removed when they reach a certain age.  If another argument
  	is present, then a line break is forced before starting the sidebar.
  
   .VE
  	End of vertical sidebar.
  
   .DS
  	Begin an indented unfilled display.
  
   .DE
  	End of indented unfilled display.
  
   .SO
  	Start of list of standard options for a Tk widget.  The
  	options follow on successive lines, in four columns separated
  	by tabs.
  
   .SE
  	End of list of standard options for a Tk widget.
  
   .OP cmdName dbName dbClass
  	Start of description of a specific option.  cmdName gives the
  	option's name as specified in the class command, dbName gives
  	the option's name in the option database, and dbClass gives
  	the option's class in the option database.
  
   .UL arg1 arg2
  	Print arg1 underlined, then print arg2 normally.
  
   RCS: @(#) $Id: man.macros,v 1.1 2009/01/30 04:56:47 andreas_kupries Exp $
  
  	# Set up traps and other miscellaneous stuff for Tcl/Tk man pages.
 -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>docstrip(n)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">docstrip(n)</td>
    <td class="head-vol"><a href=".">Literate programming tool</a></td>
    <td class="head-rtitle">docstrip(n)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<pre>
</pre>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">docstrip - Docstrip style source code extraction</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<p class="Pp">package require <b>Tcl 8.4</b></p>
<p class="Pp">package require <b>docstrip ?1.2?</b></p>
<p class="Pp"><b>docstrip::extract</b> <i>text</i> <i>terminals</i>
    ?<i>option</i> <i>value</i> ...?</p>
<p class="Pp"><b>docstrip::sourcefrom</b> <i>filename</i> <i>terminals</i>
    ?<i>option</i> <i>value</i> ...?</p>
<p class="Pp"></p>
<pre>
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp"><b>Docstrip</b> is a tool created to support a brand of Literate
    Programming. It is most common in the (La)TeX community, where it is being
    used for pretty much everything from the LaTeX core and up, but there is
    nothing about <b>docstrip</b> which prevents using it for other types of
    software.</p>
<p class="Pp">In short, the basic principle of literate programming is that
    program source should primarily be written and structured to suit the
    developers (and advanced users who want to peek &quot;under the hood&quot;),
    not to suit the whims of a compiler or corresponding source code consumer.
    This means literate sources often need some kind of &quot;translation&quot;
    to an illiterate form that dumb software can understand. The <b>docstrip</b>
    Tcl package handles this translation.</p>
<p class="Pp">Even for those who do not whole-hartedly subscribe to the
    philosophy behind literate programming, <b>docstrip</b> can bring greater
    clarity to in particular:</p>
<ul class="Bl-bullet">
  <li>programs employing non-obvious mathematics</li>
  <li>projects where separate pieces of code, perhaps in different languages,
      need to be closely coordinated.</li>
</ul>
<p class="Pp">The first is by providing access to much more powerful
    typographical features for source code comments than are possible in plain
    text. The second is because all the separate pieces of code can be kept next
    to each other in the same source file.</p>
<p class="Pp">The way it works is that the programmer edits directly only one or
    several &quot;master&quot; source code files, from which <b>docstrip</b>
    generates the more traditional &quot;source&quot; files compilers or the
    like would expect. The master sources typically contain a large amount of
    documentation of the code, sometimes even in places where the code consumers
    would not allow any comments. The etymology of &quot;docstrip&quot; is that
    this <i>doc</i>umentation was <i>strip</i>ped away (although &quot;code
    extraction&quot; might be a better description, as it has always been a
    matter of copying selected pieces of the master source rather than deleting
    text from it). The <b>docstrip</b> Tcl package contains a reimplementation
    of the basic extraction functionality from the <b>docstrip</b> program, and
    thus makes it possible for a Tcl interpreter to read and interpret the
    master source files directly.</p>
<p class="Pp">Readers who are not previously familiar with <b>docstrip</b> but
    want to know more about it may consult the following sources.</p>
<dl class="Bl-tag">
  <dt>[1]</dt>
  <dd><i>The tclldoc package and class</i>,
      <i>http://tug.org/tex-archive/macros/latex/contrib/tclldoc/</i>.</dd>
  <dt>[2]</dt>
  <dd><i>The DocStrip utility</i>,
      <i>http://tug.org/tex-archive/macros/latex/base/docstrip.dtx</i>.</dd>
  <dt>[3]</dt>
  <dd><i>The doc and shortvrb Packages</i>,
      <i>http://tug.org/tex-archive/macros/latex/base/doc.dtx</i>.</dd>
  <dt>[4]</dt>
  <dd>Chapter 14 of <i>The LaTeX Companion</i> (second edition), Addison-Wesley,
      2004; ISBN 0-201-36299-6.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="FILE_FORMAT"><a class="permalink" href="#FILE_FORMAT">FILE
  FORMAT</a></h1>
<p class="Pp">The basic unit <b>docstrip</b> operates on are the <i>lines</i> of
    a master source file. Extraction consists of selecting some of these lines
    to be copied from input text to output text. The basic distinction is that
    between <i>code lines</i> (which are copied and do not begin with a percent
    character) and <i>comment lines</i> (which begin with a percent character
    and are not copied).</p>
<pre>
   docstrip::extract [join {
     {% comment}
     {% more comment !&quot;#$%&amp;/(}
     {some command}
     { % blah $blah &quot;Not a comment.&quot;}
     {% abc; this is comment}
     {# def; this is code}
     {ghi}
     {% jkl}
   } \n] {}
</pre>
<p class="Pp">returns the same sequence of lines as</p>
<pre>
   join {
     {some command}
     { % blah $blah &quot;Not a comment.&quot;}
     {# def; this is code}
     {ghi} &quot;&quot;
   } \n
</pre>
<p class="Pp">It does not matter to <b>docstrip</b> what format is used for the
    documentation in the comment lines, but in order to do better than plain
    text comments, one typically uses some markup language. Most commonly LaTeX
    is used, as that is a very established standard and also provides the best
    support for mathematical formulae, but the <b>docstrip::util</b> package
    also gives some support for <i>doctools</i>-like markup.</p>
<p class="Pp">Besides the basic code and comment lines, there are also <i>guard
    lines</i>, which begin with the two characters '%&lt;', and <i>meta-comment
    lines</i>, which begin with the two characters &#x00B4;%%'. Within guard
    lines there is furthermore the distinction between <i>verbatim guard
    lines</i>, which begin with '%&lt;&lt;', and ordinary guard lines, where the
    '%&lt;' is not followed by another '&lt;'. The last category is by far the
    most common.</p>
<p class="Pp">Ordinary guard lines conditions extraction of the code line(s)
    they guard by the value of a boolean expression; the guarded block of code
    lines will only be included if the expression evaluates to true. The syntax
    of an ordinary guard line is one of</p>
<pre>
    '%' '&lt;' STARSLASH EXPRESSION '&gt;'
    '%' '&lt;' PLUSMINUS EXPRESSION '&gt;' CODE
</pre>
where
<pre>
    STARSLASH  ::=  '*' | '/'
    PLUSMINUS  ::=  '+' | '-' |
    EXPRESSION ::= SECONDARY | SECONDARY ',' EXPRESSION
                 | SECONDARY '|' EXPRESSION
    SECONDARY  ::= PRIMARY | PRIMARY '&amp;' SECONDARY
    PRIMARY    ::= TERMINAL | '!' PRIMARY | '(' EXPRESSION ')'
    CODE       ::= { any character except end-of-line }
</pre>
Comma and vertical bar both denote 'or'. Ampersand denotes 'and'. Exclamation
  mark denotes 'not'. A TERMINAL can be any nonempty string of characters not
  containing '&gt;', '&amp;', '|', comma, '(', or ')', although the
  <b>docstrip</b> manual is a bit restrictive and only guarantees proper
  operation for strings of letters (although even the LaTeX core sources make
  heavy use also of digits in TERMINALs). The second argument of
  <b>docstrip::extract</b> is the list of those TERMINALs that should count as
  having the value 'true'; all other TERMINALs count as being 'false' when guard
  expressions are evaluated.
<p class="Pp">In the case of a '%&lt;*<i>EXPRESSION</i>&gt;' guard, the lines
    guarded are all lines up to the next '%&lt;/<i>EXPRESSION</i>&gt;' guard
    with the same <i>EXPRESSION</i> (compared as strings). The blocks of code
    delimited by such '*' and '/' guard lines must be properly nested.</p>
<pre>
   set text [join {
      {begin}
      {%&lt;*foo&gt;}
      {1}
      {%&lt;*bar&gt;}
      {2}
      {%&lt;/bar&gt;}
      {%&lt;*!bar&gt;}
      {3}
      {%&lt;/!bar&gt;}
      {4}
      {%&lt;/foo&gt;}
      {5}
      {%&lt;*bar&gt;}
      {6}
      {%&lt;/bar&gt;}
      {end}
   } \n]
   set res [docstrip::extract $text foo]
   append res [docstrip::extract $text {foo bar}]
   append res [docstrip::extract $text bar]
</pre>
sets $res to the result of
<pre>
   join {
      {begin}
      {1}
      {3}
      {4}
      {5}
      {end}
      {begin}
      {1}
      {2}
      {4}
      {5}
      {6}
      {end}
      {begin}
      {5}
      {6}
      {end} &quot;&quot;
   } \n
</pre>
In guard lines without a '*', '/', '+', or '-' modifier after the
  &#x00B4;%&lt;', the guard applies only to the CODE following the '&gt;' on
  that single line. A '+' modifier is equivalent to no modifier. A '-' modifier
  is like the case with no modifier, but the expression is implicitly negated,
  i.e., the CODE of a '%&lt;-' guard line is only included if the expression
  evaluates to false.
<p class="Pp">Metacomment lines are &quot;comment lines which should not be
    stripped away&quot;, but be extracted like code lines; these are sometimes
    used for copyright notices and similar material. The '%%' prefix is however
    not kept, but substituted by the current <b>-metaprefix</b>, which is
    customarily set to some &quot;comment until end of line&quot; character (or
    character sequence) of the language of the code being extracted.</p>
<pre>
   set text [join {
      {begin}
      {%&lt;foo&gt; foo}
      {%&lt;+foo&gt;plusfoo}
      {%&lt;-foo&gt;minusfoo}
      {middle}
      {%% some metacomment}
      {%&lt;*foo&gt;}
      {%%another metacomment}
      {%&lt;/foo&gt;}
      {end}
   } \n]
   set res [docstrip::extract $text foo -metaprefix {# }]
   append res [docstrip::extract $text bar -metaprefix {#}]
</pre>
sets $res to the result of
<pre>
   join {
      {begin}
      { foo}
      {plusfoo}
      {middle}
      {#  some metacomment}
      {# another metacomment}
      {end}
      {begin}
      {minusfoo}
      {middle}
      {# some metacomment}
      {end} &quot;&quot;
   } \n
</pre>
Verbatim guards can be used to force code line interpretation of a block of
  lines even if some of them happen to look like any other type of lines to
  docstrip. A verbatim guard has the form '%&lt;&lt;<i>END-TAG</i>' and the
  verbatim block is terminated by the first line that is exactly
  '%<i>END-TAG</i>'.
<pre>
   set text [join {
      {begin}
      {%&lt;*myblock&gt;}
      {some stupid()}
      {   #computer&lt;program&gt;}
      {%&lt;&lt;QQQ-98765}
      {% These three lines are copied verbatim (including percents}
      {%% even if -metaprefix is something different than %%).}
      {%&lt;/myblock&gt;}
      {%QQQ-98765}
      {   using*strange@programming&lt;language&gt;}
      {%&lt;/myblock&gt;}
      {end}
   } \n]
   set res [docstrip::extract $text myblock -metaprefix {# }]
   append res [docstrip::extract $text {}]
</pre>
sets $res to the result of
<pre>
   join {
      {begin}
      {some stupid()}
      {   #computer&lt;program&gt;}
      {% These three lines are copied verbatim (including percents}
      {%% even if -metaprefix is something different than %%).}
      {%&lt;/myblock&gt;}
      {   using*strange@programming&lt;language&gt;}
      {end}
      {begin}
      {end} &quot;&quot;
   } \n
</pre>
The processing of verbatim guards takes place also inside blocks of lines which
  due to some outer block guard will not be copied.
<p class="Pp">The final piece of <b>docstrip</b> syntax is that extraction stops
    at a line that is exactly &quot;\endinput&quot;; this is often used to avoid
    copying random whitespace at the end of a file. In the unlikely case that
    one wants such a code line, one can protect it with a verbatim guard.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="COMMANDS"><a class="permalink" href="#COMMANDS">COMMANDS</a></h1>
<p class="Pp">The package defines two commands.</p>
<dl class="Bl-tag">
  <dt id="docstrip::extract"><a class="permalink" href="#docstrip::extract"><b>docstrip::extract</b>
    <i>text</i> <i>terminals</i> ?<i>option</i> <i>value</i> ...?</a></dt>
  <dd>The <b>extract</b> command docstrips the <i>text</i> and returns the
      extracted lines of code, as a string with each line terminated with a
      newline. The <i>terminals</i> is the list of those guard expression
      terminals which should evaluate to true. The available options are:</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt id="annotate"><a class="permalink" href="#annotate"><b>-annotate</b>
    <i>lines</i></a></dt>
  <dd>Requests the specified number of lines of annotation to follow each
      extracted line in the result. Defaults to 0. Annotation lines are mostly
      useful when the extracted lines are to undergo some further
      transformation. A first annotation line is a list of three elements: line
      type, prefix removed in extraction, and prefix inserted in extraction. The
      line type is one of: 'V' (verbatim), &#x00B4;M' (metacomment), '+' (+ or
      no modifier guard line), '-' (- modifier guard line), '.' (normal line). A
      second annotation line is the source line number. A third annotation line
      is the current stack of block guards. Requesting more than three lines of
      annotation is currently not supported.</dd>
  <dt id="metaprefix"><a class="permalink" href="#metaprefix"><b>-metaprefix</b>
    <i>string</i></a></dt>
  <dd>The string by which the '%%' prefix of a metacomment line will be
      replaced. Defaults to '%%'. For Tcl code this would typically be '#'.</dd>
  <dt id="onerror"><a class="permalink" href="#onerror"><b>-onerror</b>
    <i>keyword</i></a></dt>
  <dd>Controls what will be done when a format error in the <i>text</i> being
      processed is detected. The settings are:</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt id="ignore"><a class="permalink" href="#ignore"><b>ignore</b></a></dt>
  <dd>Just ignore the error; continue as if nothing happened.</dd>
  <dt id="puts"><a class="permalink" href="#puts"><b>puts</b></a></dt>
  <dd>Write an error message to <b>stderr</b>, then continue processing.</dd>
  <dt id="throw"><a class="permalink" href="#throw"><b>throw</b></a></dt>
  <dd>Throw an error. <b>::errorCode</b> is set to a list whose first element is
      <b>DOCSTRIP</b>, second element is the type of error, and third element is
      the line number where the error is detected. This is the default.</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt id="trimlines"><a class="permalink" href="#trimlines"><b>-trimlines</b>
    <i>boolean</i></a></dt>
  <dd>Controls whether <i>spaces</i> at the end of a line should be trimmed away
      before the line is processed. Defaults to true.</dd>
</dl>
</div>
It should be remarked that the <i>terminals</i> are often called
  &quot;options&quot; in the context of the <b>docstrip</b> program, since these
  specify which optional code fragments should be included.
<dl class="Bl-tag">
  <dt id="docstrip::sourcefrom"><a class="permalink" href="#docstrip::sourcefrom"><b>docstrip::sourcefrom</b>
    <i>filename</i> <i>terminals</i> ?<i>option</i> <i>value</i> ...?</a></dt>
  <dd>The <b>sourcefrom</b> command is a docstripping emulation of
      <b>source</b>. It opens the file <i>filename</i>, reads it, closes it,
      docstrips the contents as specified by the <i>terminals</i>, and evaluates
      the result in the local context of the caller, during which time the
      <b>info</b> <b>script</b> value will be the <i>filename</i>. The options
      are passed on to <b>fconfigure</b> to configure the file before its
      contents are read. The <b>-metaprefix</b> is set to '#', all other
      <b>extract</b> options have their default values.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="DOCUMENT_STRUCTURE"><a class="permalink" href="#DOCUMENT_STRUCTURE">DOCUMENT
  STRUCTURE</a></h1>
<p class="Pp">The file format (as described above) determines whether a master
    source code file can be processed correctly by <b>docstrip</b>, but the
    usefulness of the format is to no little part also dependent on that the
    code and comment lines together constitute a well-formed document.</p>
<p class="Pp">For a document format that does not require any non-Tcl software,
    see the <b>ddt2man</b> command in the <b>docstrip::util</b> package. It is
    suggested that files employing that document format are given the suffix
    &quot;<i>.ddt</i>&quot;, to distinguish them from the more traditional
    LaTeX-based &quot;<i>.dtx</i>&quot; files.</p>
<p class="Pp">Master source files with &quot;<i>.dtx</i>&quot; extension are
    usually set up so that they can be typeset directly by <b>latex</b> without
    any support from other files. This is achieved by beginning the file with
    the lines</p>
<pre>
   % \iffalse
   %&lt;*driver&gt;
   \documentclass{tclldoc}
   \begin{document}
   \DocInput{<i>filename.dtx</i>}
   \end{document}
   %&lt;/driver&gt;
   % \fi
</pre>
or some variation thereof. The trick is that the file gets read twice. With
  normal LaTeX reading rules, the first two lines are comments and therefore
  ignored. The third line is the document preamble, the fourth line begins the
  document body, and the sixth line ends the document, so LaTeX stops there --
  non-comments below that point in the file are never subjected to the normal
  LaTeX reading rules. Before that, however, the \DocInput command on the fifth
  line is processed, and that does two things: it changes the interpretation of
  '%' from &quot;comment&quot; to &quot;ignored&quot;, and it inputs the file
  specified in the argument (which is normally the name of the file the command
  is in). It is this second time that the file is being read that the comments
  and code in it are typeset.
<p class="Pp">The function of the \iffalse ... \fi is to skip lines two to seven
    on this second time through; this is similar to the &quot;if 0 { ... }&quot;
    idiom for block comments in Tcl code, and it is needed here because (amongst
    other things) the \documentclass command may only be executed once. The
    function of the &lt;driver&gt; guards is to prevent this short piece of
    LaTeX code from being extracted by <b>docstrip</b>. The total effect is that
    the file can function both as a LaTeX document and as a <b>docstrip</b>
    master source code file.</p>
<p class="Pp">It is not necessary to use the tclldoc document class, but that
    does provide a number of features that are convenient for
    &quot;<i>.dtx</i>&quot; files containing Tcl code. More information on this
    matter can be found in the references above.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp">docstrip_util</p>
</section>
<section class="Sh">
<h1 class="Sh" id="KEYWORDS"><a class="permalink" href="#KEYWORDS">KEYWORDS</a></h1>
</section>
<section class="Sh">
<h1 class="Sh" id="CATEGORY"><a class="permalink" href="#CATEGORY">CATEGORY</a></h1>
<p class="Pp">Documentation tools</p>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT"><a class="permalink" href="#COPYRIGHT">COPYRIGHT</a></h1>
<pre>Copyright (c) 2003-2005 Lars Hellstr&#x00F6;m &lt;Lars dot Hellstrom at residenset dot net&gt;
</pre>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">1.2</td>
    <td class="foot-os"><a href="..">docstrip</a></td>
  </tr>
</table>
</body>
</html>
