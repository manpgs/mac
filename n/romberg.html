<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Copyright (c) 2004 Kevin B. Kenny <kennykb@acm.org>. All rights reserved. Redistribution permitted under the terms of the Open Publication License <http://www.opencontent.org/openpub/>
  
   The definitions below are for supplemental macros used in Tcl/Tk
   manual entries.
  
   .AP type name in/out ?indent?
  	Start paragraph describing an argument to a library procedure.
  	type is type of argument (int, etc.), in/out is either "in", "out",
  	or "in/out" to describe whether procedure reads or modifies arg,
  	and indent is equivalent to second arg of .IP (shouldn't ever be
  	needed;  use .AS below instead)
  
   .AS ?type? ?name?
  	Give maximum sizes of arguments for setting tab stops.  Type and
  	name are examples of largest possible arguments that will be passed
  	to .AP later.  If args are omitted, default tab stops are used.
  
   .BS
  	Start box enclosure.  From here until next .BE, everything will be
  	enclosed in one large box.
  
   .BE
  	End of box enclosure.
  
   .CS
  	Begin code excerpt.
  
   .CE
  	End code excerpt.
  
   .VS ?version? ?br?
  	Begin vertical sidebar, for use in marking newly-changed parts
  	of man pages.  The first argument is ignored and used for recording
  	the version when the .VS was added, so that the sidebars can be
  	found and removed when they reach a certain age.  If another argument
  	is present, then a line break is forced before starting the sidebar.
  
   .VE
  	End of vertical sidebar.
  
   .DS
  	Begin an indented unfilled display.
  
   .DE
  	End of indented unfilled display.
  
   .SO
  	Start of list of standard options for a Tk widget.  The
  	options follow on successive lines, in four columns separated
  	by tabs.
  
   .SE
  	End of list of standard options for a Tk widget.
  
   .OP cmdName dbName dbClass
  	Start of description of a specific option.  cmdName gives the
  	option's name as specified in the class command, dbName gives
  	the option's name in the option database, and dbClass gives
  	the option's class in the option database.
  
   .UL arg1 arg2
  	Print arg1 underlined, then print arg2 normally.
  
   RCS: @(#) $Id: man.macros,v 1.1 2009/01/30 04:56:47 andreas_kupries Exp $
  
  	# Set up traps and other miscellaneous stuff for Tcl/Tk man pages.
 -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>math::calculus::romberg(n)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">math::calculus::romberg(n)</td>
    <td class="head-vol">Tcl Math Library</td>
    <td class="head-rtitle">math::calculus::romberg(n)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<pre>
</pre>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">math::calculus::romberg - Romberg integration</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<p class="Pp">package require <b>Tcl 8.2</b></p>
<p class="Pp">package require <b>math::calculus 0.6</b></p>
<p class="Pp"><b>::math::calculus::romberg</b> <i>f</i> <i>a</i> <i>b</i>
    ?<i>-option value</i>...?</p>
<p class="Pp"><b>::math::calculus::romberg_infinity</b> <i>f</i> <i>a</i>
    <i>b</i> ?<i>-option value</i>...?</p>
<p class="Pp"><b>::math::calculus::romberg_sqrtSingLower</b> <i>f</i> <i>a</i>
    <i>b</i> ?<i>-option value</i>...?</p>
<p class="Pp"><b>::math::calculus::romberg_sqrtSingUpper</b> <i>f</i> <i>a</i>
    <i>b</i> ?<i>-option value</i>...?</p>
<p class="Pp"><b>::math::calculus::romberg_powerLawLower</b> <i>gamma</i>
    <i>f</i> <i>a</i> <i>b</i> ?<i>-option value</i>...?</p>
<p class="Pp"><b>::math::calculus::romberg_powerLawUpper</b> <i>gamma</i>
    <i>f</i> <i>a</i> <i>b</i> ?<i>-option value</i>...?</p>
<p class="Pp"><b>::math::calculus::romberg_expLower</b> <i>f</i> <i>a</i>
    <i>b</i> ?<i>-option value</i>...?</p>
<p class="Pp"><b>::math::calculus::romberg_expUpper</b> <i>f</i> <i>a</i>
    <i>b</i> ?<i>-option value</i>...?</p>
<p class="Pp"></p>
<pre>
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">The <b>romberg</b> procedures in the <b>math::calculus</b> package
    perform numerical integration of a function of one variable. They are
    intended to be of &quot;production quality&quot; in that they are robust,
    precise, and reasonably efficient in terms of the number of function
    evaluations.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="PROCEDURES"><a class="permalink" href="#PROCEDURES">PROCEDURES</a></h1>
<p class="Pp">The following procedures are available for Romberg
  integration:</p>
<dl class="Bl-tag">
  <dt><b>::math::calculus::romberg</b> <i>f</i> <i>a</i> <i>b</i> ?<i>-option
    value</i>...?</dt>
  <dd>Integrates an analytic function over a given interval.</dd>
  <dt><b>::math::calculus::romberg_infinity</b> <i>f</i> <i>a</i> <i>b</i>
    ?<i>-option value</i>...?</dt>
  <dd>Integrates an analytic function over a half-infinite interval.</dd>
  <dt><b>::math::calculus::romberg_sqrtSingLower</b> <i>f</i> <i>a</i> <i>b</i>
    ?<i>-option value</i>...?</dt>
  <dd>Integrates a function that is expected to be analytic over an interval
      except for the presence of an inverse square root singularity at the lower
      limit.</dd>
  <dt><b>::math::calculus::romberg_sqrtSingUpper</b> <i>f</i> <i>a</i> <i>b</i>
    ?<i>-option value</i>...?</dt>
  <dd>Integrates a function that is expected to be analytic over an interval
      except for the presence of an inverse square root singularity at the upper
      limit.</dd>
  <dt><b>::math::calculus::romberg_powerLawLower</b> <i>gamma</i> <i>f</i>
    <i>a</i> <i>b</i> ?<i>-option value</i>...?</dt>
  <dd>Integrates a function that is expected to be analytic over an interval
      except for the presence of a power law singularity at the lower
    limit.</dd>
  <dt><b>::math::calculus::romberg_powerLawUpper</b> <i>gamma</i> <i>f</i>
    <i>a</i> <i>b</i> ?<i>-option value</i>...?</dt>
  <dd>Integrates a function that is expected to be analytic over an interval
      except for the presence of a power law singularity at the upper
    limit.</dd>
  <dt><b>::math::calculus::romberg_expLower</b> <i>f</i> <i>a</i> <i>b</i>
    ?<i>-option value</i>...?</dt>
  <dd>Integrates an exponentially growing function; the lower limit of the
      region of integration may be arbitrarily large and negative.</dd>
  <dt><b>::math::calculus::romberg_expUpper</b> <i>f</i> <i>a</i> <i>b</i>
    ?<i>-option value</i>...?</dt>
  <dd>Integrates an exponentially decaying function; the upper limit of the
      region of integration may be arbitrarily large.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="PARAMETERS"><a class="permalink" href="#PARAMETERS">PARAMETERS</a></h1>
<dl class="Bl-tag">
  <dt id="f"><a class="permalink" href="#f"><i>f</i></a></dt>
  <dd>Function to integrate. Must be expressed as a single Tcl command, to which
      will be appended a single argument, specifically, the abscissa at which
      the function is to be evaluated. The first word of the command will be
      processed with <b>namespace which</b> in the caller's scope prior to any
      evaluation. Given this processing, the command may local to the calling
      namespace rather than needing to be global.</dd>
  <dt id="a"><a class="permalink" href="#a"><i>a</i></a></dt>
  <dd>Lower limit of the region of integration.</dd>
  <dt id="b"><a class="permalink" href="#b"><i>b</i></a></dt>
  <dd>Upper limit of the region of integration. For the
      <b>romberg_sqrtSingLower</b>, <b>romberg_sqrtSingUpper</b>,
      <b>romberg_powerLawLower</b>, <b>romberg_powerLawUpper</b>,
      <b>romberg_expLower</b>, and <b>romberg_expUpper</b> procedures, the lower
      limit must be strictly less than the upper. For the other procedures, the
      limits may appear in either order.</dd>
  <dt id="gamma"><a class="permalink" href="#gamma"><i>gamma</i></a></dt>
  <dd>Power to use for a power law singularity; see section <b>IMPROPER
      INTEGRALS</b> for details.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="OPTIONS"><a class="permalink" href="#OPTIONS">OPTIONS</a></h1>
<dl class="Bl-tag">
  <dt id="abserror"><a class="permalink" href="#abserror"><b>-abserror</b>
    <i>epsilon</i></a></dt>
  <dd>Requests that the integration machinery proceed at most until the
      estimated absolute error of the integral is less than <i>epsilon</i>. The
      error may be seriously over- or underestimated if the function (or any of
      its derivatives) contains singularities; see section <b>IMPROPER
      INTEGRALS</b> for details. Default is 1.0e-08.</dd>
  <dt id="relerror"><a class="permalink" href="#relerror"><b>-relerror</b>
    <i>epsilon</i></a></dt>
  <dd>Requests that the integration machinery proceed at most until the
      estimated relative error of the integral is less than <i>epsilon</i>. The
      error may be seriously over- or underestimated if the function (or any of
      its derivatives) contains singularities; see section <b>IMPROPER
      INTEGRALS</b> for details. Default is 1.0e-06.</dd>
  <dt id="maxiter"><a class="permalink" href="#maxiter"><b>-maxiter</b>
    <i>m</i></a></dt>
  <dd>Requests that integration terminate after at most <i>n</i> triplings of
      the number of evaluations performed. In other words, given <i>n</i> for
      <b>-maxiter</b>, the integration machinery will make at most 3**<i>n</i>
      evaluations of the function. Default is 14, corresponding to a limit
      approximately 4.8 million evaluations. (Well-behaved functions will seldom
      require more than a few hundred evaluations.)</dd>
  <dt id="degree"><a class="permalink" href="#degree"><b>-degree</b>
    <i>d</i></a></dt>
  <dd>Requests that an extrapolating polynomial of degree <i>d</i> be used in
      Romberg integration; see section <b>DESCRIPTION</b> for details. Default
      is 4. Can be at most <i>m</i>-1.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION~2"><a class="permalink" href="#DESCRIPTION~2">DESCRIPTION</a></h1>
<p class="Pp">The <b>romberg</b> procedure performs Romberg integration using
    the modified midpoint rule. Romberg integration is an iterative process. At
    the first step, the function is evaluated at the midpoint of the region of
    integration, and the value is multiplied by the width of the interval for
    the coarsest possible estimate. At the second step, the interval is divided
    into three parts, and the function is evaluated at the midpoint of each
    part; the sum of the values is multiplied by three. At the third step, nine
    parts are used, at the fourth twenty-seven, and so on, tripling the number
    of subdivisions at each step.</p>
<p class="Pp">Once the interval has been divided at least <i>d</i> times, a
    polynomial is fitted to the integrals estimated in the last <i>d</i>+1
    divisions. The integrals are considered to be a function of the square of
    the width of the subintervals (any good numerical analysis text will discuss
    this process under &quot;Romberg integration&quot;). The polynomial is
    extrapolated to a step size of zero, computing a value for the integral and
    an estimate of the error.</p>
<p class="Pp">This process will be well-behaved only if the function is analytic
    over the region of integration; there may be removable singularities at
    either end of the region provided that the limit of the function (and of all
    its derivatives) exists as the ends are approached. Thus, <b>romberg</b> may
    be used to integrate a function like f(x)=sin(x)/x over an interval
    beginning or ending at zero.</p>
<p class="Pp">Note that <b>romberg</b> will either fail to converge or else
    return incorrect error estimates if the function, or any of its derivatives,
    has a singularity anywhere in the region of integration (except for the case
    mentioned above). Care must be used, therefore, in integrating a function
    like 1/(1-x**2) to avoid the places where the derivative is singular.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="IMPROPER_INTEGRALS"><a class="permalink" href="#IMPROPER_INTEGRALS">IMPROPER
  INTEGRALS</a></h1>
<p class="Pp">Romberg integration is also useful for integrating functions over
    half-infinite intervals or functions that have singularities. The trick is
    to make a change of variable to eliminate the singularity, and to put the
    singularity at one end or the other of the region of integration. The
    <b>math::calculus</b> package supplies a number of <b>romberg</b> procedures
    to deal with the commoner cases.</p>
<dl class="Bl-tag">
  <dt id="romberg_infinity"><a class="permalink" href="#romberg_infinity"><b>romberg_infinity</b></a></dt>
  <dd>Integrates a function over a half-infinite interval; either <i>a</i> or
      <i>b</i> may be infinite. <i>a</i> and <i>b</i> must be of the same sign;
      if you need to integrate across the axis, say, from a negative value to
      positive infinity, use <b>romberg</b> to integrate from the negative value
      to a small positive value, and then <b>romberg_infinity</b> to integrate
      from the positive value to positive infinity. The <b>romberg_infinity</b>
      procedure works by making the change of variable u=1/x, so that the
      integral from a to b of f(x) is evaluated as the integral from 1/a to 1/b
      of f(1/u)/u**2.</dd>
  <dt id="romberg_powerLawLower"><a class="permalink" href="#romberg_powerLawLower"><b>romberg_powerLawLower</b>
    and <b>romberg_powerLawUpper</b></a></dt>
  <dd>Integrate a function that has an integrable power law singularity at
      either the lower or upper bound of the region of integration (or has a
      derivative with a power law singularity there). These procedures take a
      first parameter, <i>gamma</i>, which gives the power law. The function or
      its first derivative are presumed to diverge as
      (x-<i>a</i>)**(-<i>gamma</i>) or (<i>b</i>-x)**(-<i>gamma</i>).
      <i>gamma</i> must be greater than zero and less than 1.
    <p class="Pp">These procedures are useful not only in integrating functions
        that go to infinity at one end of the region of integration, but also
        functions whose derivatives do not exist at the end of the region. For
        instance, integrating f(x)=pow(x,0.25) with the origin as one end of the
        region will result in the <b>romberg</b> procedure greatly
        underestimating the error in the integral. The problem can be fixed by
        observing that the first derivative of f(x), f'(x)=x**(-3/4)/4, goes to
        infinity at the origin. Integrating using <b>romberg_powerLawLower</b>
        with <i>gamma</i> set to 0.75 gives much more orderly convergence.</p>
    <p class="Pp">These procedures operate by making the change of variable
        u=(x-a)**(1-gamma) (<b>romberg_powerLawLower</b>) or u=(b-x)**(1-gamma)
        (<b>romberg_powerLawUpper</b>).</p>
    <p class="Pp">To summarize the meaning of gamma:</p>
  </dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>If f(x) ~ x**(-a) (0 &lt; a &lt; 1), use gamma = a</li>
  <li>If f'(x) ~ x**(-b) (0 &lt; b &lt; 1), use gamma = b</li>
</ul>
</div>
<dl class="Bl-tag">
  <dt id="romberg_sqrtSingLower"><a class="permalink" href="#romberg_sqrtSingLower"><b>romberg_sqrtSingLower</b>
    and <b>romberg_sqrtSingUpper</b></a></dt>
  <dd>These procedures behave identically to <b>romberg_powerLawLower</b> and
      <b>romberg_powerLawUpper</b> for the common case of <i>gamma</i>=0.5; that
      is, they integrate a function with an inverse square root singularity at
      one end of the interval. They have a simpler implementation involving
      square roots rather than arbitrary powers.</dd>
  <dt id="romberg_expLower"><a class="permalink" href="#romberg_expLower"><b>romberg_expLower</b>
    and <b>romberg_expUpper</b></a></dt>
  <dd>These procedures are for integrating a function that grows or decreases
      exponentially over a half-infinite interval. <b>romberg_expLower</b>
      handles exponentially growing functions, and allows the lower limit of
      integration to be an arbitrarily large negative number.
      <b>romberg_expUpper</b> handles exponentially decaying functions and
      allows the upper limit of integration to be an arbitrary large positive
      number. The functions make the change of variable u=exp(-x) and u=exp(x)
      respectively.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="OTHER_CHANGES_OF_VARIABLE"><a class="permalink" href="#OTHER_CHANGES_OF_VARIABLE">OTHER
  CHANGES OF VARIABLE</a></h1>
<p class="Pp">If you need an improper integral other than the ones listed here,
    a change of variable can be written in very few lines of Tcl. Because the
    Tcl coding that does it is somewhat arcane, we offer a worked example
  here.</p>
<p class="Pp">Let's say that the function that we want to integrate is
    f(x)=exp(x)/sqrt(1-x*x) (not a very natural function, but a good example),
    and we want to integrate it over the interval (-1,1). The denominator falls
    to zero at both ends of the interval. We wish to make a change of variable
    from x to u so that dx/sqrt(1-x**2) maps to du. Choosing x=sin(u), we can
    find that dx=cos(u)*du, and sqrt(1-x**2)=cos(u). The integral from a to b of
    f(x) is the integral from asin(a) to asin(b) of f(sin(u))*cos(u).</p>
<p class="Pp">We can make a function <b>g</b> that accepts an arbitrary function
    <b>f</b> and the parameter u, and computes this new integrand.</p>
<pre>
proc g { f u } {
    set x [expr { sin($u) }]
    set cmd $f; lappend cmd $x; set y [eval $cmd]
    return [expr { $y / cos($u) }]
}
</pre>
Now integrating <b>f</b> from <i>a</i> to <i>b</i> is the same as integrating
  <b>g</b> from <i>asin(a)</i> to <i>asin(b)</i>. It's a little tricky to get
  <b>f</b> consistently evaluated in the caller's scope; the following procedure
  does it.
<pre>
proc romberg_sine { f a b args } {
    set f [lreplace $f 0 0 [uplevel 1 [list namespace which [lindex $f 0]]]]
    set f [list g $f]
    return [eval [linsert $args 0 romberg $f [expr { asin($a) }] [expr { asin($b) }]]]
}
</pre>
This <b>romberg_sine</b> procedure will do any function with sqrt(1-x*x) in the
  denominator. Our sample function is f(x)=exp(x)/sqrt(1-x*x):
<pre>
proc f { x } {
    expr { exp($x) / sqrt( 1. - $x*$x ) }
}
</pre>
Integrating it is a matter of applying <b>romberg_sine</b> as we would any of
  the other <b>romberg</b> procedures:
<pre>
foreach { value error } [romberg_sine f -1.0 1.0] break
puts [format &quot;integral is %.6g +/- %.6g&quot; $value $error]
integral is 3.97746 +/- 2.3557e-010
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="BUGS,_IDEAS,_FEEDBACK"><a class="permalink" href="#BUGS,_IDEAS,_FEEDBACK">BUGS,
  IDEAS, FEEDBACK</a></h1>
<p class="Pp">This document, and the package it describes, will undoubtedly
    contain bugs and other problems. Please report such in the category <i>math
    :: calculus</i> of the <i>Tcllib SF Trackers</i>
    [http://sourceforge.net/tracker/?group_id=12883]. Please also report any
    ideas for enhancements you may have for either package and/or
  documentation.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp">math::calculus, math::interpolate</p>
</section>
<section class="Sh">
<h1 class="Sh" id="CATEGORY"><a class="permalink" href="#CATEGORY">CATEGORY</a></h1>
<p class="Pp">Mathematics</p>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT"><a class="permalink" href="#COPYRIGHT">COPYRIGHT</a></h1>
<pre>Copyright (c) 2004 Kevin B. Kenny &lt;kennykb@acm.org&gt;. All rights reserved. Redistribution permitted under the terms of the Open Publication License &lt;http://www.opencontent.org/openpub/&gt;
</pre>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">0.6</td>
    <td class="foot-os">math</td>
  </tr>
</table>
</body>
</html>
