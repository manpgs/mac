<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   **************************************************************************
   *                                  _   _ ____  _
   *  Project                     ___| | | |  _ \| |
   *                             / __| | | | |_) | |
   *                            | (__| |_| |  _ <| |___
   *                             \___|\___/|_| \_\_____|
   *
   * Copyright (C) Daniel Stenberg, <daniel@haxx.se>, et al.
   *
   * This software is licensed as described in the file COPYING, which
   * you should have received as part of this distribution. The terms
   * are also available at https://curl.se/docs/copyright.html.
   *
   * You may opt to use, copy, modify, merge, publish, distribute and/or sell
   * copies of the Software, and permit persons to whom the Software is
   * furnished to do so, under the terms of the COPYING file.
   *
   * This software is distributed on an "AS IS" basis, WITHOUT WARRANTY OF ANY
   * KIND, either express or implied.
   *
   * SPDX-License-Identifier: curl
   *
   **************************************************************************
   -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>CURLMOPT_PUSHFUNCTION(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">CURLMOPT_PUSHFUNCTION(3)</td>
    <td class="head-vol">libcurl</td>
    <td class="head-rtitle">CURLMOPT_PUSHFUNCTION(3)</td>
  </tr>
</table>
<div class="manual-text">
<p class="Pp"></p>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">CURLMOPT_PUSHFUNCTION - callback that approves or denies server
    pushes</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<pre>#include &lt;curl/curl.h&gt;
char *curl_pushheader_bynum(struct curl_pushheaders *h, size_t num);
char *curl_pushheader_byname(struct curl_pushheaders *h, const char *name);
int curl_push_callback(CURL *parent,
                       CURL *easy,
                       size_t num_headers,
                       struct curl_pushheaders *headers,
                       void *clientp);
CURLMcode curl_multi_setopt(CURLM *handle, CURLMOPT_PUSHFUNCTION,
                            curl_push_callback func);</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">This callback gets called when a new HTTP/2 stream is being pushed
    by the server (using the PUSH_PROMISE frame). If no push callback is set,
    all offered pushes will be denied automatically.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="CALLBACK_DESCRIPTION"><a class="permalink" href="#CALLBACK_DESCRIPTION">CALLBACK
  DESCRIPTION</a></h1>
<p class="Pp">The callback gets its arguments like this:</p>
<p class="Pp"><i>parent</i> is the handle of the stream on which this push
    arrives. The new handle has been duplicated from the parent, meaning that it
    has gotten all its options inherited. It is then up to the application to
    alter any options if desired.</p>
<p class="Pp"><i>easy</i> is a newly created handle that represents this
    upcoming transfer.</p>
<p class="Pp"><i>num_headers</i> is the number of name+value pairs that was
    received and can be accessed</p>
<p class="Pp"><i>headers</i> is a handle used to access push headers using the
    accessor functions described below. This only accesses and provides the
    PUSH_PROMISE headers, the normal response headers will be provided in the
    header callback as usual.</p>
<p class="Pp"><i>clientp</i> is the pointer set with
  <i>CURLMOPT_PUSHDATA(3)</i></p>
<p class="Pp">If the callback returns CURL_PUSH_OK, the 'easy' handle will be
    added to the multi handle, the callback must not do that by itself.</p>
<p class="Pp">The callback can access PUSH_PROMISE headers with two accessor
    functions. These functions can only be used from within this callback and
    they can only access the PUSH_PROMISE headers. The normal response headers
    will be passed to the header callback for pushed streams just as for normal
    streams.</p>
<dl class="Bl-tag">
  <dt id="curl_pushheader_bynum"><a class="permalink" href="#curl_pushheader_bynum">curl_pushheader_bynum</a></dt>
  <dd>Returns the header at index <i>num</i> (or NULL). The returned pointer
      points to a &quot;name:value&quot; string that will be freed when this
      callback returns.</dd>
  <dt id="curl_pushheader_byname"><a class="permalink" href="#curl_pushheader_byname">curl_pushheader_byname</a></dt>
  <dd>Returns the value for the given header name (or NULL). This is a shortcut
      so that the application does not have to loop through all headers to find
      the one it is interested in. The data pointed will be freed when this
      callback returns. If more than one header field use the same name, this
      returns only the first one.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="CALLBACK_RETURN_VALUE"><a class="permalink" href="#CALLBACK_RETURN_VALUE">CALLBACK
  RETURN VALUE</a></h1>
<dl class="Bl-tag">
  <dt id="CURL_PUSH_OK"><a class="permalink" href="#CURL_PUSH_OK">CURL_PUSH_OK
    (0)</a></dt>
  <dd>The application has accepted the stream and it can now start receiving
      data, the ownership of the CURL handle has been taken over by the
      application.</dd>
  <dt id="CURL_PUSH_DENY"><a class="permalink" href="#CURL_PUSH_DENY">CURL_PUSH_DENY
    (1)</a></dt>
  <dd>The callback denies the stream and no data for this will reach the
      application, the easy handle will be destroyed by libcurl.</dd>
  <dt id="CURL_PUSH_ERROROUT"><a class="permalink" href="#CURL_PUSH_ERROROUT">CURL_PUSH_ERROROUT
    (2)</a></dt>
  <dd>Returning this will reject the pushed stream and return an error back on
      the parent stream making it get closed with an error. (Added in
    7.72.0)</dd>
</dl>
<dl class="Bl-tag">
  <dt>*</dt>
  <dd>All other return codes are reserved for future use.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="DEFAULT"><a class="permalink" href="#DEFAULT">DEFAULT</a></h1>
<p class="Pp">NULL, no callback</p>
</section>
<section class="Sh">
<h1 class="Sh" id="PROTOCOLS"><a class="permalink" href="#PROTOCOLS">PROTOCOLS</a></h1>
<p class="Pp">HTTP(S) (HTTP/2 only)</p>
</section>
<section class="Sh">
<h1 class="Sh" id="EXAMPLE"><a class="permalink" href="#EXAMPLE">EXAMPLE</a></h1>
<pre>/* only allow pushes for file names starting with &quot;push-&quot; */
int push_callback(CURL *parent,
                  CURL *easy,
                  size_t num_headers,
                  struct curl_pushheaders *headers,
                  void *clientp)
{
  char *headp;
  int *transfers = (int *)clientp;
  FILE *out;
  headp = curl_pushheader_byname(headers, &quot;:path&quot;);
  if(headp &amp;&amp; !strncmp(headp, &quot;/push-&quot;, 6)) {
    fprintf(stderr, &quot;The PATH is %s\n&quot;, headp);
    /* save the push here */
    out = fopen(&quot;pushed-stream&quot;, &quot;wb&quot;);
    /* write to this file */
    curl_easy_setopt(easy, CURLOPT_WRITEDATA, out);
    (*transfers)++; /* one more */
    return CURL_PUSH_OK;
  }
  return CURL_PUSH_DENY;
}
curl_multi_setopt(multi, CURLMOPT_PUSHFUNCTION, push_callback);
curl_multi_setopt(multi, CURLMOPT_PUSHDATA, &amp;counter);</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="AVAILABILITY"><a class="permalink" href="#AVAILABILITY">AVAILABILITY</a></h1>
<p class="Pp">Added in 7.44.0</p>
</section>
<section class="Sh">
<h1 class="Sh" id="RETURN_VALUE"><a class="permalink" href="#RETURN_VALUE">RETURN
  VALUE</a></h1>
<p class="Pp">Returns CURLM_OK if the option is supported, and
    CURLM_UNKNOWN_OPTION if not.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><b>CURLMOPT_PUSHDATA</b>(3), <b>CURLMOPT_PIPELINING</b>(3),
    <b>CURLOPT_PIPEWAIT</b>(3), <b>RFC</b>7540</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">April 26, 2023</td>
    <td class="foot-os">ibcurl 8.1.2</td>
  </tr>
</table>
</body>
</html>
