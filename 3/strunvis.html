<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
  	$NetBSD: unvis.3,v 1.29 2017/10/24 19:14:55 abhinav Exp $
  	$FreeBSD$
  
   Copyright (c) 1989, 1991, 1993
  	The Regents of the University of California.  All rights reserved.
  
   Redistribution and use in source and binary forms, with or without
   modification, are permitted provided that the following conditions
   are met:
   1. Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
   2. Redistributions in binary form must reproduce the above copyright
      notice, this list of conditions and the following disclaimer in the
      documentation and/or other materials provided with the distribution.
   3. Neither the name of the University nor the names of its contributors
      may be used to endorse or promote products derived from this software
      without specific prior written permission.
  
   THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
   ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
   IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
   ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
   FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
   DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
   OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
   HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
   LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
   OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
   SUCH DAMAGE.
  
       @(#)unvis.3	8.2 (Berkeley) 12/11/93
   -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>UNVIS(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">UNVIS(3)</td>
    <td class="head-vol">Library Functions Manual</td>
    <td class="head-rtitle">UNVIS(3)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp"><code class="Nm">unvis</code>, <code class="Nm">strunvis</code>,
    <code class="Nm">strnunvis</code>, <code class="Nm">strunvisx</code>,
    <code class="Nm">strnunvisx</code> &#x2014; <span class="Nd">decode a visual
    representation of characters</span></p>
</section>
<section class="Sh">
<h1 class="Sh" id="LIBRARY"><a class="permalink" href="#LIBRARY">LIBRARY</a></h1>
<p class="Pp"><span class="Lb">Standard C&#x00A0;Library (libc, -lc)</span></p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<p class="Pp"><code class="In">#include
  &lt;<a class="In">vis.h</a>&gt;</code></p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">unvis</code>(<var class="Fa" style="white-space: nowrap;">char
    *cp</var>, <var class="Fa" style="white-space: nowrap;">int c</var>,
    <var class="Fa" style="white-space: nowrap;">int *astate</var>,
    <var class="Fa" style="white-space: nowrap;">int flag</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">strunvis</code>(<var class="Fa" style="white-space: nowrap;">char
    *dst</var>, <var class="Fa" style="white-space: nowrap;">const char
    *src</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">strnunvis</code>(<var class="Fa" style="white-space: nowrap;">char
    *dst</var>, <var class="Fa" style="white-space: nowrap;">size_t dlen</var>,
    <var class="Fa" style="white-space: nowrap;">const char *src</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">strunvisx</code>(<var class="Fa" style="white-space: nowrap;">char
    *dst</var>, <var class="Fa" style="white-space: nowrap;">const char
    *src</var>, <var class="Fa" style="white-space: nowrap;">int
  flag</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">strnunvisx</code>(<var class="Fa" style="white-space: nowrap;">char
    *dst</var>, <var class="Fa" style="white-space: nowrap;">size_t dlen</var>,
    <var class="Fa" style="white-space: nowrap;">const char *src</var>,
    <var class="Fa" style="white-space: nowrap;">int flag</var>);</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">The
    <a class="permalink" href="#unvis"><code class="Fn" id="unvis">unvis</code></a>(),
    <code class="Fn">strunvis</code>() and <code class="Fn">strunvisx</code>()
    functions are used to decode a visual representation of characters, as
    produced by the <a class="Xr" href="../3/vis">vis(3)</a> function, back into
    the original form.</p>
<p class="Pp" id="unvis~2">The
    <a class="permalink" href="#unvis~2"><code class="Fn">unvis</code></a>()
    function is called with successive characters in <var class="Ar">c</var>
    until a valid sequence is recognized, at which time the decoded character is
    available at the character pointed to by <var class="Ar">cp</var>.</p>
<p class="Pp" id="strunvis">The
    <a class="permalink" href="#strunvis"><code class="Fn">strunvis</code></a>()
    function decodes the characters pointed to by <var class="Ar">src</var> into
    the buffer pointed to by <var class="Ar">dst</var>. The
    <code class="Fn">strunvis</code>() function simply copies
    <var class="Ar">src</var> to <var class="Ar">dst</var>, decoding any escape
    sequences along the way, and returns the number of characters placed into
    <var class="Ar">dst</var>, or -1 if an invalid escape sequence was detected.
    The size of <var class="Ar">dst</var> should be equal to the size of
    <var class="Ar">src</var> (that is, no expansion takes place during
    decoding).</p>
<p class="Pp" id="strunvisx">The
    <a class="permalink" href="#strunvisx"><code class="Fn">strunvisx</code></a>()
    function does the same as the <code class="Fn">strunvis</code>() function,
    but it allows you to add a flag that specifies the style the string
    <var class="Ar">src</var> is encoded with. Currently, the supported flags
    are: <code class="Dv">VIS_HTTPSTYLE</code> and
    <code class="Dv">VIS_MIMESTYLE</code>.</p>
<p class="Pp" id="unvis~3">The
    <a class="permalink" href="#unvis~3"><code class="Fn">unvis</code></a>()
    function implements a state machine that can be used to decode an arbitrary
    stream of bytes. All state associated with the bytes being decoded is stored
    outside the <code class="Fn">unvis</code>() function (that is, a pointer to
    the state is passed in), so calls decoding different streams can be freely
    intermixed. To start decoding a stream of bytes, first initialize an integer
    to zero. Call <code class="Fn">unvis</code>() with each successive byte,
    along with a pointer to this integer, and a pointer to a destination
    character. The <code class="Fn">unvis</code>() function has several return
    codes that must be handled properly. They are:</p>
<dl class="Bl-tag">
  <dt id="0"><a class="permalink" href="#0"><code class="Li">0</code></a>
    <span class="No">(zero)</span></dt>
  <dd>Another character is necessary; nothing has been recognized yet.</dd>
  <dt id="UNVIS_VALID"><a class="permalink" href="#UNVIS_VALID"><code class="Dv">UNVIS_VALID</code></a></dt>
  <dd>A valid character has been recognized and is available at the location
      pointed to by <var class="Fa">cp</var>.</dd>
  <dt id="UNVIS_VALIDPUSH"><a class="permalink" href="#UNVIS_VALIDPUSH"><code class="Dv">UNVIS_VALIDPUSH</code></a></dt>
  <dd>A valid character has been recognized and is available at the location
      pointed to by <var class="Fa">cp</var>; however, the character currently
      passed in should be passed in again.</dd>
  <dt id="UNVIS_NOCHAR"><a class="permalink" href="#UNVIS_NOCHAR"><code class="Dv">UNVIS_NOCHAR</code></a></dt>
  <dd>A valid sequence was detected, but no character was produced. This return
      code is necessary to indicate a logical break between characters.</dd>
  <dt id="UNVIS_SYNBAD"><a class="permalink" href="#UNVIS_SYNBAD"><code class="Dv">UNVIS_SYNBAD</code></a></dt>
  <dd>An invalid escape sequence was detected, or the decoder is in an unknown
      state. The decoder is placed into the starting state.</dd>
</dl>
<p class="Pp" id="unvis~4">When all bytes in the stream have been processed,
    call
    <a class="permalink" href="#unvis~4"><code class="Fn">unvis</code></a>() one
    more time with flag set to <code class="Dv">UNVIS_END</code> to extract any
    remaining character (the character passed in is ignored).</p>
<p class="Pp" id="unvis~5">The <var class="Fa">flag</var> argument is also used
    to specify the encoding style of the source. If set to
    <code class="Dv">VIS_HTTPSTYLE</code> or
    <code class="Dv">VIS_HTTP1808</code>,
    <a class="permalink" href="#unvis~5"><code class="Fn">unvis</code></a>()
    will decode URI strings as specified in RFC 1808. If set to
    <code class="Dv">VIS_HTTP1866</code>, <code class="Fn">unvis</code>() will
    decode entity references and numeric character references as specified in
    RFC 1866. If set to <code class="Dv">VIS_MIMESTYLE</code>,
    <code class="Fn">unvis</code>() will decode MIME Quoted-Printable strings as
    specified in RFC 2045. If set to <code class="Dv">VIS_NOESCAPE</code>,
    <code class="Fn">unvis</code>() will not decode
    &#x2018;<code class="Li">\</code>&#x2019; quoted characters.</p>
<p class="Pp" id="unvis~6">The following code fragment illustrates a proper use
    of
  <a class="permalink" href="#unvis~6"><code class="Fn">unvis</code></a>().</p>
<div class="Bd Pp Bd-indent Li">
<pre>int state = 0;
char out;

while ((ch = getchar()) != EOF) {
again:
	switch(unvis(&amp;out, ch, &amp;state, 0)) {
	case 0:
	case UNVIS_NOCHAR:
		break;
	case UNVIS_VALID:
		(void)putchar(out);
		break;
	case UNVIS_VALIDPUSH:
		(void)putchar(out);
		goto again;
	case UNVIS_SYNBAD:
		errx(EXIT_FAILURE, &quot;Bad character sequence!&quot;);
	}
}
if (unvis(&amp;out, '\0', &amp;state, UNVIS_END) == UNVIS_VALID)
	(void)putchar(out);</pre>
</div>
</section>
<section class="Sh">
<h1 class="Sh" id="ERRORS"><a class="permalink" href="#ERRORS">ERRORS</a></h1>
<p class="Pp">The functions <code class="Fn">strunvis</code>(),
    <code class="Fn">strnunvis</code>(), <code class="Fn">strunvisx</code>(),
    and <code class="Fn">strnunvisx</code>() will return -1 on error and set
    <var class="Va">errno</var> to:</p>
<dl class="Bl-tag">
  <dt id="EINVAL">[<a class="permalink" href="#EINVAL"><code class="Er">EINVAL</code></a>]</dt>
  <dd>An invalid escape sequence was detected, or the decoder is in an unknown
      state.</dd>
</dl>
<p class="Pp">In addition the functions <code class="Fn">strnunvis</code>() and
    <code class="Fn">strnunvisx</code>() will can also set
    <var class="Va">errno</var> on error to:</p>
<dl class="Bl-tag">
  <dt id="ENOSPC">[<a class="permalink" href="#ENOSPC"><code class="Er">ENOSPC</code></a>]</dt>
  <dd>Not enough space to perform the conversion.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><a class="Xr" href="../1/unvis">unvis(1)</a>,
    <a class="Xr" href="../1/vis">vis(1)</a>,
    <a class="Xr" href="../3/vis">vis(3)</a></p>
<p class="Pp"><cite class="Rs"><span class="RsA">R. Fielding</span>,
    <span class="RsT">Relative Uniform Resource Locators</span>,
    <span class="RsO">RFC1808</span>.</cite></p>
</section>
<section class="Sh">
<h1 class="Sh" id="HISTORY"><a class="permalink" href="#HISTORY">HISTORY</a></h1>
<p class="Pp">The <code class="Fn">unvis</code>() function first appeared in
    <span class="Ux">4.4BSD</span>. The <code class="Fn">strnunvis</code>() and
    <code class="Fn">strnunvisx</code>() functions appeared in OS X 10.12.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="BUGS"><a class="permalink" href="#BUGS">BUGS</a></h1>
<p class="Pp">The names <code class="Dv">VIS_HTTP1808</code> and
    <code class="Dv">VIS_HTTP1866</code> are wrong. Percent-encoding was defined
    in RFC 1738, the original RFC for URL. RFC 1866 defines HTML 2.0, an
    application of SGML, from which it inherits concepts of numeric character
    references and entity references.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">March 12, 2011</td>
    <td class="foot-os">macOS 13.3</td>
  </tr>
</table>
</body>
</html>
