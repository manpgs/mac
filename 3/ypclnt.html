<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
  	$OpenBSD: ypclnt.3,v 1.5 1996/12/28 09:06:29 downsj Exp $
  
   Copyright (c) 1996 The NetBSD Foundation, Inc.
   All rights reserved.
  
   This code is derived from software contributed to The NetBSD Foundation
   by Jason R. Thorpe.
  
   Redistribution and use in source and binary forms, with or without
   modification, are permitted provided that the following conditions
   are met:
   1. Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
   2. Redistributions in binary form must reproduce the above copyright
      notice, this list of conditions and the following disclaimer in the
      documentation and/or other materials provided with the distribution.
   3. All advertising materials mentioning features or use of this software
      must display the following acknowledgement:
          This product includes software developed by the NetBSD
          Foundation, Inc. and its contributors.
   4. Neither the name of The NetBSD Foundation nor the names of its
      contributors may be used to endorse or promote products derived
      from this software without specific prior written permission.
  
   THIS SOFTWARE IS PROVIDED BY THE NETBSD FOUNDATION, INC. AND CONTRIBUTORS
   ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
   TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
   PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE
   LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
   CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
   SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
   INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
   CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
   ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
   POSSIBILITY OF SUCH DAMAGE.
   -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>YPCLNT(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">YPCLNT(3)</td>
    <td class="head-vol">Library Functions Manual</td>
    <td class="head-rtitle">YPCLNT(3)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp"><code class="Nm">yp_all</code>, <code class="Nm">yp_bind</code>,
    <code class="Nm">yp_first</code>,
    <code class="Nm">yp_get_default_domain</code>,
    <code class="Nm">yp_master</code>, <code class="Nm">yp_match</code>,
    <code class="Nm">yp_next</code>, <code class="Nm">yp_order</code>,
    <code class="Nm">yp_unbind</code>, <code class="Nm">yperr_string</code>,
    <code class="Nm">ypprot_err</code> &#x2014; <span class="Nd">Interface to
    the YP subsystem</span></p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<p class="Pp"><code class="In">#include
    <a class="In">&lt;rpc/rpc.h&gt;</a></code>
  <br/>
  <code class="In">#include <a class="In">&lt;rpcsvc/ypclnt.h&gt;</a></code>
  <br/>
  <code class="In">#include
  <a class="In">&lt;rpcsvc/yp_prot.h&gt;</a></code></p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">yp_all</code>(<var class="Fa" style="white-space: nowrap;">char
    *indomain</var>, <var class="Fa" style="white-space: nowrap;">char
    *inmap</var>, <var class="Fa" style="white-space: nowrap;">struct
    ypall_callback *incallback</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">yp_bind</code>(<var class="Fa" style="white-space: nowrap;">char
    *dom</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">yp_first</code>(<var class="Fa" style="white-space: nowrap;">char
    *indomain</var>, <var class="Fa" style="white-space: nowrap;">char
    *inmap</var>, <var class="Fa" style="white-space: nowrap;">char
    **outkey</var>, <var class="Fa" style="white-space: nowrap;">int
    *outkeylen</var>, <var class="Fa" style="white-space: nowrap;">char
    **outval</var>, <var class="Fa" style="white-space: nowrap;">int
    *outvallen</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">yp_get_default_domain</code>(<var class="Fa" style="white-space: nowrap;">char
    **domp</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">yp_master</code>(<var class="Fa" style="white-space: nowrap;">char
    *indomain</var>, <var class="Fa" style="white-space: nowrap;">char
    *inmap</var>, <var class="Fa" style="white-space: nowrap;">char
    **outname</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">yp_match</code>(<var class="Fa" style="white-space: nowrap;">char
    *indomain</var>, <var class="Fa" style="white-space: nowrap;">char
    *inmap</var>, <var class="Fa" style="white-space: nowrap;">const char
    *inkey</var>, <var class="Fa" style="white-space: nowrap;">int
    inkeylen</var>, <var class="Fa" style="white-space: nowrap;">char
    **outval</var>, <var class="Fa" style="white-space: nowrap;">int
    *outvallen</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">yp_next</code>(<var class="Fa" style="white-space: nowrap;">char
    *indomain</var>, <var class="Fa" style="white-space: nowrap;">char
    *inmap</var>, <var class="Fa" style="white-space: nowrap;">char
    *inkey</var>, <var class="Fa" style="white-space: nowrap;">int
    inkeylen</var>, <var class="Fa" style="white-space: nowrap;">char
    **outkey</var>, <var class="Fa" style="white-space: nowrap;">int
    *outkeylen</var>, <var class="Fa" style="white-space: nowrap;">char
    **outval</var>, <var class="Fa" style="white-space: nowrap;">int
    *outvallen</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">yp_order</code>(<var class="Fa" style="white-space: nowrap;">char
    *indomain</var>, <var class="Fa" style="white-space: nowrap;">char
    *inmap</var>, <var class="Fa" style="white-space: nowrap;">char
    *outorder</var>);</p>
<p class="Pp"><var class="Ft">void</var>
  <br/>
  <code class="Fn">yp_unbind</code>(<var class="Fa" style="white-space: nowrap;">char
    *dom</var>);</p>
<p class="Pp"><var class="Ft">char *</var>
  <br/>
  <code class="Fn">yperr_string</code>(<var class="Fa" style="white-space: nowrap;">int
    incode</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">ypprot_err</code>(<var class="Fa" style="white-space: nowrap;">unsigned
    int incode</var>);</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">The <code class="Nm">ypclnt</code> suite provides an interface to
    the YP subsystem. For a general description of the YP subsystem, see
    <a class="Xr" href="../8/yp">yp(8)</a>.</p>
<p class="Pp" id="malloc">For all functions, input values begin with
    <span class="Pa">in</span> and output values begin with
    <span class="Pa">out</span>. Any output values of type <i class="Em">char
    **</i> should be the addresses of uninitialized character pointers. Memory
    will be allocated by the YP client routines using
    <a class="permalink" href="#malloc"><code class="Fn">malloc</code></a>().
    This memory can later be freed by the user if there is no additional need
    for the data stored there. For <span class="Pa">outkey</span> and
    <span class="Pa">outval</span>, two extra bytes of memory are allocated for
    a &#x2018;<code class="Li">\n</code>&#x2019; and
    &#x2018;<code class="Li">\0</code>&#x2019;, which are not reflected in the
    values of <span class="Pa">outkeylen</span> or
    <span class="Pa">outvallen</span>. All occurrences of
    <span class="Pa">indomain</span> and <span class="Pa">inmap</span> must be
    non-null, null-terminated strings. All input strings which also have a
    corresponding length parameter cannot be null unless the corresponding
    length value is zero. Such strings need not be null-terminated.</p>
<p class="Pp" id="yp_all">All YP lookup calls (the functions
    <a class="permalink" href="#yp_all"><code class="Fn">yp_all</code></a>(),
    <code class="Fn">yp_first</code>(),
    <a class="permalink" href="#yp_master"><code class="Fn" id="yp_master">yp_master</code></a>(),
    <code class="Fn">yp_match</code>(), <code class="Fn">yp_next</code>(),
    <code class="Fn">yp_order</code>()) require a YP domain name and a YP map
    name. The default domain name may be obtained by calling
    <a class="permalink" href="#yp_get_default_domain"><code class="Fn" id="yp_get_default_domain">yp_get_default_domain</code></a>(),
    and should thus be used before all other YP calls in a client program. The
    value it places <span class="Pa">outdomain</span> is suitable for use as the
    <span class="Pa">indomain</span> parameter to all subsequent YP calls.</p>
<p class="Pp" id="yp_bind">In order for YP lookup calls to succeed, the client
    process must be bound to a YP server process. The client process need not
    explicitly bind to the server, as it happens automatically whenever a lookup
    occurs. The function
    <a class="permalink" href="#yp_bind"><code class="Fn">yp_bind</code></a>()
    is provided for a backup strategy, e.g. a local file, when a YP server
    process is not available. Each binding uses one socket descriptor on the
    client process, which may be explicitly freed using
    <a class="permalink" href="#yp_unbind"><code class="Fn" id="yp_unbind">yp_unbind</code></a>(),
    which frees all per-process and per-node resources to bind the domain and
    marks the domain unbound.</p>
<p class="Pp">If, during a YP lookup, an RPC failure occurs, the domain used in
    the lookup is automatically marked unbound and the
    <code class="Nm">ypclnt</code> layer retries the lookup as long as
    <a class="Xr" href="../8/ypbind">ypbind(8)</a> is running and either the
    client process cannot bind to a server for the domain specified in the
    lookup, or RPC requests to the YP server process fail. If an error is not
    RPC-related, one of the YP error codes described below is returned and
    control given back to the user code.</p>
<p class="Pp">The <code class="Nm">ypclnt</code> suite provides the following
    functionality:</p>
<dl class="Bl-tag">
  <dt id="yp_match"><a class="permalink" href="#yp_match"><code class="Fn">yp_match</code></a>()</dt>
  <dd>Provides the value associated with the given key.</dd>
  <dt><code class="Fn">yp_first</code>()</dt>
  <dd>Provides the first key-value pair from the given map in the named
    domain.</dd>
  <dt><code class="Fn">yp_next</code>()</dt>
  <dd>Provides the next key-value pair in the given map. To obtain the second
      pair, the <span class="Pa">inkey</span> value should be the
      <span class="Pa">outkey</span> value provided by the initial call to
      <code class="Fn">yp_first</code>(). In the general case, the next
      key-value pair may be obtained by using the <span class="Pa">outkey</span>
      value from the previous call to <code class="Fn">yp_next</code>() as the
      value for <span class="Pa">inkey</span>.
    <p class="Pp" id="yp_first">Of course, the notions of ``first'' and ``next''
        are particular to the type of YP map being accessed, and thus there is
        no guarantee of lexical order. The only guarantees provided with
        <a class="permalink" href="#yp_first"><code class="Fn">yp_first</code></a>()
        and
        <a class="permalink" href="#yp_next"><code class="Fn" id="yp_next">yp_next</code></a>(),
        providing that the same map on the same server is polled repeatedly
        until <code class="Fn">yp_next</code>() returns YPERR_NOMORE, are that
        all key-value pairs in that map will be accessed exactly once, and if
        the entire procedure is repeated, the order will be the same.</p>
    <p class="Pp" id="yp_all~2">If the server is heaviliy loaded or the server
        fails for some reason, the domain being used may become unbound. If this
        happens, and the client process re-binds, the retrieval rules will
        break: some entries may be seen twice, and others not at all. For this
        reason, the function
        <a class="permalink" href="#yp_all~2"><code class="Fn">yp_all</code></a>()
        provides a better solution for reading all of the entries in a
        particular map.</p>
  </dd>
  <dt id="Yp_all"><code class="Fn">yp_all</code>()</dt>
  <dd>This function provides a way to transfer an entire map from the server to
      the client process with a single request. This transfer uses TCP, unlike
      all other functions in the <code class="Nm">ypclnt</code> suite, which use
      UDP. The entire transaction occurs in a single RPC request-response. The
      third argument to this function provides a way to supply the name of a
      function to process each key-value pair in the map.
      <a class="permalink" href="#Yp_all"><code class="Fn">Yp_all</code></a>()
      returns after the entire transaction is complete, or the
      <span class="Pa">foreach</span> function decides that it does not want any
      more key-value pairs. The third argument to
      <code class="Fn">yp_all</code>() is:
    <div class="Bd Pp Bd-indent Li">
    <pre>struct ypall_callback *incallback {
	int (*foreach)();
	char *data;
};</pre>
    </div>
    <p class="Pp" id="yp_all~3">The <i class="Em">char *data</i> argument is an
        opaque pointer for use by the callback function. The
        <span class="Pa">foreach</span> function should return non-zero when it
        no longer wishes to process key-value pairs, at which time
        <a class="permalink" href="#yp_all~3"><code class="Fn">yp_all</code></a>()
        returns a value of 0, and is called with the following arguments:</p>
    <div class="Bd Pp Bd-indent Li">
    <pre>int foreach (
	unsigned long instatus,
	char *inkey,
	int inkeylen,
	char *inval,
	int invallen,
	void *indata
);</pre>
    </div>
    <p class="Pp">Where:</p>
    <dl class="Bl-tag">
      <dt id="ypprot_err"><var class="Fa">instatus</var></dt>
      <dd>Holds one of the return status values described in
          <code class="Nm">&lt;rpcsvc/yp_prot.h&gt;</code>: see
          <a class="permalink" href="#ypprot_err"><code class="Fn">ypprot_err</code></a>()
          below for a function that will translate YP protocol errors into a
          <code class="Nm">ypclnt</code> layer error code as described in
          <code class="Nm">&lt;rpcsvc/ypclnt.h&gt;</code>.</dd>
      <dt><var class="Fa">inkey, inval</var></dt>
      <dd>The key and value arguments are somewhat different here than described
          above. In this case, the memory pointed to by
          <var class="Fa">inkey</var> and <var class="Fa">inval</var> is private
          to <code class="Fn">yp_all</code>(), and is overwritten with each
          subsequent key-value pair, thus the <span class="Pa">foreach</span>
          function should do something useful with the contents of that memory
          during each iteration. If the key-value pairs are not terminated with
          either &#x2018;<code class="Li">\n</code>&#x2019; or
          &#x2018;<code class="Li">\0</code>&#x2019; in the map, then they will
          not be terminated as such when given to the
          <span class="Pa">foreach</span> function, either.</dd>
      <dt><var class="Fa">indata</var></dt>
      <dd>This is the contents of the
          <span class="Pa">incallback-&gt;data</span> element of the callback
          structure. It is provided as a means to share state between the
          <span class="Pa">foreach</span> function and the user code. Its use is
          completely optional: cast it to something useful or simply ignore
        it.</dd>
    </dl>
  </dd>
  <dt id="yp_order"><a class="permalink" href="#yp_order"><code class="Fn">yp_order</code></a>()</dt>
  <dd>Returns the order number for a map. The order number is updated whenever a
      map is updated. Clients may use the order number to check whether they are
      using the most recent map.</dd>
  <dt><code class="Fn">yp_master</code>()</dt>
  <dd>Returns the hostname for the machine on which the master YP server process
      for a map is running.</dd>
  <dt id="yperr_string"><a class="permalink" href="#yperr_string"><code class="Fn">yperr_string</code></a>()</dt>
  <dd>Returns a pointer to a null-terminated error string that does not contain
      a &#x2018;<code class="Li">.</code>&#x2019; or
      &#x2018;<code class="Li">\n</code>&#x2019;.</dd>
  <dt><code class="Fn">ypprot_err</code>()</dt>
  <dd>Converts a YP protocol error code to a <code class="Nm">ypclnt</code>
      error code suitable for <code class="Fn">yperr_string</code>().</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="RETURN_VALUES"><a class="permalink" href="#RETURN_VALUES">RETURN
  VALUES</a></h1>
<p class="Pp">All functions in the <code class="Nm">ypclnt</code> suite which
    are of type
    <a class="permalink" href="#int"><i class="Em" id="int">int</i></a> return 0
    upon success or one of the following error codes upon failure:</p>
<dl class="Bl-tag">
  <dt>[<code class="Er">YPERR_BADARGS</code>]</dt>
  <dd>The passed arguments to the function are invalid</dd>
  <dt>[<code class="Er">YPERR_BADDB</code>]</dt>
  <dd>The YP map that was polled is defective.</dd>
  <dt>[<code class="Er">YPERR_DOMAIN</code>]</dt>
  <dd>Client process cannot bind to server on this YP domain.</dd>
  <dt>[<code class="Er">YPERR_KEY</code>]</dt>
  <dd>The key passed does not exist.</dd>
  <dt>[<code class="Er">YPERR_MAP</code>]</dt>
  <dd>There is no such map in the server's domain.</dd>
  <dt>[<code class="Er">YPERR_DOM</code>]</dt>
  <dd>The local YP domain is not set.</dd>
  <dt>[<code class="Er">YPERR_NOMORE</code>]</dt>
  <dd>There are no more records in the queried map.</dd>
  <dt>[<code class="Er">YPERR_PMAP</code>]</dt>
  <dd>Cannot communicate with portmap.</dd>
  <dt>[<code class="Er">YPERR_RESRC</code>]</dt>
  <dd>A resource allocation failure occurred.</dd>
  <dt>[<code class="Er">YPERR_RPC</code>]</dt>
  <dd>An RPC failure has occurred. The domain has been marked unbound.</dd>
  <dt>[<code class="Er">YPERR_VERS</code>]</dt>
  <dd>Client/server version mismatch. If the server is running version 1 of the
      YP protocol, <code class="Fn">yp_all</code>() functionality does not
      exist.</dd>
  <dt>[<code class="Er">YPERR_BIND</code>]</dt>
  <dd>Cannot communicate with
    <a class="Xr" href="../8/ypbind">ypbind(8)</a>.</dd>
  <dt>[<code class="Er">YPERR_YPERR</code>]</dt>
  <dd>An internal server or client error has occurred.</dd>
  <dt>[<code class="Er">YPERR_YPSERV</code>]</dt>
  <dd>The client cannot communicate with the YP server process.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><a class="Xr" href="../3/malloc">malloc(3)</a>,
    <a class="Xr" href="../8/yp">yp(8)</a>,
    <a class="Xr" href="../8/ypbind">ypbind(8)</a>,
    <a class="Xr" href="../8/ypserv">ypserv(8)</a></p>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHOR"><a class="permalink" href="#AUTHOR">AUTHOR</a></h1>
<p class="Pp">Theo De Raadt</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">October 26, 1994</td>
    <td class="foot-os">macOS 14.3</td>
  </tr>
</table>
</body>
</html>
