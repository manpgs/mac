<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
  	$KAME: inet6_opt_init.3,v 1.7 2004/12/27 05:08:23 itojun Exp $
  
   Copyright (C) 2004 WIDE Project.
   All rights reserved.
  
   Redistribution and use in source and binary forms, with or without
   modification, are permitted provided that the following conditions
   are met:
   1. Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
   2. Redistributions in binary form must reproduce the above copyright
      notice, this list of conditions and the following disclaimer in the
      documentation and/or other materials provided with the distribution.
   3. Neither the name of the project nor the names of its contributors
      may be used to endorse or promote products derived from this software
      without specific prior written permission.
  
   THIS SOFTWARE IS PROVIDED BY THE PROJECT AND CONTRIBUTORS ``AS IS'' AND
   ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
   IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
   ARE DISCLAIMED.  IN NO EVENT SHALL THE PROJECT OR CONTRIBUTORS BE LIABLE
   FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
   DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
   OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
   HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
   LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
   OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
   SUCH DAMAGE.
  
   $FreeBSD: src/lib/libc/net/inet6_opt_init.3,v 1.10.10.1.4.1 2010/06/14 02:09:06 kensmith Exp $
   -->
<head>
  <meta charset="utf-8"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>INET6_OPT_INIT(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">INET6_OPT_INIT(3)</td>
    <td class="head-vol">Library Functions Manual</td>
    <td class="head-rtitle">INET6_OPT_INIT(3)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp"><code class="Nm">inet6_opt_init</code>,
    <code class="Nm">inet6_opt_append</code>,
    <code class="Nm">inet6_opt_finish</code>,
    <code class="Nm">inet6_opt_set_val</code>,
    <code class="Nm">inet6_opt_next</code>,
    <code class="Nm">inet6_opt_find</code>,
    <code class="Nm">inet6_opt_get_val</code> &#x2014; <span class="Nd">IPv6
    Hop-by-Hop and Destination Options manipulation</span></p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<p class="Pp"><code class="In">#include
    &lt;<a class="In">netinet/in.h</a>&gt;</code></p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">inet6_opt_init</code>(<var class="Fa" style="white-space: nowrap;">void
    *extbuf</var>, <var class="Fa" style="white-space: nowrap;">socklen_t
    extlen</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">inet6_opt_append</code>(<var class="Fa" style="white-space: nowrap;">void
    *extbuf</var>, <var class="Fa" style="white-space: nowrap;">socklen_t
    extlen</var>, <var class="Fa" style="white-space: nowrap;">int offset</var>,
    <var class="Fa" style="white-space: nowrap;">u_int8_t type</var>,
    <var class="Fa" style="white-space: nowrap;">socklen_t len</var>,
    <var class="Fa" style="white-space: nowrap;">u_int8_t align</var>,
    <var class="Fa" style="white-space: nowrap;">void **databufp</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">inet6_opt_finish</code>(<var class="Fa" style="white-space: nowrap;">void
    *extbuf</var>, <var class="Fa" style="white-space: nowrap;">socklen_t
    extlen</var>, <var class="Fa" style="white-space: nowrap;">int
    offset</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">inet6_opt_set_val</code>(<var class="Fa" style="white-space: nowrap;">void
    *databuf</var>, <var class="Fa" style="white-space: nowrap;">int
    offset</var>, <var class="Fa" style="white-space: nowrap;">void *val</var>,
    <var class="Fa" style="white-space: nowrap;">socklen_t vallen</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">inet6_opt_next</code>(<var class="Fa" style="white-space: nowrap;">void
    *extbuf</var>, <var class="Fa" style="white-space: nowrap;">socklen_t
    extlen</var>, <var class="Fa" style="white-space: nowrap;">int offset</var>,
    <var class="Fa" style="white-space: nowrap;">u_int8_t *typep</var>,
    <var class="Fa" style="white-space: nowrap;">socklen_t *lenp</var>,
    <var class="Fa" style="white-space: nowrap;">void **databufp</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">inet6_opt_find</code>(<var class="Fa" style="white-space: nowrap;">void
    *extbuf</var>, <var class="Fa" style="white-space: nowrap;">socklen_t
    extlen</var>, <var class="Fa" style="white-space: nowrap;">int offset</var>,
    <var class="Fa" style="white-space: nowrap;">u_int8_t type</var>,
    <var class="Fa" style="white-space: nowrap;">socklen_t *lenp</var>,
    <var class="Fa" style="white-space: nowrap;">void **databufp</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">inet6_opt_get_val</code>(<var class="Fa" style="white-space: nowrap;">void
    *databuf</var>, <var class="Fa" style="white-space: nowrap;">int
    offset</var>, <var class="Fa" style="white-space: nowrap;">void *val</var>,
    <var class="Fa" style="white-space: nowrap;">socklen_t vallen</var>);</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">Building and parsing the Hop-by-Hop and Destination options is
    complicated. The advanced sockets API defines a set of functions to help
    applications create and manipulate Hop-by-Hop and Destination options. This
    man page describes the functions specified in IETF Draft RFC3542. These
    functions use the formatting rules specified in Appendix B in RFC2460, i.e.,
    that the largest field is placed last in the option. The function prototypes
    for these functions are all contained in the
    <code class="In">&lt;<a class="In">netinet/in.h</a>&gt;</code> header
  file.</p>
<section class="Ss">
<h2 class="Ss">inet6_opt_init</h2>
<p class="Pp">The
    <a class="permalink" href="#inet6_opt_init"><code class="Fn" id="inet6_opt_init">inet6_opt_init</code></a>()
    function returns the number of bytes needed for an empty extension header,
    one without any options. If the <var class="Fa">extbuf</var> argument points
    to a valid section of memory then the
    <code class="Fn">inet6_opt_init</code>() function also initializes the
    extension header's length field. When attempting to initialize an extension
    buffer passed in the <var class="Fa">extbuf</var> argument,
    <var class="Fa">extlen</var> must be a positive multiple of 8 or else the
    function fails and returns -1 to the caller.</p>
</section>
<section class="Ss">
<h2 class="Ss">inet6_opt_append</h2>
<p class="Pp">The <code class="Fn">inet6_opt_append</code>() function can
    perform two different jobs. When a valid <var class="Fa">extbuf</var>
    argument is supplied it appends an option to the extension buffer and
    returns the updated total length as well as a pointer to the newly created
    option in <var class="Fa">databufp</var>. If the value of
    <var class="Fa">extbuf</var> is <code class="Dv">NULL</code> then the
    <code class="Fn">inet6_opt_append</code>() function only reports what the
    total length would be if the option were actually appended. The
    <var class="Fa">len</var> and <var class="Fa">align</var> arguments specify
    the length of the option and the required data alignment which must be used
    when appending the option. The <var class="Fa">offset</var> argument should
    be the length returned by the <code class="Fn">inet6_opt_init</code>()
    function or a previous call to
  <code class="Fn">inet6_opt_append</code>().</p>
<p class="Pp">The <var class="Fa">type</var> argument is the 8-bit option
  type.</p>
<p class="Pp" id="inet6_opt_append">After
    <a class="permalink" href="#inet6_opt_append"><code class="Fn">inet6_opt_append</code></a>()
    has been called, the application can use the buffer pointed to by
    <var class="Fa">databufp</var> directly, or use
    <code class="Fn">inet6_opt_set_val</code>() to specify the data to be
    contained in the option.</p>
<p class="Pp">Option types of <code class="Li">0</code> and
    <code class="Li">1</code> are reserved for the <code class="Li">Pad1</code>
    and <code class="Li">PadN</code> options. All other values from 2 through
    255 may be used by applications.</p>
<p class="Pp">The length of the option data is contained in an 8-bit value and
    so may contain any value from 0 through 255.</p>
<p class="Pp">The <var class="Fa">align</var> parameter must have a value of 1,
    2, 4, or 8 and cannot exceed the value of <var class="Fa">len</var>. The
    alignment values represent no alignment, 16 bit, 32 bit and 64 bit
    alignments, respectively.</p>
</section>
<section class="Ss">
<h2 class="Ss">inet6_opt_finish</h2>
<p class="Pp">The
    <a class="permalink" href="#inet6_opt_finish"><code class="Fn" id="inet6_opt_finish">inet6_opt_finish</code></a>()
    function calculates the final padding necessary to make the extension header
    a multiple of 8 bytes, as required by the IPv6 extension header
    specification, and returns the extension header's updated total length. The
    <var class="Fa">offset</var> argument should be the length returned by
    <code class="Fn">inet6_opt_init</code>() or
    <code class="Fn">inet6_opt_append</code>(). When
    <var class="Fa">extbuf</var> is not <code class="Dv">NULL</code> the
    function also sets up the appropriate padding bytes by inserting a Pad1 or
    PadN option of the proper length.</p>
<p class="Pp">If the extension header is too small to contain the proper padding
    then an error of -1 is returned to the caller.</p>
</section>
<section class="Ss">
<h2 class="Ss">inet6_opt_set_val</h2>
<p class="Pp">The
    <a class="permalink" href="#inet6_opt_set_val"><code class="Fn" id="inet6_opt_set_val">inet6_opt_set_val</code></a>()
    function inserts data items of various sizes into the data portion of the
    option. The <var class="Fa">databuf</var> argument is a pointer to memory
    that was returned by the <code class="Fn">inet6_opt_append</code>() call and
    the <var class="Fa">offset</var> argument specifies where the option should
    be placed in the data buffer. The <var class="Fa">val</var> argument points
    to an area of memory containing the data to be inserted into the extension
    header, and the <var class="Fa">vallen</var> argument indicates how much
    data to copy.</p>
<p class="Pp">The caller should ensure that each field is aligned on its natural
    boundaries as described in Appendix B of RFC2460.</p>
<p class="Pp">The function returns the offset for the next field which is
    calculated as <var class="Fa">offset</var> + <var class="Fa">vallen</var>
    and is used when composing options with multiple fields.</p>
</section>
<section class="Ss">
<h2 class="Ss">inet6_opt_next</h2>
<p class="Pp">The
    <a class="permalink" href="#inet6_opt_next"><code class="Fn" id="inet6_opt_next">inet6_opt_next</code></a>()
    function parses received extension headers. The <var class="Fa">extbuf</var>
    and <var class="Fa">extlen</var> arguments specify the location and length
    of the extension header being parsed. The <var class="Fa">offset</var>
    argument should either be zero, for the first option, or the length value
    returned by a previous call to <code class="Fn">inet6_opt_next</code>() or
    <a class="permalink" href="#inet6_opt_find"><code class="Fn" id="inet6_opt_find">inet6_opt_find</code></a>().
    The return value specifies the position where to continue scanning the
    extension buffer. The option is returned in the arguments
    <var class="Fa">typep</var>, <var class="Fa">lenp</var>, and
    <var class="Fa">databufp</var>, which point to the 8-bit option type, the
    8-bit option length and the option data, respectively. This function does
    not return any PAD1 or PADN options. When an error occurs or there are no
    more options, the return value is -1.</p>
</section>
<section class="Ss">
<h2 class="Ss">inet6_opt_find</h2>
<p class="Pp">The <code class="Fn">inet6_opt_find</code>() function searches the
    extension buffer for a particular option type, passed in through the
    <var class="Fa">type</var> argument. If the option is found then the
    <var class="Fa">lenp</var> and <var class="Fa">databufp</var> arguments are
    updated to point to the option's length and data, respectively. The
    <var class="Fa">extbuf</var> and <var class="Fa">extlen</var> arguments must
    point to a valid extension buffer and give its length. The
    <var class="Fa">offset</var> argument can be used to search from a location
    anywhere in the extension header.</p>
</section>
<section class="Ss">
<h2 class="Ss">inet6_opt_get_val</h2>
<p class="Pp">The
    <a class="permalink" href="#inet6_opt_get_val"><code class="Fn" id="inet6_opt_get_val">inet6_opt_get_val</code></a>()
    function extracts data items of various sizes in the data portion of the
    option. The <var class="Fa">databuf</var> is a pointer returned by the
    <code class="Fn">inet6_opt_next</code>() or
    <code class="Fn">inet6_opt_find</code>() functions. The
    <var class="Fa">val</var> argument points where the data will be extracted.
    The <var class="Fa">offset</var> argument specifies from where in the data
    portion of the option the value should be extracted; the first byte of
    option data is specified by an offset of zero.</p>
<p class="Pp">It is expected that each field is aligned on its natural
    boundaries as described in Appendix B of RFC2460.</p>
<p class="Pp">The function returns the offset for the next field by calculating
    <var class="Fa">offset</var> + <var class="Fa">vallen</var> which can be
    used when extracting option content with multiple fields. Robust receivers
    must verify alignment before calling this function.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="RETURN_VALUES"><a class="permalink" href="#RETURN_VALUES">RETURN
  VALUES</a></h1>
<p class="Pp">All the functions return -1 on an error.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="EXAMPLES"><a class="permalink" href="#EXAMPLES">EXAMPLES</a></h1>
<p class="Pp">RFC3542 gives comprehensive examples in Section 23.</p>
<p class="Pp">KAME also provides examples in the
    <span class="Pa">advapitest</span> directory of its kit.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><cite class="Rs"><span class="RsA">W. Stevens</span>,
    <span class="RsA">M. Thomas</span>, <span class="RsA">E. Nordmark</span>,
    and <span class="RsA">T. Jinmei</span>, <span class="RsT">Advanced Sockets
    API for IPv6</span>, <span class="RsN">RFC3542</span>,
    <span class="RsD">October 2002</span>.</cite></p>
<p class="Pp"><cite class="Rs"><span class="RsA">S. Deering</span> and
    <span class="RsA">R. Hinden</span>, <span class="RsT">Internet Protocol,
    Version 6 (IPv6) Specification</span>, <span class="RsN">RFC2460</span>,
    <span class="RsD">December 1998</span>.</cite></p>
</section>
<section class="Sh">
<h1 class="Sh" id="STANDARDS"><a class="permalink" href="#STANDARDS">STANDARDS</a></h1>
<p class="Pp">The functions are documented in &#x201C;Advanced Sockets API for
    IPv6&#x201D; (RFC3542).</p>
</section>
<section class="Sh">
<h1 class="Sh" id="HISTORY"><a class="permalink" href="#HISTORY">HISTORY</a></h1>
<p class="Pp">The implementation first appeared in KAME advanced networking
  kit.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">December 23, 2004</td>
    <td class="foot-os">macOS 12.6</td>
  </tr>
</table>
</body>
</html>
