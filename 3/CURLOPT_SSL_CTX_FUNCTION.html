<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   **************************************************************************
   *                                  _   _ ____  _
   *  Project                     ___| | | |  _ \| |
   *                             / __| | | | |_) | |
   *                            | (__| |_| |  _ <| |___
   *                             \___|\___/|_| \_\_____|
   *
   * Copyright (C) 1998 - 2022, Daniel Stenberg, <daniel@haxx.se>, et al.
   *
   * This software is licensed as described in the file COPYING, which
   * you should have received as part of this distribution. The terms
   * are also available at https://curl.se/docs/copyright.html.
   *
   * You may opt to use, copy, modify, merge, publish, distribute and/or sell
   * copies of the Software, and permit persons to whom the Software is
   * furnished to do so, under the terms of the COPYING file.
   *
   * This software is distributed on an "AS IS" basis, WITHOUT WARRANTY OF ANY
   * KIND, either express or implied.
   *
   * SPDX-License-Identifier: curl
   *
   **************************************************************************
   -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>CURLOPT_SSL_CTX_FUNCTION(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">CURLOPT_SSL_CTX_FUNCTION(3)</td>
    <td class="head-vol">curl_easy_setopt options</td>
    <td class="head-rtitle">CURLOPT_SSL_CTX_FUNCTION(3)</td>
  </tr>
</table>
<div class="manual-text">
<p class="Pp"></p>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">CURLOPT_SSL_CTX_FUNCTION - SSL context callback for OpenSSL,
    wolfSSL or mbedTLS</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<pre>#include &lt;curl/curl.h&gt;
CURLcode ssl_ctx_callback(CURL *curl, void *ssl_ctx, void *userptr);
CURLcode curl_easy_setopt(CURL *handle, CURLOPT_SSL_CTX_FUNCTION,
                          ssl_ctx_callback);</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">This option only works for libcurl powered by OpenSSL, wolfSSL,
    mbedTLS or BearSSL. If libcurl was built against another SSL library this
    functionality is absent.</p>
<p class="Pp">Pass a pointer to your callback function, which should match the
    prototype shown above.</p>
<p class="Pp">This callback function gets called by libcurl just before the
    initialization of an SSL connection after having processed all other SSL
    related options to give a last chance to an application to modify the
    behavior of the SSL initialization. The <i>ssl_ctx</i> parameter is actually
    a pointer to the SSL library's <i>SSL_CTX</i> for OpenSSL or wolfSSL, a
    pointer to <i>mbedtls_ssl_config</i> for mbedTLS or a pointer to
    <i>br_ssl_client_context</i> for BearSSL. If an error is returned from the
    callback no attempt to establish a connection is made and the perform
    operation will return the callback's error code. Set the <i>userptr</i>
    argument with the <i>CURLOPT_SSL_CTX_DATA(3)</i> option.</p>
<p class="Pp">This function will get called on all new connections made to a
    server, during the SSL negotiation. The <i>ssl_ctx</i> will point to a newly
    initialized object each time, but note the pointer may be the same as from a
    prior call.</p>
<p class="Pp">To use this properly, a non-trivial amount of knowledge of your
    SSL library is necessary. For example, you can use this function to call
    library-specific callbacks to add additional validation code for
    certificates, and even to change the actual URI of an HTTPS request.</p>
<p class="Pp">WARNING: The <i>CURLOPT_SSL_CTX_FUNCTION(3)</i> callback allows
    the application to reach in and modify SSL details in the connection without
    libcurl itself knowing anything about it, which then subsequently can lead
    to libcurl unknowingly reusing SSL connections with different properties. To
    remedy this you may set <i>CURLOPT_FORBID_REUSE(3)</i> from the callback
    function.</p>
<p class="Pp">WARNING: If you are using DNS-over-HTTPS (DoH) via
    <i>CURLOPT_DOH_URL(3)</i> then this callback will also be called for those
    transfers and the curl handle is set to an internal handle. <b>This behavior
    is subject to change.</b> We recommend before performing your transfer set
    <i>CURLOPT_PRIVATE(3)</i> on your curl handle so you can identify it in the
    context callback. If you have a reason to modify DoH SSL context please let
    us know on the curl-library mailing list because we are considering removing
    this capability.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DEFAULT"><a class="permalink" href="#DEFAULT">DEFAULT</a></h1>
<p class="Pp">NULL</p>
</section>
<section class="Sh">
<h1 class="Sh" id="PROTOCOLS"><a class="permalink" href="#PROTOCOLS">PROTOCOLS</a></h1>
<p class="Pp">All TLS based protocols: HTTPS, FTPS, IMAPS, POP3S, SMTPS etc.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="EXAMPLE"><a class="permalink" href="#EXAMPLE">EXAMPLE</a></h1>
<pre>/* OpenSSL specific */
#include &lt;openssl/ssl.h&gt;
#include &lt;curl/curl.h&gt;
#include &lt;stdio.h&gt;
static CURLcode sslctx_function(CURL *curl, void *sslctx, void *parm)
{
  X509_STORE *store;
  X509 *cert = NULL;
  BIO *bio;
  char *mypem = parm;
  /* get a BIO */
  bio = BIO_new_mem_buf(mypem, -1);
  /* use it to read the PEM formatted certificate from memory into an
   * X509 structure that SSL can use
   */
  PEM_read_bio_X509(bio, &amp;cert, 0, NULL);
  if(cert == NULL)
    printf(&quot;PEM_read_bio_X509 failed...\n&quot;);
  /* get a pointer to the X509 certificate store (which may be empty) */
  store = SSL_CTX_get_cert_store((SSL_CTX *)sslctx);
  /* add our certificate to this store */
  if(X509_STORE_add_cert(store, cert) == 0)
    printf(&quot;error adding certificate\n&quot;);
  /* decrease reference counts */
  X509_free(cert);
  BIO_free(bio);
  /* all set to go */
  return CURLE_OK;
}
int main(void)
{
  CURL * ch;
  CURLcode rv;
  char *mypem = /* example CA cert PEM - shortened */
    &quot;-----BEGIN CERTIFICATE-----\n&quot;
    &quot;MIIHPTCCBSWgAwIBAgIBADANBgkqhkiG9w0BAQQFADB5MRAwDgYDVQQKEwdSb290\n&quot;
    &quot;IENBMR4wHAYDVQQLExVodHRwOi8vd3d3LmNhY2VydC5vcmcxIjAgBgNVBAMTGUNB\n&quot;
    &quot;IENlcnQgU2lnbmluZyBBdXRob3JpdHkxITAfBgkqhkiG9w0BCQEWEnN1cHBvcnRA\n&quot;
    &quot;Y2FjZXJ0Lm9yZzAeFw0wMzAzMzAxMjI5NDlaFw0zMzAzMjkxMjI5NDlaMHkxEDAO\n&quot;
    &quot;GCSNe9FINSkYQKyTYOGWhlC0elnYjyELn8+CkcY7v2vcB5G5l1YjqrZslMZIBjzk\n&quot;
    &quot;zk6q5PYvCdxTby78dOs6Y5nCpqyJvKeyRKANihDjbPIky/qbn3BHLt4Ui9SyIAmW\n&quot;
    &quot;omTxJBzcoTWcFbLUvFUufQb1nA5V9FrWk9p2rSVzTMVD\n&quot;
    &quot;-----END CERTIFICATE-----\n&quot;;
  curl_global_init(CURL_GLOBAL_ALL);
  ch = curl_easy_init();
  curl_easy_setopt(ch, CURLOPT_SSLCERTTYPE, &quot;PEM&quot;);
  curl_easy_setopt(ch, CURLOPT_SSL_VERIFYPEER, 1L);
  curl_easy_setopt(ch, CURLOPT_URL, &quot;https://www.example.com/&quot;);
  /* Retrieve page using cacerts' certificate -&gt; will succeed
   * load the certificate by installing a function doing the necessary
   * &quot;modifications&quot; to the SSL CONTEXT just before link init
   */
  curl_easy_setopt(ch, CURLOPT_SSL_CTX_FUNCTION, *sslctx_function);
  curl_easy_setopt(ch, CURLOPT_SSL_CTX_DATA, mypem);
  rv = curl_easy_perform(ch);
  if(!rv)
    printf(&quot;*** transfer succeeded ***\n&quot;);
  else
    printf(&quot;*** transfer failed ***\n&quot;);
  curl_easy_cleanup(ch);
  curl_global_cleanup();
  return rv;
}</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="AVAILABILITY"><a class="permalink" href="#AVAILABILITY">AVAILABILITY</a></h1>
<p class="Pp">Added in 7.11.0 for OpenSSL, in 7.42.0 for wolfSSL, in 7.54.0 for
    mbedTLS, in 7.83.0 in BearSSL. Other SSL backends are not supported.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="RETURN_VALUE"><a class="permalink" href="#RETURN_VALUE">RETURN
  VALUE</a></h1>
<p class="Pp">CURLE_OK if supported; or an error such as:</p>
<p class="Pp">CURLE_NOT_BUILT_IN - Not supported by the SSL backend</p>
<p class="Pp">CURLE_UNKNOWN_OPTION</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><b>CURLOPT_SSL_CTX_DATA</b>(3), <b>CURLOPT_SSL_VERIFYPEER</b>(3),
  </p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">September 20, 2022</td>
    <td class="foot-os">libcurl 7.87.0</td>
  </tr>
</table>
</body>
</html>
