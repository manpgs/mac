<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Copyright (c) 2008-2011 Apple Inc. All rights reserved.
  
   @APPLE_LICENSE_HEADER_START@
  
   This file contains Original Code and/or Modifications of Original Code
   as defined in and that are subject to the Apple Public Source License
   Version 2.0 (the 'License'). You may not use this file except in
   compliance with the License. Please obtain a copy of the License at
   http://www.opensource.apple.com/apsl/ and read it before using this
   file.
  
   The Original Code and all software distributed under the License are
   distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
   EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
   INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
   FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
   Please see the License for the specific language governing rights and
   limitations under the License.
  
   @APPLE_LICENSE_HEADER_END@
   -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>SETAUDIT_ADDR(2)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">SETAUDIT_ADDR(2)</td>
    <td class="head-vol">System Calls Manual</td>
    <td class="head-rtitle">SETAUDIT_ADDR(2)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp"><code class="Nm">setaudit_addr</code>,
    <code class="Nm">setaudit(NOW DEPRECATED)</code> &#x2014;
    <span class="Nd">set audit session state</span></p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<p class="Pp"><code class="In">#include
    &lt;<a class="In">bsm/audit.h</a>&gt;</code>
  <br/>
  <code class="In">#include
  &lt;<a class="In">bsm/audit_session.h</a>&gt;</code></p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">setaudit_addr</code>(<var class="Fa" style="white-space: nowrap;">auditinfo_addr_t
    *auditinfo_addr</var>, <var class="Fa" style="white-space: nowrap;">u_int
    length</var>);</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS_(NOW_DEPRECATED)"><a class="permalink" href="#SYNOPSIS_(NOW_DEPRECATED)">SYNOPSIS
  (NOW DEPRECATED)</a></h1>
<p class="Pp"><code class="In">&lt;<a class="In">bsm/audit.h</a>&gt;</code>
    <var class="Ft">int</var>
    <a class="permalink" href="#setaudit"><code class="Fn" id="setaudit">setaudit</code></a>(<var class="Fa">auditinfo_t
    *auditinfo</var>)</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">The
    <a class="permalink" href="#setaudit_addr"><code class="Fn" id="setaudit_addr">setaudit_addr</code></a>()
    system call uses the <var class="Fa">auditinfo_addr_t</var> data structure
    for the <var class="Fa">auditinfo_addr</var> argument which supports
    Terminal IDs with large addresses such as those used in IP version 6. It is
    defined as follows:</p>
<pre></pre>
<div class="Bd Pp Bd-indent Li">
struct auditinfo_addr {
	au_id_t ai_auid; /* Audit user ID. */
	au_mask_t ai_mask; /* Audit masks. */
	au_tid_addr_t ai_termid; /* Terminal ID. */
	au_asid_t ai_asid; /* Audit session ID. */
	u_int64_t ai_flags; /* Audit session flags */
};
typedef struct auditinfo_addr auditinfo_addr_t;</div>
<p class="Pp">The <var class="Fa">ai_auid</var> variable contains the audit
    identifier which is recorded in the audit log for each event the process
    caused. The value of AU_DEFAUDITID (-1) should not be used. The exception is
    if the value of audit identifier is known at the start of the session but
    will be determined and set later. Until <var class="Fa">ai_auid</var> is set
    to something other than AU_DEFAUDITID any audit events generated by the
    system with be filtered by the non-attributed audit mask.</p>
<p class="Pp">The <var class="Fa">au_mask_t</var> data structure defines the bit
    mask for auditing successful and failed events out of the predefined list of
    event classes. It is defined as follows:</p>
<pre></pre>
<div class="Bd Pp Bd-indent Li">
struct au_mask {
	unsigned int am_success; /* success bits */
	unsigned int am_failure; /* failure bits */
};
typedef struct au_mask au_mask_t;</div>
<p class="Pp">The <var class="Fa">au_tid_addr_t</var> data structure includes a
    larger address storage field and an additional field with the type of
    address stored:</p>
<pre></pre>
<div class="Bd Pp Bd-indent Li">
struct au_tid_addr {
	dev_t at_port;
	u_int32_t at_type;
	u_int32_t at_addr[4];
};
typedef struct au_tid_addr au_tid_addr_t;</div>
<p class="Pp">The <var class="Fa">ai_asid</var> variable contains the audit
    session ID which is recorded with every event caused by the process. It can
    be any value in the range 1 to PID_MAX (99999). If the value of
    AU_ASSIGN_ASID is used for <var class="Fa">ai_asid</var> a unique session ID
    will be generated by the kernel. The audit session ID will be returned in
    the <var class="Fa">ai_asid</var> field on success.</p>
<p class="Pp">The <var class="Fa">ai_flags</var> field is opaque to the kernel
    and can be used to store flags associated with the audit session. Please see
    the &#x27E8;<span class="Pa">bsm/audit_session.h</span>&#x27E9; header file
    for more information and flag definitions for this platform.</p>
<p class="Pp">The <var class="Fa">setaudit_addr</var> system call require an
    appropriate privilege to complete.</p>
<p class="Pp">This system call should only be called once at the start of a new
    session and not again during the same session to update the session
    information. There are some exceptions, however. The
    <var class="Fa">ai_auid</var> field may be updated later if initially set to
    the value of AU_DEFAUDITID (-1). Likewise, the
    <var class="Fa">ai_termid</var> fields may be updated later if the
    <var class="Fa">at_type</var> field in <var class="Fa">au_tid_addr</var> is
    set to AU_IPv4 and the other <var class="Fa">ai_tid_addr</var> fields are
    all set to zero. Creating a new session is done by setting the
    <var class="Fa">ai_asid</var> field to an unique session value or
    AU_ASSIGN_ASID. These system calls will fail when attempting to change the
    <var class="Fa">ai_auid</var> or <var class="Fa">ai_termid</var> fields once
    set to something other than the default values. The
    <var class="Fa">ai_flags</var> field may be updated only according to local
    access control policy but this is usually accomplished with
    <a class="Xr" href="../2/auditon">auditon(2)</a> using the A_SETSFLAGS
    command. The audit preselection masks may be changed at any time but are
    usually updated with <a class="Xr" href="../2/auditon">auditon(2)</a></p>
<p class="Pp" id="setaudit~2">The
    <a class="permalink" href="#setaudit~2"><code class="Fn">setaudit</code></a>()
    system call (NOW DEPRECATED) sets the active audit session state for the
    current process via the <var class="Vt">auditinfo_t</var> pointed to by
    <var class="Fa">auditinfo</var>. The <code class="Fn">setaudit_addr</code>()
    system call sets extended state via <var class="Fa">auditinfo_addr</var> and
    <var class="Fa">length</var>.</p>
<p class="Pp">The <var class="Fa">auditinfo_t</var> data structure (NOW
    DEPRECATED) is defined as follows:</p>
<pre></pre>
<div class="Bd Pp Bd-indent Li">
struct auditinfo {
	au_id_t ai_auid; /* Audit user ID */
	au_mask_t ai_mask; /* Audit masks */
	au_tid_t ai_termid; /* Terminal ID */
	au_asid_t ai_asid; /* Audit session ID */
};
typedef struct auditinfo auditinfo_t;</div>
<p class="Pp">The <var class="Fa">au_termid_t</var> data structure (NOW
    DEPRECATED) defines the Terminal ID recorded with every event caused by the
    process. It is defined as follows:</p>
<pre></pre>
<div class="Bd Pp Bd-indent Li">
struct au_tid {
	dev_t port;
	u_int32_t machine;
};
typedef struct au_tid au_tid_t;</div>
</section>
<section class="Sh">
<h1 class="Sh" id="RETURN_VALUES"><a class="permalink" href="#RETURN_VALUES">RETURN
  VALUES</a></h1>
<p class="Pp">The <code class="Fn">setaudit_addr</code>() function returns the
    value&#x00A0;0 if successful; otherwise the value&#x00A0;-1 is returned and
    the global variable <var class="Va">errno</var> is set to indicate the
    error.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="ERRORS"><a class="permalink" href="#ERRORS">ERRORS</a></h1>
<dl class="Bl-tag">
  <dt id="EFAULT">[<a class="permalink" href="#EFAULT"><code class="Er">EFAULT</code></a>]</dt>
  <dd>A failure occurred while data transferred to or from the kernel
    failed.</dd>
  <dt id="EINVAL">[<a class="permalink" href="#EINVAL"><code class="Er">EINVAL</code></a>]</dt>
  <dd>Illegal argument was passed by a system call.</dd>
  <dt id="EPERM">[<a class="permalink" href="#EPERM"><code class="Er">EPERM</code></a>]</dt>
  <dd>The process does not have sufficient permission to complete the
    operation.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><a class="Xr" href="../2/audit">audit(2)</a>,
    <a class="Xr" href="../2/auditon">auditon(2)</a>,
    <a class="Xr" href="../2/getaudit">getaudit(2)</a>,
    <a class="Xr" href="../2/getauid">getauid(2)</a>,
    <a class="Xr" href="../2/setauid">setauid(2)</a>,
    <a class="Xr" href="../3/libbsm">libbsm(3)</a></p>
</section>
<section class="Sh">
<h1 class="Sh" id="HISTORY"><a class="permalink" href="#HISTORY">HISTORY</a></h1>
<p class="Pp">The OpenBSM implementation was created by McAfee Research, the
    security division of McAfee Inc., under contract to Apple Computer Inc. in
    2004. It was subsequently adopted by the TrustedBSD Project as the
    foundation for the OpenBSM distribution.</p>
<p class="Pp"><code class="Fn">setaudit_addr</code>() replaced
    <code class="Fn">setaudit</code>() in Mac OS X 10.7 to support longer
    terminal addresses such as those used by IP version 6.
    <code class="Fn">setaudit</code>() is now deprecated and
    <code class="Fn">setaudit_addr</code>() should be used instead.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHORS"><a class="permalink" href="#AUTHORS">AUTHORS</a></h1>
<p class="Pp">This software was created by McAfee Research, the security
    research division of McAfee, Inc., under contract to Apple Computer Inc.
    Additional authors include <span class="An">Wayne Salamon</span>,
    <span class="An">Robert Watson</span>, and SPARTA Inc.</p>
<p class="Pp">The Basic Security Module (BSM) interface to audit records and
    audit event stream format were defined by Sun Microsystems.</p>
<p class="Pp">This manual page was written by <span class="An">Robert
    Watson</span> &#x27E8;rwatson@FreeBSD.org&#x27E9; and
    <span class="An">Stacey Son</span> &#x27E8;sson@FreeBSD.org&#x27E9;.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">March 4, 2011</td>
    <td class="foot-os">macOS 14.4</td>
  </tr>
</table>
</body>
</html>
