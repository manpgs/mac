<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>Test2::AsyncSubtest(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Test2::AsyncSubtest(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">Test2::AsyncSubtest(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">Test2::AsyncSubtest - Object representing an async subtest.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">Regular subtests have a limited scope, they start, events are
    generated, then they close and send an Test2::Event::Subtest event. This is
    a problem if you want the subtest to keep receiving events while other
    events are also being generated. This class implements subtests that stay
    open until you decide to close them.</p>
<p class="Pp">This is mainly useful for tools that start a subtest in one
    process and then spawn children. In many cases it is nice to let the parent
    process continue instead of waiting on the children.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<pre>    use Test2::AsyncSubtest;
    my $ast = Test2::AsyncSubtest-&gt;new(name =&gt; foo);
    $ast-&gt;run(sub {
        ok(1, &quot;Event in parent&quot; );
    });
    ok(1, &quot;Event outside of subtest&quot;);
    $ast-&gt;run_fork(sub {
        ok(1, &quot;Event in child process&quot;);
    });
    ...
    $ast-&gt;finish;
    done_testing;
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="CONSTRUCTION"><a class="permalink" href="#CONSTRUCTION">CONSTRUCTION</a></h1>
<pre>    my $ast = Test2::AsyncSubtest-&gt;new( ... );
</pre>
<dl class="Bl-tag">
  <dt id="name"><a class="permalink" href="#name">name =&gt; $name
    (required)</a></dt>
  <dd>Name of the subtest. This construction argument is required.</dd>
  <dt id="send_to"><a class="permalink" href="#send_to">send_to =&gt; $hub
    (optional)</a></dt>
  <dd>Hub to which the final subtest event should be sent. This must be an
      instance of Test2::Hub or a subclass. If none is specified then the
      current top hub will be used.</dd>
  <dt id="trace"><a class="permalink" href="#trace">trace =&gt; $trace
    (optional)</a></dt>
  <dd>File/Line to which errors should be attributed. This must be an instance
      of Test2::Util::Trace. If none is specified then the file/line where the
      constructor was called will be used.</dd>
  <dt id="hub"><a class="permalink" href="#hub">hub =&gt; $hub
    (optional)</a></dt>
  <dd>Use this to specify a hub the subtest should use. By default a new hub is
      generated. This must be an instance of Test2::AsyncSubtest::Hub.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="METHODS"><a class="permalink" href="#METHODS">METHODS</a></h1>
<section class="Ss">
<h2 class="Ss">SIMPLE ACCESSORS</h2>
<dl class="Bl-tag">
  <dt>$bool = $ast-&gt;active</dt>
  <dd>True if the subtest is active. The subtest is active if its hub appears in
      the global hub stack. This is true when
      <span class="Li">&quot;$ast-&gt;run(...)&quot;</span> us running.</dd>
  <dt>$arrayref = $ast-&gt;children</dt>
  <dd>Get an arrayref of child processes/threads. Numerical items are PIDs,
      blessed items are threads instances.</dd>
  <dt>$arrayref = $ast-&gt;events</dt>
  <dd>Get an arrayref of events that have been sent to the subtests hub.</dd>
  <dt>$bool = $ast-&gt;finished</dt>
  <dd>True if <span class="Li">&quot;finished()&quot;</span> has already been
      called.</dd>
  <dt>$hub = $ast-&gt;hub</dt>
  <dd>The hub created for the subtest.</dd>
  <dt>$int = $ast-&gt;id</dt>
  <dd>Attach/Detach counter. Used internally, not useful to users.</dd>
  <dt>$str = $ast-&gt;name</dt>
  <dd>Name of the subtest.</dd>
  <dt>$pid = $ast-&gt;pid</dt>
  <dd>PID in which the subtest was created.</dd>
  <dt>$tid = $ast-&gt;tid</dt>
  <dd>Thread ID in which the subtest was created.</dd>
  <dt>$hub = $ast-&gt;send_to</dt>
  <dd>Hub to which the final subtest event should be sent.</dd>
  <dt>$arrayref = $ast-&gt;stack</dt>
  <dd>Stack of async subtests at the time this one was created. This is mainly
      for internal use.</dd>
  <dt>$trace = $ast-&gt;trace</dt>
  <dd>Test2::Util::Trace instance used for error reporting.</dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss">INTERFACE</h2>
<dl class="Bl-tag">
  <dt>$ast-&gt;attach($id)</dt>
  <dd>Attach a subtest in a child/process to the original.
    <p class="Pp"><b>Note:</b> <span class="Li">&quot;my $id =
        $ast-&gt;cleave&quot;</span> must have been called in the parent
        process/thread before the child was started, the id it returns must be
        used in the call to
        <span class="Li">&quot;$ast-&gt;attach($id)&quot;</span></p>
  </dd>
  <dt>$id = $ast-&gt;cleave</dt>
  <dd>Prepare a slot for a child process/thread to attach. This must be called
      BEFORE the child process or thread is started. The ID returned is used by
      <span class="Li">&quot;attach()&quot;</span>.
    <p class="Pp">This must only be called in the original process/thread.</p>
  </dd>
  <dt>$ctx = $ast-&gt;context</dt>
  <dd>Get an Test2::API::Context instance that can be used to send events to the
      context in which the hub was created. This is not a canonical context, you
      should not call <span class="Li">&quot;$ctx-&gt;release&quot;</span> on
      it.</dd>
  <dt>$ast-&gt;detach</dt>
  <dd>Detach from the parent in a child process/thread. This should be called
      just before the child exits.</dd>
  <dt>$ast-&gt;finish</dt>
  <dd></dd>
  <dt>$ast-&gt;finish(%options)</dt>
  <dd>Finish the subtest, wait on children, and send the final subtest event.
    <p class="Pp">This must only be called in the original process/thread.</p>
    <p class="Pp"><b>Note:</b> This calls
        <span class="Li">&quot;$ast-&gt;wait&quot;</span>.</p>
    <p class="Pp">These are the options:</p>
  </dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt id="collapse"><a class="permalink" href="#collapse">collapse =&gt;
    1</a></dt>
  <dd>This intelligently allows a subtest to be empty.
    <p class="Pp">If no events bump the test count then the subtest no final
        plan will be added. The subtest will not be considered a failure
        (normally an empty subtest is a failure).</p>
    <p class="Pp">If there are no events at all the subtest will be collapsed
        into an Test2::Event::Ok event.</p>
  </dd>
  <dt id="silent"><a class="permalink" href="#silent">silent =&gt; 1</a></dt>
  <dd>This will prevent finish from generating a final Test2::Event::Subtest
      event. This effectively ends the subtest without it effecting the parent
      subtest (or top level test).</dd>
  <dt id="no_plan"><a class="permalink" href="#no_plan">no_plan =&gt; 1</a></dt>
  <dd>This will prevent a final plan from being added to the subtest for you
      when none is directly specified.</dd>
  <dt id="skip"><a class="permalink" href="#skip">skip =&gt;
    &quot;reason&quot;</a></dt>
  <dd>This will issue an Test2::Event::Skip instead of a subtest. This will
      throw an exception if any events have been seen, or if state implies
      events have occurred.</dd>
</dl>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>$out = $ast-&gt;fork</dt>
  <dd>This is a slightly higher level interface to fork. Running it will fork
      your code in-place just like <span class="Li">&quot;fork()&quot;</span>.
      It will return a pid in the parent, and an Scope::Guard instance in the
      child. An exception will be thrown if fork fails.
    <p class="Pp">It is recommended that you use
        <span class="Li">&quot;$ast-&gt;run_fork(sub { ... })&quot;</span>
        instead.</p>
  </dd>
  <dt>$bool = $ast-&gt;pending</dt>
  <dd>True if there are child processes, threads, or subtests that depend on
      this one.</dd>
  <dt>$bool = $ast-&gt;ready</dt>
  <dd>This is essentially
    <span class="Li">&quot;!$ast-&gt;pending&quot;</span>.</dd>
  <dt>$ast-&gt;run(sub { ... })</dt>
  <dd>Run the provided codeblock inside the subtest. This will push the subtest
      hub onto the stack, run the code, then pop the hub off the stack.</dd>
  <dt>$pid = $ast-&gt;run_fork(sub { ... })</dt>
  <dd>Same as <span class="Li">&quot;$ast-&gt;run()&quot;</span>, except that
      the codeblock is run in a child process.
    <p class="Pp">You do not need to directly call
        <span class="Li">&quot;wait($pid)&quot;</span>, that will be done for
        you when <span class="Li">&quot;$ast-&gt;wait&quot;</span>, or
        <span class="Li">&quot;$ast-&gt;finish&quot;</span> are called.</p>
  </dd>
  <dt id="my"><a class="permalink" href="#my">my $thr = $ast-&gt;run_thread(sub
    { ... });</a></dt>
  <dd><b>** DISCOURAGED **</b> Threads cause problems. This method remains for
      anyone who REALLY wants it, but it is no longer supported. Tests for this
      functionality do not even run unless the AUTHOR_TESTING or
      T2_DO_THREAD_TESTS env vars are enabled.
    <p class="Pp">Same as <span class="Li">&quot;$ast-&gt;run()&quot;</span>,
        except that the codeblock is run in a child thread.</p>
    <p class="Pp">You do not need to directly call
        <span class="Li">&quot;$thr-&gt;join&quot;</span>, that is done for you
        when <span class="Li">&quot;$ast-&gt;wait&quot;</span>, or
        <span class="Li">&quot;$ast-&gt;finish&quot;</span> are called.</p>
  </dd>
  <dt>$passing = $ast-&gt;start</dt>
  <dd>Push the subtest hub onto the stack. Returns the current pass/fail status
      of the subtest.</dd>
  <dt>$ast-&gt;stop</dt>
  <dd>Pop the subtest hub off the stack. Returns the current pass/fail status of
      the subtest.</dd>
  <dt>$ast-&gt;wait</dt>
  <dd>Wait on all threads/processes that were started using
      <span class="Li">&quot;$ast-&gt;fork&quot;</span>,
      <span class="Li">&quot;$ast-&gt;run_fork&quot;</span>, or
      <span class="Li">&quot;$ast-&gt;run_thread&quot;</span>.</dd>
</dl>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="SOURCE"><a class="permalink" href="#SOURCE">SOURCE</a></h1>
<p class="Pp">The source code repository for Test2-AsyncSubtest can be found at
    <i>https://github.com/Test-More/Test2-Suite/</i>.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="MAINTAINERS"><a class="permalink" href="#MAINTAINERS">MAINTAINERS</a></h1>
<dl class="Bl-tag">
  <dt id="Chad"><a class="permalink" href="#Chad">Chad Granum
    &lt;exodist@cpan.org&gt;</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHORS"><a class="permalink" href="#AUTHORS">AUTHORS</a></h1>
<dl class="Bl-tag">
  <dt id="Chad~2"><a class="permalink" href="#Chad~2">Chad Granum
    &lt;exodist@cpan.org&gt;</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT"><a class="permalink" href="#COPYRIGHT">COPYRIGHT</a></h1>
<p class="Pp">Copyright 2018 Chad Granum &lt;exodist7@gmail.com&gt;.</p>
<p class="Pp">This program is free software; you can redistribute it and/or
    modify it under the same terms as Perl itself.</p>
<p class="Pp">See <i>http://dev.perl.org/licenses/</i></p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2020-10-22</td>
    <td class="foot-os">perl v5.30.3</td>
  </tr>
</table>
</body>
</html>
