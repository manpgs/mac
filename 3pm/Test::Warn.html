<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>
  <meta charset="utf-8"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>Warn(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Warn(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">Warn(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">Test::Warn - Perl extension to test methods for warnings</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<pre>
  use Test::Warn;

  warning_is    {foo(-dri =&gt; &quot;/&quot;)} &quot;Unknown Parameter 'dri'&quot;, &quot;dri != dir gives warning&quot;;
  warnings_are  {bar(1,1)} [&quot;Width very small&quot;, &quot;Height very small&quot;];

  warning_is    {add(2,2)} undef, &quot;No warnings for calc 2+2&quot;; # or
  warnings_are  {add(2,2)} [],    &quot;No warnings for calc 2+2&quot;; # whichever reads better :-)

  warning_like  {foo(-dri =&gt; &quot;/&quot;)} qr/unknown param/i, &quot;an unknown parameter test&quot;;
  warnings_like {bar(1,1)} [qr/width.*small/i, qr/height.*small/i];

  warning_is    {foo()} {carped =&gt; &quot;didn't find the right parameters&quot;};
  warnings_like {foo()} [qr/undefined/,qr/undefined/,{carped =&gt; qr/no result/i}];

  warning_like {foo(undef)}                 'uninitialized';
  warning_like {bar(file =&gt; '/etc/passwd')} 'io';

  warning_like {eval q/&quot;$x&quot;; $x;/}
               [qw/void uninitialized/],
               &quot;some warnings at compile time&quot;;

  warnings_exist {...} [qr/expected warning/], &quot;Expected warning is thrown&quot;;
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">A good style of Perl programming calls for a lot of diverse
    regression tests.</p>
<p class="Pp">This module provides a few convenience methods for testing warning
    based-code.</p>
<p class="Pp">If you are not already familiar with the Test::More manpage now
    would be the time to go take a look.</p>
<section class="Ss">
<h2 class="Ss">FUNCTIONS</h2>
<dl class="Bl-tag">
  <dt id="warning_is"><a class="permalink" href="#warning_is"><b>warning_is</b>
    <i>BLOCK STRING, TEST_NAME</i></a></dt>
  <dd>Tests that BLOCK gives the specified warning exactly once.
    <p class="Pp">The test fails if the BLOCK warns more than once or does not
        warn at all. If the string is undef, then the test succeeds if the BLOCK
        doesn't give any warning.</p>
    <p class="Pp">Another way to say that there are no warnings in the block
      is:</p>
    <p class="Pp"></p>
    <pre>
  warnings_are {foo()} [], &quot;no warnings&quot;
    </pre>
    <p class="Pp">If you want to test for a warning given by Carp you have to
        write something like:</p>
    <p class="Pp"></p>
    <pre>
  warning_is {carp &quot;msg&quot;} {carped =&gt; 'msg'}, &quot;Test for a carped warning&quot;;
    </pre>
    <p class="Pp">The test will fail if a &quot;normal&quot; warning is found
        instead of a &quot;carped&quot; one.</p>
    <p class="Pp">Note: <span class="Li">&quot;warn &quot;foo&quot;&quot;</span>
        would print something like <span class="Li">&quot;foo at -e line
        1&quot;</span>. This method ignores everything after the &quot;at&quot;.
        Thus to match this warning you would have to call
        <span class="Li">&quot;warning_is {warn &quot;foo&quot;}
        &quot;foo&quot;, &quot;Foo succeeded&quot;&quot;</span>. If you need to
        test for a warning at an exact line, try something like:</p>
    <p class="Pp"></p>
    <pre>
  warning_like {warn &quot;foo&quot;} qr/at XYZ.dat line 5/
    </pre>
    <p class="Pp">Warn messages with a trailing newline (like
        <span class="Li">&quot;warn &quot;foo\n&quot;&quot;</span>) don't
        produce the <span class="Li">&quot;at -e line 1&quot;</span> message by
        Perl. Up to Test::Warn 0.30 such warning weren't supported by
        <span class="Li">&quot;warning_is {warn &quot;foo\n&quot;}
        &quot;foo\n&quot;&quot;</span>. Starting with version 0.31 they are
        supported, but also marked as experimental.</p>
    <p class="Pp"><span class="Li">&quot;warning_is()&quot;</span> and
        <span class="Li">&quot;warnings_are()&quot;</span> are only aliases to
        the same method. So you also could write
        <span class="Li">&quot;warning_is {foo()} [], &quot;no
        warning&quot;&quot;</span> or something similar.</p>
    <p class="Pp">I decided to give two methods the same name to improve
        readability.</p>
    <p class="Pp">A true value is returned if the test succeeds, false
        otherwise.</p>
    <p class="Pp">The test name is optional, but recommended.</p>
  </dd>
  <dt id="warnings_are"><a class="permalink" href="#warnings_are"><b>warnings_are</b>
    <i>BLOCK ARRAYREF, TEST_NAME</i></a></dt>
  <dd>Tests to see that BLOCK gives exactly the specified warnings. The test
      fails if the warnings from BLOCK are not exactly the ones in ARRAYREF. If
      the ARRAYREF is equal to <span class="Li">&quot;[]&quot;</span>, then the
      test succeeds if the BLOCK doesn't give any warning.
    <p class="Pp">Please read also the notes to
        <span class="Li">&quot;warning_is()&quot;</span> as these methods are
        only aliases.</p>
    <p class="Pp">If you want more than one test for carped warnings, try
      this:</p>
    <p class="Pp"></p>
    <pre>
  warnings_are {carp &quot;c1&quot;; carp &quot;c2&quot;} {carped =&gt; ['c1','c2'];
    </pre>
    <p class="Pp">or</p>
    <p class="Pp"></p>
    <pre>
  warnings_are {foo()} [&quot;Warning 1&quot;, {carped =&gt; [&quot;Carp 1&quot;, &quot;Carp 2&quot;]}, &quot;Warning 2&quot;];
    </pre>
    <p class="Pp">Note that <span class="Li">&quot;{carped =&gt;
        ...}&quot;</span> must always be a hash ref.</p>
  </dd>
  <dt id="warning_like"><a class="permalink" href="#warning_like"><b>warning_like</b>
    <i>BLOCK REGEXP, TEST_NAME</i></a></dt>
  <dd>Tests that BLOCK gives exactly one warning and it can be matched by the
      given regexp.
    <p class="Pp">If the string is undef, then the tests succeeds if the BLOCK
        doesn't give any warning.</p>
    <p class="Pp">The REGEXP is matched against the whole warning line, which in
        general has the form <span class="Li">&quot;WARNING at __FILE__ line
        __LINE__&quot;</span>. So you can check for a warning in the file
        <span class="Li">&quot;Foo.pm&quot;</span> on line 5 with:</p>
    <p class="Pp"></p>
    <pre>
  warning_like {bar()} qr/at Foo.pm line 5/, &quot;Testname&quot;
    </pre>
    <p class="Pp">I don't know whether it makes sense to do such a test :-(</p>
    <p class="Pp">However, you should be prepared as a matching with
        <span class="Li">'at'</span>, <span class="Li">'file'</span>,
        <span class="Li">'\d'</span> or similar will always pass.</p>
    <p class="Pp">Consider <span class="Li">&quot;qr/^foo/&quot;</span> if you
        want to test for warning <span class="Li">&quot;foo
        something&quot;</span> in file <i>foo.pl</i>.</p>
    <p class="Pp">You can also write the regexp in a string as
        <span class="Li">&quot;/.../&quot;</span> instead of using the
        <span class="Li">&quot;qr/.../&quot;</span> syntax.</p>
    <p class="Pp">Note that the slashes are important in the string, as strings
        without slashes are reserved for warning categories (to match warning
        categories as can be seen in the perllexwarn man page).</p>
    <p class="Pp">Similar to <span class="Li">&quot;warning_is()&quot;</span>
        and <span class="Li">&quot;warnings_are()&quot;</span> you can test for
        warnings via <span class="Li">&quot;carp&quot;</span> with:</p>
    <p class="Pp"></p>
    <pre>
  warning_like {bar()} {carped =&gt; qr/bar called too early/i};
    </pre>
    <p class="Pp">Similar to <span class="Li">&quot;warning_is()&quot;</span>
        and <span class="Li">&quot;warnings_are()&quot;</span>,</p>
    <p class="Pp"><span class="Li">&quot;warning_like()&quot;</span> and
        <span class="Li">&quot;warnings_like()&quot;</span> are only aliases to
        the same methods.</p>
    <p class="Pp">A true value is returned if the test succeeds, false
        otherwise.</p>
    <p class="Pp">The test name is optional, but recommended.</p>
  </dd>
  <dt id="warning_like~2"><a class="permalink" href="#warning_like~2"><b>warning_like</b>
    <i>BLOCK STRING, TEST_NAME</i></a></dt>
  <dd>Tests whether a BLOCK gives exactly one warning of the passed category.
    <p class="Pp">The categories are grouped in a tree, like it is expressed in
        perllexwarn. Also see &quot;BUGS AND LIMITATIONS&quot;.</p>
    <p class="Pp">Thanks to the grouping in a tree, it's possible to test simply
        for an 'io' warning, instead of testing for a
        'closed|exec|layer|newline|pipe|unopened' warning.</p>
    <p class="Pp">Note, that warnings occurring at compile time can only be
        caught in an eval block. So</p>
    <p class="Pp"></p>
    <pre>
  warning_like {eval q/&quot;$x&quot;; $x;/}
                [qw/void uninitialized/],
                &quot;some warnings at compile time&quot;;
    </pre>
    <p class="Pp">will work, while it wouldn't work without the eval.</p>
    <p class="Pp">Note, that it isn't possible yet, to test for own categories,
        created with warnings::register.</p>
  </dd>
  <dt id="warnings_like"><a class="permalink" href="#warnings_like"><b>warnings_like</b>
    <i>BLOCK ARRAYREF, TEST_NAME</i></a></dt>
  <dd>Tests to see that BLOCK gives exactly the number of the specified
      warnings, in the defined order.
    <p class="Pp">Please read also the notes to
        <span class="Li">&quot;warning_like()&quot;</span> as these methods are
        only aliases.</p>
    <p class="Pp">Similar to <span class="Li">&quot;warnings_are()&quot;</span>,
        you can test for multiple warnings via
        <span class="Li">&quot;carp&quot;</span> and for warning categories,
        too:</p>
    <p class="Pp"></p>
    <pre>
  warnings_like {foo()}
                [qr/bar warning/,
                 qr/bar warning/,
                 {carped =&gt; qr/bar warning/i},
                 'io'
                ],
                &quot;I hope you'll never have to write a test for so many warnings :-)&quot;;
    </pre>
  </dd>
  <dt id="warnings_exist"><a class="permalink" href="#warnings_exist"><b>warnings_exist</b>
    <i>BLOCK STRING|ARRAYREF, TEST_NAME</i></a></dt>
  <dd>Same as warning_like, but will <span class="Li">&quot;warn()&quot;</span>
      all warnings that do not match the supplied regex/category, instead of
      registering an error. Use this test when you just want to make sure that
      specific warnings were generated, and couldn't care less if other warnings
      happened in the same block of code.
    <p class="Pp"></p>
    <pre>
  warnings_exist {...} [qr/expected warning/], &quot;Expected warning is thrown&quot;;

  warnings_exist {...} ['uninitialized'], &quot;Expected warning is thrown&quot;;
    </pre>
  </dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss">EXPORT</h2>
<p class="Pp"><span class="Li">&quot;warning_is&quot;</span>,
    <span class="Li">&quot;warnings_are&quot;</span>,
    <span class="Li">&quot;warning_like&quot;</span>,
    <span class="Li">&quot;warnings_like&quot;</span>,
    <span class="Li">&quot;warnings_exist&quot;</span> by default.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="BUGS_AND_LIMITATIONS"><a class="permalink" href="#BUGS_AND_LIMITATIONS">BUGS
  AND LIMITATIONS</a></h1>
<p class="Pp">Category check is done as
    <span class="Li">&quot;qr/category_name/&quot;</span>. In some case this
    works, like for category <span class="Li">'uninitialized'</span>. For
    <span class="Li">'utf8'</span> it does not work. Perl does not have a list
    of warnings, so it is not possible to generate one for
    <span class="Li">&quot;Test::Warn&quot;</span>.</p>
<p class="Pp">If you want to add a warning to a category, send a pull request.
    Modifications should be done to
    <span class="Li">%warnings_in_category</span>. You should look into perl
    source to check how warning is looking exactly.</p>
<p class="Pp">Please note that warnings with newlines inside are very awkward.
    The only sensible way to handle them is to use the
    <span class="Li">&quot;warning_like&quot;</span> or
    <span class="Li">&quot;warnings_like&quot;</span> methods. The background is
    that there is no really safe way to distinguish between warnings with
    newlines and a stacktrace.</p>
<p class="Pp">If a method has its own warn handler, overwriting
    <span class="Li">$SIG{__WARN__}</span>, my test warning methods won't get
    these warnings.</p>
<p class="Pp">The <span class="Li">&quot;warning_like BLOCK CATEGORY,
    TEST_NAME&quot;</span> method isn't fully tested. Please take note if you
    use this this calling style, and report any bugs you find.</p>
<section class="Ss">
<h2 class="Ss">XS warnings</h2>
<p class="Pp">As described in
    https://rt.cpan.org/Ticket/Display.html?id=42070&amp;results=3c71d1b101a730e185691657f3b02f21
    or https://github.com/hanfried/test-warn/issues/1 XS warnings might not be
    caught.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp">Have a look to the similar Test::Exception module. Test::Trap</p>
</section>
<section class="Sh">
<h1 class="Sh" id="THANKS"><a class="permalink" href="#THANKS">THANKS</a></h1>
<p class="Pp">Many thanks to Adrian Howard, chromatic and Michael G. Schwern,
    who have given me a lot of ideas.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHOR"><a class="permalink" href="#AUTHOR">AUTHOR</a></h1>
<p class="Pp">Janek Schleicher, &lt;bigj AT kamelfreund.de&gt;</p>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT_AND_LICENSE"><a class="permalink" href="#COPYRIGHT_AND_LICENSE">COPYRIGHT
  AND LICENSE</a></h1>
<p class="Pp">Copyright 2002 by Janek Schleicher</p>
<p class="Pp">Copyright 2007-2014 by Alexandr Ciornii,
    &lt;http://chorny.net/&gt;</p>
<p class="Pp">Copyright 2015-2018 by Janek Schleicher</p>
<p class="Pp">This library is free software; you can redistribute it and/or
    modify it under the same terms as Perl itself.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2018-06-23</td>
    <td class="foot-os">perl v5.30.2</td>
  </tr>
</table>
</body>
</html>
