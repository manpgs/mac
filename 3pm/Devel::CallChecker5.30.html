<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>Devel::CallChecker(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Devel::CallChecker(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">Devel::CallChecker(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">Devel::CallChecker - custom op checking attached to
  subroutines</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<pre>    # to generate header prior to XS compilation
    perl -MDevel::CallChecker=callchecker0_h \
        -e 'print callchecker0_h' &gt; callchecker0.h
    # in Perl part of module
    use Devel::CallChecker;
    /* in XS */
    #include &quot;callchecker0.h&quot;
    cv_get_call_checker(cv, &amp;ckfun, &amp;ckobj);
    static OP *my_ckfun(pTHX_ OP *o, GV *namegv, SV *ckobj);
    cv_set_call_checker(cv, my_ckfun, ckobj);
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">This module makes some new features of the Perl 5.14.0 C API
    available to XS modules running on older versions of Perl. The features are
    centred around the function
    <span class="Li">&quot;cv_set_call_checker&quot;</span>, which allows XS
    code to attach a magical annotation to a Perl subroutine, resulting in
    resolvable calls to that subroutine being mutated at compile time by
    arbitrary C code. This module makes
    <span class="Li">&quot;cv_set_call_checker&quot;</span> and several
    supporting functions available. (It is possible to achieve the effect of
    <span class="Li">&quot;cv_set_call_checker&quot;</span> from XS code on much
    earlier Perl versions, but it is painful to achieve without the centralised
    facility.)</p>
<p class="Pp">This module provides the implementation of the functions at
    runtime (on Perls where they are not provided by the core). It also, at
    compile time, supplies the C header file and link library which provide
    access to the functions. In normal use, &quot;callchecker0_h&quot; and
    &quot;callchecker_linkable&quot; should be called at build time (not
    authoring time) for the module that wishes to use the C functions.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="CONSTANTS"><a class="permalink" href="#CONSTANTS">CONSTANTS</a></h1>
<dl class="Bl-tag">
  <dt id="callchecker0_h"><a class="permalink" href="#callchecker0_h">callchecker0_h</a></dt>
  <dd>Content of a C header file, intended to be named
      &quot;<span class="Li">&quot;callchecker0.h&quot;</span>&quot;. It is to
      be included in XS code, and <span class="Li">&quot;perl.h&quot;</span>
      must be included first. When the XS module is loaded at runtime, the
      <span class="Li">&quot;Devel::CallChecker&quot;</span> module must be
      loaded first. This will result in the Perl API functions
      <span class="Li">&quot;rv2cv_op_cv&quot;</span>,
      <span class="Li">&quot;ck_entersub_args_list&quot;</span>,
      <span class="Li">&quot;ck_entersub_args_proto&quot;</span>,
      <span class="Li">&quot;ck_entersub_args_proto_or_list&quot;</span>,
      <span class="Li">&quot;cv_get_call_checker&quot;</span>, and
      <span class="Li">&quot;cv_set_call_checker&quot;</span>, as defined below
      and in the Perl 5.14.0 API, being available to the XS code.</dd>
  <dt id="callchecker_linkable"><a class="permalink" href="#callchecker_linkable">callchecker_linkable</a></dt>
  <dd>List of names of files that must be used as additional objects when
      linking an XS module that uses the C functions supplied by this module.
      This list will be empty on many platforms.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="C_FUNCTIONS"><a class="permalink" href="#C_FUNCTIONS">C
  FUNCTIONS</a></h1>
<dl class="Bl-tag">
  <dt id="rv2cv_op_cv"><a class="permalink" href="#rv2cv_op_cv">rv2cv_op_cv</a></dt>
  <dd>Examines an op, which is expected to identify a subroutine at runtime, and
      attempts to determine at compile time which subroutine it identifies. This
      is normally used during Perl compilation to determine whether a prototype
      can be applied to a function call. <i>cvop</i> is the op being considered,
      normally an <span class="Li">&quot;rv2cv&quot;</span> op. A pointer to the
      identified subroutine is returned, if it could be determined statically,
      and a null pointer is returned if it was not possible to determine
      statically.
    <p class="Pp">Whether the subroutine is statically identifiable is
        determined in accordance with the prevailing standards of the Perl
        version being used. The same criteria are used that the core uses to
        determine whether to apply a prototype to a subroutine call. From
        version 5.11.2 onwards, the subroutine can be determined if the RV that
        the <span class="Li">&quot;rv2cv&quot;</span> is to operate on is
        provided by a suitable <span class="Li">&quot;gv&quot;</span> or
        <span class="Li">&quot;const&quot;</span> op. Prior to 5.11.2, only a
        <span class="Li">&quot;gv&quot;</span> op will do. A
        <span class="Li">&quot;gv&quot;</span> op is suitable if the GV's CV
        slot is populated. A <span class="Li">&quot;const&quot;</span> op is
        suitable if the constant value must be an RV pointing to a CV. Details
        of this process may change in future versions of Perl.</p>
    <p class="Pp">If the <span class="Li">&quot;rv2cv&quot;</span> op has the
        <span class="Li">&quot;OPpENTERSUB_AMPER&quot;</span> flag set then no
        attempt is made to identify the subroutine statically: this flag is used
        to suppress compile-time magic on a subroutine call, forcing it to use
        default runtime behaviour.</p>
    <p class="Pp">If <i>flags</i> has the bit
        <span class="Li">&quot;RV2CVOPCV_MARK_EARLY&quot;</span> set, then the
        handling of a GV reference is modified. If a GV was examined and its CV
        slot was found to be empty, then the
        <span class="Li">&quot;gv&quot;</span> op has the
        <span class="Li">&quot;OPpEARLY_CV&quot;</span> flag set. If the op is
        not optimised away, and the CV slot is later populated with a subroutine
        having a prototype, that flag eventually triggers the warning
        &quot;called too early to check prototype&quot;.</p>
    <p class="Pp">If <i>flags</i> has the bit
        <span class="Li">&quot;RV2CVOPCV_RETURN_NAME_GV&quot;</span> set, then
        instead of returning a pointer to the subroutine it returns a pointer to
        the GV giving the most appropriate name for the subroutine in this
        context. Normally this is just the
        <span class="Li">&quot;CvGV&quot;</span> of the subroutine, but for an
        anonymous (<span class="Li">&quot;CvANON&quot;</span>) subroutine that
        is referenced through a GV it will be the referencing GV. The resulting
        <span class="Li">&quot;GV*&quot;</span> is cast to
        <span class="Li">&quot;CV*&quot;</span> to be returned. A null pointer
        is returned as usual if there is no statically-determinable
      subroutine.</p>
    <p class="Pp"></p>
    <pre>    CV *rv2cv_op_cv(OP *cvop, U32 flags)
    </pre>
  </dd>
  <dt id="cv_get_call_checker"><a class="permalink" href="#cv_get_call_checker">cv_get_call_checker</a></dt>
  <dd>Retrieves the function that will be used to fix up a call to <i>cv</i>.
      Specifically, the function is applied to an
      <span class="Li">&quot;entersub&quot;</span> op tree for a subroutine
      call, not marked with <span class="Li">&quot;&amp;&quot;</span>, where the
      callee can be identified at compile time as <i>cv</i>.
    <p class="Pp">The C-level function pointer is returned in <i>*ckfun_p</i>,
        and an SV argument for it is returned in <i>*ckobj_p</i>. The function
        is intended to be called in this manner:</p>
    <p class="Pp"></p>
    <pre>    entersubop = (*ckfun_p)(aTHX_ entersubop, namegv, (*ckobj_p));
    </pre>
    <p class="Pp">In this call, <i>entersubop</i> is a pointer to the
        <span class="Li">&quot;entersub&quot;</span> op, which may be replaced
        by the check function, and <i>namegv</i> is a GV supplying the name that
        should be used by the check function to refer to the callee of the
        <span class="Li">&quot;entersub&quot;</span> op if it needs to emit any
        diagnostics. It is permitted to apply the check function in non-standard
        situations, such as to a call to a different subroutine or to a method
        call.</p>
    <p class="Pp">By default, the function is
        Perl_ck_entersub_args_proto_or_list, and the SV parameter is <i>cv</i>
        itself. This implements standard prototype processing. It can be
        changed, for a particular subroutine, by
        &quot;cv_set_call_checker&quot;.</p>
    <p class="Pp"></p>
    <pre>    void cv_get_call_checker(CV *cv, Perl_call_checker *ckfun_p,
            SV **ckobj_p)
    </pre>
  </dd>
  <dt id="cv_set_call_checker"><a class="permalink" href="#cv_set_call_checker">cv_set_call_checker</a></dt>
  <dd>Sets the function that will be used to fix up a call to <i>cv</i>.
      Specifically, the function is applied to an
      <span class="Li">&quot;entersub&quot;</span> op tree for a subroutine
      call, not marked with <span class="Li">&quot;&amp;&quot;</span>, where the
      callee can be identified at compile time as <i>cv</i>.
    <p class="Pp">The C-level function pointer is supplied in <i>ckfun</i>, and
        an SV argument for it is supplied in <i>ckobj</i>. The function is
        intended to be called in this manner:</p>
    <p class="Pp"></p>
    <pre>    entersubop = ckfun(aTHX_ entersubop, namegv, ckobj);
    </pre>
    <p class="Pp">In this call, <i>entersubop</i> is a pointer to the
        <span class="Li">&quot;entersub&quot;</span> op, which may be replaced
        by the check function, and <i>namegv</i> is a GV supplying the name that
        should be used by the check function to refer to the callee of the
        <span class="Li">&quot;entersub&quot;</span> op if it needs to emit any
        diagnostics. It is permitted to apply the check function in non-standard
        situations, such as to a call to a different subroutine or to a method
        call.</p>
    <p class="Pp">The current setting for a particular CV can be retrieved by
        &quot;cv_get_call_checker&quot;.</p>
    <p class="Pp"></p>
    <pre>    void cv_set_call_checker(CV *cv, Perl_call_checker ckfun,
            SV *ckobj)
    </pre>
  </dd>
  <dt id="ck_entersub_args_list"><a class="permalink" href="#ck_entersub_args_list">ck_entersub_args_list</a></dt>
  <dd>Performs the default fixup of the arguments part of an
      <span class="Li">&quot;entersub&quot;</span> op tree. This consists of
      applying list context to each of the argument ops. This is the standard
      treatment used on a call marked with
      <span class="Li">&quot;&amp;&quot;</span>, or a method call, or a call
      through a subroutine reference, or any other call where the callee can't
      be identified at compile time, or a call where the callee has no
      prototype.
    <p class="Pp"></p>
    <pre>    OP *ck_entersub_args_list(OP *entersubop)
    </pre>
  </dd>
  <dt id="ck_entersub_args_proto"><a class="permalink" href="#ck_entersub_args_proto">ck_entersub_args_proto</a></dt>
  <dd>Performs the fixup of the arguments part of an
      <span class="Li">&quot;entersub&quot;</span> op tree based on a subroutine
      prototype. This makes various modifications to the argument ops, from
      applying context up to inserting
      <span class="Li">&quot;refgen&quot;</span> ops, and checking the number
      and syntactic types of arguments, as directed by the prototype. This is
      the standard treatment used on a subroutine call, not marked with
      <span class="Li">&quot;&amp;&quot;</span>, where the callee can be
      identified at compile time and has a prototype.
    <p class="Pp"><i>protosv</i> supplies the subroutine prototype to be applied
        to the call. It may be a normal defined scalar, of which the string
        value will be used. Alternatively, for convenience, it may be a
        subroutine object (a <span class="Li">&quot;CV*&quot;</span> that has
        been cast to <span class="Li">&quot;SV*&quot;</span>) which has a
        prototype. The prototype supplied, in whichever form, does not need to
        match the actual callee referenced by the op tree.</p>
    <p class="Pp">If the argument ops disagree with the prototype, for example
        by having an unacceptable number of arguments, a valid op tree is
        returned anyway. The error is reflected in the parser state, normally
        resulting in a single exception at the top level of parsing which covers
        all the compilation errors that occurred. In the error message, the
        callee is referred to by the name defined by the <i>namegv</i>
        parameter.</p>
    <p class="Pp"></p>
    <pre>    OP *ck_entersub_args_proto(OP *entersubop, GV *namegv,
            SV *protosv)
    </pre>
  </dd>
  <dt id="ck_entersub_args_proto_or_list"><a class="permalink" href="#ck_entersub_args_proto_or_list">ck_entersub_args_proto_or_list</a></dt>
  <dd>Performs the fixup of the arguments part of an
      <span class="Li">&quot;entersub&quot;</span> op tree either based on a
      subroutine prototype or using default list-context processing. This is the
      standard treatment used on a subroutine call, not marked with
      <span class="Li">&quot;&amp;&quot;</span>, where the callee can be
      identified at compile time.
    <p class="Pp"><i>protosv</i> supplies the subroutine prototype to be applied
        to the call, or indicates that there is no prototype. It may be a normal
        scalar, in which case if it is defined then the string value will be
        used as a prototype, and if it is undefined then there is no prototype.
        Alternatively, for convenience, it may be a subroutine object (a
        <span class="Li">&quot;CV*&quot;</span> that has been cast to
        <span class="Li">&quot;SV*&quot;</span>), of which the prototype will be
        used if it has one. The prototype (or lack thereof) supplied, in
        whichever form, does not need to match the actual callee referenced by
        the op tree.</p>
    <p class="Pp">If the argument ops disagree with the prototype, for example
        by having an unacceptable number of arguments, a valid op tree is
        returned anyway. The error is reflected in the parser state, normally
        resulting in a single exception at the top level of parsing which covers
        all the compilation errors that occurred. In the error message, the
        callee is referred to by the name defined by the <i>namegv</i>
        parameter.</p>
    <p class="Pp"></p>
    <pre>    OP *ck_entersub_args_proto_or_list(OP *entersubop, GV *namegv,
            SV *protosv)
    </pre>
  </dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp">B::CallChecker, Devel::CallParser, &quot;cv_set_call_checker&quot;
    in perlapi</p>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHOR"><a class="permalink" href="#AUTHOR">AUTHOR</a></h1>
<p class="Pp">Andrew Main (Zefram) &lt;zefram@fysh.org&gt;</p>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT"><a class="permalink" href="#COPYRIGHT">COPYRIGHT</a></h1>
<p class="Pp">Copyright (C) 2011, 2012, 2013, 2015, 2017 Andrew Main (Zefram)
    &lt;zefram@fysh.org&gt;</p>
</section>
<section class="Sh">
<h1 class="Sh" id="LICENSE"><a class="permalink" href="#LICENSE">LICENSE</a></h1>
<p class="Pp">This module is free software; you can redistribute it and/or
    modify it under the same terms as Perl itself.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2022-11-05</td>
    <td class="foot-os">perl v5.30.2</td>
  </tr>
</table>
</body>
</html>
