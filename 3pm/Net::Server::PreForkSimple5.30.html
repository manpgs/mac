<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>Net::Server::PreForkSimple(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Net::Server::PreForkSimple(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">Net::Server::PreForkSimple(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">Net::Server::PreForkSimple - Net::Server personality</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<pre>    use base qw(Net::Server::PreForkSimple);
    sub process_request {
        #...code...
    }
    __PACKAGE__-&gt;run();
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">Please read the pod on Net::Server first. This module is a
    personality, or extension, or sub class, of the Net::Server module.</p>
<p class="Pp">This personality binds to one or more ports and then forks
    <span class="Li">&quot;max_servers&quot;</span> child processes. The server
    will make sure that at any given time there are always
    <span class="Li">&quot;max_servers&quot;</span> available to receive a
    client request. Each of these children will process up to
    <span class="Li">&quot;max_requests&quot;</span> client connections. This
    type is good for a heavily hit site that can keep
    <span class="Li">&quot;max_servers&quot;</span> processes dedicated to the
    serving. (Multi port accept defaults to using flock to serialize the
    children).</p>
<p class="Pp">At this time, it does not appear that this module will pass tests
    on Win32 systems. Any ideas or patches for making the tests pass would be
    welcome.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SAMPLE_CODE"><a class="permalink" href="#SAMPLE_CODE">SAMPLE
  CODE</a></h1>
<p class="Pp">Please see the sample listed in Net::Server.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="COMMAND_LINE_ARGUMENTS"><a class="permalink" href="#COMMAND_LINE_ARGUMENTS">COMMAND
  LINE ARGUMENTS</a></h1>
<p class="Pp">In addition to the command line arguments of the Net::Server base
    class, Net::Server::PreFork contains several other configurable
  parameters.</p>
<p class="Pp"></p>
<pre>    Key               Value                   Default
    max_servers       \d+                     50
    max_requests      \d+                     1000
    serialize         (flock|semaphore
                       |pipe|none)  undef
    # serialize defaults to flock on multi_port or on Solaris
    lock_file         &quot;filename&quot;              File::Temp-&gt;new
    check_for_dead    \d+                     30
    max_dequeue       \d+                     undef
    check_for_dequeue \d+                     undef
</pre>
<dl class="Bl-tag">
  <dt id="max_servers"><a class="permalink" href="#max_servers">max_servers</a></dt>
  <dd>The maximum number of child servers to start and maintain. This does not
      apply to dequeue processes.</dd>
  <dt id="max_requests"><a class="permalink" href="#max_requests">max_requests</a></dt>
  <dd>The number of client connections to receive before a child
    terminates.</dd>
  <dt id="serialize"><a class="permalink" href="#serialize">serialize</a></dt>
  <dd>Determines whether the server serializes child connections. Options are
      undef, flock, semaphore, pipe, or none. Default is undef. On multi_port
      servers or on servers running on Solaris, the default is flock. The flock
      option uses blocking exclusive flock on the file specified in
      <i>lock_file</i> (see below). The semaphore option uses IPC::Semaphore
      (thanks to Bennett Todd) for giving some sample code. The pipe option
      reads on a pipe to choose the next. the flock option should be the most
      bulletproof while the pipe option should be the most portable. (Flock is
      able to reliquish the block if the process dies between accept on the
      socket and reading of the client connection - semaphore and pipe do not).
      An option of none will not perform any serialization. If &quot;none&quot;
      is passed and there are multiple ports then a the default serialization
      will be used insted of &quot;none.&quot;</dd>
  <dt id="lock_file"><a class="permalink" href="#lock_file">lock_file</a></dt>
  <dd>Filename to use in flock serialized accept in order to serialize the
      accept sequece between the children. This will default to a generated
      temporary filename. If default value is used the lock_file will be removed
      when the server closes.</dd>
  <dt id="check_for_dead"><a class="permalink" href="#check_for_dead">check_for_dead</a></dt>
  <dd>Seconds to wait before checking to see if a child died without letting the
      parent know.</dd>
  <dt id="max_dequeue"><a class="permalink" href="#max_dequeue">max_dequeue</a></dt>
  <dd>The maximum number of dequeue processes to start. If a value of zero or
      undef is given, no dequeue processes will be started. The number of
      running dequeue processes will be checked by the check_for_dead
    variable.</dd>
  <dt id="check_for_dequeue"><a class="permalink" href="#check_for_dequeue">check_for_dequeue</a></dt>
  <dd>Seconds to wait before forking off a dequeue process. The run_dequeue hook
      must be defined when using this setting. It is intended to use the dequeue
      process to take care of items such as mail queues. If a value of undef is
      given, no dequeue processes will be started.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="CONFIGURATION_FILE"><a class="permalink" href="#CONFIGURATION_FILE">CONFIGURATION
  FILE</a></h1>
<p class="Pp"><span class="Li">&quot;Net::Server::PreFork&quot;</span> allows
    for the use of a configuration file to read in server parameters. The format
    of this conf file is simple key value pairs. Comments and white space are
    ignored.</p>
<p class="Pp"></p>
<pre>    #-------------- file test.conf --------------
    ### server information
    max_servers   80
    max_requests  1000
    ### user and group to become
    user        somebody
    group       everybody
    ### logging ?
    log_file    /var/log/server.log
    log_level   3
    pid_file    /tmp/server.pid
    ### access control
    allow       .+\.(net|com)
    allow       domain\.com
    deny        a.+
    ### background the process?
    background  1
    ### ports to bind
    host        127.0.0.1
    port        localhost:20204
    port        20205
    ### reverse lookups ?
    # reverse_lookups on
    #-------------- file test.conf --------------
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="PROCESS_FLOW"><a class="permalink" href="#PROCESS_FLOW">PROCESS
  FLOW</a></h1>
<p class="Pp">Process flow follows Net::Server until the loop phase. At this
    point <span class="Li">&quot;max_servers&quot;</span> are forked and wait
    for connections. When a child accepts a connection, finishs processing a
    client, or exits, it relays that information to the parent, which keeps
    track and makes sure there are always
    <span class="Li">&quot;max_servers&quot;</span> running.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="HOOKS"><a class="permalink" href="#HOOKS">HOOKS</a></h1>
<p class="Pp">The PreForkSimple server has the following hooks in addition to
    the hooks provided by the Net::Server base class. See Net::Server</p>
<dl class="Bl-tag">
  <dt>&quot;$self-&gt;run_n_children_hook()&quot;</dt>
  <dd>This hook occurs at the top of run_n_children which is called each time
      the server goes to start more child processes. This gives the parent to do
      a little of its own accountting (as desired). Idea for this hook came from
      James FitzGibbon.</dd>
  <dt>&quot;$self-&gt;child_init_hook()&quot;</dt>
  <dd>This hook takes place immeditately after the child process forks from the
      parent and before the child begins accepting connections. It is intended
      for any addiotional chrooting or other security measures. It is suggested
      that all perl modules be used by this point, so that the most shared
      memory possible is used.</dd>
  <dt>&quot;$self-&gt;child_finish_hook()&quot;</dt>
  <dd>This hook takes place immediately before the child tells the parent that
      it is exiting. It is intended for saving out logged information or other
      general cleanup.</dd>
  <dt>&quot;$self-&gt;run_dequeue()&quot;</dt>
  <dd>This hook only gets called in conjunction with the check_for_dequeue
      setting.</dd>
  <dt>&quot;$self-&gt;idle_loop_hook()&quot;</dt>
  <dd>This hook is called in every pass through the main process wait loop.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="HOT_DEPLOY"><a class="permalink" href="#HOT_DEPLOY">HOT
  DEPLOY</a></h1>
<p class="Pp">Since version 2.000, the PreForkSimple server has accepted the
    TTIN and TTOU signals. When a TTIN is received, the max_servers is increased
    by 1. If a TTOU signal is received the max_servers is decreased by 1. This
    allows for adjusting the number of handling processes without having to
    restart the server.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="BUGS"><a class="permalink" href="#BUGS">BUGS</a></h1>
<p class="Pp">Tests don't seem to work on Win32. Any ideas or patches would be
    welcome.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="TO_DO"><a class="permalink" href="#TO_DO">TO DO</a></h1>
<p class="Pp">See Net::Server</p>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHOR"><a class="permalink" href="#AUTHOR">AUTHOR</a></h1>
<p class="Pp">Paul T. Seamons paul@seamons.com</p>
</section>
<section class="Sh">
<h1 class="Sh" id="THANKS"><a class="permalink" href="#THANKS">THANKS</a></h1>
<p class="Pp">See Net::Server</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp">Please see also Net::Server::Fork, Net::Server::INET,
    Net::Server::PreFork, Net::Server::MultiType, Net::Server::Single
    Net::Server::SIG Net::Server::Daemonize Net::Server::Proto</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2017-08-10</td>
    <td class="foot-os">perl v5.30.3</td>
  </tr>
</table>
</body>
</html>
