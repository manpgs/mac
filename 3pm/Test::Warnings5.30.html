<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>Test::Warnings(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Test::Warnings(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">Test::Warnings(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">Test::Warnings - Test for warnings and the lack of them</p>
</section>
<section class="Sh">
<h1 class="Sh" id="VERSION"><a class="permalink" href="#VERSION">VERSION</a></h1>
<p class="Pp">version 0.030</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<pre>    use Test::More;
    use Test::Warnings;
    pass('yay!');
    done_testing;
</pre>
<p class="Pp">emits TAP:</p>
<p class="Pp"></p>
<pre>    ok 1 - yay!
    ok 2 - no (unexpected) warnings (via done_testing)
    1..2
</pre>
<p class="Pp">and:</p>
<p class="Pp"></p>
<pre>    use Test::More tests =&gt; 3;
    use Test::Warnings 0.005 ':all';
    pass('yay!');
    like(warning { warn &quot;oh noes!&quot; }, qr/^oh noes/, 'we warned');
</pre>
<p class="Pp">emits TAP:</p>
<p class="Pp"></p>
<pre>    ok 1 - yay!
    ok 2 - we warned
    ok 3 - no (unexpected) warnings (via END block)
    1..3
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">If you've ever tried to use Test::NoWarnings to confirm there are
    no warnings generated by your tests, combined with the convenience of
    <span class="Li">&quot;done_testing&quot;</span> to not have to declare a
    test count, you'll have discovered that these two features do not play well
    together, as the test count will be calculated <i>before</i> the warnings
    test is run, resulting in a TAP error. (See
    <span class="Li">&quot;examples/test_nowarnings.pl&quot;</span> in this
    distribution for a demonstration.)</p>
<p class="Pp">This module is intended to be used as a drop-in replacement for
    Test::NoWarnings: it also adds an extra test, but runs this test
    <i>before</i> <span class="Li">&quot;done_testing&quot;</span> calculates
    the test count, rather than after. It does this by hooking into
    <span class="Li">&quot;done_testing&quot;</span> as well as via an
    <span class="Li">&quot;END&quot;</span> block. You can declare a plan, or
    not, and things will still Just Work.</p>
<p class="Pp">It is actually equivalent to:</p>
<p class="Pp"></p>
<pre>    use Test::NoWarnings 1.04 ':early';
</pre>
<p class="Pp">as warnings are still printed normally as they occur. You are
    safe, and enthusiastically encouraged, to perform a global search-replace of
    the above with <span class="Li">&quot;use Test::Warnings;&quot;</span>
    whether or not your tests have a plan.</p>
<p class="Pp">It can also be used as a replacement for Test::Warn, if you wish
    to test the content of expected warnings; read on to find out how.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="FUNCTIONS"><a class="permalink" href="#FUNCTIONS">FUNCTIONS</a></h1>
<p class="Pp">The following functions are available for import (not included by
    default; you can also get all of them by importing the tag
    <span class="Li">&quot;:all&quot;</span>):</p>
<section class="Ss">
<h2 class="Ss" id="_allow_warnings(_bool_)__"><a class="permalink" href="#_allow_warnings(_bool_)__">&quot;allow_warnings([bool])&quot;
  - EXPERIMENTAL - MAY BE REMOVED</a></h2>
<p class="Pp">When passed a true value, or no value at all, subsequent warnings
    will not result in a test failure; when passed a false value, subsequent
    warnings will result in a test failure. Initial value is
    <span class="Li">&quot;false&quot;</span>.</p>
<p class="Pp">When warnings are allowed, any warnings will instead be emitted
    via Test::Builder::note.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_allowing_warnings__"><a class="permalink" href="#_allowing_warnings__">&quot;allowing_warnings&quot;
  - EXPERIMENTAL - MAY BE REMOVED</a></h2>
<p class="Pp">Returns whether we are currently allowing warnings (set by
    <span class="Li">&quot;allow_warnings&quot;</span> as described above).</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_had_no_warnings(_optional_test_name_)_"><a class="permalink" href="#_had_no_warnings(_optional_test_name_)_">&quot;had_no_warnings(&lt;optional
  test name&gt;)&quot;</a></h2>
<p class="Pp">Tests whether there have been any warnings so far, not preceded by
    an <span class="Li">&quot;allowing_warnings&quot;</span> call. It is run
    automatically at the end of all tests, but can also be called manually at
    any time, as often as desired.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_warnings(___code___)_"><a class="permalink" href="#_warnings(___code___)_">&quot;warnings(
  { code } )&quot;</a></h2>
<p class="Pp">Given a code block, runs the block and returns a list of all the
    (not previously allowed via
    <span class="Li">&quot;allow_warnings&quot;</span>) warnings issued within.
    This lets you test for the presence of warnings that you not only would
    <i>allow</i>, but <i>must</i> be issued. Testing functions are not provided;
    given the strings returned, you can test these yourself using your favourite
    testing functions, such as Test::More::is or Test::Deep::cmp_deeply.</p>
<p class="Pp">You can use this construct as a replacement for
    Test::Warn::warnings_are:</p>
<p class="Pp"></p>
<pre>    is_deeply(
        [ warnings { ... } ],
        [
            'warning message 1',
            'warning message 2',
        ],
        'got expected warnings',
    );
</pre>
<p class="Pp">or, to replace Test::Warn::warnings_like:</p>
<p class="Pp"></p>
<pre>    cmp_deeply(
        [ warnings { ... } ],
        bag(    # ordering of messages doesn't matter
            re(qr/warning message 1/),
            re(qr/warning message 2/),
        ),
        'got expected warnings (in any order)',
    );
</pre>
<p class="Pp">Warnings generated by this code block are <i>NOT</i> propagated
    further. However, since they are returned from this function with their
    filename and line numbers intact, you can re-issue them yourself immediately
    after calling <span class="Li">&quot;warnings(...)&quot;</span>, if
  desired.</p>
<p class="Pp">Note that <span class="Li">&quot;use Test::Warnings
    'warnings'&quot;</span> will give you a
    <span class="Li">&quot;warnings&quot;</span> subroutine in your namespace
    (most likely <span class="Li">&quot;main&quot;</span>, if you're writing a
    test), so you (or things you load) can't subsequently do
    <span class="Li">&quot;warnings-&gt;import&quot;</span> -- it will result in
    the error: &quot;Not enough arguments for Test::Warnings::warnings at ...,
    near &quot;warnings-&gt;import&quot;&quot;. To work around this, either use
    the fully-qualified form
    (<span class="Li">&quot;Test::warnings&quot;</span>) or make your calls to
    the <span class="Li">&quot;warnings&quot;</span> package first.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_warning(___code___)_"><a class="permalink" href="#_warning(___code___)_">&quot;warning(
  { code } )&quot;</a></h2>
<p class="Pp">Same as <span class="Li">&quot;warnings( { code } )&quot;</span>,
    except a scalar is always returned - the single warning produced, if there
    was one, or an arrayref otherwise -- which can be more convenient to use
    than <span class="Li">&quot;warnings()&quot;</span> if you are expecting
    exactly one warning.</p>
<p class="Pp">However, you are advised to capture the result from
    <span class="Li">&quot;warning()&quot;</span> into a temp variable so you
    can dump its value if it doesn't contain what you expect. e.g. with this
    test:</p>
<p class="Pp"></p>
<pre>    like(
        warning { foo() },
        qr/^this is a warning/,
        'got a warning from foo()',
    );
</pre>
<p class="Pp">if you get two warnings (or none) back instead of one, you'll get
    an arrayref, which will result in an unhelpful test failure message
  like:</p>
<p class="Pp"></p>
<pre>    #   Failed test 'got a warning from foo()'
    #   at t/mytest.t line 10.
    #                   'ARRAY(0xdeadbeef)'
    #     doesn't match '(?^:^this is a warning)'
</pre>
<p class="Pp">So instead, change your test to:</p>
<p class="Pp"></p>
<pre>    my $warning = warning { foo() };
    like(
        $warning,
        qr/^this is a warning/,
        'got a warning from foo()',
    ) or diag 'got warning(s): ', explain($warning);
</pre>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="IMPORT_OPTIONS"><a class="permalink" href="#IMPORT_OPTIONS">IMPORT
  OPTIONS</a></h1>
<section class="Ss">
<h2 class="Ss" id="_:all_"><a class="permalink" href="#_:all_">&quot;:all&quot;</a></h2>
<p class="Pp">Imports all functions listed above</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_:no_end_test_"><a class="permalink" href="#_:no_end_test_">&quot;:no_end_test&quot;</a></h2>
<p class="Pp">Disables the addition of a
    <span class="Li">&quot;had_no_warnings&quot;</span> test via
    <span class="Li">&quot;END&quot;</span> or
    <span class="Li">&quot;done_testing&quot;</span></p>
</section>
<section class="Ss">
<h2 class="Ss" id="_:fail_on_warning_"><a class="permalink" href="#_:fail_on_warning_">&quot;:fail_on_warning&quot;</a></h2>
<p class="Pp">When used, fail immediately when an unexempted warning is
    generated (as opposed to waiting until &quot;had_no_warnings&quot; or
    <span class="Li">&quot;done_testing&quot;</span> is called).</p>
<p class="Pp">I recommend you only turn this option on when debugging a test, to
    see where a surprise warning is coming from, and rely on the end-of-tests
    check otherwise.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_:report_warnings_"><a class="permalink" href="#_:report_warnings_">&quot;:report_warnings&quot;</a></h2>
<p class="Pp">When used, <span class="Li">&quot;had_no_warnings()&quot;</span>
    will print all the unexempted warning content, in case it had been
    suppressed earlier by other captures (such as &quot;stderr_like&quot; in
    Test::Output or &quot;capture&quot; in Capture::Tiny).</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="CAVEATS"><a class="permalink" href="#CAVEATS">CAVEATS</a></h1>
<p class="Pp">Sometimes new warnings can appear in Perl that should <b>not</b>
    block installation -- for example, smartmatch was recently deprecated in
    perl 5.17.11, so now any distribution that uses smartmatch and also tests
    for warnings cannot be installed under 5.18.0. You might want to consider
    only making warnings fail tests in an author environment -- you can do this
    with the if pragma:</p>
<p class="Pp"></p>
<pre>    use if $ENV{AUTHOR_TESTING} || $ENV{RELEASE_TESTING}, 'Test::Warnings';
</pre>
<p class="Pp">In future versions of this module, when interfaces are added to
    test the content of warnings, there will likely be additional sugar
    available to indicate that warnings should be checked only in author tests
    (or TODO when not in author testing), but will still provide exported subs.
    Comments are enthusiastically solicited - drop me an email, write up an RT
    ticket, or come by <span class="Li">&quot;#perl-qa&quot;</span> on irc!</p>
<p class="Pp"><b>Achtung!</b> This is not a great idea:</p>
<p class="Pp"></p>
<pre>    sub warning_like(&amp;$;$) {
        my ($code, $pattern, $name) = @_;
        like( &amp;warning($code), $pattern, $name );
    }
    warning_like( { ... }, qr/foo/, 'foo appears in the warning' );
</pre>
<p class="Pp">If the code in the <span class="Li">&quot;{ ... }&quot;</span> is
    going to warn with a stack trace with the arguments to each subroutine in
    its call stack (for example via
    <span class="Li">&quot;Carp::cluck&quot;</span>), the test name, &quot;foo
    appears in the warning&quot; will itself be matched by the regex (see
    <i>examples/warning_like.t</i>). Instead, write this:</p>
<p class="Pp"></p>
<pre>  like( warning { ... }, qr/foo/, 'foo appears in the warning' );
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="TO_DO_(or:_POSSIBLE_FEATURES_COMING_IN_FUTURE_RELEASES)"><a class="permalink" href="#TO_DO_(or:_POSSIBLE_FEATURES_COMING_IN_FUTURE_RELEASES)">TO
  DO (or: POSSIBLE FEATURES COMING IN FUTURE RELEASES)</a></h1>
<ul class="Bl-bullet">
  <li><span class="Li">&quot;allow_warnings(qr/.../)&quot;</span> - allow some
      warnings and not others</li>
  <li>more sophisticated handling in subtests - if we save some state on the
      Test::Builder object itself, we can allow warnings in a subtest and then
      the state will revert when the subtest ends, as well as check for warnings
      at the end of every subtest via
      <span class="Li">&quot;done_testing&quot;</span>.</li>
  <li>sugar for making failures TODO when testing outside an author
    environment</li>
</ul>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<ul class="Bl-bullet">
  <li>Test::NoWarnings</li>
  <li>Test::FailWarnings</li>
  <li>blogs.perl.org: YANWT (Yet Another No-Warnings Tester)
      &lt;http://blogs.perl.org/users/ether/2013/03/yanwt-yet-another-no-warnings-tester.html&gt;</li>
  <li>strictures - which makes all warnings fatal in tests, hence lessening the
      need for special warning testing</li>
  <li>Test::Warn</li>
  <li>Test::Fatal</li>
</ul>
</section>
<section class="Sh">
<h1 class="Sh" id="SUPPORT"><a class="permalink" href="#SUPPORT">SUPPORT</a></h1>
<p class="Pp">Bugs may be submitted through the RT bug tracker
    &lt;https://rt.cpan.org/Public/Dist/Display.html?Name=Test-Warnings&gt; (or
    bug-Test-Warnings@rt.cpan.org
  &lt;mailto:bug-Test-Warnings@rt.cpan.org&gt;).</p>
<p class="Pp">There is also a mailing list available for users of this
    distribution, at &lt;http://lists.perl.org/list/perl-qa.html&gt;.</p>
<p class="Pp">There is also an irc channel available for users of this
    distribution, at <span class="Li">&quot;#perl&quot;</span> on
    <span class="Li">&quot;irc.perl.org&quot;</span>
    &lt;irc://irc.perl.org/#perl-qa&gt;.</p>
<p class="Pp">I am also usually active on irc, as 'ether' at
    <span class="Li">&quot;irc.perl.org&quot;</span>.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHOR"><a class="permalink" href="#AUTHOR">AUTHOR</a></h1>
<p class="Pp">Karen Etheridge &lt;ether@cpan.org&gt;</p>
</section>
<section class="Sh">
<h1 class="Sh" id="CONTRIBUTORS"><a class="permalink" href="#CONTRIBUTORS">CONTRIBUTORS</a></h1>
<ul class="Bl-bullet">
  <li>Graham Knop &lt;haarg@haarg.org&gt;</li>
  <li>A. Sinan Unur &lt;nanis@cpan.org&gt;</li>
  <li>Leon Timmermans &lt;fawaka@gmail.com&gt;</li>
  <li>Tina Mueller &lt;cpan2@tinita.de&gt;</li>
</ul>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT_AND_LICENCE"><a class="permalink" href="#COPYRIGHT_AND_LICENCE">COPYRIGHT
  AND LICENCE</a></h1>
<p class="Pp">This software is copyright (c) 2013 by Karen Etheridge.</p>
<p class="Pp">This is free software; you can redistribute it and/or modify it
    under the same terms as the Perl 5 programming language system itself.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2020-03-21</td>
    <td class="foot-os">perl v5.30.3</td>
  </tr>
</table>
</body>
</html>
