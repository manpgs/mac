<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>
  <meta charset="utf-8"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>Net::Server::HTTP(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Net::Server::HTTP(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">Net::Server::HTTP(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">Net::Server::HTTP - very basic Net::Server based HTTP server
  class</p>
</section>
<section class="Sh">
<h1 class="Sh" id="TEST_ONE_LINER"><a class="permalink" href="#TEST_ONE_LINER">TEST
  ONE LINER</a></h1>
<pre>
    perl -e 'use base qw(Net::Server::HTTP); main-&gt;run(port =&gt; 8080)'
    # will start up an echo server
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<pre>
    use base qw(Net::Server::HTTP);
    __PACKAGE__-&gt;run;

    sub process_http_request {
        my $self = shift;

        print &quot;Content-type: text/html\n\n&quot;;
        print &quot;&lt;form method=post action=/bam&gt;&lt;input type=text name=foo&gt;&lt;input type=submit&gt;&lt;/form&gt;\n&quot;;

        require Data::Dumper;
        local $Data::Dumper::Sortkeys = 1;

        require CGI;
        my $form = {};
        my $q = CGI-&gt;new; $form-&gt;{$_} = $q-&gt;param($_) for $q-&gt;param;

        print &quot;&lt;pre&gt;&quot;.Data::Dumper-&gt;Dump([\%ENV, $form], ['*ENV', 'form']).&quot;&lt;/pre&gt;&quot;;
    }
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">Even though Net::Server::HTTP doesn't fall into the normal
    parallel of the other Net::Server flavors, handling HTTP requests is an
    often requested feature and is a standard and simple protocol.</p>
<p class="Pp">Net::Server::HTTP begins with base type MultiType defaulting to
    Net::Server::Fork. It is easy to change it to any of the other Net::Server
    flavors by passing server_type =&gt; <span class="Li">$other_flavor</span>
    in the server configurtation. The port has also been defaulted to port 80 -
    but could easily be changed to another through the server configuration. You
    can also very easily add ssl by including, proto=&gt;&quot;ssl&quot; and
    provide a SSL_cert_file and SSL_key_file.</p>
<p class="Pp">For example, here is a basic server that will bind to all
    interfaces, will speak both HTTP on port 8080 as well as HTTPS on 8443, and
    will speak both IPv4, as well as IPv6 if it is available.</p>
<p class="Pp"></p>
<pre>
    use base qw(Net::Server::HTTP);

    __PACKAGE__-&gt;run(
        port  =&gt; [8080, &quot;8443/ssl&quot;],
        ipv   =&gt; '*', # IPv6 if available
        SSL_key_file  =&gt; '/my/key',
        SSL_cert_file =&gt; '/my/cert',
    );
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="METHODS"><a class="permalink" href="#METHODS">METHODS</a></h1>
<dl class="Bl-tag">
  <dt>&quot;_init_access_log&quot;</dt>
  <dd>Used to open and initialize any requested access_log (see access_log_file
      and access_log_format).</dd>
  <dt>&quot;_tie_client_stdout&quot;</dt>
  <dd>Used to initialize automatic response header parsing.</dd>
  <dt>&quot;process_http_request&quot;</dt>
  <dd>Will be passed the client handle, and will have STDOUT and STDIN tied to
      the client.
    <p class="Pp">During this method, the <span class="Li">%ENV</span> will have
        been set to a standard CGI style environment. You will need to be sure
        to print the Content-type header. This is one change from the other
        standard Net::Server base classes.</p>
    <p class="Pp">During this method you can read from
        <span class="Li">%ENV</span> and STDIN just like a normal HTTP request
        in other web servers. You can print to STDOUT and Net::Server will
        handle the header negotiation for you.</p>
    <p class="Pp">Note: Net::Server::HTTP has no concept of document root or
        script aliases or default handling of static content. That is up to the
        consumer of Net::Server::HTTP to work out.</p>
    <p class="Pp">Net::Server::HTTP comes with a basic
        <span class="Li">%ENV</span> display installed as the default
        process_http_request method.</p>
  </dd>
  <dt>&quot;process_request&quot;</dt>
  <dd>This method has been overridden in Net::Server::HTTP - you should not use
      it while using Net::Server::HTTP. This overridden method parses the
      environment and sets up request alarms and handles dying failures. It
      calls process_http_request once the request is ready and headers have been
      parsed.</dd>
  <dt>&quot;process_headers&quot;</dt>
  <dd>Used to read in the incoming headers and set the ENV.</dd>
  <dt>&quot;_init_http_request_info&quot;</dt>
  <dd>Called at the end of process_headers. Initializes the contents of
      http_request_info.</dd>
  <dt>&quot;http_request_info&quot;</dt>
  <dd>Returns a hashref of information specific to the current request. This
      information will be used for logging later on.</dd>
  <dt>&quot;send_status&quot;</dt>
  <dd>Takes an HTTP status and a message. Sends out the correct headers.</dd>
  <dt>&quot;send_500&quot;</dt>
  <dd>Calls send_status with 500 and the argument passed to send_500.</dd>
  <dt id="c_log_http_request_"><a class="permalink" href="#c_log_http_request_">c&lt;log_http_request&gt;</a></dt>
  <dd>Called at the end of post_process_request. The default method looks for
      the default access_log_format and checks if logging was initilized during
      _init_access_log. If both of these exist, the http_request_info is
      formatted using http_log_format and the result is logged.</dd>
  <dt>&quot;http_log_format&quot;</dt>
  <dd>Takes a format string, and request_info and returns a formatted string.
      The format should follow the apache mod_log_config specification. As in
      the mod_log_config specification, backslashes, quotes should be escaped
      with backslashes and you may also include \n and \t characters as well.
    <p class="Pp">The following is a listing of the available parameters as well
        as sample output based on a very basic HTTP server.</p>
    <p class="Pp"></p>
    <pre>
    %%                %                 # a percent
    %a                ::1               # remote ip
    %A                ::1               # local ip
    %b                83                # response size (- if 0) Common Log Format
    %B                83                # response size
    %{bar}C           baz               # value of cookie by that name
    %D                916               # elapsed in microseconds
    %{HTTP_COOKIE}e   bar=baz           # value of %ENV by that name
    %f                -                 # filename - unused
    %h                ::1               # remote host if lookups are on, remote ip otherwise
    %H                http              # request protocol
    %{Host}i          localhost:8080    # request header by that name
    %I                336               # bytes received including headers
    %l                -                 # remote logname - unsused
    %m                GET               # request method
    %n                Just a note       # http_note by that name
    %{Content-type}o  text/html         # output header by that name
    %O                189               # response size including headers
    %p                8080              # server port
    %P                22999             # pid - does not support %{tid}P
    q                 ?hello=there      # query_string including ? (- otherwise)
    r                 GET /bam?hello=there HTTP/1.1      # the first line of the request
    %s                200               # response status
    %u                -                 # remote user - unused
    %U                /bam              # request path (no query string)
    %t                [06/Jun/2012:12:14:21 -0600]       # http_log_time standard format
    %t{%F %T %z}t     [2012-06-06 12:14:21 -0600]        # http_log_time with format
    %T                0                 # elapsed time in seconds
    %v                localhost:8080    # http_log_vhost - partial implementation
    %V                localhost:8080    # http_log_vhost - partial implementation
    %X                -                 # Connection completed and is 'close' (-)
    </pre>
    <p class="Pp">Additionally, the log parsing allows for the following
        formats.</p>
    <p class="Pp"></p>
    <pre>
    %&gt;s               200               # status of last request
    %&lt;s               200               # status of original request
    %400a             -                 # remote ip if status is 400
    %!400a            ::1               # remote ip if status is not 400
    %!200a            -                 # remote ip if status is not 200
    </pre>
    <p class="Pp">There are few bits not completely implemented:</p>
    <p class="Pp"></p>
    <pre>
    &gt; and &lt;    # There is no internal redirection
    %I         # The answer to this is based on header size and Content-length
                 instead of the more correct actual number of bytes read though
                 in common cases those would be the same.
    %X         # There is no Connection keepalive in the default server.
    %v and %V  # There are no virtual hosts in the default HTTP server.
    %{tid}P    # The default servers are not threaded.
    </pre>
    <p class="Pp">See the <span class="Li">&quot;access_log_format&quot;</span>
        option for how to set a different format as well as to see the default
        string.</p>
  </dd>
  <dt>&quot;exec_cgi&quot;</dt>
  <dd>Allow for calling an external script as a CGI. This will use IPC::Open3 to
      fork a new process and read/write from it.
    <p class="Pp"></p>
    <pre>
    use base qw(Net::Server::HTTP);
    __PACKAGE__-&gt;run;

    sub process_http_request {
        my $self = shift;

        if ($ENV{'PATH_INFO'} &amp;&amp; $ENV{'PATH_INFO'} =~ s{^ (/foo) (?= $ | /) }{}x) {
           $ENV{'SCRIPT_NAME'} = $1;
           my $file = &quot;/var/www/cgi-bin/foo&quot;; # assuming this exists
           return $self-&gt;exec_cgi($file);
        }

        print &quot;Content-type: text/html\n\n&quot;;
        print &quot;&lt;a href=/foo&gt;Foo&lt;/a&gt;&quot;;
    }
    </pre>
    <p class="Pp">At this first release, the parent server is not tracking the
        child script which may cause issues if the script is running when a HUP
        is received.</p>
  </dd>
  <dt>&quot;http_log_time&quot;</dt>
  <dd>Used to implement the <span class="Li">%t</span> format.</dd>
  <dt>&quot;http_log_env&quot;</dt>
  <dd>Used to implement the <span class="Li">%e</span> format.</dd>
  <dt>&quot;http_log_cookie&quot;</dt>
  <dd>Used to implement the <span class="Li">%C</span> format.</dd>
  <dt>&quot;http_log_header_in&quot;</dt>
  <dd>used to implement the <span class="Li">%i</span> format.</dd>
  <dt>&quot;http_log_note&quot;</dt>
  <dd>Used to implement the <span class="Li">%n</span> format.</dd>
  <dt>&quot;http_note&quot;</dt>
  <dd>Takes a key and an optional value. If passed a key and value, sets the
      note for that key. Always returns the value. These notes currently only
      are used for %{key}n output format.</dd>
  <dt>&quot;http_log_header_out&quot;</dt>
  <dd>Used to implement the <span class="Li">%o</span> format.</dd>
  <dt>&quot;http_log_pid&quot;</dt>
  <dd>Used to implement the <span class="Li">%P</span> format.</dd>
  <dt>&quot;http_log_vhost&quot;</dt>
  <dd>Used to implement the <span class="Li">%v</span> and
      <span class="Li">%V</span> formats.</dd>
  <dt>&quot;http_log_constat&quot;</dt>
  <dd>Used to implement the <span class="Li">%X</span> format.</dd>
  <dt>&quot;exec_trusted_perl&quot;</dt>
  <dd>Allow for calling an external perl script. This method will still fork,
      but instead of using IPC::Open3, it simply requires the perl script. That
      means that the running script will be able to make use of any shared
      memory. It also means that the STDIN/STDOUT/STDERR handles the script is
      using are those directly bound by the server process.
    <p class="Pp"></p>
    <pre>
    use base qw(Net::Server::HTTP);
    __PACKAGE__-&gt;run;

    sub process_http_request {
        my $self = shift;

        if ($ENV{'PATH_INFO'} &amp;&amp; $ENV{'PATH_INFO'} =~ s{^ (/foo) (?= $ | /) }{}x) {
           $ENV{'SCRIPT_NAME'} = $1;
           my $file = &quot;/var/www/cgi-bin/foo&quot;; # assuming this exists
           return $self-&gt;exec_trusted_perl($file);
        }

        print &quot;Content-type: text/html\n\n&quot;;
        print &quot;&lt;a href=/foo&gt;Foo&lt;/a&gt;&quot;;
    }
    </pre>
    <p class="Pp">At this first release, the parent server is not tracking the
        child script which may cause issues if the script is running when a HUP
        is received.</p>
  </dd>
  <dt>&quot;exec_fork_hook&quot;</dt>
  <dd>This method is called after the fork of exec_trusted_perl and exec_cgi
      hooks. It is passed the pid (0 if the child) and the file being ran. Note,
      that the hook will not be called from the child during exec_cgi.</dd>
  <dt>&quot;http_dispatch&quot;</dt>
  <dd>Called if the default process_http_request and process_request methods
      have not been overridden and <span class="Li">&quot;app&quot;</span>
      configuration parameters have been passed. In this case this replaces the
      default echo server. You can also enable this subsystem for your own
      direct use by setting enable_dispatch to true during configuration. See
      the <span class="Li">&quot;app&quot;</span> configuration item. It will be
      passed a dispatch qr (regular expression) generated during
      _check_dispatch, and a dispatch table. The qr will be applied to
      path_info. This mechanism could be used to augment Net::Server::HTTP with
      document root and virtual host capabilities.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="OPTIONS"><a class="permalink" href="#OPTIONS">OPTIONS</a></h1>
<p class="Pp">In addition to the command line arguments of the Net::Server base
    classes you can also set the following options.</p>
<dl class="Bl-tag">
  <dt id="max_header_size"><a class="permalink" href="#max_header_size">max_header_size</a></dt>
  <dd>Defaults to 100_000. Maximum number of bytes to read while parsing
      headers.</dd>
  <dt id="server_revision"><a class="permalink" href="#server_revision">server_revision</a></dt>
  <dd>Defaults to Net::Server::HTTP/$Net::Server::VERSION.</dd>
  <dt id="timeout_header"><a class="permalink" href="#timeout_header">timeout_header</a></dt>
  <dd>Defaults to 15 - number of seconds to wait for parsing headers.</dd>
  <dt id="timeout_idle"><a class="permalink" href="#timeout_idle">timeout_idle</a></dt>
  <dd>Defaults to 60 - number of seconds a request can be idle before the
      request is closed.</dd>
  <dt id="access_log_file"><a class="permalink" href="#access_log_file">access_log_file</a></dt>
  <dd>Defaults to undef. If true, this represents the location of where the
      access log should be written to. If a special value of STDERR is passed,
      the access log entry will be writing to the same location as the ERROR
      log.</dd>
  <dt id="access_log_format"><a class="permalink" href="#access_log_format">access_log_format</a></dt>
  <dd>Should be a valid apache log format that will be passed to
      http_log_format. See the http_log_format method for more information.
    <p class="Pp">The default value is the NCSA extended/combined log
      format:</p>
    <p class="Pp"></p>
    <pre>
    '%h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot;'
    </pre>
  </dd>
  <dt id="app"><a class="permalink" href="#app">app</a></dt>
  <dd>Takes one or more items and registers them for dispatch. Arguments may be
      supplied as an arrayref containing a location/target pairs, a hashref
      containing a location/target pairs, a bare code ref that will use
      &quot;/&quot; as the location and the codref as the target, a string with
      a space indicating &quot;location target&quot;, a string containing
      &quot;location=target&quot;, or finally a string that will be used as both
      location and target. For items passed as an arrayref or hashref, the
      target may be a coderef which will be called and should handle the
      request. In all other cases the target should be a valid executable
      suitable for passing to exec_cgi.
    <p class="Pp">The locations will be added in the order that they are
        configured. They will be added to a regular expression which will be
        applied to the incoming PATH_INFO string. If the match is successful,
        the <span class="Li">$ENV</span>{'SCRIPT_NAME'} will be set to the
        matched portion and the matched portion will be removed from
        <span class="Li">$ENV</span>{'PATH_INFO'}.</p>
    <p class="Pp">Once an app has been passed, it is necessary for the server to
        listen on /. Therefore if &quot;/&quot; has not been specifically
        configured for dispatch, the first found dispatch target will also be
        used to handle &quot;/&quot;.</p>
    <p class="Pp">For convenience, if the log_level is 2 or greater, the
        dispatch table is output to the log.</p>
    <p class="Pp">This mechanism is left as a generic mechanism suitable for
        overriding by servers meant to handle more complex dispatch. At the
        moment there is no handling of virtual hosts. At some point we will add
        in the default ability to play static content and likely for the ability
        to configure virtual hosts - or that may have to wait for a third party
        module.</p>
    <p class="Pp"></p>
    <pre>
    app =&gt; &quot;/home/paul/foo.cgi&quot;,
      # Dispatch: /home/paul/foo.cgi =&gt; home/paul/foo.cgi
      # Dispatch: / =&gt; home/paul/foo.cgi (default)


    app =&gt; &quot;../../foo.cgi&quot;,
    app =&gt; &quot;./bar.cgi&quot;,
    app =&gt; &quot;baz ./bar.cgi&quot;,
    app =&gt; &quot;bim=./bar.cgi&quot;,
      # Dispatch: /foo.cgi =&gt; ../../foo.cgi
      # Dispatch: /bar.cgi =&gt; ./bar.cgi
      # Dispatch: /baz =&gt; ./bar.cgi
      # Dispatch: /bim =&gt; ./bar.cgi
      # Dispatch: / =&gt; ../../foo.cgi (default)


    app =&gt; &quot;../../foo.cgi&quot;,
    app =&gt; &quot;/=./bar.cgi&quot;,
      # Dispatch: /foo.cgi =&gt; ../../foo.cgi
      # Dispatch: / =&gt; ./bar.cgi

    # you could also do this on the commandline
    net-server HTTP app ../../foo.cgi app /=./bar.cgi

    # extended options when configured from code

    Net::Server::HTTP-&gt;run(app =&gt; { # loses order of matching
      '/' =&gt; sub { ... },
      '/foo' =&gt; sub { ... },
      '/bar' =&gt; '/path/to/some.cgi',
    });

    Net::Server::HTTP-&gt;run(app =&gt; [
      '/' =&gt; sub { ... },
      '/foo' =&gt; sub { ... },
      '/bar' =&gt; '/path/to/some.cgi',
    ]);
    </pre>
  </dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="TODO"><a class="permalink" href="#TODO">TODO</a></h1>
<p class="Pp">Add support for writing out HTTP/1.1.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHOR"><a class="permalink" href="#AUTHOR">AUTHOR</a></h1>
<p class="Pp">Paul T. Seamons paul@seamons.com</p>
</section>
<section class="Sh">
<h1 class="Sh" id="THANKS"><a class="permalink" href="#THANKS">THANKS</a></h1>
<p class="Pp">See Net::Server</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp">Please see also Net::Server::Fork, Net::Server::INET,
    Net::Server::PreFork, Net::Server::PreForkSimple, Net::Server::MultiType,
    Net::Server::Single Net::Server::SIG Net::Server::Daemonize
    Net::Server::Proto</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2017-08-10</td>
    <td class="foot-os">perl v5.30.2</td>
  </tr>
</table>
</body>
</html>
