<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>
  <meta charset="utf-8"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>Test2::Manual::Tooling::FirstTool(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Test2::Manual::Tooling::FirstTool(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">Test2::Manual::Tooling::FirstTool(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">Test2::Manual::Tooling::FirstTool - Write your first tool with
    Test2.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">This tutorial will help you write your very first tool by cloning
    the <span class="Li">&quot;ok()&quot;</span> tool.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="COMPLETE_CODE_UP_FRONT"><a class="permalink" href="#COMPLETE_CODE_UP_FRONT">COMPLETE
  CODE UP FRONT</a></h1>
<pre>
    package Test2::Tools::MyOk;
    use strict;
    use warnings;

    use Test2::API qw/context/;

    use base 'Exporter';
    our @EXPORT = qw/ok/;

    sub ok($;$@) {
        my ($bool, $name, @diag) = @_;

        my $ctx = context();

        return $ctx-&gt;pass_and_release($name) if $bool;
        return $ctx-&gt;fail_and_release($name, @diag);
    }

    1;
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="LINE_BY_LINE"><a class="permalink" href="#LINE_BY_LINE">LINE
  BY LINE</a></h1>
<dl class="Bl-tag">
  <dt id="sub"><a class="permalink" href="#sub">sub ok($;$@) {</a></dt>
  <dd>In this case we are emulating the <span class="Li">&quot;ok()&quot;</span>
      function exported by Test2::Tools::Basic.
    <p class="Pp"><span class="Li">&quot;ok()&quot;</span> and similar test
        tools use prototypes to enforce argument parsing. Your test tools do not
        necessarily need prototypes, like any perl function you need to make the
        decision based on how it is used.</p>
    <p class="Pp">The prototype requires at least 1 argument, which will be
        forced into a scalar context. The second argument is optional, and is
        also forced to be scalar, it is the name of the test. Any remaining
        arguments are treated as diagnostics messages that will only be used if
        the test failed.</p>
  </dd>
  <dt id="my"><a class="permalink" href="#my">my ($bool, $name, @diag) =
    @_;</a></dt>
  <dd>This line does not need much explanation, we are simply grabbing the
    args.</dd>
  <dt id="my~2"><a class="permalink" href="#my~2">my $ctx =
    <b>context()</b>;</a></dt>
  <dd>This is a vital line in <b>ALL</b> tools. The context object is the
      primary API for test tools. You <b>MUST</b> get a context if you want to
      issue any events, such as making assertions. Further, the context is
      responsible for making sure failures are attributed to the correct file
      and line number.
    <p class="Pp"><b>Note:</b> A test function <b>MUST</b> always release the
        context when it is done, you cannot simply let it fall out of scope and
        be garbage collected. Test2 does a pretty good job of yelling at you if
        you make this mistake.</p>
    <p class="Pp"><b>Note:</b> You <b>MUST NOT</b> ever store or pass around a
        <i>real</i> context object. If you wish to hold on to a context for any
        reason you must use clone to make a copy <span class="Li">&quot;my $copy
        = $ctx-&gt;clone&quot;</span>. The copy may be passed around or stored,
        but the original <b>MUST</b> be released when you are done with it.</p>
  </dd>
  <dt id="return"><a class="permalink" href="#return">return
    $ctx-&gt;pass_and_release($name) if $bool;</a></dt>
  <dd>When <span class="Li">$bool</span> is true, this line uses the context
      object to issue a Test2::Event::Pass event. Along with issuing the event
      this will also release the context object and return true.
    <p class="Pp">This is short form for:</p>
    <p class="Pp"></p>
    <pre>
    if($bool) {
        $ctx-&gt;pass($name);
        $ctx-&gt;release;
        return 1;
    }
    </pre>
  </dd>
  <dt id="return~2"><a class="permalink" href="#return~2">return
    $ctx-&gt;fail_and_release($name, @diag);</a></dt>
  <dd>This line issues a Test2::Event::Fail event, releases the context object,
      and returns false. The fail event will include any diagnostics messages
      from the <span class="Li">@diag</span> array.
    <p class="Pp">This is short form for:</p>
    <p class="Pp"></p>
    <pre>
    $ctx-&gt;fail($name, @diag);
    $ctx-&gt;release;
    return 0;
    </pre>
  </dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="CONTEXT_OBJECT_DOCUMENTATION"><a class="permalink" href="#CONTEXT_OBJECT_DOCUMENTATION">CONTEXT
  OBJECT DOCUMENTATION</a></h1>
<p class="Pp">Test2::API::Context is the place to read up on what methods the
    context provides.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp">Test2::Manual - Primary index of the manual.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SOURCE"><a class="permalink" href="#SOURCE">SOURCE</a></h1>
<p class="Pp">The source code repository for Test2-Manual can be found at
    <i>https://github.com/Test-More/Test2-Suite/</i>.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="MAINTAINERS"><a class="permalink" href="#MAINTAINERS">MAINTAINERS</a></h1>
<dl class="Bl-tag">
  <dt id="Chad"><a class="permalink" href="#Chad">Chad Granum
    &lt;exodist@cpan.org&gt;</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHORS"><a class="permalink" href="#AUTHORS">AUTHORS</a></h1>
<dl class="Bl-tag">
  <dt id="Chad~2"><a class="permalink" href="#Chad~2">Chad Granum
    &lt;exodist@cpan.org&gt;</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT"><a class="permalink" href="#COPYRIGHT">COPYRIGHT</a></h1>
<p class="Pp">Copyright 2018 Chad Granum &lt;exodist@cpan.org&gt;.</p>
<p class="Pp">This program is free software; you can redistribute it and/or
    modify it under the same terms as Perl itself.</p>
<p class="Pp">See <i>http://dev.perl.org/licenses/</i></p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2020-10-22</td>
    <td class="foot-os">perl v5.30.2</td>
  </tr>
</table>
</body>
</html>
