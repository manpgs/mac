<!DOCTYPE html>
<html lang="en">
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.14 (Pod::Simple 3.42)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>Test::Fatal(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Test::Fatal(3)</td>
    <td class="head-vol"><a href=".">User Contributed Perl Documentation</a></td>
    <td class="head-rtitle">Test::Fatal(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">Test::Fatal - incredibly simple helpers for testing code with
    exceptions</p>
</section>
<section class="Sh">
<h1 class="Sh" id="VERSION"><a class="permalink" href="#VERSION">VERSION</a></h1>
<p class="Pp">version 0.014</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<pre>  use Test::More;
  use Test::Fatal;
  use System::Under::Test qw(might_die);
  is(
    exception { might_die; },
    undef,
    &quot;the code lived&quot;,
  );
  like(
    exception { might_die; },
    qr/turns out it died/,
    &quot;the code died as expected&quot;,
  );
  isa_ok(
    exception { might_die; },
    'Exception::Whatever',
    'the thrown exception',
  );
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">Test::Fatal is an alternative to the popular Test::Exception. It
    does much less, but should allow greater flexibility in testing
    exception-throwing code with about the same amount of typing.</p>
<p class="Pp">It exports one routine by default:
    <span class="Li">&quot;exception&quot;</span>.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="FUNCTIONS"><a class="permalink" href="#FUNCTIONS">FUNCTIONS</a></h1>
<section class="Ss">
<h2 class="Ss" id="exception"><a class="permalink" href="#exception">exception</a></h2>
<pre>  my $exception = exception { ... };
</pre>
<p class="Pp"><span class="Li">&quot;exception&quot;</span> takes a bare block
    of code and returns the exception thrown by that block. If no exception was
    thrown, it returns undef.</p>
<p class="Pp"><b>Achtung!</b> If the block results in a <i>false</i> exception,
    such as 0 or the empty string, Test::Fatal itself will die. Since either of
    these cases indicates a serious problem with the system under testing, this
    behavior is considered a <i>feature</i>. If you must test for these
    conditions, you should use Try::Tiny's try/catch mechanism. (Try::Tiny is
    the underlying exception handling system of Test::Fatal.)</p>
<p class="Pp">Note that there is no TAP assert being performed. In other words,
    no &quot;ok&quot; or &quot;not ok&quot; line is emitted. It's up to you to
    use the rest of <span class="Li">&quot;exception&quot;</span> in an existing
    test like <span class="Li">&quot;ok&quot;</span>,
    <span class="Li">&quot;isa_ok&quot;</span>,
    <span class="Li">&quot;is&quot;</span>, et cetera. Or you may wish to use
    the <span class="Li">&quot;dies_ok&quot;</span> and
    <span class="Li">&quot;lives_ok&quot;</span> wrappers, which do provide TAP
    output.</p>
<p class="Pp"><span class="Li">&quot;exception&quot;</span> does <i>not</i>
    alter the stack presented to the called block, meaning that if the exception
    returned has a stack trace, it will include some frames between the code
    calling <span class="Li">&quot;exception&quot;</span> and the thing throwing
    the exception. This is considered a <i>feature</i> because it avoids the
    occasionally twitchy <span class="Li">&quot;Sub::Uplevel&quot;</span>
    mechanism.</p>
<p class="Pp"><b>Achtung!</b> This is not a great idea:</p>
<p class="Pp"></p>
<pre>  sub exception_like(&amp;$;$) {
      my ($code, $pattern, $name) = @_;
      like( &amp;exception($code), $pattern, $name );
  }
  exception_like(sub { }, qr/foo/, 'foo appears in the exception');
</pre>
<p class="Pp">If the code in the <span class="Li">&quot;...&quot;</span> is
    going to throw a stack trace with the arguments to each subroutine in its
    call stack (for example via
    <span class="Li">&quot;Carp::confess&quot;</span>, the test name, &quot;foo
    appears in the exception&quot; will itself be matched by the regex. Instead,
    write this:</p>
<p class="Pp"></p>
<pre>  like( exception { ... }, qr/foo/, 'foo appears in the exception' );
</pre>
<p class="Pp"><b>Achtung</b>: One final bad idea:</p>
<p class="Pp"></p>
<pre>  isnt( exception { ... }, undef, &quot;my code died!&quot;);
</pre>
<p class="Pp">It's true that this tests that your code died, but you should
    really test that it died <i>for the right reason</i>. For example, if you
    make an unrelated mistake in the block, like using the wrong dereference,
    your test will pass even though the code to be tested isn't really run at
    all. If you're expecting an inspectable exception with an identifier or
    class, test that. If you're expecting a string exception, consider using
    <span class="Li">&quot;like&quot;</span>.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="success"><a class="permalink" href="#success">success</a></h2>
<pre>  try {
    should_live;
  } catch {
    fail(&quot;boo, we died&quot;);
  } success {
    pass(&quot;hooray, we lived&quot;);
  };
</pre>
<p class="Pp"><span class="Li">&quot;success&quot;</span>, exported only by
    request, is a Try::Tiny helper with semantics identical to
    <span class="Li">&quot;finally&quot;</span>, but the body of the block will
    only be run if the <span class="Li">&quot;try&quot;</span> block ran without
    error.</p>
<p class="Pp">Although almost any needed exception tests can be performed with
    <span class="Li">&quot;exception&quot;</span>, success blocks may sometimes
    help organize complex testing.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="dies_ok"><a class="permalink" href="#dies_ok">dies_ok</a></h2>
</section>
<section class="Ss">
<h2 class="Ss" id="lives_ok"><a class="permalink" href="#lives_ok">lives_ok</a></h2>
<p class="Pp">Exported only by request, these two functions run a given block of
    code, and provide TAP output indicating if it did, or did not throw an
    exception. These provide an easy upgrade path for replacing existing unit
    tests based on <span class="Li">&quot;Test::Exception&quot;</span>.</p>
<p class="Pp">RJBS does not suggest using this except as a convenience while
    porting tests to use Test::Fatal's
    <span class="Li">&quot;exception&quot;</span> routine.</p>
<p class="Pp"></p>
<pre>  use Test::More tests =&gt; 2;
  use Test::Fatal qw(dies_ok lives_ok);
  dies_ok { die &quot;I failed&quot; } 'code that fails';
  lives_ok { return &quot;I'm still alive&quot; } 'code that does not fail';
</pre>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHOR"><a class="permalink" href="#AUTHOR">AUTHOR</a></h1>
<p class="Pp">Ricardo Signes &lt;rjbs@cpan.org&gt;</p>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT_AND_LICENSE"><a class="permalink" href="#COPYRIGHT_AND_LICENSE">COPYRIGHT
  AND LICENSE</a></h1>
<p class="Pp">This software is copyright (c) 2010 by Ricardo Signes.</p>
<p class="Pp">This is free software; you can redistribute it and/or modify it
    under the same terms as the Perl 5 programming language system itself.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2014-12-09</td>
    <td class="foot-os"><a href="..">perl v5.34.0</a></td>
  </tr>
</table>
</body>
</html>
