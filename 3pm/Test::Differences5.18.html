<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 2.27 (Pod::Simple 3.28)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>
  <meta charset="utf-8"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>Test::Differences(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Test::Differences(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">Test::Differences(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">Test::Differences - Test strings and data structures and show
    differences if not ok</p>
</section>
<section class="Sh">
<h1 class="Sh" id="VERSION"><a class="permalink" href="#VERSION">VERSION</a></h1>
<p class="Pp">0.61</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<pre>
   use Test;    ## Or use Test::More
   use Test::Differences;

   eq_or_diff $got,  &quot;a\nb\nc\n&quot;,   &quot;testing strings&quot;;
   eq_or_diff \@got, [qw( a b c )], &quot;testing arrays&quot;;

   ## Passing options:
   eq_or_diff $got, $expected, $name, { context =&gt; 300 };  ## options

   ## Using with DBI-like data structures

   use DBI;

   ... open connection &amp; prepare statement and @expected_... here...

   eq_or_diff $sth-&gt;fetchall_arrayref, \@expected_arrays  &quot;testing DBI arrays&quot;;
   eq_or_diff $sth-&gt;fetchall_hashref,  \@expected_hashes, &quot;testing DBI hashes&quot;;

   ## To force textual or data line numbering (text lines are numbered 1..):
   eq_or_diff_text ...;
   eq_or_diff_data ...;
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="EXPORT"><a class="permalink" href="#EXPORT">EXPORT</a></h1>
<p class="Pp">This module exports three test functions and four diff-style
    functions:</p>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Test functions</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li><span class="Li">&quot;eq_or_diff&quot;</span></li>
  <li><span class="Li">&quot;eq_or_diff_data&quot;</span></li>
  <li><span class="Li">&quot;eq_or_diff_text&quot;</span></li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Diff style functions</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li><span class="Li">&quot;table_diff&quot;</span> (the default)</li>
  <li><span class="Li">&quot;unified_diff&quot;</span></li>
  <li><span class="Li">&quot;oldstyle_diff&quot;</span></li>
  <li><span class="Li">&quot;context_diff&quot;</span></li>
</ul>
</div>
<div class="Bd-indent"></div>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">When the code you're testing returns multiple lines, records or
    data structures and they're just plain wrong, an equivalent to the Unix
    <span class="Li">&quot;diff&quot;</span> utility may be just what's needed.
    Here's output from an example test script that checks two text documents and
    then two (trivial) data structures:</p>
<p class="Pp"></p>
<pre>
 t/99example....1..3
 not ok 1 - differences in text
 #     Failed test ((eval 2) at line 14)
 #     +---+----------------+----------------+
 #     | Ln|Got             |Expected        |
 #     +---+----------------+----------------+
 #     |  1|this is line 1  |this is line 1  |
 #     *  2|this is line 2  |this is line b  *
 #     |  3|this is line 3  |this is line 3  |
 #     +---+----------------+----------------+
 not ok 2 - differences in whitespace
 #     Failed test ((eval 2) at line 20)
 #     +---+------------------+------------------+
 #     | Ln|Got               |Expected          |
 #     +---+------------------+------------------+
 #     |  1|        indented  |        indented  |
 #     *  2|        indented  |\tindented        *
 #     |  3|        indented  |        indented  |
 #     +---+------------------+------------------+
 not ok 3
 #     Failed test ((eval 2) at line 22)
 #     +----+-------------------------------------+----------------------------+
 #     | Elt|Got                                  |Expected                    |
 #     +----+-------------------------------------+----------------------------+
 #     *   0|bless( [                             |[                           *
 #     *   1|  'Move along, nothing to see here'  |  'Dry, humorless message'  *
 #     *   2|], 'Test::Builder' )                 |]                           *
 #     +----+-------------------------------------+----------------------------+
 # Looks like you failed 3 tests of 3.
</pre>
<p class="Pp">eq_or_diff_...() compares two strings or (limited) data structures
    and either emits an ok indication or a side-by-side diff. Test::Differences
    is designed to be used with Test.pm and with Test::Simple, Test::More, and
    other Test::Builder based testing modules. As the SYNOPSIS shows, another
    testing module must be used as the basis for your test suite.</p>
<p class="Pp">These functions assume that you are presenting it with
    &quot;flat&quot; records, looking like:</p>
<p class="Pp"></p>
<pre>
   - scalars composed of record-per-line
   - arrays of scalars,
   - arrays of arrays of scalars,
   - arrays of hashes containing only scalars
</pre>
<p class="Pp">All of these are flattened in to single strings which are then
    compared for differences. Differently data structures can be compared, as
    long as they flatten identically.</p>
<p class="Pp">All other data structures are run through Data::Dumper first. This
    is a bit dangerous, as some versions of perl shipped with Data::Dumpers that
    could do the oddest things with unexpected, like core dump. Only as of 5.8.0
    does Data::Dumper sort hash keys, which is necessary for HASH dumps to be
    fully predictable. This will be changed when this bites somebody or I get
    some free time.</p>
<p class="Pp"><span class="Li">&quot;eq_or_diff()&quot;</span> starts counting
    records at 0 unless you pass it two text strings:</p>
<p class="Pp"></p>
<pre>
   eq_or_diff $a, $b;   ## First line is line number 1
   eq_or_diff @a, @b;   ## First element is element 0
   eq_or_diff $a, @b;   ## First line/element is element 0
</pre>
<p class="Pp">If you want to force a first record number of 0, use
    <span class="Li">&quot;eq_or_diff_data&quot;</span>. If you want to force a
    first record number of 1, use
    <span class="Li">&quot;eq_or_diff_text&quot;</span>. I chose this over
    passing in an options hash because it's clearer and simpler this way.
  YMMV.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="OPTIONS"><a class="permalink" href="#OPTIONS">OPTIONS</a></h1>
<p class="Pp">The options to <span class="Li">&quot;eq_or_diff&quot;</span> give
    some fine-grained control over the output.</p>
<ul class="Bl-bullet">
  <li><span class="Li">&quot;context&quot;</span>
    <p class="Pp">This allows you to control the amount of context shown:</p>
    <p class="Pp"></p>
    <pre>
   eq_or_diff $got, $expected, $name, { context =&gt; 50000 };
    </pre>
    <p class="Pp">will show you lots and lots of context. Normally,
        <i>eq_or_diff()</i> uses some heuristics to determine whether to show 3
        lines of context (like a normal unified diff) or 25 lines.</p>
  </li>
  <li><span class="Li">&quot;data_type&quot;</span>
    <p class="Pp"><span class="Li">&quot;text&quot;</span> or
        <span class="Li">&quot;data&quot;</span>. See
        <span class="Li">&quot;eq_or_diff_text&quot;</span> and
        <span class="Li">&quot;eq_or_diff_data&quot;</span> to understand this.
        You can usually ignore this.</p>
  </li>
  <li><span class="Li">&quot;Sortkeys&quot;</span>
    <p class="Pp">If passed, whatever value is added is used as the argument for
        Data::Dumper Sortkeys option. See the Data::Dumper docs to understand
        how you can control the Sortkeys behavior.</p>
  </li>
</ul>
</section>
<section class="Sh">
<h1 class="Sh" id="DIFF_STYLES"><a class="permalink" href="#DIFF_STYLES">DIFF
  STYLES</a></h1>
<p class="Pp">For extremely long strings, a table diff can wrap on your screen
    and be hard to read. If you are comfortable with different diff formats, you
    can switch to a format more suitable for your data. These are the four
    formats supported by the Text::Diff module and are set with the following
    functions:</p>
<ul class="Bl-bullet">
  <li><span class="Li">&quot;table_diff&quot;</span> (the default)</li>
  <li><span class="Li">&quot;unified_diff&quot;</span></li>
  <li><span class="Li">&quot;oldstyle_diff&quot;</span></li>
  <li><span class="Li">&quot;context_diff&quot;</span></li>
</ul>
<p class="Pp">You can run the following to understand the different diff output
    styles:</p>
<p class="Pp"></p>
<pre>
 use Test::More 'no_plan';
 use Test::Differences;

 my $long_string = join '' =&gt; 1..40;

 TODO: {
     local $TODO = 'Testing diff styles';

     # this is the default and does not need to explicitly set unless you need
     # to reset it back from another diff type
     table_diff;
     eq_or_diff $long_string, &quot;-$long_string&quot;, 'table diff';

     unified_diff;
     eq_or_diff $long_string, &quot;-$long_string&quot;, 'unified diff';

     context_diff;
     eq_or_diff $long_string, &quot;-$long_string&quot;, 'context diff';

     oldstyle_diff;
     eq_or_diff $long_string, &quot;-$long_string&quot;, 'oldstyle diff';
 }
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="DEPLOYING"><a class="permalink" href="#DEPLOYING">DEPLOYING</a></h1>
<p class="Pp">There are several basic ways of deploying Test::Differences
    requiring more or less labor by you or your users.</p>
<ul class="Bl-bullet">
  <li>Fallback to <span class="Li">&quot;is_deeply&quot;</span>.
    <p class="Pp">This is your best option if you want this module to be
        optional.</p>
    <p class="Pp"></p>
    <pre>
 use Test::More;
 BEGIN {
     if (!eval q{ use Test::Differences; 1 }) {
         *eq_or_diff = \&amp;is_deeply;
     }
 }
    </pre>
  </li>
  <li>
    <p class="Pp"></p>
    <p class="Pp"></p>
    <pre>
 eval &quot;use Test::Differences&quot;;
    </pre>
    <p class="Pp">If you want to detect the presence of Test::Differences on the
        fly, something like the following code might do the trick for you:</p>
    <p class="Pp"></p>
    <pre>
    use Test qw( !ok );   ## get all syms *except* ok

    eval &quot;use Test::Differences&quot;;
    use Data::Dumper;

    sub ok {
        goto &amp;eq_or_diff if defined &amp;eq_or_diff &amp;&amp; @_ &gt; 1;
        @_ = map ref $_ ? Dumper( @_ ) : $_, @_;
        goto Test::&amp;ok;
    }

    plan tests =&gt; 1;

    ok &quot;a&quot;, &quot;b&quot;;
    </pre>
  </li>
  <li>PREREQ_PM =&gt; { .... &quot;Test::Differences&quot; =&gt; 0, ... }
    <p class="Pp">This method will let CPAN and CPANPLUS users download it
        automatically. It will discomfit those users who choose/have to download
        all packages manually.</p>
  </li>
  <li>t/lib/Test/Differences.pm, t/lib/Text/Diff.pm, ...
    <p class="Pp">By placing Test::Differences and its prerequisites in the
        t/lib directory, you avoid forcing your users to download the
        Test::Differences manually if they aren't using CPAN or CPANPLUS.</p>
    <p class="Pp">If you put a <span class="Li">&quot;use lib
        &quot;t/lib&quot;;&quot;</span> in the top of each test suite before the
        <span class="Li">&quot;use Test::Differences;&quot;</span>,
        <span class="Li">&quot;make test&quot;</span> should work well.</p>
    <p class="Pp">You might want to check once in a while for new
        Test::Differences releases if you do this.</p>
  </li>
</ul>
</section>
<section class="Sh">
<h1 class="Sh" id="LIMITATIONS"><a class="permalink" href="#LIMITATIONS">LIMITATIONS</a></h1>
<section class="Ss">
<h2 class="Ss" id="_Test__or__Test::More_"><a class="permalink" href="#_Test__or__Test::More_">&quot;Test&quot;
  or &quot;Test::More&quot;</a></h2>
<p class="Pp">This module &quot;mixes in&quot; with Test.pm or any of the test
    libraries based on Test::Builder (Test::Simple, Test::More, etc). It does
    this by peeking to see whether Test.pm or Test/Builder.pm is in
    <span class="Li">%INC</span>, so if you are not using one of those, it will
    print a warning and play dumb by not emitting test numbers (or incrementing
    them). If you are using one of these, it should interoperate nicely.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Exporting"><a class="permalink" href="#Exporting">Exporting</a></h2>
<p class="Pp">Exports all 3 functions by default (and by design). Use</p>
<p class="Pp"></p>
<pre>
    use Test::Differences ();
</pre>
<p class="Pp">to suppress this behavior if you don't like the namespace
    pollution.</p>
<p class="Pp">This module will not override functions like <i>ok()</i>,
    <i>is()</i>, <i>is_deeply()</i>, etc. If it did, then you could
    <span class="Li">&quot;eval &quot;use Test::Differences qw( is_deeply
    );&quot;&quot;</span> to get automatic upgrading to diffing behaviors
    without the <span class="Li">&quot;sub my_ok&quot;</span> shown above.
    Test::Differences intentionally does not provide this behavior because this
    would mean that Test::Differences would need to emulate every popular test
    module out there, which would require far more coding and maintenance that
    I'm willing to do. Use the eval and my_ok deployment shown above if you want
    some level of automation.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Unicode"><a class="permalink" href="#Unicode">Unicode</a></h2>
<p class="Pp">Perls before 5.6.0 don't support characters &gt; 255 at all, and
    5.6.0 seems broken. This means that you might get odd results using
    perl5.6.0 with unicode strings.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_Data::Dumper__and_older_Perls."><a class="permalink" href="#_Data::Dumper__and_older_Perls.">&quot;Data::Dumper&quot;
  and older Perls.</a></h2>
<p class="Pp">Relies on Data::Dumper (for now), which, prior to perl5.8, will
    not always report hashes in the same order. <span class="Li">
    $Data::Dumper::SortKeys </span> <i>is</i> set to 1, so on more recent
    versions of Data::Dumper, this should not occur. Check CPAN to see if it's
    been peeled out of the main perl distribution and backported. Reported by
    Ilya Martynov &lt;ilya@martynov.org&gt;, although the SortKeys &quot;future
    perfect&quot; workaround has been set in anticipation of a new Data::Dumper
    for a while. Note that the two hashes should report the same here:</p>
<p class="Pp"></p>
<pre>
    not ok 5
    #     Failed test (t/ctrl/05-home.t at line 51)
    # +----+------------------------+----+------------------------+
    # | Elt|Got                     | Elt|Expected                |
    # +----+------------------------+----+------------------------+
    # |   0|{                       |   0|{                       |
    # |   1|  'password' =&gt; '',     |   1|  'password' =&gt; '',     |
    # *   2|  'method' =&gt; 'login',  *    |                        |
    # |   3|  'ctrl' =&gt; 'home',     |   2|  'ctrl' =&gt; 'home',     |
    # |    |                        *   3|  'method' =&gt; 'login',  *
    # |   4|  'email' =&gt; 'test'     |   4|  'email' =&gt; 'test'     |
    # |   5|}                       |   5|}                       |
    # +----+------------------------+----+------------------------+
</pre>
<p class="Pp">Data::Dumper also overlooks the difference between</p>
<p class="Pp"></p>
<pre>
    $a[0] = \$a[1];
    $a[1] = \$a[0];   # $a[0] = \$a[1]
</pre>
<p class="Pp">and</p>
<p class="Pp"></p>
<pre>
    $x = \$y;
    $y = \$x;
    @a = ( $x, $y );  # $a[0] = \$y, not \$a[1]
</pre>
<p class="Pp">The former involves two scalars, the latter 4:
    <span class="Li">$x</span>, <span class="Li">$y</span>, and
    <span class="Li">@a</span>[0,1]. This was carefully explained to me in words
    of two syllables or less by Yves Orton &lt;demerphq@hotmail.com&gt;. The
    plan to address this is to allow you to select Data::Denter or some other
    module of your choice as an option.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHOR"><a class="permalink" href="#AUTHOR">AUTHOR</a></h1>
<pre>
    Barrie Slaymaker &lt;barries@slaysys.com&gt;
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="MAINTAINER"><a class="permalink" href="#MAINTAINER">MAINTAINER</a></h1>
<pre>
    Curtis &quot;Ovid&quot; Poe &lt;ovid@cpan.org&gt;
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="LICENSE"><a class="permalink" href="#LICENSE">LICENSE</a></h1>
<p class="Pp">Copyright 2001-2008 Barrie Slaymaker, All Rights Reserved.</p>
<p class="Pp">You may use this software under the terms of the GNU public
    license, any version, or the Artistic license.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2022-02-12</td>
    <td class="foot-os">perl v5.18.4</td>
  </tr>
</table>
</body>
</html>
