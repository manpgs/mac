<!DOCTYPE html>
<html lang="en">
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.14 (Pod::Simple 3.42)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>Specio::Constraint::Simple(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Specio::Constraint::Simple(3)</td>
    <td class="head-vol"><a href=".">User Contributed Perl Documentation</a></td>
    <td class="head-rtitle">Specio::Constraint::Simple(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">Specio::Constraint::Simple - Class for simple (non-parameterized
    or specialized) types</p>
</section>
<section class="Sh">
<h1 class="Sh" id="VERSION"><a class="permalink" href="#VERSION">VERSION</a></h1>
<p class="Pp">version 0.46</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<pre>    my $str = t('Str');
    print $str-&gt;name; # Str
    my $parent = $str-&gt;parent;
    if ( $str-&gt;value_is_valid($value) ) { ... }
    $str-&gt;validate_or_die($value);
    my $code = $str-&gt;inline_coercion_and_check('$_[0]');
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">This class implements simple type constraints, constraints without
    special properties or parameterization.</p>
<p class="Pp">It does not actually contain any real code of its own. The entire
    implementation is provided by the Specio::Constraint::Role::Interface role,
    but the primary API for type constraints is documented here.</p>
<p class="Pp">All other type constraint classes in this distribution implement
    this API, except where otherwise noted.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="API"><a class="permalink" href="#API">API</a></h1>
<p class="Pp">This class provides the following methods.</p>
<section class="Ss">
<h2 class="Ss" id="Specio::Constraint::Simple"><a class="permalink" href="#Specio::Constraint::Simple">Specio::Constraint::Simple-&gt;new(...)</a></h2>
<p class="Pp">This creates a new constraint. It accepts the following named
    parameters:</p>
<ul class="Bl-bullet">
  <li>name =&gt; <span class="Li">$name</span>
    <p class="Pp">This is the type's name. The name is optional, but if provided
        it must be a string.</p>
  </li>
  <li>parent =&gt; <span class="Li">$type</span>
    <p class="Pp">The type's parent type. This must be an object which does the
        Specio::Constraint::Role::Interface role.</p>
    <p class="Pp">This parameter is optional.</p>
  </li>
  <li>constraint =&gt; sub { ... }
    <p class="Pp">A subroutine reference implementing the constraint. It will be
        called as a method on the object and passed a single argument, the value
        to check.</p>
    <p class="Pp">It should return true or false to indicate whether the value
        matches the constraint.</p>
    <p class="Pp">This parameter is mutually exclusive with
        <span class="Li">&quot;inline_generator&quot;</span>.</p>
    <p class="Pp">You can also pass this option with the key
        <span class="Li">&quot;where&quot;</span> in the parameter list.</p>
  </li>
  <li>inline_generator =&gt; sub { ... }
    <p class="Pp">This should be a subroutine reference which returns a string
        containing a single term. This code should <i>not</i> end in a
        semicolon. This code should implement the constraint.</p>
    <p class="Pp">The generator will be called as a method on the constraint
        with a single argument. That argument is the name of the variable being
        coerced, something like <span class="Li">'$_[0]'</span> or
        <span class="Li">'$var'</span>.</p>
    <p class="Pp">The inline generator is expected to include code to implement
        both the current type and all its parents. Typically, the easiest way to
        do this is to write a subroutine something like this:</p>
    <p class="Pp"></p>
    <pre>  sub {
      my $self = shift;
      my $var  = shift;
      return $_[0]-&gt;parent-&gt;inline_check( $_[1] )
          . ' and more checking code goes here';
  }
    </pre>
    <p class="Pp">This parameter is mutually exclusive with
        <span class="Li">&quot;constraint&quot;</span>.</p>
    <p class="Pp">You can also pass this option with the key
        <span class="Li">&quot;inline&quot;</span> in the parameter list.</p>
  </li>
  <li>inline_environment =&gt; {}
    <p class="Pp">This should be a hash reference of variable names (with
        sigils) and values for that variable. The values should be
        <i>references</i> to the values of the variables.</p>
    <p class="Pp">This environment will be used when compiling the constraint as
        part of a subroutine. The named variables will be captured as closures
        in the generated subroutine, using Eval::Closure.</p>
    <p class="Pp">It should be very rare to need to set this in the constructor.
        It's more likely that a special type subclass would need to provide
        values that it generates internally.</p>
    <p class="Pp">If you do set this, you are responsible for generating
        variable names that won't clash with anything else in the inlined
      code.</p>
    <p class="Pp">This parameter defaults to an empty hash reference.</p>
  </li>
  <li>message_generator =&gt; sub { ... }
    <p class="Pp">A subroutine to generate an error message when the type check
        fails. The default message says something like &quot;Validation failed
        for type named Int declared in package Specio::Library::Builtins
        (.../Specio/blib/lib/Specio/Library/Builtins.pm) at line 147 in sub
        named (eval) with value 1.1&quot;.</p>
    <p class="Pp">You can override this to provide something more specific about
        the way the type failed.</p>
    <p class="Pp">The subroutine you provide will be called as a subroutine,
        <i>not as a method</i>, with two arguments. The first is the description
        of the type (the bit in the message above that starts with &quot;type
        named Int ...&quot; and ends with &quot;... in sub named (eval)&quot;.
        This description says what the thing is and where it was defined.</p>
    <p class="Pp">The second argument is the value that failed the type check,
        after any coercions that might have been applied.</p>
    <p class="Pp">You can also pass this option with the key
        <span class="Li">&quot;message&quot;</span> in the parameter list.</p>
  </li>
  <li>declared_at =&gt; <span class="Li">$declared_at</span>
    <p class="Pp">This parameter must be a Specio::DeclaredAt object.</p>
    <p class="Pp">This parameter is required.</p>
  </li>
</ul>
<p class="Pp">It is possible to create a type without a constraint of its
  own.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$type"><a class="permalink" href="#$type">$type-&gt;name</a></h2>
<p class="Pp">Returns the name of the type as it was passed the constructor.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$type~2"><a class="permalink" href="#$type~2">$type-&gt;parent</a></h2>
<p class="Pp">Returns the parent type passed to the constructor. If the type has
    no parent this returns <span class="Li">&quot;undef&quot;</span>.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$type~3"><a class="permalink" href="#$type~3">$type-&gt;is_anon</a></h2>
<p class="Pp">Returns false for named types, true otherwise.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$type~4"><a class="permalink" href="#$type~4">$type-&gt;is_a_type_of($other_type)</a></h2>
<p class="Pp">Given a type object, this returns true if the type this method is
    called on is a descendant of that type or is that type.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$type~5"><a class="permalink" href="#$type~5">$type-&gt;is_same_type_as($other_type)</a></h2>
<p class="Pp">Given a type object, this returns true if the type this method is
    called on is the same as that type.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$type~6"><a class="permalink" href="#$type~6">$type-&gt;coercions</a></h2>
<p class="Pp">Returns a list of Specio::Coercion objects which belong to this
    constraint.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$type~7"><a class="permalink" href="#$type~7">$type-&gt;coercion_from_type($name)</a></h2>
<p class="Pp">Given a type name, this method returns a Specio::Coercion object
    which coerces from that type, if such a coercion exists.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$type~8"><a class="permalink" href="#$type~8">$type-&gt;validate_or_die($value)</a></h2>
<p class="Pp">This method does nothing if the value is valid. If it is not, it
    throws a Specio::Exception.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$type~9"><a class="permalink" href="#$type~9">$type-&gt;value_is_valid($value)</a></h2>
<p class="Pp">Returns true or false depending on whether the
    <span class="Li">$value</span> passes the type constraint.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$type~10"><a class="permalink" href="#$type~10">$type-&gt;has_real_constraint</a></h2>
<p class="Pp">This returns true if the type was created with a
    <span class="Li">&quot;constraint&quot;</span> or
    <span class="Li">&quot;inline_generator&quot;</span> parameter. This is used
    internally to skip type checks for types that don't actually implement a
    constraint.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$type~11"><a class="permalink" href="#$type~11">$type-&gt;description</a></h2>
<p class="Pp">This returns a string describing the type. This includes the
    type's name and where it was declared, so you end up with something like
    <span class="Li">'type named Foo</span> <span class="Li">declared in package
    My::Lib (lib/My/Lib.pm) at line 42'</span>. If the type is anonymous the
    name will be &quot;anonymous type&quot;.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$type~12"><a class="permalink" href="#$type~12">$type-&gt;id</a></h2>
<p class="Pp">This is a unique id for the type as a string. This is useful if
    you need to make a hash key based on a type, for example. This should be
    treated as an essentially arbitrary and opaque string, and could change at
    any time in the future. If you want something human-readable, use the
    <span class="Li">&quot;$type-&gt;description&quot;</span> method.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$type~13"><a class="permalink" href="#$type~13">$type-&gt;add_coercion($coercion)</a></h2>
<p class="Pp">This adds a new Specio::Coercion to the type. If the type already
    has a coercion from the same type as the new coercion, it will throw an
    error.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$type~14"><a class="permalink" href="#$type~14">$type-&gt;has_coercion_from_type($other_type)</a></h2>
<p class="Pp">This method returns true if the type can coerce from the other
    type.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$type~15"><a class="permalink" href="#$type~15">$type-&gt;coerce_value($value)</a></h2>
<p class="Pp">This attempts to coerce a value into a new value that matches the
    type. It checks all of the type's coercions. If it finds one which has a
    &quot;from&quot; type that accepts the value, it runs the coercion and
    returns the new value.</p>
<p class="Pp">If it cannot find a matching coercion it returns the original
    value.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$type~16"><a class="permalink" href="#$type~16">$type-&gt;inline_coercion_and_check($var)</a></h2>
<p class="Pp">Given a variable name, this returns a string of code and an
    environment hash that implements all of the type's coercions as well as the
    type check itself.</p>
<p class="Pp">This will throw an exception unless both the type and all of its
    coercions are inlinable.</p>
<p class="Pp">The generated code will throw a Specio::Exception if the type
    constraint fails. If the constraint passes, then the generated code returns
    the (possibly coerced) value.</p>
<p class="Pp">The return value is a two-element list. The first element is the
    code. The second is a hash reference containing variables which need to be
    in scope for the code to work. This is intended to be passed to
    Eval::Closure's <span class="Li">&quot;eval_closure&quot;</span>
  subroutine.</p>
<p class="Pp">The returned code is a single <span class="Li">&quot;do {
    }&quot;</span> block without a terminating semicolon.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$type~17"><a class="permalink" href="#$type~17">$type-&gt;inline_assert($var)</a></h2>
<p class="Pp">Given a variable name, this generates code that implements the
    constraint and throws an exception if the variable does not pass the
    constraint.</p>
<p class="Pp">The return value is a two-element list. The first element is the
    code. The second is a hash reference containing variables which need to be
    in scope for the code to work. This is intended to be passed to
    Eval::Closure's <span class="Li">&quot;eval_closure&quot;</span>
  subroutine.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$type~18"><a class="permalink" href="#$type~18">$type-&gt;inline_check($var)</a></h2>
<p class="Pp">Given a variable name, this returns a string of code that
    implements the constraint. If the type is not inlinable, this method throws
    an error.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$type~19"><a class="permalink" href="#$type~19">$type-&gt;inline_coercion($var)</a></h2>
<p class="Pp">Given a variable name, this returns a string of code and an
    environment hash that implements all of the type's coercions. <i>It does not
    check that the</i> <i>resulting value is valid.</i></p>
<p class="Pp">This will throw an exception unless all of the type's coercions
    are inlinable.</p>
<p class="Pp">The return value is a two-element list. The first element is the
    code. The second is a hash reference containing variables which need to be
    in scope for the code to work. This is intended to be passed to
    Eval::Closure's <span class="Li">&quot;eval_closure&quot;</span>
  subroutine.</p>
<p class="Pp">The returned code is a single <span class="Li">&quot;do {
    }&quot;</span> block without a terminating semicolon.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$type~20"><a class="permalink" href="#$type~20">$type-&gt;<b>inline_environment()</b></a></h2>
<p class="Pp">This returns a hash defining the variables that need to be closed
    over when inlining the type. The keys are full variable names like
    <span class="Li">'$foo'</span> or <span class="Li">'@bar'</span>. The values
    are <i>references</i> to a variable of the matching type.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$type~21"><a class="permalink" href="#$type~21">$type-&gt;coercion_sub</a></h2>
<p class="Pp">This method returns a sub ref that takes a single argument and
    applied all relevant coercions to it. This sub ref will use Sub::Quote if
    all the type's coercions are inlinable.</p>
<p class="Pp">This method exists primarily for the benefit of Moo.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="OVERLOADING"><a class="permalink" href="#OVERLOADING">OVERLOADING</a></h1>
<p class="Pp">All constraints overloading subroutine de-referencing for the
    benefit of Moo. The returned subroutine uses Sub::Quote if the type
    constraint is inlinable.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="ROLES"><a class="permalink" href="#ROLES">ROLES</a></h1>
<p class="Pp">This role does the Specio::Constraint::Role::Interface and
    Specio::Role::Inlinable roles.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SUPPORT"><a class="permalink" href="#SUPPORT">SUPPORT</a></h1>
<p class="Pp">Bugs may be submitted at
    &lt;https://github.com/houseabsolute/Specio/issues&gt;.</p>
<p class="Pp">I am also usually active on IRC as 'autarch' on
    <span class="Li">&quot;irc://irc.perl.org&quot;</span>.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SOURCE"><a class="permalink" href="#SOURCE">SOURCE</a></h1>
<p class="Pp">The source code repository for Specio can be found at
    &lt;https://github.com/houseabsolute/Specio&gt;.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHOR"><a class="permalink" href="#AUTHOR">AUTHOR</a></h1>
<p class="Pp">Dave Rolsky &lt;autarch@urth.org&gt;</p>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT_AND_LICENSE"><a class="permalink" href="#COPYRIGHT_AND_LICENSE">COPYRIGHT
  AND LICENSE</a></h1>
<p class="Pp">This software is Copyright (c) 2012 - 2020 by Dave Rolsky.</p>
<p class="Pp">This is free software, licensed under:</p>
<p class="Pp"></p>
<pre>  The Artistic License 2.0 (GPL Compatible)
</pre>
<p class="Pp">The full text of the license can be found in the <i>LICENSE</i>
    file included with this distribution.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2020-03-14</td>
    <td class="foot-os"><a href="..">perl v5.34.0</a></td>
  </tr>
</table>
</body>
</html>
