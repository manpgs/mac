<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>Test2::Manual::Anatomy::Hubs(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Test2::Manual::Anatomy::Hubs(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">Test2::Manual::Anatomy::Hubs(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">Test2::Manual::Anatomy::Hubs - Internals documentation for the hub
    stack, and hubs.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">This document describes the hub stack, and the hubs it contains.
    It explains why we have a stack, and when to add/remove hubs from it.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="WHAT_IS_A_HUB?"><a class="permalink" href="#WHAT_IS_A_HUB?">WHAT
  IS A HUB?</a></h1>
<p class="Pp">Test2 is an event system, tools generate events, those events are
    then processed to modify the testing state (number of tests, number of
    failures, etc). The hub is responsible for receiving and processing events
    to record the change in state. All events should eventually reach a
    destination hub.</p>
<p class="Pp">The base hub is Test2::Hub. All hub classes should inherit from
    the base hub class. The base hub class provides several hooks that allow you
    to monitor or modify events. Hubs are also responsible for forwarding events
    to the output formatter.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="WHY_DO_WE_HAVE_A_HUB_STACK?"><a class="permalink" href="#WHY_DO_WE_HAVE_A_HUB_STACK?">WHY
  DO WE HAVE A HUB STACK?</a></h1>
<p class="Pp">There are cases where it makes sense to have more than one
  hub:</p>
<dl class="Bl-tag">
  <dt id="subtests"><a class="permalink" href="#subtests">subtests</a></dt>
  <dd>In Test2 subtests are implemented using the hub stack. When you start a
      subtest a new Test2::Hub::Subtest instance is created and pushed to the
      stack. Once this is done all calls to
      <span class="Li">&quot;Test2::API::context&quot;</span> will find the new
      hub and send all events to it. When the subtest tool is complete it will
      remove the new hub, and send a final subtest event to the parent hub.</dd>
  <dt id="testing"><a class="permalink" href="#testing">testing your test
    tools</a></dt>
  <dd><span class="Li">&quot;Test2::API::intercept()&quot;</span> is implemented
      using the hub stack. The
      <span class="Li">&quot;Test2::API::intercept()&quot;</span> function will
      add an Test2::Hub::Interceptor instance to the stack, any calls to
      <b>Test2::API::context()</b> will find the new hub, and send it all
      events. The intercept hub is special in that is has no connection to the
      parent hub, and usually does not have a formatter.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="WHEN_SHOULD_I_ADD_A_HUB_TO_THE_STACK?"><a class="permalink" href="#WHEN_SHOULD_I_ADD_A_HUB_TO_THE_STACK?">WHEN
  SHOULD I ADD A HUB TO THE STACK?</a></h1>
<p class="Pp">Any time you want to intercept or block events from effecting the
    test state. Adding a new hub is essentially a way to create a sandbox where
    you have absolute control over what events do. Adding a new hub insures that
    the main test state will not be effected.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="WHERE_IS_THE_STACK?"><a class="permalink" href="#WHERE_IS_THE_STACK?">WHERE
  IS THE STACK?</a></h1>
<p class="Pp">The stack is an instance of Test2::API::Stack. You can access the
    global hub stack using
    <span class="Li">&quot;Test2::API::test2_stack&quot;</span>.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="WHAT_ABOUT_THE_ROOT_HUB?"><a class="permalink" href="#WHAT_ABOUT_THE_ROOT_HUB?">WHAT
  ABOUT THE ROOT HUB?</a></h1>
<p class="Pp">The root hub is created automatically as needed. A call to
    <span class="Li">&quot;Test2::API::test2_stack-&gt;top()&quot;</span> will
    create the root hub if it does not already exist.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="HOW_DO_HUBS_HANDLE_IPC?"><a class="permalink" href="#HOW_DO_HUBS_HANDLE_IPC?">HOW
  DO HUBS HANDLE IPC?</a></h1>
<p class="Pp">If the IPC system (Test2::IPC) was not loaded, then IPC is not
    handled at all. Forking or creating new threads without the IPC system can
    cause unexpected problems.</p>
<p class="Pp">All hubs track the PID and Thread ID that was current when they
    were created. If an event is sent to a hub in a new process/thread the hub
    will detect this and try to forward the event along to the correct
    process/thread. This is accomplished using the IPC system.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp">Test2::Manual - Primary index of the manual.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SOURCE"><a class="permalink" href="#SOURCE">SOURCE</a></h1>
<p class="Pp">The source code repository for Test2-Manual can be found at
    <i>https://github.com/Test-More/Test2-Suite/</i>.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="MAINTAINERS"><a class="permalink" href="#MAINTAINERS">MAINTAINERS</a></h1>
<dl class="Bl-tag">
  <dt id="Chad"><a class="permalink" href="#Chad">Chad Granum
    &lt;exodist@cpan.org&gt;</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHORS"><a class="permalink" href="#AUTHORS">AUTHORS</a></h1>
<dl class="Bl-tag">
  <dt id="Chad~2"><a class="permalink" href="#Chad~2">Chad Granum
    &lt;exodist@cpan.org&gt;</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT"><a class="permalink" href="#COPYRIGHT">COPYRIGHT</a></h1>
<p class="Pp">Copyright 2018 Chad Granum &lt;exodist@cpan.org&gt;.</p>
<p class="Pp">This program is free software; you can redistribute it and/or
    modify it under the same terms as Perl itself.</p>
<p class="Pp">See <i>http://dev.perl.org/licenses/</i></p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2020-10-22</td>
    <td class="foot-os">perl v5.30.2</td>
  </tr>
</table>
</body>
</html>
