<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>Test2::Manual::Tooling::Testing(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Test2::Manual::Tooling::Testing(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">Test2::Manual::Tooling::Testing(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">Test2::Manual::Tooling::Testing - Tutorial on how to test your
    testing tools.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">Testing your test tools used to be a complex and difficult
    prospect. The old tools such as Test::Tester and Test::Builder::Tester were
    limited, and fragile. Test2 on the other hand was designed from the very
    start to be easily tested! This tutorial shows you how.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="THE_HOLY_GRAIL_OF_TESTING_YOUR_TOOLS"><a class="permalink" href="#THE_HOLY_GRAIL_OF_TESTING_YOUR_TOOLS">THE
  HOLY GRAIL OF TESTING YOUR TOOLS</a></h1>
<p class="Pp">The key to making Test2 easily testable (specially when compared
    to Test::Builder) is the <span class="Li">&quot;intercept&quot;</span>
    function.</p>
<p class="Pp"></p>
<pre>    use Test2::API qw/intercept/;
    my $events = intercept {
        ok(1, &quot;pass&quot;);
        ok(0, &quot;fail&quot;);
        diag(&quot;A diag&quot;);
    };
</pre>
<p class="Pp">The intercept function lets you use any test tools you want inside
    a codeblock. No events or contexts generated within the intercept codeblock
    will have any effect on the outside testing state. The
    <span class="Li">&quot;intercept&quot;</span> function completely isolates
    the tools called within.</p>
<p class="Pp"><b>Note:</b> Plugins and things that effect global API state may
    not be fully isolated. <span class="Li">&quot;intercept&quot;</span> is
    intended specifically for event isolation.</p>
<p class="Pp">The <span class="Li">&quot;intercept&quot;</span> function will
    return an arrayref containing all the events that were generated within the
    codeblock. You can now make any assertions you want about the events you
    expected your tools to generate.</p>
<p class="Pp"></p>
<pre>    [
        bless({...}, 'Test2::Event::Ok'),   # pass
        bless({...}, 'Test2::Event::Ok'),   # fail
        bless({...}, 'Test2::Event::Diag'), # Failure diagnostics (not always a second event)
        bless({...}, 'Test2::Event::Diag'), # custom 'A diag' message
    ]
</pre>
<p class="Pp">Most test tools eventually produce one or more events. To
    effectively verify the events you get from intercept you really should read
    up on how events work Test2::Manual::Anatomy::Event. Once you know about
    events you can move on to the next section which points you at some
  helpers.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="ADDITIONAL_HELPERS"><a class="permalink" href="#ADDITIONAL_HELPERS">ADDITIONAL
  HELPERS</a></h1>
<section class="Ss">
<h2 class="Ss" id="Test2::Tools::Tester"><a class="permalink" href="#Test2::Tools::Tester">Test2::Tools::Tester</a></h2>
<p class="Pp">This is the most recent set of tools to help you test your events.
    To really understand these you should familiarize yourself with
    Test2::Manual::Anatomy::Event. If you are going to be writing anything more
    than the most simple of tools you should know how events work.</p>
<p class="Pp">The Test2::Tools::Tester documentation is a good place for further
    reading.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Test2::Tools::HarnessTester"><a class="permalink" href="#Test2::Tools::HarnessTester">Test2::Tools::HarnessTester</a></h2>
<p class="Pp">The Test2::Tools::HarnessTester can export the
    <span class="Li">&quot;summarize_events()&quot;</span> tool. This tool lets
    you run your event arrayref through Test2::Harness so that you can get a
    pass/fail summary.</p>
<p class="Pp"></p>
<pre>    my $summary = summarize_events($events);
</pre>
<p class="Pp">The summary looks like this:</p>
<p class="Pp"></p>
<pre>    {
        plan       =&gt; $plan_facet,         # the plan event facet
        pass       =&gt; $bool,               # true if the events result in a pass
        fail       =&gt; $bool,               # true if the events result in a fail
        errors     =&gt; $error_count,        # Number of error facets seen
        failures   =&gt; $failure_count,      # Number of failing assertions seen
        assertions =&gt; $assertion_count,    # Total number of assertions seen
    }
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="Test2::Tools::Compare"><a class="permalink" href="#Test2::Tools::Compare">Test2::Tools::Compare</a></h2>
<p class="Pp"><b>DEPRECATED</b> These tools were written before the switch to
    faceted events. These will still work, but are no longer the recommended way
    to test your tools.</p>
<p class="Pp">The Test2::Tools::Compare library exports a handful of extras to
    help test events.</p>
<dl class="Bl-tag">
  <dt id="event"><a class="permalink" href="#event">event $TYPE =&gt;
    ...</a></dt>
  <dd>Use in an array check against <span class="Li">$events</span> to check for
      a specific type of event with the properties you specify.</dd>
  <dt id="fail_events"><a class="permalink" href="#fail_events">fail_events
    $TYPE =&gt; ...</a></dt>
  <dd>Use when you expect a failing assertion of <span class="Li">$TYPE</span>.
      This will automatically check that the next event following it is a
      diagnostics message with the default failure text.
    <p class="Pp"><b>Note:</b> This is outdated as a single event may now
        possess both the failing assertion AND the failing text, such events
        will fail this test.</p>
  </dd>
</dl>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp">Test2::Manual - Primary index of the manual.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SOURCE"><a class="permalink" href="#SOURCE">SOURCE</a></h1>
<p class="Pp">The source code repository for Test2-Manual can be found at
    <i>https://github.com/Test-More/Test2-Suite/</i>.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="MAINTAINERS"><a class="permalink" href="#MAINTAINERS">MAINTAINERS</a></h1>
<dl class="Bl-tag">
  <dt id="Chad"><a class="permalink" href="#Chad">Chad Granum
    &lt;exodist@cpan.org&gt;</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHORS"><a class="permalink" href="#AUTHORS">AUTHORS</a></h1>
<dl class="Bl-tag">
  <dt id="Chad~2"><a class="permalink" href="#Chad~2">Chad Granum
    &lt;exodist@cpan.org&gt;</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT"><a class="permalink" href="#COPYRIGHT">COPYRIGHT</a></h1>
<p class="Pp">Copyright 2018 Chad Granum &lt;exodist@cpan.org&gt;.</p>
<p class="Pp">This program is free software; you can redistribute it and/or
    modify it under the same terms as Perl itself.</p>
<p class="Pp">See <i>http://dev.perl.org/licenses/</i></p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2020-10-22</td>
    <td class="foot-os">perl v5.30.2</td>
  </tr>
</table>
</body>
</html>
