<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>
  <meta charset="utf-8"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>Test2::Manual::Tooling::TestBuilder(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Test2::Manual::Tooling::TestBuilder(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">Test2::Manual::Tooling::TestBuilder(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">Test2::Manual::Tooling::TestBuilder - This section maps
    Test::Builder methods to Test2 concepts.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">With Test::Builder tools were encouraged to use methods on the
    Test::Builder singleton object. Test2 has a different approach, every tool
    should get a new Test2::API::Context object, and call methods on that. This
    document maps several concepts from Test::Builder to Test2.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="CONTEXT"><a class="permalink" href="#CONTEXT">CONTEXT</a></h1>
<p class="Pp">First thing to do, stop using the Test::Builder singleton, in fact
    stop using or even loading Test::Builder. Instead of Test::Builder each tool
    you write should follow this template:</p>
<p class="Pp"></p>
<pre>
    use Test2::API qw/context/;

    sub my_tool {
        my $ctx  = context();

        ... do work ...

        $ctx-&gt;ok(1, &quot;a passing assertion&quot;);

        $ctx-&gt;release;

        return $whatever;
    }
</pre>
<p class="Pp">The original Test::Builder style was this:</p>
<p class="Pp"></p>
<pre>
    use Test::Builder;
    my $tb = Test::Builder-&gt;new; # gets the singleton

    sub my_tool {
        ... do work ...

        $tb-&gt;ok(1, &quot;a passing assertion&quot;);

        return $whatever;
    }
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="TEST_BUILDER_METHODS"><a class="permalink" href="#TEST_BUILDER_METHODS">TEST
  BUILDER METHODS</a></h1>
<dl class="Bl-tag">
  <dt>$tb-&gt;BAIL_OUT($reason)</dt>
  <dd>The context object has a 'bail' method:
    <p class="Pp"></p>
    <pre>
    $ctx-&gt;bail($reason)
    </pre>
  </dd>
  <dt>$tb-&gt;diag($string)</dt>
  <dd></dd>
  <dt>$tb-&gt;note($string)</dt>
  <dd>The context object has diag and note methods:
    <p class="Pp"></p>
    <pre>
    $ctx-&gt;diag($string);
    $ctx-&gt;note($string);
    </pre>
  </dd>
  <dt>$tb-&gt;done_testing</dt>
  <dd>The context object has a done_testing method:
    <p class="Pp"></p>
    <pre>
    $ctx-&gt;done_testing;
    </pre>
    <p class="Pp">Unlike the Test::Builder version, no arguments are
      allowed.</p>
  </dd>
  <dt>$tb-&gt;like</dt>
  <dd></dd>
  <dt>$tb-&gt;unlike</dt>
  <dd>These are not part of context, instead look at Test2::Compare and
      Test2::Tools::Compare.</dd>
  <dt>$tb-&gt;ok($bool, $name)</dt>
  <dd>
    <pre>
    # Preferred
    $ctx-&gt;pass($name);
    $ctx-&gt;fail($name, @diag);

    # Discouraged, but supported:
    $ctx-&gt;ok($bool, $name, \@failure_diags)
    </pre>
  </dd>
  <dt>$tb-&gt;subtest</dt>
  <dd>use the <span class="Li">&quot;Test2::API::run_subtest()&quot;</span>
      function instead. See Test2::API for documentation.</dd>
  <dt>$tb-&gt;todo_start</dt>
  <dd></dd>
  <dt>$tb-&gt;todo_end</dt>
  <dd>See Test2::Tools::Todo instead.</dd>
  <dt>$tb-&gt;output, $tb-&gt;failure_output, and $tb-&gt;todo_output</dt>
  <dd>These are handled via formatters now. See Test2::Formatter and
      Test2::Formatter::TAP.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="LEVEL"><a class="permalink" href="#LEVEL">LEVEL</a></h1>
<p class="Pp">Test::Builder had the
    <span class="Li">$Test::Builder::Level</span> variable that you could modify
    in order to set the stack depth. This was useful if you needed to nest tools
    and wanted to make sure your file and line number were correct. It was also
    frustrating and prone to errors. Some people never even discovered the level
    variable and always had incorrect line numbers when their tools would
  fail.</p>
<p class="Pp">Test2 uses the context system, which solves the problem a better
    way. The top-most tool get a context, and holds on to it until it is done.
    Any tool nested under the first will find and use the original context
    instead of generating a new one. This means the level problem is solved for
    free, no variables to mess with.</p>
<p class="Pp">Test2 is also smart enough to honor c&lt;$Test::Builder::Level&gt;
    if it is set.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="TODO"><a class="permalink" href="#TODO">TODO</a></h1>
<p class="Pp">Test::Builder used the <span class="Li">$TODO</span> package
    variable to set the TODO state. This was confusing, and easy to get wrong.
    See Test2::Tools::Todo for the modern way to accomplish a TODO state.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp">Test2::Manual - Primary index of the manual.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SOURCE"><a class="permalink" href="#SOURCE">SOURCE</a></h1>
<p class="Pp">The source code repository for Test2-Manual can be found at
    <i>https://github.com/Test-More/Test2-Suite/</i>.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="MAINTAINERS"><a class="permalink" href="#MAINTAINERS">MAINTAINERS</a></h1>
<dl class="Bl-tag">
  <dt id="Chad"><a class="permalink" href="#Chad">Chad Granum
    &lt;exodist@cpan.org&gt;</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHORS"><a class="permalink" href="#AUTHORS">AUTHORS</a></h1>
<dl class="Bl-tag">
  <dt id="Chad~2"><a class="permalink" href="#Chad~2">Chad Granum
    &lt;exodist@cpan.org&gt;</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT"><a class="permalink" href="#COPYRIGHT">COPYRIGHT</a></h1>
<p class="Pp">Copyright 2018 Chad Granum &lt;exodist@cpan.org&gt;.</p>
<p class="Pp">This program is free software; you can redistribute it and/or
    modify it under the same terms as Perl itself.</p>
<p class="Pp">See <i>http://dev.perl.org/licenses/</i></p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2020-10-22</td>
    <td class="foot-os">perl v5.30.2</td>
  </tr>
</table>
</body>
</html>
