<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>
  <meta charset="utf-8"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>Apache::TestRunPHP(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Apache::TestRunPHP(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">Apache::TestRunPHP(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">Apache::TestRunPHP - configure and run a PHP-based test suite</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<pre>
  use Apache::TestRunPHP;
  Apache::TestRunPHP-&gt;new-&gt;run(@ARGV);
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">The <span class="Li">&quot;Apache::TestRunPHP&quot;</span> package
    controls the configuration and running of the test suite for PHP-based
    tests. It's a subclass of
    <span class="Li">&quot;Apache::TestRun&quot;</span> and similar in function
    to <span class="Li">&quot;Apache::TestRunPerl&quot;</span>.</p>
<p class="Pp">Refer to the <span class="Li">&quot;Apache::TestRun&quot;</span>
    manpage for information on the available API.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="EXAMPLE"><a class="permalink" href="#EXAMPLE">EXAMPLE</a></h1>
<p class="Pp"><span class="Li">&quot;TestRunPHP&quot;</span> works almost
    identially to <span class="Li">&quot;TestRunPerl&quot;</span>, but in case
    you are new to <span class="Li">&quot;Apache-Test&quot;</span> here is a
    quick getting started guide. be sure to see the links at the end of this
    document for places to find additional details.</p>
<p class="Pp">because <span class="Li">&quot;Apache-Test&quot;</span> is a
    Perl-based testing framework we start from a
    <span class="Li">&quot;Makefile.PL&quot;</span>, which should have the
    following lines (in addition to the standard
    <span class="Li">&quot;Makefile.PL&quot;</span> parts):</p>
<p class="Pp"></p>
<pre>
  use Apache::TestMM qw(test clean);
  use Apache::TestRunPHP ();

  Apache::TestMM::filter_args();

  Apache::TestRunPHP-&gt;generate_script();
</pre>
<p class="Pp"><span class="Li">&quot;generate_script()&quot;</span> will create
    a script named <span class="Li">&quot;t/TEST&quot;</span>, the gateway to
    the Perl testing harness and what is invoked when you call
    <span class="Li">&quot;make test&quot;</span>.
    <span class="Li">&quot;filter_args()&quot;</span> accepts some
    <span class="Li">&quot;Apache::Test&quot;</span>-specific arguments and
    passes them along. for example, to point to a specific
    <span class="Li">&quot;httpd&quot;</span> installation you would invoke
    <span class="Li">&quot;Makefile.PL&quot;</span> as follows</p>
<p class="Pp"></p>
<pre>
  $ perl Makefile.PL -httpd /my/local/apache/bin/httpd
</pre>
<p class="Pp">and <span class="Li">&quot;/my/local/apache/bin/httpd&quot;</span>
    will be propagated throughout the rest of the process. note that PHP needs
    to be active within Apache prior to configuring the test framework as shown
    above, either by virtue of PHP being compiled into the
    <span class="Li">&quot;httpd&quot;</span> binary statically or through an
    active <span class="Li">&quot;LoadModule&quot;</span> statement within the
    configuration located in
    <span class="Li">&quot;/my/local/apache/conf/httpd.conf&quot;</span>. Other
    required modules are the (very common) mod_alias and mod_env.</p>
<p class="Pp">now, like with <span class="Li">&quot;Apache::TestRun&quot;</span>
    and <span class="Li">&quot;Apache::TestRunPerl&quot;</span>, you can place
    client-side Perl test scripts under <span class="Li">&quot;t/&quot;</span>,
    such as <span class="Li">&quot;t/01basic.t&quot;</span>, and
    <span class="Li">&quot;Apache-Test&quot;</span> will run these scripts when
    you call <span class="Li">&quot;make test&quot;</span>. however, what makes
    <span class="Li">&quot;Apache::TestRunPHP&quot;</span> unique is some added
    magic specifically tailored to a PHP environment. here are the
  mechanics.</p>
<p class="Pp"><span class="Li">&quot;Apache::TestRunPHP&quot;</span> will look
    for PHP test scripts in that match the following pattern</p>
<p class="Pp"></p>
<pre>
  t/response/TestFoo/bar.php
</pre>
<p class="Pp">where <span class="Li">&quot;Foo&quot;</span> and
    <span class="Li">&quot;bar&quot;</span> can be anything you like, and
    <span class="Li">&quot;t/response/Test*&quot;</span> is case sensitive. when
    this format is adhered to,
    <span class="Li">&quot;Apache::TestRunPHP&quot;</span> will create an
    associated Perl test script called
    <span class="Li">&quot;t/foo/bar.t&quot;</span>, which will be executed when
    you call <span class="Li">&quot;make test&quot;</span>. all
    <span class="Li">&quot;bar.t&quot;</span> does is issue a simple GET to
    <span class="Li">&quot;bar.php&quot;</span>, leaving the actual testing to
    <span class="Li">&quot;bar.php&quot;</span>. in essence, you can forget that
    <span class="Li">&quot;bar.t&quot;</span> even exists.</p>
<p class="Pp">what does <span class="Li">&quot;bar.php&quot;</span> look like?
    here is an example:</p>
<p class="Pp"></p>
<pre>
  &lt;?php
    print &quot;1..1\n&quot;;
    print &quot;ok 1\n&quot;
  ?&gt;
</pre>
<p class="Pp">if it looks odd, that's ok because it is. I could explain to you
    exactly what this means, but it isn't important to understand the gory
    details. instead, it is sufficient to understand that when
    <span class="Li">&quot;Apache::Test&quot;</span> calls
    <span class="Li">&quot;bar.php&quot;</span> it feeds the results directly to
    <span class="Li">&quot;Test::Harness&quot;</span>, a module that comes with
    every Perl installation, and
    <span class="Li">&quot;Test::Harness&quot;</span> expects what it receives
    to be formated in a very specific way. by itself, all of this is pretty
    useless, so <span class="Li">&quot;Apache::Test&quot;</span> provides PHP
    testers with something much better. here is a much better example:</p>
<p class="Pp"></p>
<pre>
  &lt;?php
    # import the Test::More emulation layer
    # see
    #   http://search.cpan.org/dist/Test-Simple/lib/Test/More.pm
    # for Perl's documentation - these functions should behave
    # in the same way
    require 'test-more.php';

    # plan() the number of tests
    plan(6);

    # call ok() for each test you plan
    ok ('foo' == 'foo', 'foo is equal to foo');
    ok ('foo' != 'foo', 'foo is not equal to foo');

    # ok() can be other things as well
    is ('bar', 'bar', 'bar is bar');
    is ('baz', 'bar', 'baz is baz');
    isnt ('bar', 'beer', 'bar is not beer');
    like ('bar', '/ar$/', 'bar matches ar$');

    diag(&quot;printing some debugging information&quot;);

    # whoops! one too many tests.  I wonder what will happen...
    is ('biff', 'biff', 'baz is a baz');
  ?&gt;
</pre>
<p class="Pp">the include library
    <span class="Li">&quot;test-more.php&quot;</span> is automatically generated
    by <span class="Li">&quot;Apache::TestConfigPHP&quot;</span> and
    configurations tweaked in such a a way that your PHP scripts can find it
    without issue. the functions provided by
    <span class="Li">&quot;test-more.php&quot;</span> are equivalent in name and
    function to those in <span class="Li">&quot;Test::More&quot;</span>, a
    standard Perl testing library, so you can see that manpage for details on
    the syntax and functionality of each.</p>
<p class="Pp">at this point, we have enough in place to run some tests from
    PHP-land - a <span class="Li">&quot;Makefile.PL&quot;</span> to configure
    Apache for us, and a PHP script in
    <span class="Li">&quot;t/response/TestFoo/bar.php&quot;</span> to send some
    results out to the testing engine. issuing <span class="Li">&quot;make
    test&quot;</span> would start Apache, issue the request to
    <span class="Li">&quot;bar.php&quot;</span>, generate a report, and shut
    down Apache. the report would look like something like this after running
    the tests in verbose mode (eg <span class="Li">&quot;make test
    TEST_VERBOSE=1&quot;</span>):</p>
<p class="Pp"></p>
<pre>
  t/php/bar....1..6
  ok 1 - foo is equal to foo
  not ok 2 - foo is not equal to foo
  #     Failed test (/src/devel/perl-php-test/t/response/TestFoo/bar.php at line 13)
  ok 3 - bar is bar
  not ok 4 - baz is baz
  #     Failed test (/src/devel/perl-php-test/t/response/TestFoo/bar.php at line 17)
  #           got: 'baz'
  #      expected: 'bar'
  ok 5 - bar is not beer
  ok 6 - bar matches ar$
  # printing some debugging information
  ok 7 - baz is a baz
  FAILED tests 2, 4, 7
          Failed 3/6 tests, 50.00% okay
  Failed Test Stat Wstat Total Fail  Failed  List of Failed
  -------------------------------------------------------------------------------
  t/php/bar.t                6    3  50.00%  2 4 7
  Failed 1/1 test scripts, 0.00% okay. 1/6 subtests failed, 83.33% okay.
</pre>
<p class="Pp">note that the actual test file that was run was
    <span class="Li">&quot;t/php/bar.t&quot;</span>. this file is autogenerated
    based on the <span class="Li">&quot;t/response/TestFoo/bar.php&quot;</span>
    pattern of your PHP script. <span class="Li">&quot;t/php/bar.t&quot;</span>
    happens to be written in Perl, but you really don't need to worry about it
    too much.</p>
<p class="Pp">as an interesting aside, if you are using perl-5.8.3 or later you
    can actually create your own <span class="Li">&quot;t/foo.php&quot;</span>
    client-side scripts and they will be run via php (using our
    <span class="Li">&quot;php.ini&quot;</span>). but more on that later...</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp">the best source of information about using Apache-Test with PHP
    (at this time) is probably the talk given at ApacheCon 2004
    (&lt;http://xrl.us/phpperl&gt;), as well as the code from the talk
    (&lt;http://xrl.us/phpperlcode&gt;). there is also the online tutorial
    &lt;http://perl.apache.org/docs/general/testing/testing.html&gt; which has
    all of the mod_perl-specific syntax and features have been ported to PHP
    with this class.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHOR"><a class="permalink" href="#AUTHOR">AUTHOR</a></h1>
<p class="Pp"><span class="Li">&quot;Apache-Test&quot;</span> is a community
    effort, maintained by a group of dedicated volunteers.</p>
<p class="Pp">Questions can be asked at the test-dev &lt;at&gt; httpd.apache.org
    list For more information see: http://httpd.apache.org/test/.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2015-06-18</td>
    <td class="foot-os">perl v5.30.2</td>
  </tr>
</table>
</body>
</html>
