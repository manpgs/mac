<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>DBD::SQLite(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">DBD::SQLite(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">DBD::SQLite(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">DBD::SQLite - Self-contained RDBMS in a DBI Driver</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<pre>  use DBI;
  my $dbh = DBI-&gt;connect(&quot;dbi:SQLite:dbname=$dbfile&quot;,&quot;&quot;,&quot;&quot;);
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">SQLite is a public domain file-based relational database engine
    that you can find at &lt;https://www.sqlite.org/&gt;.</p>
<p class="Pp"><b>DBD::SQLite</b> is a Perl DBI driver for SQLite, that includes
    the entire thing in the distribution. So in order to get a fast transaction
    capable RDBMS working for your perl project you simply have to install this
    module, and <b>nothing</b> else.</p>
<p class="Pp">SQLite supports the following features:</p>
<dl class="Bl-tag">
  <dt id="Implements"><a class="permalink" href="#Implements">Implements a large
    subset of SQL92</a></dt>
  <dd>See &lt;https://www.sqlite.org/lang.html&gt; for details.</dd>
  <dt id="A"><a class="permalink" href="#A">A complete DB in a single disk
    file</a></dt>
  <dd>Everything for your database is stored in a single disk file, making it
      easier to move things around than with DBD::CSV.</dd>
  <dt id="Atomic"><a class="permalink" href="#Atomic">Atomic commit and
    rollback</a></dt>
  <dd>Yes, <b>DBD::SQLite</b> is small and light, but it supports full
      transactions!</dd>
  <dt id="Extensible"><a class="permalink" href="#Extensible">Extensible</a></dt>
  <dd>User-defined aggregate or regular functions can be registered with the SQL
      parser.</dd>
</dl>
<p class="Pp">There's lots more to it, so please refer to the docs on the SQLite
    web page, listed above, for SQL details. Also refer to DBI for details on
    how to use DBI itself. The API works like every DBI module does. However,
    currently many statement attributes are not implemented or are limited by
    the typeless nature of the SQLite database.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SQLITE_VERSION"><a class="permalink" href="#SQLITE_VERSION">SQLITE
  VERSION</a></h1>
<p class="Pp">DBD::SQLite is usually compiled with a bundled SQLite library
    (SQLite version 3.29.0 as of this release) for consistency. However, a
    different version of SQLite may sometimes be used for some reasons like
    security, or some new experimental features.</p>
<p class="Pp">You can look at
    <span class="Li">$DBD::SQLite::sqlite_version</span>
    (<span class="Li">&quot;3.x.y&quot;</span> format) or
    <span class="Li">$DBD::SQLite::sqlite_version_number</span>
    (<span class="Li">&quot;3xxxyyy&quot;</span> format) to find which version
    of SQLite is actually used. You can also check
    <span class="Li">&quot;DBD::SQLite::Constants::SQLITE_VERSION_NUMBER()&quot;</span>.</p>
<p class="Pp">You can also find how the library is compiled by calling
    <span class="Li">&quot;DBD::SQLite::compile_options()&quot;</span> (see
    below).</p>
</section>
<section class="Sh">
<h1 class="Sh" id="NOTABLE_DIFFERENCES_FROM_OTHER_DRIVERS"><a class="permalink" href="#NOTABLE_DIFFERENCES_FROM_OTHER_DRIVERS">NOTABLE
  DIFFERENCES FROM OTHER DRIVERS</a></h1>
<section class="Ss">
<h2 class="Ss" id="Database_Name_Is_A_File_Name"><a class="permalink" href="#Database_Name_Is_A_File_Name">Database
  Name Is A File Name</a></h2>
<p class="Pp">SQLite creates a file per a database. You should pass the
    <span class="Li">&quot;path&quot;</span> of the database file (with or
    without a parent directory) in the DBI connection string (as a database
    <span class="Li">&quot;name&quot;</span>):</p>
<p class="Pp"></p>
<pre>  my $dbh = DBI-&gt;connect(&quot;dbi:SQLite:dbname=$dbfile&quot;,&quot;&quot;,&quot;&quot;);
</pre>
<p class="Pp">The file is opened in read/write mode, and will be created if it
    does not exist yet.</p>
<p class="Pp">Although the database is stored in a single file, the directory
    containing the database file must be writable by SQLite because the library
    will create several temporary files there.</p>
<p class="Pp">If the filename <span class="Li">$dbfile</span> is
    &quot;:memory:&quot;, then a private, temporary in-memory database is
    created for the connection. This in-memory database will vanish when the
    database connection is closed. It is handy for your library tests.</p>
<p class="Pp">Note that future versions of SQLite might make use of additional
    special filenames that begin with the &quot;:&quot; character. It is
    recommended that when a database filename actually does begin with a
    &quot;:&quot; character you should prefix the filename with a pathname such
    as &quot;./&quot; to avoid ambiguity.</p>
<p class="Pp">If the filename <span class="Li">$dbfile</span> is an empty
    string, then a private, temporary on-disk database will be created. This
    private database will be automatically deleted as soon as the database
    connection is closed.</p>
<p class="Pp">As of 1.41_01, you can pass URI filename (see
    &lt;https://www.sqlite.org/uri.html&gt;) as well for finer control:</p>
<p class="Pp"></p>
<pre>  my $dbh = DBI-&gt;connect(&quot;dbi:SQLite:uri=file:$path_to_dbfile?mode=rwc&quot;);
</pre>
<p class="Pp">Note that this is not for remote SQLite database connection. You
    can only connect to a local database.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Read-Only_Database"><a class="permalink" href="#Read-Only_Database">Read-Only
  Database</a></h2>
<p class="Pp">You can set sqlite_open_flags (only) when you connect to a
    database:</p>
<p class="Pp"></p>
<pre>  use DBD::SQLite::Constants qw/:file_open/;
  my $dbh = DBI-&gt;connect(&quot;dbi:SQLite:$dbfile&quot;, undef, undef, {
    sqlite_open_flags =&gt; SQLITE_OPEN_READONLY,
  });
</pre>
<p class="Pp">See &lt;https://www.sqlite.org/c3ref/open.html&gt; for
  details.</p>
<p class="Pp">As of 1.49_05, you can also make a database read-only by setting
    <span class="Li">&quot;ReadOnly&quot;</span> attribute to true (only) when
    you connect to a database. Actually you can set it after you connect, but in
    that case, it can't make the database read-only, and you'll see a warning
    (which you can hide by turning <span class="Li">&quot;PrintWarn&quot;</span>
    off).</p>
</section>
<section class="Ss">
<h2 class="Ss" id="DBD::SQLite_And_File::Temp"><a class="permalink" href="#DBD::SQLite_And_File::Temp">DBD::SQLite
  And File::Temp</a></h2>
<p class="Pp">When you use File::Temp to create a temporary file/directory for
    SQLite databases, you need to remember:</p>
<dl class="Bl-tag">
  <dt id="tempfile"><a class="permalink" href="#tempfile">tempfile may be locked
    exclusively</a></dt>
  <dd>You may want to use <span class="Li">&quot;tempfile()&quot;</span> to
      create a temporary database filename for DBD::SQLite, but as noted in
      File::Temp's POD, this file may have an exclusive lock under some
      operating systems (notably Mac OSX), and result in a &quot;database is
      locked&quot; error. To avoid this, set EXLOCK option to false when you
      call <b>tempfile()</b>.
    <p class="Pp"></p>
    <pre>  ($fh, $filename) = tempfile($template, EXLOCK =&gt; 0);
    </pre>
  </dd>
  <dt id="CLEANUP"><a class="permalink" href="#CLEANUP">CLEANUP may not work
    unless a database is disconnected</a></dt>
  <dd>When you set CLEANUP option to true when you create a temporary directory
      with <span class="Li">&quot;tempdir()&quot;</span> or
      <span class="Li">&quot;newdir()&quot;</span>, you may have to disconnect
      databases explicitly before the temporary directory is gone (notably under
      MS Windows).</dd>
</dl>
<p class="Pp">(The above is quoted from the pod of File::Temp.)</p>
<p class="Pp">If you don't need to keep or share a temporary database, use
    &quot;:memory:&quot; database instead. It's much handier and cleaner for
    ordinary testing.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="DBD::SQLite_and_"><a class="permalink" href="#DBD::SQLite_and_">DBD::SQLite
  and <b>fork()</b></a></h2>
<p class="Pp">Follow the advice in the SQLite FAQ
    (&lt;https://sqlite.org/faq.html&gt;).</p>
<p class="Pp"></p>
<div class="Bd-indent">Under Unix, you should not carry an open SQLite database
  across a <b>fork()</b> system call into the child process. Problems will
  result if you do.</div>
<p class="Pp">You shouldn't (re)use a database handle you created (probably to
    set up a database schema etc) before you <b>fork()</b>. Otherwise, you might
    see a database corruption in the worst case.</p>
<p class="Pp">If you need to <b>fork()</b>, (re)open a database after you
    <b>fork()</b>. You might also want to tweak
    <span class="Li">&quot;sqlite_busy_timeout&quot;</span> and
    <span class="Li">&quot;sqlite_use_immediate_transaction&quot;</span> (see
    below), depending on your needs.</p>
<p class="Pp">If you need a higher level of concurrency than SQLite supports,
    consider using other client/server database engines.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Accessing_A_Database_With_Other_Tools"><a class="permalink" href="#Accessing_A_Database_With_Other_Tools">Accessing
  A Database With Other Tools</a></h2>
<p class="Pp">To access the database from the command line, try using
    <span class="Li">&quot;dbish&quot;</span> which comes with the DBI::Shell
    module. Just type:</p>
<p class="Pp"></p>
<pre>  dbish dbi:SQLite:foo.db
</pre>
<p class="Pp">On the command line to access the file <i>foo.db</i>.</p>
<p class="Pp">Alternatively you can install SQLite from the link above without
    conflicting with <b>DBD::SQLite</b> and use the supplied
    <span class="Li">&quot;sqlite3&quot;</span> command line tool.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Blobs"><a class="permalink" href="#Blobs">Blobs</a></h2>
<p class="Pp">As of version 1.11, blobs should &quot;just work&quot; in SQLite
    as text columns. However this will cause the data to be treated as a string,
    so SQL statements such as length(x) will return the length of the column as
    a NUL terminated string, rather than the size of the blob in bytes. In order
    to store natively as a BLOB use the following code:</p>
<p class="Pp"></p>
<pre>  use DBI qw(:sql_types);
  my $dbh = DBI-&gt;connect(&quot;dbi:SQLite:dbfile&quot;,&quot;&quot;,&quot;&quot;);
  
  my $blob = `cat foo.jpg`;
  my $sth = $dbh-&gt;prepare(&quot;INSERT INTO mytable VALUES (1, ?)&quot;);
  $sth-&gt;bind_param(1, $blob, SQL_BLOB);
  $sth-&gt;execute();
</pre>
<p class="Pp">And then retrieval just works:</p>
<p class="Pp"></p>
<pre>  $sth = $dbh-&gt;prepare(&quot;SELECT * FROM mytable WHERE id = 1&quot;);
  $sth-&gt;execute();
  my $row = $sth-&gt;fetch;
  my $blobo = $row-&gt;[1];
  
  # now $blobo == $blob
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="Functions_And_Bind_Parameters"><a class="permalink" href="#Functions_And_Bind_Parameters">Functions
  And Bind Parameters</a></h2>
<p class="Pp">As of this writing, a SQL that compares a return value of a
    function with a numeric bind value like this doesn't work as you might
    expect.</p>
<p class="Pp"></p>
<pre>  my $sth = $dbh-&gt;prepare(q{
    SELECT bar FROM foo GROUP BY bar HAVING count(*) &gt; ?;
  });
  $sth-&gt;execute(5);
</pre>
<p class="Pp">This is because DBD::SQLite assumes that all the bind values are
    text (and should be quoted) by default. Thus the above statement becomes
    like this while executing:</p>
<p class="Pp"></p>
<pre>  SELECT bar FROM foo GROUP BY bar HAVING count(*) &gt; &quot;5&quot;;
</pre>
<p class="Pp">There are four workarounds for this.</p>
<dl class="Bl-tag">
  <dt id="Use"><a class="permalink" href="#Use">Use <b>bind_param()</b>
    explicitly</a></dt>
  <dd>As shown above in the <span class="Li">&quot;BLOB&quot;</span> section,
      you can always use <span class="Li">&quot;bind_param()&quot;</span> to
      tell the type of a bind value.
    <p class="Pp"></p>
    <pre>  use DBI qw(:sql_types);  # Don't forget this
  
  my $sth = $dbh-&gt;prepare(q{
    SELECT bar FROM foo GROUP BY bar HAVING count(*) &gt; ?;
  });
  $sth-&gt;bind_param(1, 5, SQL_INTEGER);
  $sth-&gt;execute();
    </pre>
  </dd>
  <dt id="Add"><a class="permalink" href="#Add">Add zero to make it a
    number</a></dt>
  <dd>This is somewhat weird, but works anyway.
    <p class="Pp"></p>
    <pre>  my $sth = $dbh-&gt;prepare(q{
    SELECT bar FROM foo GROUP BY bar HAVING count(*) &gt; (? + 0);
  });
  $sth-&gt;execute(5);
    </pre>
  </dd>
  <dt id="Use~2"><a class="permalink" href="#Use~2">Use SQL <b>cast()</b>
    function</a></dt>
  <dd>This is more explicit way to do the above.
    <p class="Pp"></p>
    <pre>  my $sth = $dbh-&gt;prepare(q{
    SELECT bar FROM foo GROUP BY bar HAVING count(*) &gt; cast(? as integer);
  });
  $sth-&gt;execute(5);
    </pre>
  </dd>
  <dt id="Set"><a class="permalink" href="#Set">Set
    &quot;sqlite_see_if_its_a_number&quot; database handle attribute</a></dt>
  <dd>As of version 1.32_02, you can use
      <span class="Li">&quot;sqlite_see_if_its_a_number&quot;</span> to let
      DBD::SQLite to see if the bind values are numbers or not.
    <p class="Pp"></p>
    <pre>  $dbh-&gt;{sqlite_see_if_its_a_number} = 1;
  my $sth = $dbh-&gt;prepare(q{
    SELECT bar FROM foo GROUP BY bar HAVING count(*) &gt; ?;
  });
  $sth-&gt;execute(5);
    </pre>
    <p class="Pp">You can set it to true when you connect to a database.</p>
    <p class="Pp"></p>
    <pre>  my $dbh = DBI-&gt;connect('dbi:SQLite:foo', undef, undef, {
    AutoCommit =&gt; 1,
    RaiseError =&gt; 1,
    sqlite_see_if_its_a_number =&gt; 1,
  });
    </pre>
    <p class="Pp">This is the most straightforward solution, but as noted above,
        existing data in your databases created by DBD::SQLite have not always
        been stored as numbers, so this *might* cause other obscure problems.
        Use this sparingly when you handle existing databases. If you handle
        databases created by other tools like native
        <span class="Li">&quot;sqlite3&quot;</span> command line tool, this
        attribute would help you.</p>
    <p class="Pp">As of 1.41_04,
        <span class="Li">&quot;sqlite_see_if_its_a_number&quot;</span> works
        only for bind values with no explicit type.</p>
    <p class="Pp"></p>
    <pre>  my $dbh = DBI-&gt;connect('dbi:SQLite:foo', undef, undef, {
    AutoCommit =&gt; 1,
    RaiseError =&gt; 1,
    sqlite_see_if_its_a_number =&gt; 1,
  });
  my $sth = $dbh-&gt;prepare('INSERT INTO foo VALUES(?)');
  # '1.230' will be inserted as a text, instead of 1.23 as a number,
  # even though sqlite_see_if_its_a_number is set.
  $sth-&gt;bind_param(1, '1.230', SQL_VARCHAR);
  $sth-&gt;execute;
    </pre>
  </dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="Placeholders"><a class="permalink" href="#Placeholders">Placeholders</a></h2>
<p class="Pp">SQLite supports several placeholder expressions, including
    <span class="Li">&quot;?&quot;</span> and
    <span class="Li">&quot;:AAAA&quot;</span>. Consult the DBI and SQLite
    documentation for details.</p>
<p class="Pp">&lt;https://www.sqlite.org/lang_expr.html#varparam&gt;</p>
<p class="Pp">Note that a question mark actually means a next unused (numbered)
    placeholder. You're advised not to use it with other (numbered or named)
    placeholders to avoid confusion.</p>
<p class="Pp"></p>
<pre>  my $sth = $dbh-&gt;prepare(
    'update TABLE set a=?1 where b=?2 and a IS NOT ?1'
  );
  $sth-&gt;execute(1, 2);
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="Pragma"><a class="permalink" href="#Pragma">Pragma</a></h2>
<p class="Pp">SQLite has a set of &quot;Pragma&quot;s to modify its operation or
    to query for its internal data. These are specific to SQLite and are not
    likely to work with other DBD libraries, but you may find some of these are
    quite useful, including:</p>
<dl class="Bl-tag">
  <dt id="journal_mode"><a class="permalink" href="#journal_mode">journal_mode</a></dt>
  <dd>You can use this pragma to change the journal mode for SQLite databases,
      maybe for better performance, or for compatibility.
    <p class="Pp">Its default mode is
        <span class="Li">&quot;DELETE&quot;</span>, which means SQLite uses a
        rollback journal to implement transactions, and the journal is deleted
        at the conclusion of each transaction. If you use
        <span class="Li">&quot;TRUNCATE&quot;</span> instead of
        <span class="Li">&quot;DELETE&quot;</span>, the journal will be
        truncated, which is usually much faster.</p>
    <p class="Pp">A <span class="Li">&quot;WAL&quot;</span> (write-ahead log)
        mode is introduced as of SQLite 3.7.0. This mode is persistent, and it
        stays in effect even after closing and reopening the database. In other
        words, once the <span class="Li">&quot;WAL&quot;</span> mode is set in
        an application or in a test script, the database becomes inaccessible by
        older clients. This tends to be an issue when you use a system
        <span class="Li">&quot;sqlite3&quot;</span> executable under a
        conservative operating system.</p>
    <p class="Pp">To fix this, You need to issue <span class="Li">&quot;PRAGMA
        journal_mode = DELETE&quot;</span> (or
        <span class="Li">&quot;TRUNCATE&quot;</span>) beforehand, or install a
        newer version of <span class="Li">&quot;sqlite3&quot;</span>.</p>
  </dd>
  <dt id="legacy_file_format"><a class="permalink" href="#legacy_file_format">legacy_file_format</a></dt>
  <dd>If you happen to need to create a SQLite database that will also be
      accessed by a very old SQLite client (prior to 3.3.0 released in Jan.
      2006), you need to set this pragma to ON before you create a
    database.</dd>
  <dt id="reverse_unordered_selects"><a class="permalink" href="#reverse_unordered_selects">reverse_unordered_selects</a></dt>
  <dd>You can set this pragma to ON to reverse the order of results of SELECT
      statements without an ORDER BY clause so that you can see if applications
      are making invalid assumptions about the result order.
    <p class="Pp">Note that SQLite 3.7.15 (bundled with DBD::SQLite 1.38_02)
        enhanced its query optimizer and the order of results of a SELECT
        statement without an ORDER BY clause may be different from the one of
        the previous versions.</p>
  </dd>
  <dt id="synchronous"><a class="permalink" href="#synchronous">synchronous</a></dt>
  <dd>You can set set this pragma to OFF to make some of the operations in
      SQLite faster with a possible risk of database corruption in the worst
      case. See also &quot;Performance&quot; section below.</dd>
</dl>
<p class="Pp">See &lt;https://www.sqlite.org/pragma.html&gt; for more
  details.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Foreign_Keys"><a class="permalink" href="#Foreign_Keys">Foreign
  Keys</a></h2>
<p class="Pp">SQLite has started supporting foreign key constraints since 3.6.19
    (released on Oct 14, 2009; bundled in DBD::SQLite 1.26_05). To be exact,
    SQLite has long been able to parse a schema with foreign keys, but the
    constraints has not been enforced. Now you can issue a
    <span class="Li">&quot;foreign_keys&quot;</span> pragma to enable this
    feature and enforce the constraints, preferably as soon as you connect to a
    database and you're not in a transaction:</p>
<p class="Pp"></p>
<pre>  $dbh-&gt;do(&quot;PRAGMA foreign_keys = ON&quot;);
</pre>
<p class="Pp">And you can explicitly disable the feature whenever you like by
    turning the pragma off:</p>
<p class="Pp"></p>
<pre>  $dbh-&gt;do(&quot;PRAGMA foreign_keys = OFF&quot;);
</pre>
<p class="Pp">As of this writing, this feature is disabled by default by the
    SQLite team, and by us, to secure backward compatibility, as this feature
    may break your applications, and actually broke some for us. If you have
    used a schema with foreign key constraints but haven't cared them much and
    supposed they're always ignored for SQLite, be prepared, and please do
    extensive testing to ensure that your applications will continue to work
    when the foreign keys support is enabled by default.</p>
<p class="Pp">See &lt;https://www.sqlite.org/foreignkeys.html&gt; for
  details.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Transactions"><a class="permalink" href="#Transactions">Transactions</a></h2>
<p class="Pp">DBI/DBD::SQLite's transactions may be a bit confusing. They behave
    differently according to the status of the
    <span class="Li">&quot;AutoCommit&quot;</span> flag:</p>
<dl class="Bl-tag">
  <dt id="When"><a class="permalink" href="#When">When the AutoCommit flag is
    on</a></dt>
  <dd>You're supposed to always use the auto-commit mode, except you explicitly
      begin a transaction, and when the transaction ended, you're supposed to go
      back to the auto-commit mode. To begin a transaction, call
      <span class="Li">&quot;begin_work&quot;</span> method, or issue a
      <span class="Li">&quot;BEGIN&quot;</span> statement. To end it, call
      <span class="Li">&quot;commit/rollback&quot;</span> methods, or issue the
      corresponding statements.
    <p class="Pp"></p>
    <pre>  $dbh-&gt;{AutoCommit} = 1;
  
  $dbh-&gt;begin_work; # or $dbh-&gt;do('BEGIN TRANSACTION');
  
  # $dbh-&gt;{AutoCommit} is turned off temporarily during a transaction;
  
  $dbh-&gt;commit; # or $dbh-&gt;do('COMMIT');
  
  # $dbh-&gt;{AutoCommit} is turned on again;
    </pre>
  </dd>
  <dt id="When~2"><a class="permalink" href="#When~2">When the AutoCommit flag
    is off</a></dt>
  <dd>You're supposed to always use the transactional mode, until you explicitly
      turn on the AutoCommit flag. You can explicitly issue a
      <span class="Li">&quot;BEGIN&quot;</span> statement (only when an actual
      transaction has not begun yet) but you're not allowed to call
      <span class="Li">&quot;begin_work&quot;</span> method (if you don't issue
      a <span class="Li">&quot;BEGIN&quot;</span>, it will be issued
      internally). You can commit or roll it back freely. Another transaction
      will automatically begin if you execute another statement.
    <p class="Pp"></p>
    <pre>  $dbh-&gt;{AutoCommit} = 0;
  
  # $dbh-&gt;do('BEGIN TRANSACTION') is not necessary, but possible
  
  ...
  
  $dbh-&gt;commit; # or $dbh-&gt;do('COMMIT');
  
  # $dbh-&gt;{AutoCommit} stays intact;
  
  $dbh-&gt;{AutoCommit} = 1;  # ends the transactional mode
    </pre>
  </dd>
</dl>
<p class="Pp">This <span class="Li">&quot;AutoCommit&quot;</span> mode is
    independent from the autocommit mode of the internal SQLite library, which
    always begins by a <span class="Li">&quot;BEGIN&quot;</span> statement, and
    ends by a <span class="Li">&quot;COMMIT&quot;</span> or a
    <span class="Li">&quot;ROLLBACK&quot;</span>.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Transaction_and_Database_Locking"><a class="permalink" href="#Transaction_and_Database_Locking">Transaction
  and Database Locking</a></h2>
<p class="Pp">The default transaction behavior of SQLite is
    <span class="Li">&quot;deferred&quot;</span>, that means, locks are not
    acquired until the first read or write operation, and thus it is possible
    that another thread or process could create a separate transaction and write
    to the database after the <span class="Li">&quot;BEGIN&quot;</span> on the
    current thread has executed, and eventually cause a &quot;deadlock&quot;. To
    avoid this, DBD::SQLite internally issues a <span class="Li">&quot;BEGIN
    IMMEDIATE&quot;</span> if you begin a transaction by calling
    <span class="Li">&quot;begin_work&quot;</span> or by turning off
    <span class="Li">&quot;AutoCommit&quot;</span> (since 1.38_01).</p>
<p class="Pp">If you really need to turn off this feature for some reasons, set
    <span class="Li">&quot;sqlite_use_immediate_transaction&quot;</span>
    database handle attribute to false, and the default
    <span class="Li">&quot;deferred&quot;</span> transaction will be used.</p>
<p class="Pp"></p>
<pre>  my $dbh = DBI-&gt;connect(&quot;dbi:SQLite::memory:&quot;, &quot;&quot;, &quot;&quot;, {
    sqlite_use_immediate_transaction =&gt; 0,
  });
</pre>
<p class="Pp">Or, issue a <span class="Li">&quot;BEGIN&quot;</span> statement
    explicitly each time you begin a transaction.</p>
<p class="Pp">See &lt;http://sqlite.org/lockingv3.html&gt; for locking
  details.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_$sth"><a class="permalink" href="#_$sth">&quot;$sth-&gt;finish&quot;
  and Transaction Rollback</a></h2>
<p class="Pp">As the DBI doc says, you almost certainly do <b>not</b> need to
    call &quot;finish&quot; in DBI method if you fetch all rows (probably in a
    loop). However, there are several exceptions to this rule, and rolling-back
    of an unfinished <span class="Li">&quot;SELECT&quot;</span> statement is one
    of such exceptional cases.</p>
<p class="Pp">SQLite prohibits <span class="Li">&quot;ROLLBACK&quot;</span> of
    unfinished <span class="Li">&quot;SELECT&quot;</span> statements in a
    transaction (See &lt;http://sqlite.org/lang_transaction.html&gt; for
    details). So you need to call <span class="Li">&quot;finish&quot;</span>
    before you issue a rollback.</p>
<p class="Pp"></p>
<pre>  $sth = $dbh-&gt;prepare(&quot;SELECT * FROM t&quot;);
  $dbh-&gt;begin_work;
  eval {
      $sth-&gt;execute;
      $row = $sth-&gt;fetch;
      ...
      die &quot;For some reason&quot;;
      ...
  };
  if($@) {
     $sth-&gt;finish;  # You need this for SQLite
     $dbh-&gt;rollback;
  } else {
     $dbh-&gt;commit;
  }
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="Processing_Multiple_Statements_At_A_Time"><a class="permalink" href="#Processing_Multiple_Statements_At_A_Time">Processing
  Multiple Statements At A Time</a></h2>
<p class="Pp">DBI's statement handle is not supposed to process multiple
    statements at a time. So if you pass a string that contains multiple
    statements (a <span class="Li">&quot;dump&quot;</span>) to a statement
    handle (via <span class="Li">&quot;prepare&quot;</span> or
    <span class="Li">&quot;do&quot;</span>), DBD::SQLite only processes the
    first statement, and discards the rest.</p>
<p class="Pp">If you need to process multiple statements at a time, set a
    <span class="Li">&quot;sqlite_allow_multiple_statements&quot;</span>
    attribute of a database handle to true when you connect to a database, and
    <span class="Li">&quot;do&quot;</span> method takes care of the rest (since
    1.30_01, and without creating DBI's statement handles internally since
    1.47_01). If you do need to use <span class="Li">&quot;prepare&quot;</span>
    or <span class="Li">&quot;prepare_cached&quot;</span> (which I don't
    recommend in this case, because typically there's no placeholder nor
    reusable part in a dump), you can look at
    <span class="Li">&quot;$sth-&gt;{sqlite_unprepared_statements}&quot;</span>
    to retrieve what's left, though it usually contains nothing but white
    spaces.</p>
</section>
<section class="Ss">
<h2 class="Ss">TYPE statement attribute</h2>
<p class="Pp">Because of historical reasons, DBD::SQLite's
    <span class="Li">&quot;TYPE&quot;</span> statement handle attribute returns
    an array ref of string values, contrary to the DBI specification. This value
    is also less useful for SQLite users because SQLite uses dynamic type system
    (that means, the datatype of a value is associated with the value itself,
    not with its container).</p>
<p class="Pp">As of version 1.61_02, if you set
    <span class="Li">&quot;sqlite_prefer_numeric_type&quot;</span> database
    handle attribute to true, <span class="Li">&quot;TYPE&quot;</span> statement
    handle attribute returns an array of integer, as an experiment.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Performance"><a class="permalink" href="#Performance">Performance</a></h2>
<p class="Pp">SQLite is fast, very fast. Matt processed his 72MB log file with
    it, inserting the data (400,000+ rows) by using transactions and only
    committing every 1000 rows (otherwise the insertion is quite slow), and then
    performing queries on the data.</p>
<p class="Pp">Queries like count(*) and avg(bytes) took fractions of a second to
    return, but what surprised him most of all was:</p>
<p class="Pp"></p>
<pre>  SELECT url, count(*) as count
  FROM access_log
  GROUP BY url
  ORDER BY count desc
  LIMIT 20
</pre>
<p class="Pp">To discover the top 20 hit URLs on the site
    (&lt;http://axkit.org&gt;), and it returned within 2 seconds. He was
    seriously considering switching his log analysis code to use this little
    speed demon!</p>
<p class="Pp">Oh yeah, and that was with no indexes on the table, on a 400MHz
    PIII.</p>
<p class="Pp">For best performance be sure to tune your hdparm settings if you
    are using linux. Also you might want to set:</p>
<p class="Pp"></p>
<pre>  PRAGMA synchronous = OFF
</pre>
<p class="Pp">Which will prevent SQLite from doing fsync's when writing (which
    slows down non-transactional writes significantly) at the expense of some
    peace of mind. Also try playing with the cache_size pragma.</p>
<p class="Pp">The memory usage of SQLite can also be tuned using the cache_size
    pragma.</p>
<p class="Pp"></p>
<pre>  $dbh-&gt;do(&quot;PRAGMA cache_size = 800000&quot;);
</pre>
<p class="Pp">The above will allocate 800M for DB cache; the default is 2M. Your
    sweet spot probably lies somewhere in between.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="DRIVER_PRIVATE_ATTRIBUTES"><a class="permalink" href="#DRIVER_PRIVATE_ATTRIBUTES">DRIVER
  PRIVATE ATTRIBUTES</a></h1>
<section class="Ss">
<h2 class="Ss" id="Database_Handle_Attributes"><a class="permalink" href="#Database_Handle_Attributes">Database
  Handle Attributes</a></h2>
<dl class="Bl-tag">
  <dt id="sqlite_version"><a class="permalink" href="#sqlite_version">sqlite_version</a></dt>
  <dd>Returns the version of the SQLite library which <b>DBD::SQLite</b> is
      using, e.g., &quot;3.26.0&quot;. Can only be read.</dd>
  <dt id="sqlite_unicode"><a class="permalink" href="#sqlite_unicode">sqlite_unicode</a></dt>
  <dd>If set to a true value, <b>DBD::SQLite</b> will turn the UTF-8 flag on for
      all text strings coming out of the database (this feature is currently
      disabled for perl &lt; 5.8.5). For more details on the UTF-8 flag see
      perlunicode. The default is for the UTF-8 flag to be turned off.
    <p class="Pp">Also note that due to some bizarreness in SQLite's type system
        (see &lt;https://www.sqlite.org/datatype3.html&gt;), if you want to
        retain blob-style behavior for <b>some</b> columns under
        <span class="Li">&quot;$dbh-&gt;{sqlite_unicode} = 1&quot;</span> (say,
        to store images in the database), you have to state so explicitly using
        the 3-argument form of &quot;bind_param&quot; in DBI when doing
      updates:</p>
    <p class="Pp"></p>
    <pre>  use DBI qw(:sql_types);
  $dbh-&gt;{sqlite_unicode} = 1;
  my $sth = $dbh-&gt;prepare(&quot;INSERT INTO mytable (blobcolumn) VALUES (?)&quot;);
  
  # Binary_data will be stored as is.
  $sth-&gt;bind_param(1, $binary_data, SQL_BLOB);
    </pre>
    <p class="Pp">Defining the column type as
        <span class="Li">&quot;BLOB&quot;</span> in the DDL is <b>not</b>
        sufficient.</p>
    <p class="Pp">This attribute was originally named as
        <span class="Li">&quot;unicode&quot;</span>, and renamed to
        <span class="Li">&quot;sqlite_unicode&quot;</span> for integrity since
        version 1.26_06. Old <span class="Li">&quot;unicode&quot;</span>
        attribute is still accessible but will be deprecated in the near
      future.</p>
  </dd>
  <dt id="sqlite_allow_multiple_statements"><a class="permalink" href="#sqlite_allow_multiple_statements">sqlite_allow_multiple_statements</a></dt>
  <dd>If you set this to true, <span class="Li">&quot;do&quot;</span> method
      will process multiple statements at one go. This may be handy, but with
      performance penalty. See above for details.</dd>
  <dt id="sqlite_use_immediate_transaction"><a class="permalink" href="#sqlite_use_immediate_transaction">sqlite_use_immediate_transaction</a></dt>
  <dd>If you set this to true, DBD::SQLite tries to issue a
      <span class="Li">&quot;begin</span> <span class="Li">immediate
      transaction&quot;</span> (instead of <span class="Li">&quot;begin
      transaction&quot;</span>) when necessary. See above for details.
    <p class="Pp">As of version 1.38_01, this attribute is set to true by
        default. If you really need to use
        <span class="Li">&quot;deferred&quot;</span> transactions for some
        reasons, set this to false explicitly.</p>
  </dd>
  <dt id="sqlite_see_if_its_a_number"><a class="permalink" href="#sqlite_see_if_its_a_number">sqlite_see_if_its_a_number</a></dt>
  <dd>If you set this to true, DBD::SQLite tries to see if the bind values are
      number or not, and does not quote if they are numbers. See above for
      details.</dd>
  <dt id="sqlite_extended_result_codes"><a class="permalink" href="#sqlite_extended_result_codes">sqlite_extended_result_codes</a></dt>
  <dd>If set to true, DBD::SQLite uses extended result codes where appropriate
      (see &lt;https://www.sqlite.org/rescode.html&gt;).</dd>
  <dt id="sqlite_defensive"><a class="permalink" href="#sqlite_defensive">sqlite_defensive</a></dt>
  <dd>If set to true, language features that allow ordinary SQL to deliberately
      corrupt the database file are prohibited.</dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="Statement_Handle_Attributes"><a class="permalink" href="#Statement_Handle_Attributes">Statement
  Handle Attributes</a></h2>
<dl class="Bl-tag">
  <dt id="sqlite_unprepared_statements"><a class="permalink" href="#sqlite_unprepared_statements">sqlite_unprepared_statements</a></dt>
  <dd>Returns an unprepared part of the statement you pass to
      <span class="Li">&quot;prepare&quot;</span>. Typically this contains
      nothing but white spaces after a semicolon. See above for details.</dd>
</dl>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="METHODS"><a class="permalink" href="#METHODS">METHODS</a></h1>
<p class="Pp">See also to the DBI documentation for the details of other common
    methods.</p>
<section class="Ss">
<h2 class="Ss" id="table_info"><a class="permalink" href="#table_info">table_info</a></h2>
<pre>  $sth = $dbh-&gt;table_info(undef, $schema, $table, $type, \%attr);
</pre>
<p class="Pp">Returns all tables and schemas (databases) as specified in
    &quot;table_info&quot; in DBI. The schema and table arguments will do a
    <span class="Li">&quot;LIKE&quot;</span> search. You can specify an ESCAPE
    character by including an 'Escape' attribute in \%attr. The
    <span class="Li">$type</span> argument accepts a comma separated list of the
    following types 'TABLE', 'VIEW', 'LOCAL TEMPORARY' and 'SYSTEM TABLE' (by
    default all are returned). Note that a statement handle is returned, and not
    a direct list of tables.</p>
<p class="Pp">The following fields are returned:</p>
<p class="Pp"><b>TABLE_CAT</b>: Always NULL, as SQLite does not have the concept
    of catalogs.</p>
<p class="Pp"><b>TABLE_SCHEM</b>: The name of the schema (database) that the
    table or view is in. The default schema is 'main', temporary tables are in
    'temp' and other databases will be in the name given when the database was
    attached.</p>
<p class="Pp"><b>TABLE_NAME</b>: The name of the table or view.</p>
<p class="Pp"><b>TABLE_TYPE</b>: The type of object returned. Will be one of
    'TABLE', 'VIEW', 'LOCAL TEMPORARY' or 'SYSTEM TABLE'.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="primary_key,_primary_key_info"><a class="permalink" href="#primary_key,_primary_key_info">primary_key,
  primary_key_info</a></h2>
<pre>  @names = $dbh-&gt;primary_key(undef, $schema, $table);
  $sth   = $dbh-&gt;primary_key_info(undef, $schema, $table, \%attr);
</pre>
<p class="Pp">You can retrieve primary key names or more detailed information.
    As noted above, SQLite does not have the concept of catalogs, so the first
    argument of the methods is usually
    <span class="Li">&quot;undef&quot;</span>, and you'll usually set
    <span class="Li">&quot;undef&quot;</span> for the second one (unless you
    want to know the primary keys of temporary tables).</p>
</section>
<section class="Ss">
<h2 class="Ss" id="foreign_key_info"><a class="permalink" href="#foreign_key_info">foreign_key_info</a></h2>
<pre>  $sth = $dbh-&gt;foreign_key_info(undef, $pk_schema, $pk_table,
                                undef, $fk_schema, $fk_table);
</pre>
<p class="Pp">Returns information about foreign key constraints, as specified in
    &quot;foreign_key_info&quot; in DBI, but with some limitations :</p>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>information in rows returned by the <span class="Li">$sth</span> is
      incomplete with respect to the &quot;foreign_key_info&quot; in DBI
      specification. All requested fields are present, but the content is
      <span class="Li">&quot;undef&quot;</span> for some of them.</dd>
</dl>
<p class="Pp">The following nonempty fields are returned :</p>
<p class="Pp"><b>PKTABLE_NAME</b>: The primary (unique) key table
  identifier.</p>
<p class="Pp"><b>PKCOLUMN_NAME</b>: The primary (unique) key column
  identifier.</p>
<p class="Pp"><b>FKTABLE_NAME</b>: The foreign key table identifier.</p>
<p class="Pp"><b>FKCOLUMN_NAME</b>: The foreign key column identifier.</p>
<p class="Pp"><b>KEY_SEQ</b>: The column sequence number (starting with 1), when
    several columns belong to a same constraint.</p>
<p class="Pp"><b>UPDATE_RULE</b>: The referential action for the UPDATE rule.
    The following codes are defined:</p>
<p class="Pp"></p>
<pre>  CASCADE              0
  RESTRICT             1
  SET NULL             2
  NO ACTION            3
  SET DEFAULT          4
</pre>
<p class="Pp">Default is 3 ('NO ACTION').</p>
<p class="Pp"><b>DELETE_RULE</b>: The referential action for the DELETE rule.
    The codes are the same as for UPDATE_RULE.</p>
<p class="Pp"><b>DEFERRABILITY</b>: The following codes are defined:</p>
<p class="Pp"></p>
<pre>  INITIALLY DEFERRED   5
  INITIALLY IMMEDIATE  6
  NOT DEFERRABLE       7
</pre>
<p class="Pp"><b>UNIQUE_OR_PRIMARY</b>: Whether the column is primary or
  unique.</p>
<p class="Pp"><b>Note</b>: foreign key support in SQLite must be explicitly
    turned on through a <span class="Li">&quot;PRAGMA&quot;</span> command; see
    &quot;Foreign keys&quot; earlier in this manual.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="statistics_info"><a class="permalink" href="#statistics_info">statistics_info</a></h2>
<pre>  $sth = $dbh-&gt;statistics_info(undef, $schema, $table,
                                $unique_only, $quick);
</pre>
<p class="Pp">Returns information about a table and it's indexes, as specified
    in &quot;statistics_info&quot; in DBI, but with some limitations :</p>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>information in rows returned by the <span class="Li">$sth</span> is
      incomplete with respect to the &quot;statistics_info&quot; in DBI
      specification. All requested fields are present, but the content is
      <span class="Li">&quot;undef&quot;</span> for some of them.</dd>
</dl>
<p class="Pp">The following nonempty fields are returned :</p>
<p class="Pp"><b>TABLE_SCHEM</b>: The name of the schema (database) that the
    table is in. The default schema is 'main', temporary tables are in 'temp'
    and other databases will be in the name given when the database was
    attached.</p>
<p class="Pp"><b>TABLE_NAME</b>: The name of the table</p>
<p class="Pp"><b>NON_UNIQUE</b>: Contains 0 for unique indexes, 1 for non-unique
    indexes</p>
<p class="Pp"><b>INDEX_NAME</b>: The name of the index</p>
<p class="Pp"><b>TYPE</b>: SQLite uses 'btree' for all it's indexes</p>
<p class="Pp"><b>ORDINAL_POSITION</b>: Column sequence number (starting with
  1).</p>
<p class="Pp"><b>COLUMN_NAME</b>: The name of the column</p>
</section>
<section class="Ss">
<h2 class="Ss" id="ping"><a class="permalink" href="#ping">ping</a></h2>
<pre>  my $bool = $dbh-&gt;ping;
</pre>
<p class="Pp">returns true if the database file exists (or the database is
    in-memory), and the database connection is active.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="DRIVER_PRIVATE_METHODS"><a class="permalink" href="#DRIVER_PRIVATE_METHODS">DRIVER
  PRIVATE METHODS</a></h1>
<p class="Pp">The following methods can be called via the <b>func()</b> method
    with a little tweak, but the use of <b>func()</b> method is now discouraged
    by the DBI author for various reasons (see DBI's document
    &lt;https://metacpan.org/pod/DBI::DBD#Using-<b>install_method()</b>-to-expose-driver-private-methods&gt;
    for details). So, if you're using DBI &gt;= 1.608, use these
    <span class="Li">&quot;sqlite_&quot;</span> methods. If you need to use an
    older DBI, you can call these like this:</p>
<p class="Pp"></p>
<pre>  $dbh-&gt;func( ..., &quot;(method name without sqlite_ prefix)&quot; );
</pre>
<p class="Pp">Exception: <span class="Li">&quot;sqlite_trace&quot;</span> should
    always be called as is, even with <span class="Li">&quot;func()&quot;</span>
    method (to avoid conflict with DBI's <b>trace()</b> method).</p>
<p class="Pp"></p>
<pre>  $dbh-&gt;func( ..., &quot;sqlite_trace&quot;);
</pre>
<section class="Ss">
<h2 class="Ss" id="$dbh"><a class="permalink" href="#$dbh">$dbh-&gt;<b>sqlite_last_insert_rowid()</b></a></h2>
<p class="Pp">This method returns the last inserted rowid. If you specify an
    INTEGER PRIMARY KEY as the first column in your table, that is the column
    that is returned. Otherwise, it is the hidden ROWID column. See the SQLite
    docs for details.</p>
<p class="Pp">Generally you should not be using this method. Use the DBI
    last_insert_id method instead. The usage of this is:</p>
<p class="Pp"></p>
<pre>  $h-&gt;last_insert_id($catalog, $schema, $table_name, $field_name [, \%attr ])
</pre>
<p class="Pp">Running
    <span class="Li">&quot;$h-&gt;last_insert_id(&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;)&quot;</span>
    is the equivalent of running
    <span class="Li">&quot;$dbh-&gt;sqlite_last_insert_rowid()&quot;</span>
    directly.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$dbh~2"><a class="permalink" href="#$dbh~2">$dbh-&gt;<b>sqlite_db_filename()</b></a></h2>
<p class="Pp">Retrieve the current (main) database filename. If the database is
    in-memory or temporary, this returns an empty string, or
    <span class="Li">&quot;undef&quot;</span>.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$dbh~3"><a class="permalink" href="#$dbh~3">$dbh-&gt;<b>sqlite_busy_timeout()</b></a></h2>
<p class="Pp">Retrieve the current busy timeout.</p>
</section>
<section class="Ss">
<h2 class="Ss">$dbh-&gt;sqlite_busy_timeout( $ms )</h2>
<p class="Pp">Set the current busy timeout. The timeout is in milliseconds.</p>
</section>
<section class="Ss">
<h2 class="Ss">$dbh-&gt;sqlite_create_function( $name, $argc, $code_ref, $flags
  )</h2>
<p class="Pp">This method will register a new function which will be usable in
    an SQL query. The method's parameters are:</p>
<dl class="Bl-tag">
  <dt>$name</dt>
  <dd>The name of the function. This is the name of the function as it will be
      used from SQL.</dd>
  <dt>$argc</dt>
  <dd>The number of arguments taken by the function. If this number is -1, the
      function can take any number of arguments.</dd>
  <dt>$code_ref</dt>
  <dd>This should be a reference to the function's implementation.</dd>
  <dt>$flags</dt>
  <dd>You can optionally pass an extra flag bit to create_function, which then
      would be ORed with SQLITE_UTF8 (default). As of 1.47_02 (SQLite 3.8.9),
      only meaning bit is SQLITE_DETERMINISTIC (introduced at SQLite 3.8.3),
      which can make the function perform better. See C API documentation at
      &lt;http://sqlite.org/c3ref/create_function.html&gt; for details.</dd>
</dl>
<p class="Pp">For example, here is how to define a <b>now()</b> function which
    returns the current number of seconds since the epoch:</p>
<p class="Pp"></p>
<pre>  $dbh-&gt;sqlite_create_function( 'now', 0, sub { return time } );
</pre>
<p class="Pp">After this, it could be used from SQL as:</p>
<p class="Pp"></p>
<pre>  INSERT INTO mytable ( now() );
</pre>
<p class="Pp"><i>REGEXP function</i></p>
<p class="Pp">SQLite includes syntactic support for an infix operator 'REGEXP',
    but without any implementation. The
    <span class="Li">&quot;DBD::SQLite&quot;</span> driver automatically
    registers an implementation that performs standard perl regular expression
    matching, using current locale. So for example you can search for words
    starting with an 'A' with a query like</p>
<p class="Pp"></p>
<pre>  SELECT * from table WHERE column REGEXP '\bA\w+'
</pre>
<p class="Pp">If you want case-insensitive searching, use perl regex flags, like
    this :</p>
<p class="Pp"></p>
<pre>  SELECT * from table WHERE column REGEXP '(?i:\bA\w+)'
</pre>
<p class="Pp">The default REGEXP implementation can be overridden through the
    <span class="Li">&quot;create_function&quot;</span> API described above.</p>
<p class="Pp">Note that regexp matching will <b>not</b> use SQLite indices, but
    will iterate over all rows, so it could be quite costly in terms of
    performance.</p>
</section>
<section class="Ss">
<h2 class="Ss">$dbh-&gt;sqlite_create_collation( $name, $code_ref )</h2>
<p class="Pp">This method manually registers a new function which will be usable
    in an SQL query as a COLLATE option for sorting. Such functions can also be
    registered automatically on demand: see section &quot;COLLATION
    FUNCTIONS&quot; below.</p>
<p class="Pp">The method's parameters are:</p>
<dl class="Bl-tag">
  <dt>$name</dt>
  <dd>The name of the function exposed to SQL.</dd>
  <dt>$code_ref</dt>
  <dd>Reference to the function's implementation. The driver will check that
      this is a proper sorting function.</dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss">$dbh-&gt;sqlite_collation_needed( $code_ref )</h2>
<p class="Pp">This method manually registers a callback function that will be
    invoked whenever an undefined collation sequence is required from an SQL
    statement. The callback is invoked as</p>
<p class="Pp"></p>
<pre>  $code_ref-&gt;($dbh, $collation_name)
</pre>
<p class="Pp">and should register the desired collation using
    &quot;sqlite_create_collation&quot;.</p>
<p class="Pp">An initial callback is already registered by
    <span class="Li">&quot;DBD::SQLite&quot;</span>, so for most common cases it
    will be simpler to just add your collation sequences in the
    <span class="Li">%DBD::SQLite::COLLATION</span> hash (see section
    &quot;COLLATION FUNCTIONS&quot; below).</p>
</section>
<section class="Ss">
<h2 class="Ss">$dbh-&gt;sqlite_create_aggregate( $name, $argc, $pkg, $flags
  )</h2>
<p class="Pp">This method will register a new aggregate function which can then
    be used from SQL. The method's parameters are:</p>
<dl class="Bl-tag">
  <dt>$name</dt>
  <dd>The name of the aggregate function, this is the name under which the
      function will be available from SQL.</dd>
  <dt>$argc</dt>
  <dd>This is an integer which tells the SQL parser how many arguments the
      function takes. If that number is -1, the function can take any number of
      arguments.</dd>
  <dt>$pkg</dt>
  <dd>This is the package which implements the aggregator interface.</dd>
  <dt>$flags</dt>
  <dd>You can optionally pass an extra flag bit to create_aggregate, which then
      would be ORed with SQLITE_UTF8 (default). As of 1.47_02 (SQLite 3.8.9),
      only meaning bit is SQLITE_DETERMINISTIC (introduced at SQLite 3.8.3),
      which can make the function perform better. See C API documentation at
      &lt;http://sqlite.org/c3ref/create_function.html&gt; for details.</dd>
</dl>
<p class="Pp">The aggregator interface consists of defining three methods:</p>
<dl class="Bl-tag">
  <dt id="new()"><a class="permalink" href="#new()"><b>new()</b></a></dt>
  <dd>This method will be called once to create an object which should be used
      to aggregate the rows in a particular group. The <b>step()</b> and
      <b>finalize()</b> methods will be called upon the reference return by the
      method.</dd>
  <dt id="step(@_)"><a class="permalink" href="#step(@_)">step(@_)</a></dt>
  <dd>This method will be called once for each row in the aggregate.</dd>
  <dt id="finalize()"><a class="permalink" href="#finalize()"><b>finalize()</b></a></dt>
  <dd>This method will be called once all rows in the aggregate were processed
      and it should return the aggregate function's result. When there is no
      rows in the aggregate, <b>finalize()</b> will be called right after
      <b>new()</b>.</dd>
</dl>
<p class="Pp">Here is a simple aggregate function which returns the variance
    (example adapted from pysqlite):</p>
<p class="Pp"></p>
<pre>  package variance;
  
  sub new { bless [], shift; }
  
  sub step {
      my ( $self, $value ) = @_;
  
      push @$self, $value;
  }
  
  sub finalize {
      my $self = $_[0];
  
      my $n = @$self;
  
      # Variance is NULL unless there is more than one row
      return undef unless $n || $n == 1;
  
      my $mu = 0;
      foreach my $v ( @$self ) {
          $mu += $v;
      }
      $mu /= $n;
  
      my $sigma = 0;
      foreach my $v ( @$self ) {
          $sigma += ($v - $mu)**2;
      }
      $sigma = $sigma / ($n - 1);
  
      return $sigma;
  }
  
  $dbh-&gt;sqlite_create_aggregate( &quot;variance&quot;, 1, 'variance' );
</pre>
<p class="Pp">The aggregate function can then be used as:</p>
<p class="Pp"></p>
<pre>  SELECT group_name, variance(score)
  FROM results
  GROUP BY group_name;
</pre>
<p class="Pp">For more examples, see the DBD::SQLite::Cookbook.</p>
</section>
<section class="Ss">
<h2 class="Ss">$dbh-&gt;sqlite_progress_handler( $n_opcodes, $code_ref )</h2>
<p class="Pp">This method registers a handler to be invoked periodically during
    long running calls to SQLite.</p>
<p class="Pp">An example use for this interface is to keep a GUI updated during
    a large query. The parameters are:</p>
<dl class="Bl-tag">
  <dt>$n_opcodes</dt>
  <dd>The progress handler is invoked once for every
      <span class="Li">$n_opcodes</span> virtual machine opcodes in SQLite.</dd>
  <dt>$code_ref</dt>
  <dd>Reference to the handler subroutine. If the progress handler returns
      non-zero, the SQLite operation is interrupted. This feature can be used to
      implement a &quot;Cancel&quot; button on a GUI dialog box.
    <p class="Pp">Set this argument to <span class="Li">&quot;undef&quot;</span>
        if you want to unregister a previous progress handler.</p>
  </dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss">$dbh-&gt;sqlite_commit_hook( $code_ref )</h2>
<p class="Pp">This method registers a callback function to be invoked whenever a
    transaction is committed. Any callback set by a previous call to
    <span class="Li">&quot;sqlite_commit_hook&quot;</span> is overridden. A
    reference to the previous callback (if any) is returned. Registering an
    <span class="Li">&quot;undef&quot;</span> disables the callback.</p>
<p class="Pp">When the commit hook callback returns zero, the commit operation
    is allowed to continue normally. If the callback returns non-zero, then the
    commit is converted into a rollback (in that case, any attempt to
    <i>explicitly</i> call
    <span class="Li">&quot;$dbh-&gt;rollback()&quot;</span> afterwards would
    yield an error).</p>
</section>
<section class="Ss">
<h2 class="Ss">$dbh-&gt;sqlite_rollback_hook( $code_ref )</h2>
<p class="Pp">This method registers a callback function to be invoked whenever a
    transaction is rolled back. Any callback set by a previous call to
    <span class="Li">&quot;sqlite_rollback_hook&quot;</span> is overridden. A
    reference to the previous callback (if any) is returned. Registering an
    <span class="Li">&quot;undef&quot;</span> disables the callback.</p>
</section>
<section class="Ss">
<h2 class="Ss">$dbh-&gt;sqlite_update_hook( $code_ref )</h2>
<p class="Pp">This method registers a callback function to be invoked whenever a
    row is updated, inserted or deleted. Any callback set by a previous call to
    <span class="Li">&quot;sqlite_update_hook&quot;</span> is overridden. A
    reference to the previous callback (if any) is returned. Registering an
    <span class="Li">&quot;undef&quot;</span> disables the callback.</p>
<p class="Pp">The callback will be called as</p>
<p class="Pp"></p>
<pre>  $code_ref-&gt;($action_code, $database, $table, $rowid)
</pre>
<p class="Pp">where</p>
<dl class="Bl-tag">
  <dt>$action_code</dt>
  <dd>is an integer equal to either
      <span class="Li">&quot;DBD::SQLite::INSERT&quot;</span>,
      <span class="Li">&quot;DBD::SQLite::DELETE&quot;</span> or
      <span class="Li">&quot;DBD::SQLite::UPDATE&quot;</span> (see &quot;Action
      Codes&quot;);</dd>
  <dt>$database</dt>
  <dd>is the name of the database containing the affected row;</dd>
  <dt>$table</dt>
  <dd>is the name of the table containing the affected row;</dd>
  <dt>$rowid</dt>
  <dd>is the unique 64-bit signed integer key of the affected row within that
      table.</dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss">$dbh-&gt;sqlite_set_authorizer( $code_ref )</h2>
<p class="Pp">This method registers an authorizer callback to be invoked
    whenever SQL statements are being compiled by the &quot;prepare&quot; in DBI
    method. The authorizer callback should return
    <span class="Li">&quot;DBD::SQLite::OK&quot;</span> to allow the action,
    <span class="Li">&quot;DBD::SQLite::IGNORE&quot;</span> to disallow the
    specific action but allow the SQL statement to continue to be compiled, or
    <span class="Li">&quot;DBD::SQLite::DENY&quot;</span> to cause the entire
    SQL statement to be rejected with an error. If the authorizer callback
    returns any other value, then <span class="Li">&quot;prepare&quot;</span>
    call that triggered the authorizer will fail with an error message.</p>
<p class="Pp">An authorizer is used when preparing SQL statements from an
    untrusted source, to ensure that the SQL statements do not try to access
    data they are not allowed to see, or that they do not try to execute
    malicious statements that damage the database. For example, an application
    may allow a user to enter arbitrary SQL queries for evaluation by a
    database. But the application does not want the user to be able to make
    arbitrary changes to the database. An authorizer could then be put in place
    while the user-entered SQL is being prepared that disallows everything
    except SELECT statements.</p>
<p class="Pp">The callback will be called as</p>
<p class="Pp"></p>
<pre>  $code_ref-&gt;($action_code, $string1, $string2, $database, $trigger_or_view)
</pre>
<p class="Pp">where</p>
<dl class="Bl-tag">
  <dt>$action_code</dt>
  <dd>is an integer that specifies what action is being authorized (see
      &quot;Action Codes&quot;).</dd>
  <dt>$string1, $string2</dt>
  <dd>are strings that depend on the action code (see &quot;Action
    Codes&quot;).</dd>
  <dt>$database</dt>
  <dd>is the name of the database (<span class="Li">&quot;main&quot;</span>,
      <span class="Li">&quot;temp&quot;</span>, etc.) if applicable.</dd>
  <dt>$trigger_or_view</dt>
  <dd>is the name of the inner-most trigger or view that is responsible for the
      access attempt, or <span class="Li">&quot;undef&quot;</span> if this
      access attempt is directly from top-level SQL code.</dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss">$dbh-&gt;sqlite_backup_from_file( $filename )</h2>
<p class="Pp">This method accesses the SQLite Online Backup API, and will take a
    backup of the named database file, copying it to, and overwriting, your
    current database connection. This can be particularly handy if your current
    connection is to the special :memory: database, and you wish to populate it
    from an existing DB.</p>
</section>
<section class="Ss">
<h2 class="Ss">$dbh-&gt;sqlite_backup_to_file( $filename )</h2>
<p class="Pp">This method accesses the SQLite Online Backup API, and will take a
    backup of the currently connected database, and write it out to the named
    file.</p>
</section>
<section class="Ss">
<h2 class="Ss">$dbh-&gt;sqlite_backup_from_dbh( $another_dbh )</h2>
<p class="Pp">This method accesses the SQLite Online Backup API, and will take a
    backup of the database for the passed handle, copying it to, and
    overwriting, your current database connection. This can be particularly
    handy if your current connection is to the special :memory: database, and
    you wish to populate it from an existing DB. You can use this to backup from
    an in-memory database to another in-memory database.</p>
</section>
<section class="Ss">
<h2 class="Ss">$dbh-&gt;sqlite_backup_to_dbh( $another_dbh )</h2>
<p class="Pp">This method accesses the SQLite Online Backup API, and will take a
    backup of the currently connected database, and write it out to the passed
    database handle.</p>
</section>
<section class="Ss">
<h2 class="Ss">$dbh-&gt;sqlite_enable_load_extension( $bool )</h2>
<p class="Pp">Calling this method with a true value enables loading (external)
    SQLite3 extensions. After the call, you can load extensions like this:</p>
<p class="Pp"></p>
<pre>  $dbh-&gt;sqlite_enable_load_extension(1);
  $sth = $dbh-&gt;prepare(&quot;select load_extension('libsqlitefunctions.so')&quot;)
  or die &quot;Cannot prepare: &quot; . $dbh-&gt;errstr();
</pre>
</section>
<section class="Ss">
<h2 class="Ss">$dbh-&gt;sqlite_load_extension( $file, $proc )</h2>
<p class="Pp">Loading an extension by a select statement (with the
    &quot;load_extension&quot; SQLite3 function like above) has some
    limitations. If you need to, say, create other functions from an extension,
    use this method. <span class="Li">$file</span> (a path to the extension) is
    mandatory, and <span class="Li">$proc</span> (an entry point name) is
    optional. You need to call
    <span class="Li">&quot;sqlite_enable_load_extension&quot;</span> before
    calling <span class="Li">&quot;sqlite_load_extension&quot;</span>.</p>
</section>
<section class="Ss">
<h2 class="Ss">$dbh-&gt;sqlite_trace( $code_ref )</h2>
<p class="Pp">This method registers a trace callback to be invoked whenever SQL
    statements are being run.</p>
<p class="Pp">The callback will be called as</p>
<p class="Pp"></p>
<pre>  $code_ref-&gt;($statement)
</pre>
<p class="Pp">where</p>
<dl class="Bl-tag">
  <dt>$statement</dt>
  <dd>is a UTF-8 rendering of the SQL statement text as the statement first
      begins executing.</dd>
</dl>
<p class="Pp">Additional callbacks might occur as each triggered subprogram is
    entered. The callbacks for triggers contain a UTF-8 SQL comment that
    identifies the trigger.</p>
<p class="Pp">See also &quot;TRACING&quot; in DBI for better tracing
  options.</p>
</section>
<section class="Ss">
<h2 class="Ss">$dbh-&gt;sqlite_profile( $code_ref )</h2>
<p class="Pp">This method registers a profile callback to be invoked whenever a
    SQL statement finishes.</p>
<p class="Pp">The callback will be called as</p>
<p class="Pp"></p>
<pre>  $code_ref-&gt;($statement, $elapsed_time)
</pre>
<p class="Pp">where</p>
<dl class="Bl-tag">
  <dt>$statement</dt>
  <dd>is the original statement text (without bind parameters).</dd>
  <dt>$elapsed_time</dt>
  <dd>is an estimate of wall-clock time of how long that statement took to run
      (in milliseconds).</dd>
</dl>
<p class="Pp">This method is considered experimental and is subject to change in
    future versions of SQLite.</p>
<p class="Pp">See also DBI::Profile for better profiling options.</p>
</section>
<section class="Ss">
<h2 class="Ss">$dbh-&gt;sqlite_table_column_metadata( $dbname, $tablename,
  $columnname )</h2>
<p class="Pp">is for internal use only.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$dbh~4"><a class="permalink" href="#$dbh~4">$dbh-&gt;<b>sqlite_db_status()</b></a></h2>
<p class="Pp">Returns a hash reference that holds a set of status information of
    database connection such as cache usage. See
    &lt;https://www.sqlite.org/c3ref/c_dbstatus_options.html&gt; for details.
    You may also pass 0 as an argument to reset the status.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$sth"><a class="permalink" href="#$sth">$sth-&gt;<b>sqlite_st_status()</b></a></h2>
<p class="Pp">Returns a hash reference that holds a set of status information of
    SQLite statement handle such as full table scan count. See
    &lt;https://www.sqlite.org/c3ref/c_stmtstatus_counter.html&gt; for details.
    Statement status only holds the current value.</p>
<p class="Pp"></p>
<pre>  my $status = $sth-&gt;sqlite_st_status();
  my $cur = $status-&gt;{fullscan_step};
</pre>
<p class="Pp">You may also pass 0 as an argument to reset the status.</p>
</section>
<section class="Ss">
<h2 class="Ss">$dbh-&gt;sqlite_db_config( $id, $new_integer_value )</h2>
<p class="Pp">You can change how the connected database should behave like
  this:</p>
<p class="Pp"></p>
<pre>  use DBD::SQLite::Constants qw/:database_connection_configuration_options/;
  
  my $dbh = DBI-&gt;connect('dbi:SQLite::memory:');
  # This disables language features that allow ordinary SQL
  # to deliberately corrupt the database file
  $dbh-&gt;sqlite_db_config( SQLITE_DBCONFIG_DEFENSIVE, 1 );
  
  # This disables two-arg version of fts3_tokenizer.
  $dbh-&gt;sqlite_db_config( SQLITE_DBCONFIG_ENABLE_FTS3_TOKENIZER, 0 );
</pre>
<p class="Pp"><span class="Li">&quot;sqlite_db_config&quot;</span> returns the
    new value after the call. If you just want to know the current value without
    changing anything, pass a negative integer value.</p>
<p class="Pp"></p>
<pre>  my $current_value = $dbh-&gt;sqlite_db_config( SQLITE_DBCONFIG_DEFENSIVE, -1 );
</pre>
<p class="Pp">As of this writing,
    <span class="Li">&quot;sqlite_db_config&quot;</span> only supports options
    that set an integer value.
    <span class="Li">&quot;SQLITE_DBCONFIG_LOOKASIDE&quot;</span> and
    <span class="Li">&quot;SQLITE_DBCONFIG_MAINDBNAME&quot;</span> are not
    supported. See also
    <span class="Li">&quot;https://www.sqlite.org/capi3ref.html#sqlite3_db_config&quot;</span>
    for details.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$dbh~5"><a class="permalink" href="#$dbh~5">$dbh-&gt;<b>sqlite_create_module()</b></a></h2>
<p class="Pp">Registers a name for a <i>virtual table module</i>. Module names
    must be registered before creating a new virtual table using the module and
    before using a preexisting virtual table for the module. Virtual tables are
    explained in DBD::SQLite::VirtualTable.</p>
</section>
<section class="Ss">
<h2 class="Ss">$dbh-&gt;sqlite_limit( $category_id, $new_value )</h2>
<p class="Pp">Sets a new run-time limit for the category, and returns the
    current limit. If the new value is a negative number (or omitted), the limit
    is unchanged and just returns the current limit. Category ids
    (SQLITE_LIMIT_LENGTH, SQLITE_LIMIT_VARIABLE_NUMBER, etc) can be imported
    from DBD::SQLite::Constants.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="$dbh~6"><a class="permalink" href="#$dbh~6">$dbh-&gt;<b>sqlite_get_autocommit()</b></a></h2>
<p class="Pp">Returns true if the internal SQLite connection is in an autocommit
    mode. This does not always return the same value as
    <span class="Li">&quot;$dbh-&gt;{AutoCommit}&quot;</span>. This returns
    false if you explicitly issue a
    <span class="Li">&quot;&lt;BEGIN&quot;</span>&gt; statement.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="DRIVER_FUNCTIONS"><a class="permalink" href="#DRIVER_FUNCTIONS">DRIVER
  FUNCTIONS</a></h1>
<section class="Ss">
<h2 class="Ss"><b>DBD::SQLite::compile_options()</b></h2>
<p class="Pp">Returns an array of compile options (available since SQLite
    3.6.23, bundled in DBD::SQLite 1.30_01), or an empty array if the bundled
    library is old or compiled with SQLITE_OMIT_COMPILEOPTION_DIAGS.</p>
</section>
<section class="Ss">
<h2 class="Ss"><b>DBD::SQLite::sqlite_status()</b></h2>
<p class="Pp">Returns a hash reference that holds a set of status information of
    SQLite runtime such as memory usage or page cache usage (see
    &lt;https://www.sqlite.org/c3ref/c_status_malloc_count.html&gt; for
    details). Each of the entry contains the current value and the highwater
    value.</p>
<p class="Pp"></p>
<pre>  my $status = DBD::SQLite::sqlite_status();
  my $cur  = $status-&gt;{memory_used}{current};
  my $high = $status-&gt;{memory_used}{highwater};
</pre>
<p class="Pp">You may also pass 0 as an argument to reset the status.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="DBD::SQLite::strlike($pattern,_$string,_$escape_char),_DBD::SQLite::strglob($pattern,_$string)"><a class="permalink" href="#DBD::SQLite::strlike($pattern,_$string,_$escape_char),_DBD::SQLite::strglob($pattern,_$string)">DBD::SQLite::strlike($pattern,
  $string, $escape_char), DBD::SQLite::strglob($pattern, $string)</a></h2>
<p class="Pp">As of 1.49_05 (SQLite 3.10.0), you can use these two functions to
    see if a string matches a pattern. These may be useful when you create a
    virtual table or a custom function. See
    &lt;http://sqlite.org/c3ref/strlike.html&gt; and
    &lt;http://sqlite.org/c3ref/strglob.html&gt; for details.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="DRIVER_CONSTANTS"><a class="permalink" href="#DRIVER_CONSTANTS">DRIVER
  CONSTANTS</a></h1>
<p class="Pp">A subset of SQLite C constants are made available to Perl, because
    they may be needed when writing hooks or authorizer callbacks. For accessing
    such constants, the <span class="Li">&quot;DBD::SQLite&quot;</span> module
    must be explicitly <span class="Li">&quot;use&quot;</span>d at compile time.
    For example, an authorizer that forbids any DELETE operation would be
    written as follows :</p>
<p class="Pp"></p>
<pre>  use DBD::SQLite;
  $dbh-&gt;sqlite_set_authorizer(sub {
    my $action_code = shift;
    return $action_code == DBD::SQLite::DELETE ? DBD::SQLite::DENY
                                               : DBD::SQLite::OK;
  });
</pre>
<p class="Pp">The list of constants implemented in
    <span class="Li">&quot;DBD::SQLite&quot;</span> is given below; more
    information can be found ad at
    &lt;https://www.sqlite.org/c3ref/constlist.html&gt;.</p>
<section class="Ss">
<h2 class="Ss" id="Authorizer_Return_Codes"><a class="permalink" href="#Authorizer_Return_Codes">Authorizer
  Return Codes</a></h2>
<pre>  OK
  DENY
  IGNORE
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="Action_Codes"><a class="permalink" href="#Action_Codes">Action
  Codes</a></h2>
<p class="Pp">The &quot;set_authorizer&quot; method registers a callback
    function that is invoked to authorize certain SQL statement actions. The
    first parameter to the callback is an integer code that specifies what
    action is being authorized. The second and third parameters to the callback
    are strings, the meaning of which varies according to the action code. Below
    is the list of action codes, together with their associated strings.</p>
<p class="Pp"></p>
<pre>  # constant              string1         string2
  # ========              =======         =======
  CREATE_INDEX            Index Name      Table Name
  CREATE_TABLE            Table Name      undef
  CREATE_TEMP_INDEX       Index Name      Table Name
  CREATE_TEMP_TABLE       Table Name      undef
  CREATE_TEMP_TRIGGER     Trigger Name    Table Name
  CREATE_TEMP_VIEW        View Name       undef
  CREATE_TRIGGER          Trigger Name    Table Name
  CREATE_VIEW             View Name       undef
  DELETE                  Table Name      undef
  DROP_INDEX              Index Name      Table Name
  DROP_TABLE              Table Name      undef
  DROP_TEMP_INDEX         Index Name      Table Name
  DROP_TEMP_TABLE         Table Name      undef
  DROP_TEMP_TRIGGER       Trigger Name    Table Name
  DROP_TEMP_VIEW          View Name       undef
  DROP_TRIGGER            Trigger Name    Table Name
  DROP_VIEW               View Name       undef
  INSERT                  Table Name      undef
  PRAGMA                  Pragma Name     1st arg or undef
  READ                    Table Name      Column Name
  SELECT                  undef           undef
  TRANSACTION             Operation       undef
  UPDATE                  Table Name      Column Name
  ATTACH                  Filename        undef
  DETACH                  Database Name   undef
  ALTER_TABLE             Database Name   Table Name
  REINDEX                 Index Name      undef
  ANALYZE                 Table Name      undef
  CREATE_VTABLE           Table Name      Module Name
  DROP_VTABLE             Table Name      Module Name
  FUNCTION                undef           Function Name
  SAVEPOINT               Operation       Savepoint Name
</pre>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="COLLATION_FUNCTIONS"><a class="permalink" href="#COLLATION_FUNCTIONS">COLLATION
  FUNCTIONS</a></h1>
<section class="Ss">
<h2 class="Ss" id="Definition"><a class="permalink" href="#Definition">Definition</a></h2>
<p class="Pp">SQLite v3 provides the ability for users to supply arbitrary
    comparison functions, known as user-defined &quot;collation sequences&quot;
    or &quot;collating functions&quot;, to be used for comparing two text
    values. &lt;https://www.sqlite.org/datatype3.html#collation&gt; explains how
    collations are used in various SQL expressions.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Builtin_collation_sequences"><a class="permalink" href="#Builtin_collation_sequences">Builtin
  collation sequences</a></h2>
<p class="Pp">The following collation sequences are builtin within SQLite :</p>
<dl class="Bl-tag">
  <dt id="BINARY"><a class="permalink" href="#BINARY"><b>BINARY</b></a></dt>
  <dd>Compares string data using <b>memcmp()</b>, regardless of text
    encoding.</dd>
  <dt id="NOCASE"><a class="permalink" href="#NOCASE"><b>NOCASE</b></a></dt>
  <dd>The same as binary, except the 26 upper case characters of ASCII are
      folded to their lower case equivalents before the comparison is performed.
      Note that only ASCII characters are case folded. SQLite does not attempt
      to do full UTF case folding due to the size of the tables required.</dd>
  <dt id="RTRIM"><a class="permalink" href="#RTRIM"><b>RTRIM</b></a></dt>
  <dd>The same as binary, except that trailing space characters are
    ignored.</dd>
</dl>
<p class="Pp">In addition, <span class="Li">&quot;DBD::SQLite&quot;</span>
    automatically installs the following collation sequences :</p>
<dl class="Bl-tag">
  <dt id="perl"><a class="permalink" href="#perl"><b>perl</b></a></dt>
  <dd>corresponds to the Perl <span class="Li">&quot;cmp&quot;</span>
    operator</dd>
  <dt id="perllocale"><a class="permalink" href="#perllocale"><b>perllocale</b></a></dt>
  <dd>Perl <span class="Li">&quot;cmp&quot;</span> operator, in a context where
      <span class="Li">&quot;use locale&quot;</span> is activated.</dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="Usage"><a class="permalink" href="#Usage">Usage</a></h2>
<p class="Pp">You can write for example</p>
<p class="Pp"></p>
<pre>  CREATE TABLE foo(
      txt1 COLLATE perl,
      txt2 COLLATE perllocale,
      txt3 COLLATE nocase
  )
</pre>
<p class="Pp">or</p>
<p class="Pp"></p>
<pre>  SELECT * FROM foo ORDER BY name COLLATE perllocale
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="Unicode_handling"><a class="permalink" href="#Unicode_handling">Unicode
  handling</a></h2>
<p class="Pp">If the attribute
    <span class="Li">&quot;$dbh-&gt;{sqlite_unicode}&quot;</span> is set,
    strings coming from the database and passed to the collation function will
    be properly tagged with the utf8 flag; but this only works if the
    <span class="Li">&quot;sqlite_unicode&quot;</span> attribute is set
    <b>before</b> the first call to a perl collation sequence . The recommended
    way to activate unicode is to set the parameter at connection time :</p>
<p class="Pp"></p>
<pre>  my $dbh = DBI-&gt;connect(
      &quot;dbi:SQLite:dbname=foo&quot;, &quot;&quot;, &quot;&quot;,
      {
          RaiseError     =&gt; 1,
          sqlite_unicode =&gt; 1,
      }
  );
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="Adding_user-defined_collations"><a class="permalink" href="#Adding_user-defined_collations">Adding
  user-defined collations</a></h2>
<p class="Pp">The native SQLite API for adding user-defined collations is
    exposed through methods &quot;sqlite_create_collation&quot; and
    &quot;sqlite_collation_needed&quot;.</p>
<p class="Pp">To avoid calling these functions every time a
    <span class="Li">$dbh</span> handle is created,
    <span class="Li">&quot;DBD::SQLite&quot;</span> offers a simpler interface
    through the <span class="Li">%DBD::SQLite::COLLATION</span> hash : just
    insert your own collation functions in that hash, and whenever an unknown
    collation name is encountered in SQL, the appropriate collation function
    will be loaded on demand from the hash. For example, here is a way to sort
    text values regardless of their accented characters :</p>
<p class="Pp"></p>
<pre>  use DBD::SQLite;
  $DBD::SQLite::COLLATION{no_accents} = sub {
    my ( $a, $b ) = map lc, @_;
    tr[&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;]
      [aaaaaacdeeeeiiiinoooooouuuuy] for $a, $b;
    $a cmp $b;
  };
  my $dbh  = DBI-&gt;connect(&quot;dbi:SQLite:dbname=dbfile&quot;);
  my $sql  = &quot;SELECT ... FROM ... ORDER BY ... COLLATE no_accents&quot;);
  my $rows = $dbh-&gt;selectall_arrayref($sql);
</pre>
<p class="Pp">The builtin <span class="Li">&quot;perl&quot;</span> or
    <span class="Li">&quot;perllocale&quot;</span> collations are predefined in
    that same hash.</p>
<p class="Pp">The COLLATION hash is a global registry within the current
    process; hence there is a risk of undesired side-effects. Therefore, to
    prevent action at distance, the hash is implemented as a
    &quot;write-only&quot; hash, that will happily accept new entries, but will
    raise an exception if any attempt is made to override or delete a existing
    entry (including the builtin <span class="Li">&quot;perl&quot;</span> and
    <span class="Li">&quot;perllocale&quot;</span>).</p>
<p class="Pp">If you really, really need to change or delete an entry, you can
    always grab the tied object underneath
    <span class="Li">%DBD::SQLite::COLLATION</span> --- but don't do that unless
    you really know what you are doing. Also observe that changes in the global
    hash will not modify existing collations in existing database handles: it
    will only affect new <i>requests</i> for collations. In other words, if you
    want to change the behaviour of a collation within an existing
    <span class="Li">$dbh</span>, you need to call the
    &quot;create_collation&quot; method directly.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="FULLTEXT_SEARCH"><a class="permalink" href="#FULLTEXT_SEARCH">FULLTEXT
  SEARCH</a></h1>
<p class="Pp">SQLite is bundled with an extension module for full-text indexing.
    Tables with this feature enabled can be efficiently queried to find rows
    that contain one or more instances of some specified words, in any column,
    even if the table contains many large documents.</p>
<p class="Pp">Explanations for using this feature are provided in a separate
    document: see DBD::SQLite::Fulltext_search.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="R*_TREE_SUPPORT"><a class="permalink" href="#R*_TREE_SUPPORT">R*
  TREE SUPPORT</a></h1>
<p class="Pp">The RTREE extension module within SQLite adds support for creating
    a R-Tree, a special index for range and multidimensional queries. This
    allows users to create tables that can be loaded with (as an example)
    geospatial data such as latitude/longitude coordinates for buildings within
    a city :</p>
<p class="Pp"></p>
<pre>  CREATE VIRTUAL TABLE city_buildings USING rtree(
     id,               -- Integer primary key
     minLong, maxLong, -- Minimum and maximum longitude
     minLat, maxLat    -- Minimum and maximum latitude
  );
</pre>
<p class="Pp">then query which buildings overlap or are contained within a
    specified region:</p>
<p class="Pp"></p>
<pre>  # IDs that are contained within query coordinates
  my $contained_sql = &lt;&lt;&quot;&quot;;
  SELECT id FROM city_buildings
     WHERE  minLong &gt;= ? AND maxLong &lt;= ?
     AND    minLat  &gt;= ? AND maxLat  &lt;= ?
  
  # ... and those that overlap query coordinates
  my $overlap_sql = &lt;&lt;&quot;&quot;;
  SELECT id FROM city_buildings
     WHERE    maxLong &gt;= ? AND minLong &lt;= ?
     AND      maxLat  &gt;= ? AND minLat  &lt;= ?
  
  my $contained = $dbh-&gt;selectcol_arrayref($contained_sql,undef,
                        $minLong, $maxLong, $minLat, $maxLat);
  
  my $overlapping = $dbh-&gt;selectcol_arrayref($overlap_sql,undef,
                        $minLong, $maxLong, $minLat, $maxLat);
</pre>
<p class="Pp">For more detail, please see the SQLite R-Tree page
    (&lt;https://www.sqlite.org/rtree.html&gt;). Note that custom R-Tree queries
    using callbacks, as mentioned in the prior link, have not been implemented
    yet.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="VIRTUAL_TABLES_IMPLEMENTED_IN_PERL"><a class="permalink" href="#VIRTUAL_TABLES_IMPLEMENTED_IN_PERL">VIRTUAL
  TABLES IMPLEMENTED IN PERL</a></h1>
<p class="Pp">SQLite has a concept of &quot;virtual tables&quot; which look like
    regular tables but are implemented internally through specific functions.
    The fulltext or R* tree features described in the previous chapters are
    examples of such virtual tables, implemented in C code.</p>
<p class="Pp"><span class="Li">&quot;DBD::SQLite&quot;</span> also supports
    virtual tables implemented in <i>Perl code</i>: see
    DBD::SQLite::VirtualTable for using or implementing such virtual tables.
    These can have many interesting uses for joining regular DBMS data with some
    other kind of data within your Perl programs. Bundled with the present
    distribution are :</p>
<ul class="Bl-bullet">
  <li>DBD::SQLite::VirtualTable::FileContent : implements a virtual column that
      exposes file contents. This is especially useful in conjunction with a
      fulltext index; see DBD::SQLite::Fulltext_search.</li>
  <li>DBD::SQLite::VirtualTable::PerlData : binds to a Perl array within the
      Perl program. This can be used for simple import/export operations, for
      debugging purposes, for joining data from different sources, etc.</li>
</ul>
<p class="Pp">Other Perl virtual tables may also be published separately on
    CPAN.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="FOR_DBD::SQLITE_EXTENSION_AUTHORS"><a class="permalink" href="#FOR_DBD::SQLITE_EXTENSION_AUTHORS">FOR
  DBD::SQLITE EXTENSION AUTHORS</a></h1>
<p class="Pp">Since 1.30_01, you can retrieve the bundled SQLite C source and/or
    header like this:</p>
<p class="Pp"></p>
<pre>  use File::ShareDir 'dist_dir';
  use File::Spec::Functions 'catfile';
  
  # the whole sqlite3.h header
  my $sqlite3_h = catfile(dist_dir('DBD-SQLite'), 'sqlite3.h');
  
  # or only a particular header, amalgamated in sqlite3.c
  my $what_i_want = 'parse.h';
  my $sqlite3_c = catfile(dist_dir('DBD-SQLite'), 'sqlite3.c');
  open my $fh, '&lt;', $sqlite3_c or die $!;
  my $code = do { local $/; &lt;$fh&gt; };
  my ($parse_h) = $code =~ m{(
    /\*+[ ]Begin[ ]file[ ]$what_i_want[ ]\*+
    .+?
    /\*+[ ]End[ ]of[ ]$what_i_want[ ]\*+/
  )}sx;
  open my $out, '&gt;', $what_i_want or die $!;
  print $out $parse_h;
  close $out;
</pre>
<p class="Pp">You usually want to use this in your extension's
    <span class="Li">&quot;Makefile.PL&quot;</span>, and you may want to add
    DBD::SQLite to your extension's
    <span class="Li">&quot;CONFIGURE_REQUIRES&quot;</span> to ensure your
    extension users use the same C source/header they use to build DBD::SQLite
    itself (instead of the ones installed in their system).</p>
</section>
<section class="Sh">
<h1 class="Sh" id="TO_DO"><a class="permalink" href="#TO_DO">TO DO</a></h1>
<p class="Pp">The following items remain to be done.</p>
<section class="Ss">
<h2 class="Ss" id="Leak_Detection"><a class="permalink" href="#Leak_Detection">Leak
  Detection</a></h2>
<p class="Pp">Implement one or more leak detection tests that only run during
    AUTOMATED_TESTING and RELEASE_TESTING and validate that none of the C code
    we work with leaks.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Stream_"><a class="permalink" href="#Stream_">Stream API for
  Blobs</a></h2>
<p class="Pp">Reading/writing into blobs using
    <span class="Li">&quot;sqlite2_blob_open&quot;</span> /
    <span class="Li">&quot;sqlite2_blob_close&quot;</span>.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Support_for_custom_callbacks_for_R"><a class="permalink" href="#Support_for_custom_callbacks_for_R">Support
  for custom callbacks for R-Tree queries</a></h2>
<p class="Pp">Custom queries of a R-Tree index using a callback are possible
    with the SQLite C API (&lt;https://www.sqlite.org/rtree.html&gt;), so one
    could potentially use a callback that narrowed the result set down based on
    a specific need, such as querying for overlapping circles.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="SUPPORT"><a class="permalink" href="#SUPPORT">SUPPORT</a></h1>
<p class="Pp">Bugs should be reported to GitHub issues:</p>
<p class="Pp">&lt;https://github.com/DBD-SQLite/DBD-SQLite/issues&gt;</p>
<p class="Pp">or via RT if you prefer:</p>
<p class="Pp">&lt;http://rt.cpan.org/NoAuth/ReportBug.html?Queue=DBD-SQLite&gt;</p>
<p class="Pp">Note that bugs of bundled SQLite library (i.e. bugs in
    <span class="Li">&quot;sqlite3.[ch]&quot;</span>) should be reported to the
    SQLite developers at sqlite.org via their bug tracker or via their mailing
    list.</p>
<p class="Pp">The master repository is on GitHub:</p>
<p class="Pp">&lt;https://github.com/DBD-SQLite/DBD-SQLite&gt;.</p>
<p class="Pp">We also have a mailing list:</p>
<p class="Pp">&lt;http://lists.scsys.co.uk/cgi-bin/mailman/listinfo/dbd-sqlite&gt;</p>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHORS"><a class="permalink" href="#AUTHORS">AUTHORS</a></h1>
<p class="Pp">Matt Sergeant &lt;matt@sergeant.org&gt;</p>
<p class="Pp">Francis J. Lacoste &lt;flacoste@logreport.org&gt;</p>
<p class="Pp">Wolfgang Sourdeau &lt;wolfgang@logreport.org&gt;</p>
<p class="Pp">Adam Kennedy &lt;adamk@cpan.org&gt;</p>
<p class="Pp">Max Maischein &lt;corion@cpan.org&gt;</p>
<p class="Pp">Laurent Dami &lt;dami@cpan.org&gt;</p>
<p class="Pp">Kenichi Ishigaki &lt;ishigaki@cpan.org&gt;</p>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT"><a class="permalink" href="#COPYRIGHT">COPYRIGHT</a></h1>
<p class="Pp">The bundled SQLite code in this distribution is Public Domain.</p>
<p class="Pp">DBD::SQLite is copyright 2002 - 2007 Matt Sergeant.</p>
<p class="Pp">Some parts copyright 2008 Francis J. Lacoste.</p>
<p class="Pp">Some parts copyright 2008 Wolfgang Sourdeau.</p>
<p class="Pp">Some parts copyright 2008 - 2013 Adam Kennedy.</p>
<p class="Pp">Some parts copyright 2009 - 2013 Kenichi Ishigaki.</p>
<p class="Pp">Some parts derived from DBD::SQLite::Amalgamation copyright 2008
    Audrey Tang.</p>
<p class="Pp">This program is free software; you can redistribute it and/or
    modify it under the same terms as Perl itself.</p>
<p class="Pp">The full text of the license can be found in the LICENSE file
    included with this module.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2019-08-12</td>
    <td class="foot-os">perl v5.30.2</td>
  </tr>
</table>
</body>
</html>
