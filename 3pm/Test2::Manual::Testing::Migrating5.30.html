<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>Test2::Manual::Testing::Migrating(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Test2::Manual::Testing::Migrating(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">Test2::Manual::Testing::Migrating(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">Test2::Manual::Testing::Migrating - How to migrate existing tests
    from Test::More to Test2.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">This tutorial covers the conversion of an existing test. This
    tutorial assumes you have a test written using Test::More.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="LEGACY_TEST"><a class="permalink" href="#LEGACY_TEST">LEGACY
  TEST</a></h1>
<p class="Pp">This tutorial will be converting this example test one section at
    a time:</p>
<p class="Pp"><span class="Li">&quot;t/example.t&quot;</span>:</p>
<p class="Pp"></p>
<pre>    #####################
    # Boilerplate
    use strict;
    use warnings;
    use Test::More tests =&gt; 14;
    use_ok 'Scalar::Util';
    require_ok 'Exporter';
    #####################
    # Simple assertions (no changes)
    ok(1, &quot;pass&quot;);
    is(&quot;apple&quot;, &quot;apple&quot;, &quot;Simple string compare&quot;);
    like(&quot;foo bar baz&quot;, qr/bar/, &quot;Regex match&quot;);
    #####################
    # Todo
    {
        local $TODO = &quot;These are todo&quot;;
        ok(0, &quot;oops&quot;);
    }
    #####################
    # Deep comparisons
    is_deeply([1, 2, 3], [1, 2, 3], &quot;Deep comparison&quot;);
    #####################
    # Comparing references
    my $ref = [1];
    is($ref, $ref, &quot;Check that we have the same ref both times&quot;);
    #####################
    # Things that are gone
    ok(eq_array([1], [1]), &quot;array comparison&quot;);
    ok(eq_hash({a =&gt; 1}, {a =&gt; 1}), &quot;hash comparison&quot;);
    ok(eq_set([1, 3, 2], [1, 2, 3]), &quot;set comparison&quot;);
    note explain([1, 2, 3]);
    {
        package THING;
        sub new { bless({}, shift) }
    }
    my $thing = new_ok('THING');
    #####################
    # Tools that changed
    isa_ok($thing, 'THING', '$thing');
    can_ok(__PACKAGE__, qw/ok is/);
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="BOILERPLATE"><a class="permalink" href="#BOILERPLATE">BOILERPLATE</a></h1>
<p class="Pp">BEFORE:</p>
<p class="Pp"></p>
<pre>    use strict;
    use warnings;
    use Test::More tests =&gt; 14;
    use_ok 'Scalar::Util';
    require_ok 'Exporter';
</pre>
<p class="Pp">AFTER:</p>
<p class="Pp"></p>
<pre>    use Test2::V0;
    plan(11);
    use Scalar::Util;
    require Exporter;
</pre>
<dl class="Bl-tag">
  <dt id="Replace"><a class="permalink" href="#Replace">Replace Test::More with
    Test2::V0</a></dt>
  <dd>Test2::V0 is the recommended bundle. In a full migration you will want to
      replace Test::More with the Test2::V0 bundle.
    <p class="Pp"><b>Note:</b> You should always double check the latest Test2
        to see if there is a new recommended bundle. When writing a new test you
        should always use the newest Test::V# module. Higher numbers are newer
        version.</p>
  </dd>
  <dt id="Stop"><a class="permalink" href="#Stop">Stop using
    <b>use_ok()</b></a></dt>
  <dd><span class="Li">&quot;use_ok()&quot;</span> has been removed. a
      <span class="Li">&quot;use MODULE&quot;</span> statement will throw an
      exception on failure anyway preventing the test from passing.
    <p class="Pp">If you <i>REALLY</i> want/need to assert that the file loaded
        you can use the ok module:</p>
    <p class="Pp"></p>
    <pre>    use ok 'Scalar::Util';
    </pre>
    <p class="Pp">The main difference here is that there is a space instead of
        an underscore.</p>
  </dd>
  <dt id="Stop~2"><a class="permalink" href="#Stop~2">Stop using
    <b>require_ok()</b></a></dt>
  <dd><span class="Li">&quot;require_ok&quot;</span> has been removed just like
      <span class="Li">&quot;use_ok&quot;</span>. There is no ok module
      equivalent here. Just use
    <span class="Li">&quot;require&quot;</span>.</dd>
  <dt id="Remove"><a class="permalink" href="#Remove">Remove strict/warnings
    (optional)</a></dt>
  <dd>The Test2::V0 bundle turns strict and warnings on for you.</dd>
  <dt id="Change"><a class="permalink" href="#Change">Change where the plan is
    set</a></dt>
  <dd>Test2 does not allow you to set the plan at import. In the old code you
      would pass <span class="Li">&quot;tests =&gt; 11&quot;</span> as an import
      argument. In Test2 you either need to use the
      <span class="Li">&quot;plan()&quot;</span> function to set the plan, or
      use <span class="Li">&quot;done_testing()&quot;</span> at the end of the
      test.
    <p class="Pp">If your test already uses
        <span class="Li">&quot;done_testing()&quot;</span> you can keep that and
        no plan changes are necessary.</p>
    <p class="Pp"><b>Note:</b> We are also changing the plan from 14 to 11, that
        is because we dropped <span class="Li">&quot;use_ok&quot;</span>,
        <span class="Li">&quot;require_ok&quot;</span>, and we will be dropping
        one more later on. This is why
        <span class="Li">&quot;done_testing()&quot;</span> is recommended over a
        set plan.</p>
  </dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="SIMPLE_ASSERTIONS"><a class="permalink" href="#SIMPLE_ASSERTIONS">SIMPLE
  ASSERTIONS</a></h1>
<p class="Pp">The vast majority of assertions will not need any changes:</p>
<p class="Pp"></p>
<pre>    #####################
    # Simple assertions (no changes)
    ok(1, &quot;pass&quot;);
    is(&quot;apple&quot;, &quot;apple&quot;, &quot;Simple string compare&quot;);
    like(&quot;foo bar baz&quot;, qr/bar/, &quot;Regex match&quot;);
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="TODO"><a class="permalink" href="#TODO">TODO</a></h1>
<pre>    {
        local $TODO = &quot;These are todo&quot;;
        ok(0, &quot;oops&quot;);
    }
</pre>
<p class="Pp">The <span class="Li">$TODO</span> package variable is gone. You
    now have a <span class="Li">&quot;todo()&quot;</span> function.</p>
<p class="Pp">There are 2 ways this can be used:</p>
<dl class="Bl-tag">
  <dt id="todo"><a class="permalink" href="#todo">todo $reason =&gt; sub { ...
    }</a></dt>
  <dd>
    <pre>    todo &quot;These are todo&quot; =&gt; sub {
        ok(0, &quot;oops&quot;);
    };
    </pre>
    <p class="Pp">This is the cleanest way to do a todo. This will make all
        assertions inside the codeblock into TODO assertions.</p>
  </dd>
  <dt>{ my $TODO = todo $reason; ... }</dt>
  <dd>
    <pre>    {
        my $TODO = todo &quot;These are todo&quot;;
        ok(0, &quot;oops&quot;);
    }
    </pre>
    <p class="Pp">This is a system that emulates the old way. Instead of
        modifying a global <span class="Li">$TODO</span> variable you create a
        todo object with the <span class="Li">&quot;todo()&quot;</span> function
        and assign it to a lexical variable. Once the todo object falls out of
        scope the TODO ends.</p>
  </dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="DEEP_COMPARISONS"><a class="permalink" href="#DEEP_COMPARISONS">DEEP
  COMPARISONS</a></h1>
<pre>    is_deeply([1, 2, 3], [1, 2, 3], &quot;Deep comparison&quot;);
</pre>
<p class="Pp">Deep comparisons are easy, simply replace
    <span class="Li">&quot;is_deeply()&quot;</span> with
    <span class="Li">&quot;is()&quot;</span>.</p>
<p class="Pp"></p>
<pre>    is([1, 2, 3], [1, 2, 3], &quot;Deep comparison&quot;);
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="COMPARING_REFERENCES"><a class="permalink" href="#COMPARING_REFERENCES">COMPARING
  REFERENCES</a></h1>
<pre>    my $ref = [1];
    is($ref, $ref, &quot;Check that we have the same ref both times&quot;);
</pre>
<p class="Pp">The <span class="Li">&quot;is()&quot;</span> function provided by
    Test::More forces both arguments into strings, which makes this a comparison
    of the reference addresses. Test2's <span class="Li">&quot;is()&quot;</span>
    function is a deep comparison, so this will still pass, but fails to
    actually test what we want (that both references are the same exact ref, not
    just identical structures.)</p>
<p class="Pp">We now have the <span class="Li">&quot;ref_is()&quot;</span>
    function that does what we really want, it ensures both references are the
    same reference. This function does the job better than the original, which
    could be thrown off by string overloading.</p>
<p class="Pp"></p>
<pre>    my $ref = [1];
    ref_is($ref, $ref, &quot;Check that we have the same ref both times&quot;);
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="TOOLS_THAT_ARE_GONE"><a class="permalink" href="#TOOLS_THAT_ARE_GONE">TOOLS
  THAT ARE GONE</a></h1>
<pre>    ok(eq_array([1], [1]), &quot;array comparison&quot;);
    ok(eq_hash({a =&gt; 1}, {a =&gt; 1}), &quot;hash comparison&quot;);
    ok(eq_set([1, 3, 2], [1, 2, 3]), &quot;set comparison&quot;);
    note explain([1, 2, 3]);
    {
        package THING;
        sub new { bless({}, shift) }
    }
    my $thing = new_ok('THING');
</pre>
<p class="Pp"><span class="Li">&quot;eq_array&quot;</span>,
    <span class="Li">&quot;eq_hash&quot;</span> and
    <span class="Li">&quot;eq_set&quot;</span> have been considered deprecated
    for a very long time, Test2 does not provide them at all. Instead you can
    just use <span class="Li">&quot;is()&quot;</span>:</p>
<p class="Pp"></p>
<pre>    is([1], [1], &quot;array comparison&quot;);
    is({a =&gt; 1}, {a =&gt; 1}, &quot;hash comparison&quot;);
</pre>
<p class="Pp"><span class="Li">&quot;eq_set&quot;</span> is a tad more
    complicated, see Test2::Tools::Compare for an explanation:</p>
<p class="Pp"></p>
<pre>    is([1, 3, 2], bag { item 1; item 2; item 3; end }, &quot;set comparison&quot;);
</pre>
<p class="Pp"><span class="Li">&quot;explain()&quot;</span> has a rocky history.
    There have been arguments about how it should work. Test2 decided to simply
    not include <span class="Li">&quot;explain()&quot;</span> to avoid the
    arguments. You can instead directly use Data::Dumper:</p>
<p class="Pp"></p>
<pre>    use Data::Dumper;
    note Dumper([1, 2, 3]);
</pre>
<p class="Pp"><span class="Li">&quot;new_ok()&quot;</span> is gone. The
    implementation was complicated, and did not add much value:</p>
<p class="Pp"></p>
<pre>    {
        package THING;
        sub new { bless({}, shift) }
    }
    my $thing = THING-&gt;new;
    ok($thing, &quot;made a new thing&quot;);
</pre>
<p class="Pp">The complete section after the conversion is:</p>
<p class="Pp"></p>
<pre>    is([1], [1], &quot;array comparison&quot;);
    is({a =&gt; 1}, {a =&gt; 1}, &quot;hash comparison&quot;);
    is([1, 3, 2], bag { item 1; item 2; item 3; end }, &quot;set comparison&quot;);
    use Data::Dumper;
    note Dumper([1, 2, 3]);
    {
        package THING;
        sub new { bless({}, shift) }
    }
    my $thing = THING-&gt;new;
    ok($thing, &quot;made a new thing&quot;);
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="TOOLS_THAT_HAVE_CHANGED"><a class="permalink" href="#TOOLS_THAT_HAVE_CHANGED">TOOLS
  THAT HAVE CHANGED</a></h1>
<pre>    isa_ok($thing, 'THING', '$thing');
    can_ok(__PACKAGE__, qw/ok is/);
</pre>
<p class="Pp">In Test::More these functions are very confusing, and most people
    use them wrong!</p>
<p class="Pp"><span class="Li">&quot;isa_ok()&quot;</span> from Test::More takes
    a thing, a class/reftype to check, and then uses the third argument as an
    alternative display name for the first argument (NOT a test name!).</p>
<p class="Pp"><span class="Li">&quot;can_ok()&quot;</span> from Test::More is
    not consistent with <span class="Li">&quot;isa_ok&quot;</span> as all
    arguments after the first are subroutine names.</p>
<p class="Pp">Test2 fixes this by making both functions consistent and
  obvious:</p>
<p class="Pp"></p>
<pre>    isa_ok($thing, ['THING'], 'got a THING');
    can_ok(__PACKAGE__, [qw/ok is/], &quot;have expected subs&quot;);
</pre>
<p class="Pp">You will note that both functions take a thing, an arrayref as the
    second argument, then a test name as the third argument.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="FINAL_VERSION"><a class="permalink" href="#FINAL_VERSION">FINAL
  VERSION</a></h1>
<pre>    #####################
    # Boilerplate
    use Test2::V0;
    plan(11);
    use Scalar::Util;
    require Exporter;
    #####################
    # Simple assertions (no changes)
    ok(1, &quot;pass&quot;);
    is(&quot;apple&quot;, &quot;apple&quot;, &quot;Simple string compare&quot;);
    like(&quot;foo bar baz&quot;, qr/bar/, &quot;Regex match&quot;);
    #####################
    # Todo
    todo &quot;These are todo&quot; =&gt; sub {
        ok(0, &quot;oops&quot;);
    };
    #####################
    # Deep comparisons
    is([1, 2, 3], [1, 2, 3], &quot;Deep comparison&quot;);
    #####################
    # Comparing references
    my $ref = [1];
    ref_is($ref, $ref, &quot;Check that we have the same ref both times&quot;);
    #####################
    # Things that are gone
    is([1], [1], &quot;array comparison&quot;);
    is({a =&gt; 1}, {a =&gt; 1}, &quot;hash comparison&quot;);
    is([1, 3, 2], bag { item 1; item 2; item 3; end }, &quot;set comparison&quot;);
    use Data::Dumper;
    note Dumper([1, 2, 3]);
    {
        package THING;
        sub new { bless({}, shift) }
    }
    my $thing = THING-&gt;new;
    #####################
    # Tools that changed
    isa_ok($thing, ['THING'], 'got a THING');
    can_ok(__PACKAGE__, [qw/ok is/], &quot;have expected subs&quot;);
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp">Test2::Manual - Primary index of the manual.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SOURCE"><a class="permalink" href="#SOURCE">SOURCE</a></h1>
<p class="Pp">The source code repository for Test2-Manual can be found at
    <i>https://github.com/Test-More/Test2-Suite/</i>.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="MAINTAINERS"><a class="permalink" href="#MAINTAINERS">MAINTAINERS</a></h1>
<dl class="Bl-tag">
  <dt id="Chad"><a class="permalink" href="#Chad">Chad Granum
    &lt;exodist@cpan.org&gt;</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHORS"><a class="permalink" href="#AUTHORS">AUTHORS</a></h1>
<dl class="Bl-tag">
  <dt id="Chad~2"><a class="permalink" href="#Chad~2">Chad Granum
    &lt;exodist@cpan.org&gt;</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT"><a class="permalink" href="#COPYRIGHT">COPYRIGHT</a></h1>
<p class="Pp">Copyright 2018 Chad Granum &lt;exodist@cpan.org&gt;.</p>
<p class="Pp">This program is free software; you can redistribute it and/or
    modify it under the same terms as Perl itself.</p>
<p class="Pp">See <i>http://dev.perl.org/licenses/</i></p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2020-10-22</td>
    <td class="foot-os">perl v5.30.3</td>
  </tr>
</table>
</body>
</html>
