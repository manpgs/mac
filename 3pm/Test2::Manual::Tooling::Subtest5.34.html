<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.14 (Pod::Simple 3.42)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>Test2::Manual::Tooling::Subtest(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Test2::Manual::Tooling::Subtest(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">Test2::Manual::Tooling::Subtest(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">Test2::Manual::Tooling::Subtest - How to implement a tool that
    makes use of subtests.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">Subtests are a nice way of making related events visually, and
    architecturally distinct.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="WHICH_TYPE_OF_SUBTEST_DO_I_NEED?"><a class="permalink" href="#WHICH_TYPE_OF_SUBTEST_DO_I_NEED?">WHICH
  TYPE OF SUBTEST DO I NEED?</a></h1>
<p class="Pp">There are 2 types of subtest. The first type is subtests with
    user-supplied coderefs, such as the
    <span class="Li">&quot;subtest()&quot;</span> function itself. The second
    type is subtest that do not have any user supplied coderefs.</p>
<p class="Pp">So which type do you need? The answer to that is simple, if you
    are going to let the user define the subtest with their own codeblock, you
    have the first type, otherwise you have the second.</p>
<p class="Pp">In either case, you will still need use the same API function:
    <span class="Li">&quot;Test2::API::run_subtest&quot;</span>.</p>
<section class="Ss">
<h2 class="Ss">SUBTEST WITH USER SUPPLIED CODEREF</h2>
<p class="Pp">This example will emulate the
    <span class="Li">&quot;subtest&quot;</span> function.</p>
<p class="Pp"></p>
<pre>    use Test2::API qw/context run_subtest/;
    sub my_subtest {
        my ($name, $code) = @_;
        # Like any other tool, you need to acquire a context, if you do not then
        # things will not report the correct file and line number.
        my $ctx = context();
        my $bool = run_subtest($name, $code);
        $ctx-&gt;release;
        return $bool;
    }
</pre>
<p class="Pp">This looks incredibly simple... and it is.
    <span class="Li">&quot;run_subtest()&quot;</span> does all the hard work for
    you. This will issue an Test2::Event::Subtest event with the results of the
    subtest. The subtest event itself will report to the proper file and line
    number due to the context you acquired (even though it does not <i>look</i>
    like you used the context.</p>
<p class="Pp"><span class="Li">&quot;run_subtest()&quot;</span> can take
    additional arguments:</p>
<p class="Pp"></p>
<pre>    run_subtest($name, $code, \%params, @args);
</pre>
<dl class="Bl-tag">
  <dt>@args</dt>
  <dd>This allows you to pass arguments into the codeblock that gets run.</dd>
  <dt>\%params</dt>
  <dd>This is a hashref of parameters. Currently there are 3 possible
      parameters:</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt id="buffered"><a class="permalink" href="#buffered">buffered =&gt;
    $bool</a></dt>
  <dd>This will turn the subtest into the new style buffered subtest. This type
      of subtest is recommended, but not default.</dd>
  <dt id="inherit_trace"><a class="permalink" href="#inherit_trace">inherit_trace
    =&gt; $bool</a></dt>
  <dd>This is used for tool-side coderefs.</dd>
  <dt id="no_fork"><a class="permalink" href="#no_fork">no_fork =&gt;
    $bool</a></dt>
  <dd>react to forking/threading inside the subtest itself. In general you are
      unlikely to need/want this parameter.</dd>
</dl>
</div>
<div class="Bd-indent"></div>
</section>
<section class="Ss">
<h2 class="Ss">SUBTEST WITH TOOL-SIDE CODEREF</h2>
<p class="Pp">This is particularly useful if you want to turn a tool that wraps
    other tools into a subtest. For this we will be using the tool we created in
    Test2::Manual::Tooling::Nesting.</p>
<p class="Pp"></p>
<pre>    use Test2::API qw/context run_subtest/;
    sub check_class {
        my $class = shift;
        my $ctx = context();
        my $code = sub {
            my $obj = $class-&gt;new;
            is($obj-&gt;foo, 'foo', &quot;got foo&quot;);
            is($obj-&gt;bar, 'bar', &quot;got bar&quot;);
        };
        my $bool = run_subtest($class, $code, {buffered =&gt; 1, inherit_trace =&gt; 1});
        $ctx-&gt;release;
        return $bool;
    }
</pre>
<p class="Pp">The <span class="Li">&quot;run_subtest()&quot;</span> function
    does all the heavy lifting for us. All we need to do is give the function a
    name, a coderef to run, and the <span class="Li">&quot;inherit_trace =&gt;
    1&quot;</span> parameter. The <span class="Li">&quot;buffered =&gt;
    1&quot;</span> parameter is optional, but recommended.</p>
<p class="Pp">The <span class="Li">&quot;inherit_trace&quot;</span> parameter
    tells the subtest tool that the contexts acquired inside the nested tools
    should use the same trace as the subtest itself. For user-supplied
    codeblocks you do not use inherit_trace because you want errors to report to
    the user-supplied file+line.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp">Test2::Manual - Primary index of the manual.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SOURCE"><a class="permalink" href="#SOURCE">SOURCE</a></h1>
<p class="Pp">The source code repository for Test2-Manual can be found at
    <i>https://github.com/Test-More/Test2-Suite/</i>.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="MAINTAINERS"><a class="permalink" href="#MAINTAINERS">MAINTAINERS</a></h1>
<dl class="Bl-tag">
  <dt id="Chad"><a class="permalink" href="#Chad">Chad Granum
    &lt;exodist@cpan.org&gt;</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHORS"><a class="permalink" href="#AUTHORS">AUTHORS</a></h1>
<dl class="Bl-tag">
  <dt id="Chad~2"><a class="permalink" href="#Chad~2">Chad Granum
    &lt;exodist@cpan.org&gt;</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT"><a class="permalink" href="#COPYRIGHT">COPYRIGHT</a></h1>
<p class="Pp">Copyright 2018 Chad Granum &lt;exodist@cpan.org&gt;.</p>
<p class="Pp">This program is free software; you can redistribute it and/or
    modify it under the same terms as Perl itself.</p>
<p class="Pp">See <i>http://dev.perl.org/licenses/</i></p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2020-10-22</td>
    <td class="foot-os">perl v5.34.0</td>
  </tr>
</table>
</body>
</html>
