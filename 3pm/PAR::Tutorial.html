<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>
  <meta charset="utf-8"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>PAR::Tutorial(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">PAR::Tutorial(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">PAR::Tutorial(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">PAR::Tutorial - Cross-Platform Packaging and Deployment with
  PAR</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<p class="Pp">This is a tutorial on PAR, first appeared at the 7th Perl
    Conference. The HTML version of this tutorial is available online as
    &lt;http://search.cpan.org/perldoc?PAR::Tutorial&gt;</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<section class="Ss">
<h2 class="Ss" id="On_Deploying_Perl_Applications"><a class="permalink" href="#On_Deploying_Perl_Applications">On
  Deploying Perl Applications</a></h2>
<pre>
 % sshnuke.pl 10.2.2.2 -rootpw=&quot;Z1ON0101&quot;
 Perl v5.6.1 required--this is only v5.6.0, stopped at sshnuke.pl line 1.
 BEGIN failed--compilation aborted at sshnuke.pl line 1.
</pre>
<ul class="Bl-bullet">
  <li>Q: &quot;Help! I can't run your program!&quot;</li>
  <li>A1: Install Perl &amp; <span class="Li">&quot;perl -MCPAN
      -e'install(...)'&quot;</span></li>
</ul>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>How do we know which modules are needed?</li>
  <li>New versions of CPAN modules may break
      <span class="Li">&quot;sshnuke.pl&quot;</span></li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>A2: Install Perl &amp; <span class="Li">&quot;tar zxf
      my_perllib.tgz&quot;</span></dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Possibly overwriting existing modules; not cross-platform at all</dd>
</dl>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>A3: Use the executable generated by <span class="Li">&quot;perlcc
      sshnuke.pl&quot;</span></dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Impossible to debug; <span class="Li">&quot;perlcc&quot;</span> usually
      does not work anyway</dd>
</dl>
</div>
<div class="Bd-indent"></div>
</section>
<section class="Ss">
<h2 class="Ss">PAR, the Perl Archive Toolkit</h2>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Do what JAR (Java Archive) does for Perl</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>Aggregates modules, scripts and other files into a Zip file</li>
  <li>Easy to generate, update and extract</li>
  <li>Version consistency: solves forward-compatibility problems</li>
  <li>Developed by community:
    <span class="Li">&quot;par@perl.org&quot;</span></li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>PAR files can be packed into self-contained scripts</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>Automatically scans perl script for dependencies</li>
  <li>Bundles all necessary 3rd-party modules with it</li>
  <li>Requires only core Perl to run on the target machine</li>
  <li>PAR also comes with <span class="Li">&quot;pp&quot;</span>, the Perl
      Packager:
    <p class="Pp"></p>
    <pre>
 % pp -o sshnuke.exe sshnuke.pl # stand-alone executable!
    </pre>
  </li>
</ul>
</div>
<div class="Bd-indent"></div>
</section>
<section class="Ss">
<h2 class="Ss" id="Simple_Packaging"><a class="permalink" href="#Simple_Packaging">Simple
  Packaging</a></h2>
<ul class="Bl-bullet">
  <li>PAR files are just Zip files with modules in it</li>
  <li>Any Zip tools can generate them:
    <p class="Pp"></p>
    <pre>
 % zip foo.par Hello.pm World.pm        # pack two modules
 % zip -r bar.par lib/          # grab all modules in lib/
    </pre>
  </li>
  <li>To load modules from PAR files:
    <p class="Pp"></p>
    <pre>
 use PAR;
 use lib &quot;foo.par&quot;;             # the .par part is optional
 use Hello;
    </pre>
  </li>
  <li>This also works:
    <p class="Pp"></p>
    <pre>
 use PAR &quot;/home/mylibs/*.par&quot;;  # put all of them into @INC
 use Hello;
    </pre>
  </li>
</ul>
</section>
<section class="Ss">
<h2 class="Ss">PAR Loaders</h2>
<ul class="Bl-bullet">
  <li>Use <span class="Li">&quot;par.pl&quot;</span> to run files inside a PAR
      archive:
    <p class="Pp"></p>
    <pre>
 % par.pl foo.par               # looks for 'main.pl' by default
 % par.pl foo.par test.pl       # runs script/test.pl in foo.par
    </pre>
  </li>
  <li>Same thing, with the stand-alone <span class="Li">&quot;parl&quot;</span>
      or <span class="Li">&quot;parl.exe&quot;</span>:
    <p class="Pp"></p>
    <pre>
 % parl foo.par                 # no perl or PAR.pm needed!
 % parl foo.par test.pl         # ditto
    </pre>
  </li>
  <li>The PAR loader can prepend itself to a PAR file:</li>
</ul>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li><span class="Li">&quot;-b&quot;</span> bundles non-core modules needed by
      <span class="Li">&quot;PAR.pm&quot;</span>:
    <p class="Pp"></p>
    <pre>
 % par.pl -b -O./foo.pl foo.par # self-contained script
    </pre>
  </li>
  <li><span class="Li">&quot;-B&quot;</span> bundles core modules in addition to
      <span class="Li">&quot;-b&quot;</span>:
    <p class="Pp"></p>
    <pre>
 % parl -B -O./foo.exe foo.par  # self-contained binary
    </pre>
  </li>
</ul>
</div>
<div class="Bd-indent"></div>
</section>
<section class="Ss">
<h2 class="Ss" id="Dependency_Scanning"><a class="permalink" href="#Dependency_Scanning">Dependency
  Scanning</a></h2>
<ul class="Bl-bullet">
  <li>Recursively scan dependencies with
      <span class="Li">&quot;scandeps.pl&quot;</span>:
    <p class="Pp"></p>
    <pre>
 % scandeps.pl sshnuke.pl
 # Legend: [C]ore [X]ternal [S]ubmodule [?]NotOnCPAN
 'Crypt::SSLeay'       =&gt; '0', #  X   #
 'Net::HTTP'           =&gt; '0', #      #
 'Crypt::SSLeay::X509' =&gt; '0', # S    # Crypt::SSLeay
 'Net::HTTP::Methods'  =&gt; '0', # S    # Net::HTTP
 'Compress::Zlib'      =&gt; '0', #  X   # Net::HTTP::Methods
    </pre>
  </li>
  <li>Scan an one-liner, list all involved files:
    <p class="Pp"></p>
    <pre>
 % scandeps.pl -V -e &quot;use Dynaloader;&quot;
 ...
 # auto/DynaLoader/dl_findfile.al [autoload]
 # auto/DynaLoader/extralibs.ld [autoload]
 # auto/File/Glob/Glob.bs [data]
 # auto/File/Glob/Glob.so [shared]
 ...
    </pre>
  </li>
</ul>
</section>
<section class="Ss">
<h2 class="Ss" id="Perl_Packager:__pp_"><a class="permalink" href="#Perl_Packager:__pp_">Perl
  Packager: &quot;pp&quot;</a></h2>
<ul class="Bl-bullet">
  <li>Combines scanning, zipping and loader-embedding:
    <p class="Pp"></p>
    <pre>
 % pp -o out.exe src.pl         # self-contained .exe
 % out.exe                      # runs anywhere on the same OS
    </pre>
  </li>
  <li>Bundle additional modules:
    <p class="Pp"></p>
    <pre>
 % pp -o out.exe -M CGI src.pl  # pack CGI + its dependencies, too
    </pre>
  </li>
  <li>Pack one-liners:
    <p class="Pp"></p>
    <pre>
 % pp -o out.exe -e 'print &quot;Hi!&quot;'   # turns one-liner into executable
    </pre>
  </li>
  <li>Generate PAR files instead of executables:
    <p class="Pp"></p>
    <pre>
 % pp -p src.pl                 # makes 'source.par'
 % pp -B -p src.pl              # include core modules
    </pre>
  </li>
</ul>
</section>
<section class="Ss">
<h2 class="Ss" id="How_it_works"><a class="permalink" href="#How_it_works">How
  it works</a></h2>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Command-line options are almost identical to
      <span class="Li">&quot;perlcc&quot;</span>'s</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Also supports <span class="Li">&quot;gcc&quot;</span>-style long options:
    <p class="Pp"></p>
    <pre>
 % pp --gui --verbose --output=out.exe src.pl
    </pre>
  </dd>
</dl>
</div>
<div class="Bd-indent"></div>
<ul class="Bl-bullet">
  <li>Small initial overhead; no runtime overhead</li>
  <li>Dependencies are POD-stripped before packing</li>
  <li>Loads modules directly into memory on demand</li>
  <li>Shared libraries (DLLs) are extracted with File::Temp</li>
  <li>Works on Perl 5.6.0 or above</li>
  <li>Tested on Win32 (VC++ and MinGW), FreeBSD, NetBSD, Linux, MacOSX, Cygwin,
      AIX, Solaris, HP-UX, Tru64...</li>
</ul>
</section>
<section class="Ss">
<h2 class="Ss" id="Aggregating_multiple_programs"><a class="permalink" href="#Aggregating_multiple_programs">Aggregating
  multiple programs</a></h2>
<ul class="Bl-bullet">
  <li>A common question:
    <p class="Pp"></p>
    <pre>
 &gt; I have used pp to make several standalone applications which work
 &gt; great, the only problem is that for each executable that I make, I am
 &gt; assuming the parl.exe is somehow bundled into the resulting exe.
    </pre>
  </li>
  <li>The obvious workaround:
    <p class="Pp"></p>
    <pre>
 You can ship parl.exe by itself, along with .par files built
 by &quot;pp -p&quot;, and run those PAR files by associating them to parl.exe.
    </pre>
  </li>
  <li>On platforms that have <span class="Li">&quot;ln&quot;</span>, there is a
      better solution:
    <p class="Pp"></p>
    <pre>
 % pp --output=a.out a.pl b.pl  # two scripts in one!
 % ln a.out b.out               # symlink also works
 % ./a.out                      # runs a.pl
 % ./b.out                      # runs b.pl
    </pre>
  </li>
</ul>
</section>
<section class="Ss">
<h2 class="Ss" id="Cross-platform_Packages"><a class="permalink" href="#Cross-platform_Packages">Cross-platform
  Packages</a></h2>
<ul class="Bl-bullet">
  <li>Of course, there is no cross-platform binary format</li>
  <li>Pure-perl PAR packages are cross-platform by default</li>
</ul>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>However, XS modules are specific to Perl version and platform</li>
  <li>Multiple versions of a XS module can co-exist in a PAR file</li>
</ul>
</div>
<div class="Bd-indent"></div>
<ul class="Bl-bullet">
  <li>Suppose we need <span class="Li">&quot;out.par&quot;</span> on both Win32
      and Finix:
    <p class="Pp"></p>
    <pre>
 C:\&gt; pp --multiarch --output=out.par src.pl
 ...copy src.pl and out.par to a Finix machine...
 % pp --multiarch --output=out.par src.pl
    </pre>
  </li>
  <li>Now it works on both platforms:
    <p class="Pp"></p>
    <pre>
 % parl out.par                 # runs src.pl
 % perl -MPAR=out.par -e '...'  # uses modules inside out.par
    </pre>
  </li>
</ul>
</section>
<section class="Ss">
<h2 class="Ss" id="The_Anatomy_of_a_"><a class="permalink" href="#The_Anatomy_of_a_">The
  Anatomy of a PAR file</a></h2>
<ul class="Bl-bullet">
  <li>Modules can reside in several directories:
    <p class="Pp"></p>
    <pre>
 /                      # casual packaging only
 /lib/                  # standard location
 /arch/                 # for creating from blib/ 
 /i386-freebsd/         # i.e. $Config{archname}
 /5.8.0/                # i.e. Perl version number
 /5.8.0/i386-freebsd/   # combination of the two above
    </pre>
  </li>
  <li>Scripts are stored in one of the two locations:
    <p class="Pp"></p>
    <pre>
 /                      # casual packaging only
 /script/               # standard location
    </pre>
  </li>
  <li>Shared libraries may be architecture- or perl-version-specific:
    <p class="Pp"></p>
    <pre>
 /shlib/(5.8.0/)?(i386-freebsd/)?
    </pre>
  </li>
  <li>PAR files may recursively contain other PAR files:
    <p class="Pp"></p>
    <pre>
 /par/(5.8.0/)?(i386-freebsd/)?
    </pre>
  </li>
</ul>
</section>
<section class="Ss">
<h2 class="Ss" id="Special_files"><a class="permalink" href="#Special_files">Special
  files</a></h2>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>MANIFEST</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>Index of all files inside PAR</li>
  <li>Can be parsed with
    <span class="Li">&quot;ExtUtils::Manifest&quot;</span></li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>META.yml</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>Dependency, license, runtime options</li>
  <li>Can be parsed with <span class="Li">&quot;YAML&quot;</span></li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>SIGNATURE</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>OpenPGP-signed digital signature</li>
  <li>Can be parsed and verified with
      <span class="Li">&quot;Module::Signature&quot;</span></li>
</ul>
</div>
<div class="Bd-indent"></div>
</section>
<section class="Ss">
<h2 class="Ss" id="Advantages_over_perlcc,_PerlApp_and_Perl2exe"><a class="permalink" href="#Advantages_over_perlcc,_PerlApp_and_Perl2exe">Advantages
  over perlcc, PerlApp and Perl2exe</a></h2>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>This is not meant to be a flame</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>All three maintainers have contributed to PAR directly; I'm grateful</dd>
</dl>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>perlcc</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>&quot;The code generated in this way is not guaranteed to work... Use for
      production purposes is strongly discouraged.&quot; (from perldoc
    perlcc)</li>
  <li><i>Guaranteed to not work</i> is more like it</li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>PerlApp / Perl2exe</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>Expensive: Need to pay for each upgrade</li>
  <li>Non-portable: Only available for limited platforms</li>
  <li>Proprietary: Cannot extend its features or fix bugs</li>
  <li>Obfuscated: Vendor and black-hats can see your code, but you can't</li>
  <li>Inflexible: Does not work with existing Perl installations</li>
</ul>
</div>
<div class="Bd-indent"></div>
</section>
<section class="Ss">
<h2 class="Ss">MANIFEST: Best viewed with Mozilla</h2>
<ul class="Bl-bullet">
  <li>The URL of <span class="Li">&quot;MANIFEST&quot;</span> inside
      <span class="Li">&quot;/home/autrijus/foo.par&quot;</span>:
    <p class="Pp"></p>
    <pre>
 jar:file:///home/autrijus/foo.par!/MANIFEST
    </pre>
  </li>
  <li>Open it in a Gecko browser (e.g. Netscape 6+) with Javascript
    enabled:</li>
  <li>No needed to unzip anything; just click on files to view them</li>
</ul>
</section>
<section class="Ss">
<h2 class="Ss">META.yml: Metadata galore</h2>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Static, machine-readable distribution metadata</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Supported by <span class="Li">&quot;Module::Build&quot;</span>,
      <span class="Li">&quot;ExtUtils::MakeMaker&quot;</span>,
      <span class="Li">&quot;Module::Install&quot;</span></dd>
</dl>
</div>
<div class="Bd-indent"></div>
<ul class="Bl-bullet">
  <li>A typical <span class="Li">&quot;pp&quot;</span>-generated
      <span class="Li">&quot;META.yml&quot;</span> looks like this:
    <p class="Pp"></p>
    <pre>
 build_requires: {}
 conflicts: {}
 dist_name: out.par
 distribution_type: par
 dynamic_config: 0
 generated_by: 'Perl Packager version 0.03'
 license: unknown
 par:
   clean: 0
   signature: ''
   verbatim: 0
   version: 0.68
    </pre>
  </li>
  <li>The <span class="Li">&quot;par:&quot;</span> settings controls its runtime
      behavior</li>
</ul>
</section>
<section class="Ss">
<h2 class="Ss">SIGNATURE: Signing and verifying packages</h2>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>OpenPGP clear-signed manifest with SHA1 digests</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Supported by <span class="Li">&quot;Module::Signature&quot;</span>,
      <span class="Li">&quot;CPANPLUS&quot;</span> and
      <span class="Li">&quot;Module::Build&quot;</span></dd>
</dl>
</div>
<div class="Bd-indent"></div>
<ul class="Bl-bullet">
  <li>A typical <span class="Li">&quot;SIGNATURE&quot;</span> looks like this:
    <p class="Pp"></p>
    <pre>
 -----BEGIN PGP SIGNED MESSAGE-----
 Hash: SHA1

 SHA1 8a014cd6d0f6775552a01d1e6354a69eb6826046 AUTHORS
 ...
 -----BEGIN PGP SIGNATURE-----
 ...
 -----END PGP SIGNATURE-----
    </pre>
  </li>
  <li>Use <span class="Li">&quot;pp&quot;</span> and
      <span class="Li">&quot;cpansign&quot;</span> to work with signatures:
    <p class="Pp"></p>
    <pre>
 % pp -s -o foo.par bar.pl      # make and sign foo.par from bar.pl
 % cpansign -s foo.par  # sign this PAR file
 % cpansign -v foo.par  # verify this PAR file
    </pre>
  </li>
</ul>
</section>
<section class="Ss">
<h2 class="Ss" id="Perl_Servlets_with_Apache::PAR"><a class="permalink" href="#Perl_Servlets_with_Apache::PAR">Perl
  Servlets with Apache::PAR</a></h2>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Framework for self-contained Web applications</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>Similar to Java's &quot;Web Application Archive&quot; (WAR) files</li>
  <li>Works with mod_perl 1.x or 2.x</li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>A complete web application inside a
      <span class="Li">&quot;.par&quot;</span> file</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>Apache configuration, static files, Perl modules...</li>
  <li>Supports Static, Registry and PerlRun handlers</li>
  <li>Can also load all PARs under a directory</li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>One additional special file: <span class="Li">&quot;web.conf&quot;</span>
    <p class="Pp"></p>
    <pre>
 Alias /myapp/cgi-perl/ ##PARFILE##/
 &lt;Location /myapp/cgi-perl&gt;
     Options +ExecCGI
     SetHandler perl-script
     PerlHandler Apache::PAR::Registry
 &lt;/Location&gt;
    </pre>
  </dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="Hon_Dah,_A"><a class="permalink" href="#Hon_Dah,_A">Hon Dah,
  A-par-che!</a></h2>
<ul class="Bl-bullet">
  <li>First, make a <span class="Li">&quot;hondah.par&quot;</span> from an
      one-liner:
    <p class="Pp"></p>
    <pre>
 # use the &quot;web.conf&quot; from the previous slide
 % pp -p -o hondah.par -e 'print &quot;Hon Dah!\n&quot;' \
      --add web.conf
 % chmod a+x hondah.par
    </pre>
  </li>
  <li>Add this to <span class="Li">&quot;httpd.conf&quot;</span>, then restart
      apache:
    <p class="Pp"></p>
    <pre>
 &lt;IfDefine MODPERL2&gt;
 PerlModule Apache2
 &lt;/IfDefine&gt;
 PerlAddVar PARInclude /home/autrijus/hondah.par
 PerlModule Apache::PAR
    </pre>
  </li>
  <li>Test it out:
    <p class="Pp"></p>
    <pre>
 % GET http://localhost/myapp/cgi-perl/main.pl
 Hon Dah!
    </pre>
  </li>
  <li>Instant one-liner web application that works!</li>
</ul>
</section>
<section class="Ss">
<h2 class="Ss" id="On-demand_library_fetching"><a class="permalink" href="#On-demand_library_fetching">On-demand
  library fetching</a></h2>
<ul class="Bl-bullet">
  <li>With LWP installed, your can use remote PAR files:
    <p class="Pp"></p>
    <pre>
 use PAR;
 use lib 'http://aut.dyndns.org/par/DBI-latest.par';
 use DBI;    # always up to date!
    </pre>
  </li>
  <li>Modules are now cached under
    <span class="Li">$ENV{PAR_GLOBAL_TEMP}</span></li>
  <li>Auto-updates with
    <span class="Li">&quot;LWP::Simple::mirror&quot;</span></li>
</ul>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>Download only if modified</li>
  <li>Safe for offline use after the first time</li>
  <li>May use <span class="Li">&quot;SIGNATURE&quot;</span> to prevent
      DNS-spoofing</li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Makes large-scale deployment a breeze</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>Upgrades from a central location</li>
  <li>No installers needed</li>
</ul>
</div>
<div class="Bd-indent"></div>
</section>
<section class="Ss">
<h2 class="Ss" id="Code_Obfuscation"><a class="permalink" href="#Code_Obfuscation">Code
  Obfuscation</a></h2>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Also known as <i>source-hiding</i> techniques</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>It is <i>not</i> encryption</li>
  <li>Offered by PerlApp, Perl2Exe, Stunnix...</li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Usually easy to defeat</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>Take optree dump from memory, feed to
      <span class="Li">&quot;B::Deparse&quot;</span></li>
  <li>If you just want to stop a casual
      <span class="Li">&quot;grep&quot;</span>, &quot;deflate&quot; already
      works</li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>PAR now supports pluggable <i>input filters</i> with
      <span class="Li">&quot;pp -f&quot;</span></dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>Bundled examples: Bleach, PodStrip and PatchContent</li>
  <li>True encryption using <span class="Li">&quot;Crypt::*&quot;</span></li>
  <li>Or even _product activation_ over the internet</li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Alternatively, just keep core logic in your server and use RPC</dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="Accessing_packed_files"><a class="permalink" href="#Accessing_packed_files">Accessing
  packed files</a></h2>
<ul class="Bl-bullet">
  <li>To get the host archive from a packed program:
    <p class="Pp"></p>
    <pre>
 my $zip = PAR::par_handle($0); # an Archive::Zip object
 my $content = $zip-&gt;contents('MANIFEST');
    </pre>
  </li>
  <li>Same thing, but with <span class="Li">&quot;read_file()&quot;</span>:
    <p class="Pp"></p>
    <pre>
 my $content = PAR::read_file('MANIFEST');
    </pre>
  </li>
  <li>Loaded PAR files are stored in <span class="Li">%PAR::LibCache</span>:
    <p class="Pp"></p>
    <pre>
 use PAR '/home/mylibs/*.par';
 while (my ($filename, $zip) = each %PAR::LibCache) {
     print &quot;[$filename - MANIFEST]\n&quot;;
     print $zip-&gt;contents('MANIFEST');
 }
    </pre>
  </li>
</ul>
</section>
<section class="Ss">
<h2 class="Ss" id="Packing_"><a class="permalink" href="#Packing_">Packing GUI
  applications</a></h2>
<ul class="Bl-bullet">
  <li>GUI toolkits often need to link with shared libraries:
    <p class="Pp"></p>
    <pre>
 # search for libncurses under library paths and pack it
 % pp -l ncurses curses_app.pl  # same for Tk, Wx, Gtk, Qt...
    </pre>
  </li>
  <li>Use <span class="Li">&quot;pp --gui&quot;</span> on Win32 to eliminate the
      console window:
    <p class="Pp"></p>
    <pre>
 # pack 'src.pl' into a console-less 'out.exe' (Win32 only)
 % pp --gui -o out.exe src.pl
    </pre>
  </li>
  <li>&quot;Can't locate Foo/Widget/Bar.pm in
      <span class="Li">@INC</span>&quot;?</li>
</ul>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>Some toolkits (notably Tk) autoloads modules without
      <span class="Li">&quot;use&quot;</span> or
      <span class="Li">&quot;require&quot;</span></li>
  <li>Hence <span class="Li">&quot;pp&quot;</span> and
      <span class="Li">&quot;Module::ScanDeps&quot;</span> may fail to detect
      them</li>
  <li>Tk problems mostly fixed by now, but other toolkits may still break</li>
  <li>You can work around it with <span class="Li">&quot;pp -M&quot;</span> or
      an explicit <span class="Li">&quot;require&quot;</span></li>
  <li>Or better, send a short test-case to
      <span class="Li">&quot;par@perl.org&quot;</span> so we can fix it</li>
</ul>
</div>
<div class="Bd-indent"></div>
</section>
<section class="Ss">
<h2 class="Ss" id="Precompiled_"><a class="permalink" href="#Precompiled_">Precompiled
  CPAN distributions</a></h2>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Installing XS extensions from CPAN was difficult</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>Some platforms do not come with a compiler (Win32, MacOSX...)</li>
  <li>Some headers or libraries may be missing</li>
  <li>PAR.pm itself used to suffer from both problems</li>
</ul>
</div>
<div class="Bd-indent"></div>
<ul class="Bl-bullet">
  <li>...but not anymore -- <span class="Li">&quot;Module::Install&quot;</span>
      to the rescue!
    <p class="Pp"></p>
    <pre>
 # same old Makefile.PL, with a few changes
 use inc::Module::Install;      # was &quot;use ExtUtils::MakeMaker;&quot;
 WriteMakefile( ... );          # same as the original
 check_nmake();                 # make sure the user have nmake
 par_base('AUTRIJUS');          # your CPAN ID or a URL
 fetch_par() unless can_cc();   # use precompiled PAR only if necessary
    </pre>
  </li>
  <li>Users will not notice anything, except now it works</li>
</ul>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>Of course, you still need to type <span class="Li">&quot;make
      par&quot;</span> and upload the precompiled package</li>
  <li>PAR users can also install it directly with <span class="Li">&quot;parl
      -i&quot;</span></li>
</ul>
</div>
<div class="Bd-indent"></div>
</section>
<section class="Ss">
<h2 class="Ss" id="Platform-specific_Tips"><a class="permalink" href="#Platform-specific_Tips">Platform-specific
  Tips</a></h2>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Win32 and other icon-savvy platforms</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>Needs 3rd-party tools to add icons to
      <span class="Li">&quot;pp&quot;</span>-generated executables</li>
  <li>PE Header manipulation in Perl -- volunteers wanted!</li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Linux and other libc-based platforms</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>Try to avoid running <span class="Li">&quot;pp&quot;</span> on a
      bleeding-edge version of the OS</li>
  <li>Older versions with an earlier libc won't work with new ones</li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Solaris and other zlib-lacking platforms (but not Win32)</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>You need a static-linked
      <span class="Li">&quot;Compress::Zlib&quot;</span> before installing
    PAR</li>
  <li>In the future, PAR may depend on
      <span class="Li">&quot;Compress::Zlib::Static&quot;</span> instead</li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Any platform with limited bandwidth or disk space</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Use UPX to minimize the executable size</dd>
</dl>
</div>
<div class="Bd-indent"></div>
</section>
<section class="Ss">
<h2 class="Ss" id="Thank_you!"><a class="permalink" href="#Thank_you!">Thank
  you!</a></h2>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Additional resources</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>Mailing list: <span class="Li">&quot;par@perl.org&quot;</span></li>
  <li>Subscribe: Send a blank email to
      <span class="Li">&quot;par-subscribe@perl.org&quot;</span></li>
  <li>List archive: &lt;http://nntp.x.perl.org/group/perl.par&gt;</li>
  <li>PAR::Intro: &lt;http://search.cpan.org/dist/PAR/lib/PAR/Intro.pod&gt;</li>
  <li>Apache::PAR: &lt;http://search.cpan.org/dist/Apache-PAR/&gt;</li>
  <li>Module::Install: &lt;http://search.cpan.org/dist/Module-Install/&gt;</li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Any questions?</dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="Bonus_Slides:_"><a class="permalink" href="#Bonus_Slides:_">Bonus
  Slides: PAR Internals</a></h2>
</section>
<section class="Ss">
<h2 class="Ss" id="Overview_of_"><a class="permalink" href="#Overview_of_">Overview
  of PAR.pm's Implementation</a></h2>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Here begins the scary part</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>Grues, Dragons and Jabberwocks abound...</li>
  <li>You are going to learn weird things about Perl internals</li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>PAR invokes four areas of Perl arcana:</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li><span class="Li">@INC</span> code references</li>
  <li>On-the-fly source filtering</li>
  <li>Overriding <span class="Li">&quot;DynaLoader::bootstrap()&quot;</span> to
      handle XS modules</li>
  <li>Making self-bootstrapping binary executables</li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>The first two only works on 5.6 or later</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>DynaLoader and <span class="Li">%INC</span> are there since Perl 5 was
      born</li>
  <li>PAR currently needs 5.6, but a 5.005 port is possible</li>
</ul>
</div>
<div class="Bd-indent"></div>
</section>
<section class="Ss">
<h2 class="Ss" id="Code_References_in_@INC"><a class="permalink" href="#Code_References_in_@INC">Code
  References in @INC</a></h2>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>On 1999-07-19, Ken Fox submitted a patch to P5P</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>To _enable using remote modules_ by putting hooks in
      <span class="Li">@INC</span></li>
  <li>It's accepted to come in Perl 5.6, but undocumented until 5.8</li>
  <li>Type <span class="Li">&quot;perldoc -f require&quot;</span> to read the
      nitty-gritty details</li>
</ul>
</div>
<div class="Bd-indent"></div>
<ul class="Bl-bullet">
  <li>Coderefs in <span class="Li">@INC</span> may return a fh, or undef to
      'pass':
    <p class="Pp"></p>
    <pre>
 push @INC, sub {
     my ($coderef, $filename) = @_;  # $coderef is \&amp;my_sub
     open my $fh, &quot;wget ftp://example.com/$filename |&quot;;
     return $fh;        # using remote modules, indeed!
 };
    </pre>
  </li>
  <li>Perl 5.8 let you open a file handle to a string, so we just use that:
    <p class="Pp"></p>
    <pre>
        open my $fh, '&lt;', \($zip-&gt;memberNamed($filename)-&gt;contents);
        return $fh;
    </pre>
  </li>
  <li>But Perl 5.6 does not have that, and I don't want to use temp
    files...</li>
</ul>
</section>
<section class="Ss">
<h2 class="Ss" id="Source_Filtering_without_Filter::*_Modules"><a class="permalink" href="#Source_Filtering_without_Filter::*_Modules">Source
  Filtering without Filter::* Modules</a></h2>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>... Undocumented features to the rescue!</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>It turns out that <span class="Li">@INC</span> hooks can return <b>two</b>
      values</li>
  <li>The first is still the file handle</li>
  <li>The second is a code reference for line-by-line source filtering!</li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>This is how
      <span class="Li">&quot;Acme::use::strict::with::pride&quot;</span> works:
    <p class="Pp"></p>
    <pre>
 # Force all modules used to use strict and warnings
 open my $fh, &quot;&lt;&quot;, $filename or return;
 my @lines = (&quot;use strict; use warnings;\n&quot;, &quot;#line 1 \&quot;$full\&quot;\n&quot;);
 return ($fh, sub {
     return 0 unless @lines;    
     push @lines, $_; $_ = shift @lines; return length $_;
 });
    </pre>
  </dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="Source_Filtering_without_Filter::*_Modules_(cont.)"><a class="permalink" href="#Source_Filtering_without_Filter::*_Modules_(cont.)">Source
  Filtering without Filter::* Modules (cont.)</a></h2>
<ul class="Bl-bullet">
  <li>But we don't really have a filehandle for anything</li>
  <li>Another undocumented feature saves the day!</li>
  <li>We can actually omit the first return value altogether:
    <p class="Pp"></p>
    <pre>
 # Return all contents line-by-line from the file inside PAR
 my @lines = split(
     /(?&lt;=\n)/,
     $zip-&gt;memberNamed($filename)-&gt;contents
 );
 return (sub {
     $_ = shift(@lines);
     return length $_;
 });
    </pre>
  </li>
</ul>
</section>
<section class="Ss">
<h2 class="Ss" id="Overriding_DynaLoader::bootstrap"><a class="permalink" href="#Overriding_DynaLoader::bootstrap">Overriding
  DynaLoader::bootstrap</a></h2>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>XS modules have dynamically loaded libraries</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>They cannot be loaded as part of a zip file, so we extract them out</li>
  <li>Must intercept DynaLoader's library-finding process</li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Module names are passed to <span class="Li">&quot;bootstrap&quot;</span>
      for XS loading</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>During the process, it calls
      <span class="Li">&quot;dl_findfile&quot;</span> to locate the file</li>
  <li>So we install pre-hooks around both functions</li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Our <span class="Li">&quot;_bootstrap&quot;</span> just checks if the
      library is in PARs</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>If yes, extract it to a <span class="Li">&quot;File::Temp&quot;</span>
      temp file</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>The file will be automatically cleaned up when the program ends</dd>
</dl>
</div>
<div class="Bd-indent"></div>
<ul class="Bl-bullet">
  <li>It then pass the arguments to the original
      <span class="Li">&quot;bootstrap&quot;</span></li>
  <li>Finally, our <span class="Li">&quot;dl_findfile&quot;</span> intercepts
      known filenames and return it</li>
</ul>
</div>
<div class="Bd-indent"></div>
</section>
<section class="Ss">
<h2 class="Ss" id="Anatomy_of_a_Self-Contained_"><a class="permalink" href="#Anatomy_of_a_Self-Contained_">Anatomy
  of a Self-Contained PAR executable</a></h2>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>The par script ($0) itself</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>May be in plain-text or native executable format</dd>
</dl>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Any number of embedded files</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>Typically used to bootstrap PAR's various dependencies</li>
  <li>Each section begins with the magic string &quot;FILE&quot;</li>
  <li>Length of filename in pack('N') format and the filename (auto/.../)</li>
  <li>File length in pack('N') and the file's content (not compressed)</li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>One PAR file</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Just a regular zip file with the magic string
      <span class="Li">&quot;PK\003\004&quot;</span></dd>
</dl>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Ending section</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>A pack('N') number of the total length of FILE and PAR sections</li>
  <li>Finally, there must be a 8-bytes magic string:
      <span class="Li">&quot;\012PAR.pm\012&quot;</span></li>
</ul>
</div>
<div class="Bd-indent"></div>
</section>
<section class="Ss">
<h2 class="Ss" id="Self-Bootstrapping_Tricks"><a class="permalink" href="#Self-Bootstrapping_Tricks">Self-Bootstrapping
  Tricks</a></h2>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>All we can expect is a working perl interpreter</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>The self-contained script *must not* use any modules at all</li>
  <li>But to process PAR files, we need XS modules like Compress::Zlib</li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Answer: bundle all modules + libraries used by PAR.pm</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>That's what the <span class="Li">&quot;FILE&quot;</span> section in the
      previous slide is for</li>
  <li>Load modules to memory, and write object files to disk</li>
  <li>Then use a local <span class="Li">@INC</span> hook to load them on
    demand</li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Minimizing the amount of temporary files</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li>First, try to load PerlIO::scalar and File::Temp</li>
  <li>Set up an END hook to unlink all temp files up to this point</li>
  <li>Load other bundled files, and look in the compressed PAR section</li>
  <li>This can be much easier with a pure-perl
      <span class="Li">&quot;inflate()&quot;</span>; patches welcome!</li>
</ul>
</div>
<div class="Bd-indent"></div>
</section>
<section class="Ss">
<h2 class="Ss" id="Thank_you_(again)!"><a class="permalink" href="#Thank_you_(again)!">Thank
  you (again)!</a></h2>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Any questions, <i>please</i>?</dd>
</dl>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp">PAR, pp, par.pl, parl</p>
<p class="Pp">ex::lib::zip, Acme::use::strict::with::pride</p>
<p class="Pp">App::Packer, Apache::PAR, CPANPLUS, Module::Install</p>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHORS"><a class="permalink" href="#AUTHORS">AUTHORS</a></h1>
<p class="Pp">Audrey Tang &lt;cpan@audreyt.org&gt;</p>
<p class="Pp">You can write to the mailing list at &lt;par@perl.org&gt;, or send
    an empty mail to &lt;par-subscribe@perl.org&gt; to participate in the
    discussion.</p>
<p class="Pp">Please submit bug reports to &lt;bug-par@rt.cpan.org&gt;.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT"><a class="permalink" href="#COPYRIGHT">COPYRIGHT</a></h1>
<p class="Pp">Copyright 2003, 2004, 2005, 2006 by Audrey Tang
    &lt;cpan@audreyt.org&gt;.</p>
<p class="Pp">This document is free documentation; you can redistribute it
    and/or modify it under the same terms as Perl itself.</p>
<p class="Pp">See <i>LICENSE</i>.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2016-11-28</td>
    <td class="foot-os">perl v5.30.2</td>
  </tr>
</table>
</body>
</html>
