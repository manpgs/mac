<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.14 (Pod::Simple 3.42)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>Lexical::SealRequireHints(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Lexical::SealRequireHints(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">Lexical::SealRequireHints(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">Lexical::SealRequireHints - prevent leakage of lexical hints</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<pre>        use Lexical::SealRequireHints;
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">This module works around two historical bugs in Perl's handling of
    the <span class="Li">&quot;%^H&quot;</span> (lexical hints) variable. One
    bug causes lexical state in one file to leak into another that is
    <span class="Li">&quot;require&quot;</span>d/<span class="Li">&quot;use&quot;</span>d
    from it. This bug, [perl #68590], was present from Perl 5.6 up to Perl 5.10,
    fixed in Perl 5.11.0. The second bug causes lexical state (normally a blank
    <span class="Li">&quot;%^H&quot;</span> once the first bug is fixed) to leak
    outwards from <span class="Li">&quot;utf8.pm&quot;</span>, if it is
    automatically loaded during Unicode regular expression matching, into
    whatever source is compiling at the time of the regexp match. This bug,
    [perl #73174], was present from Perl 5.8.7 up to Perl 5.11.5, fixed in Perl
    5.12.0.</p>
<p class="Pp">Both of these bugs seriously damage the usability of any module
    relying on <span class="Li">&quot;%^H&quot;</span> for lexical scoping, on
    the affected Perl versions. It is in practice essential to work around these
    bugs when using such modules. On versions of Perl that require such a
    workaround, this module globally changes the behaviour of
    <span class="Li">&quot;require&quot;</span>, including
    <span class="Li">&quot;use&quot;</span> and the implicit
    <span class="Li">&quot;require&quot;</span> performed in Unicode regular
    expression matching, so that it no longer exhibits these bugs.</p>
<p class="Pp">The workaround supplied by this module takes effect the first time
    its <span class="Li">&quot;import&quot;</span> method is called. Typically
    this will be done by means of a <span class="Li">&quot;use&quot;</span>
    statement. This should be done as early as possible, because it only affects
    <span class="Li">&quot;require&quot;</span>/<span class="Li">&quot;use&quot;</span>
    statements that are compiled after the workaround goes into effect. For
    <span class="Li">&quot;use&quot;</span> statements, and
    <span class="Li">&quot;require&quot;</span> statements that are executed
    immediately and only once, it suffices to invoke the workaround when loading
    the first module that will set up vulnerable lexical state. Delayed-action
    <span class="Li">&quot;require&quot;</span> statements, however, are more
    troublesome, and can require the workaround to be loaded much earlier.
    Ultimately, an affected Perl program may need to load the workaround as very
    nearly its first action. Invoking this module multiple times, from multiple
    modules, is not a problem: the workaround is only applied once, and applies
    to everything subsequently compiled.</p>
<p class="Pp">This module is implemented in XS, with a pure Perl backup version
    for systems that can't handle XS modules. The XS version has a better chance
    of playing nicely with other modules that modify
    <span class="Li">&quot;require&quot;</span> handling. The pure Perl version
    can't work at all on some Perl versions; users of those versions must use
    the XS. On all Perl versions suffering the underlying hint leakage bug, pure
    Perl hooking of <span class="Li">&quot;require&quot;</span> breaks the use
    of <span class="Li">&quot;require&quot;</span> without an explicit parameter
    (implicitly using <span class="Li">$_</span>).</p>
</section>
<section class="Sh">
<h1 class="Sh" id="PERL_VERSION_DIFFERENCES"><a class="permalink" href="#PERL_VERSION_DIFFERENCES">PERL
  VERSION DIFFERENCES</a></h1>
<p class="Pp">The history of the <span class="Li">&quot;%^H&quot;</span> bugs is
    complex. Here is a chronological statement of the relevant changes.</p>
<dl class="Bl-tag">
  <dt id="Perl"><a class="permalink" href="#Perl">Perl 5.6.0</a></dt>
  <dd><span class="Li">&quot;%^H&quot;</span> introduced. It exists only as a
      hash at compile time. It is not localised by
      <span class="Li">&quot;require&quot;</span>, so lexical hints leak into
      every module loaded, which is bug [perl #68590].
    <p class="Pp">The <span class="Li">&quot;CORE::GLOBAL&quot;</span> mechanism
        doesn't work cleanly for <span class="Li">&quot;require&quot;</span>,
        because overriding <span class="Li">&quot;require&quot;</span> loses the
        necessary special parsing of bareword arguments to it. As a result, pure
        Perl code can't properly globally affect the behaviour of
        <span class="Li">&quot;require&quot;</span>. Pure Perl code can localise
        <span class="Li">&quot;%^H&quot;</span> itself for any particular
        <span class="Li">&quot;require&quot;</span> invocation, but a global fix
        is only possible through XS.</p>
  </dd>
  <dt id="Perl~2"><a class="permalink" href="#Perl~2">Perl 5.7.2</a></dt>
  <dd>The <span class="Li">&quot;CORE::GLOBAL&quot;</span> mechanism now works
      cleanly for <span class="Li">&quot;require&quot;</span>, so pure Perl code
      can globally affect the behaviour of
      <span class="Li">&quot;require&quot;</span> to achieve a global fix for
      the bug.</dd>
  <dt id="Perl~3"><a class="permalink" href="#Perl~3">Perl 5.8.7</a></dt>
  <dd>When <span class="Li">&quot;utf8.pm&quot;</span> is automatically loaded
      during Unicode regular expression matching,
      <span class="Li">&quot;%^H&quot;</span> now leaks outward from it into
      whatever source is compiling at the time of the regexp match, which is bug
      [perl #73174]. It often goes unnoticed, because [perl #68590] makes
      <span class="Li">&quot;%^H&quot;</span> leak into
      <span class="Li">&quot;utf8.pm&quot;</span> which then doesn't modify it,
      so what leaks out tends to be identical to what leaked in. If [perl
      #68590] is worked around, however, <span class="Li">&quot;%^H&quot;</span>
      tends to be (correctly) blank inside
      <span class="Li">&quot;utf8.pm&quot;</span>, and this bug therefore blanks
      it for the outer module.</dd>
  <dt id="Perl~4"><a class="permalink" href="#Perl~4">Perl 5.9.4</a></dt>
  <dd><span class="Li">&quot;%^H&quot;</span> now exists in two forms. In
      addition to the relatively ordinary hash that is modified during
      compilation, the value that it had at each point in compilation is
      recorded in the compiled op tree, for later examination at runtime. It is
      in a special representation-sharing format, and writes to
      <span class="Li">&quot;%^H&quot;</span> are meant to be performed on both
      forms. <span class="Li">&quot;require&quot;</span> does not localise the
      runtime form of <span class="Li">&quot;%^H&quot;</span> (and still doesn't
      localise the compile-time form).
    <p class="Pp">A couple of special <span class="Li">&quot;%^H&quot;</span>
        entries are erroneously written only to the runtime form.</p>
    <p class="Pp">Pure Perl code, although it can localise the compile-time
        <span class="Li">&quot;%^H&quot;</span> by normal means, can't
        adequately localise the runtime <span class="Li">&quot;%^H&quot;</span>,
        except by using a string eval stack frame. This makes a satisfactory
        global fix for the leakage bug impossible in pure Perl.</p>
  </dd>
  <dt id="Perl~5"><a class="permalink" href="#Perl~5">Perl 5.10.1</a></dt>
  <dd><span class="Li">&quot;require&quot;</span> now properly localises the
      runtime form of <span class="Li">&quot;%^H&quot;</span>, but still not the
      compile-time form.
    <p class="Pp">A global fix is once again possible in pure Perl, because the
        fix only needs to localise the compile-time form.</p>
  </dd>
  <dt id="Perl~6"><a class="permalink" href="#Perl~6">Perl 5.11.0</a></dt>
  <dd><span class="Li">&quot;require&quot;</span> now properly localises both
      forms of <span class="Li">&quot;%^H&quot;</span>, fixing [perl #68590].
      This makes [perl #73174] apparent without any workaround for [perl
      #68590].
    <p class="Pp">The special <span class="Li">&quot;%^H&quot;</span> entries
        are now correctly written to both forms of the hash.</p>
  </dd>
  <dt id="Perl~7"><a class="permalink" href="#Perl~7">Perl 5.12.0</a></dt>
  <dd>The automatic loading of <span class="Li">&quot;utf8.pm&quot;</span>
      during Unicode regular expression matching now properly restores
      <span class="Li">&quot;%^H&quot;</span>, fixing [perl #73174].</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="BUGS"><a class="permalink" href="#BUGS">BUGS</a></h1>
<p class="Pp">The operation of this module depends on influencing the
    compilation of <span class="Li">&quot;require&quot;</span>. As a result, it
    cannot prevent lexical state leakage through a
    <span class="Li">&quot;require&quot;</span> statement that was compiled
    before this module was invoked. Where problems occur, this module must be
    invoked earlier.</p>
<p class="Pp">On all Perl versions that need a fix for the lexical hint leakage
    bug, the pure Perl implementation of this module unavoidably breaks the use
    of <span class="Li">&quot;require&quot;</span> without an explicit parameter
    (implicitly using <span class="Li">$_</span>). This is due to another bug in
    the Perl core, fixed in Perl 5.15.5, and is inherent to the mechanism by
    which pure Perl code can hook <span class="Li">&quot;require&quot;</span>.
    The use of implicit <span class="Li">$_</span> with
    <span class="Li">&quot;require&quot;</span> is rare, so although this state
    of affairs is faulty it will actually work for most programs. Perl versions
    5.12.0 and greater, despite having the
    <span class="Li">&quot;require&quot;</span> hooking bug, don't actually
    exhibit a problem with the pure Perl version of this module, because with
    the lexical hint leakage bug fixed there is no need for this module to hook
    <span class="Li">&quot;require&quot;</span>.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp">perlpragma</p>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHOR"><a class="permalink" href="#AUTHOR">AUTHOR</a></h1>
<p class="Pp">Andrew Main (Zefram) &lt;zefram@fysh.org&gt;</p>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT"><a class="permalink" href="#COPYRIGHT">COPYRIGHT</a></h1>
<p class="Pp">Copyright (C) 2009, 2010, 2011, 2012, 2015, 2016, 2017 Andrew Main
    (Zefram) &lt;zefram@fysh.org&gt;</p>
</section>
<section class="Sh">
<h1 class="Sh" id="LICENSE"><a class="permalink" href="#LICENSE">LICENSE</a></h1>
<p class="Pp">This module is free software; you can redistribute it and/or
    modify it under the same terms as Perl itself.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2024-11-10</td>
    <td class="foot-os">perl v5.34.0</td>
  </tr>
</table>
</body>
</html>
